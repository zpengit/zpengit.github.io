<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>03-HTML、CSS</title>
    <url>/2020/06/11/03-HTML%E3%80%81CSS/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="03-HTML、CSS"><a href="#03-HTML、CSS" class="headerlink" title="03-HTML、CSS"></a>03-HTML、CSS</h1><h1 id="unit-03-HTML、CSS"><a href="#unit-03-HTML、CSS" class="headerlink" title="unit 03-HTML、CSS"></a>unit 03-HTML、CSS</h1><p>HTML: 用于开发网页的一门技术</p>
<p>CSS: 用于修饰、渲染网页的一门技术</p>
<p>HTML+CSS可以开发一个非常美观、非常漂亮的网页</p>
<p>开发网页 盖房子</p>
<p>HTML标签搭建网页的结构 砖块(搭建房子的结构)</p>
<p>CSS属性 石灰、油漆等涂料</p>
<h2 id="HTML概述"><a href="#HTML概述" class="headerlink" title="HTML概述"></a>HTML概述</h2><h3 id="HTML是什么"><a href="#HTML是什么" class="headerlink" title="HTML是什么"></a>HTML是什么</h3><p>HTML(Hyper Text Markup Language): 超文本标记语言</p>
<p>超文本: 超级文本、超过文本（其中可以包含除了文本以外的其他数据，例如图片、音频、视频等各种格式）</p>
<p>标记：也叫标签、元素、节点等，就是用尖括号(&lt;&gt;)括起来的一组内容，例如：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;head&gt; &lt;body&gt; &lt;div&gt; &lt;span&gt; &lt;table&gt;等</span><br></pre></td></tr></table></figure>

<p>HTML是最基础的开发网页的语言。</p>
<p>HTML由W3C组织提供(CSS/xml)</p>
<p>关于HTML的细节:</p>
<p>(1)使用HTML开发的网页文件通常以 .htm或.html 为后缀!</p>
<p>(2)使用HTML开发的网页文件由浏览器负责解析并显示（浏览器就是一个html解析器）</p>
<p>(3)HTML是文档的一种(txt/word/ppt/pdf等)</p>
<p>总结: HTML就是用于开发网页的一门语言!!</p>
<h3 id="HTML的结构"><a href="#HTML的结构" class="headerlink" title="HTML的结构"></a>HTML的结构</h3><p><strong>1、案例：编写我的第一个HTML网页，并用浏览器打开</strong></p>
<p>新建一个txt文档，将后缀名改为.html，代码实现如下：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">title</span>&gt;</span>网页的标题<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">		Hello CGB1808...</span><br><span class="line">	<span class="tag">&lt;/<span class="name">body</span>&gt;</span>		</span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>2、HTML结构详解</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">(1)&lt;!DOCTYPE HTML&gt; 文档声明, 用来声明HTML文档所遵循的HTML规范和版本</span><br><span class="line">	上面是html5.0的声明, 也是目前最常用的版本</span><br><span class="line">(2)&lt;head&gt;&lt;&#x2F;head&gt; 头部分, 用来存放HTML文档的基本属性信息, 比如网页的标题, 文档使用的编码等, 这部分信息会被浏览器优先加载.</span><br><span class="line">(3)&lt;body&gt;&lt;&#x2F;body&gt; 体部分, 用来存放网页可视化数据. 即真正的网页数据</span><br><span class="line">(4)&lt;title&gt;&lt;&#x2F;title&gt; 声明网页的标题</span><br><span class="line">(5)&lt;meta charset&#x3D;&quot;utf-8&quot;&#x2F;&gt; 用来通知浏览器使用哪一个编码来打开HTML文档, 这个编码一定要和文件保存时的编码保持一致, 才不会出现中文乱码问题.</span><br></pre></td></tr></table></figure>

<h3 id="HTML语法-了解"><a href="#HTML语法-了解" class="headerlink" title="HTML语法(了解)"></a>HTML语法(了解)</h3><p><strong>1、html标签</strong></p>
<p>标签：也叫做标记、元素等，标签分为开始标签，例如：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span>、<span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>和结束标签，例如:</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span>、<span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>开始标签和结束标签之间还可以包含其他内容。</p>
<p>有些标签开始标签和结束标签之间没有内容要包裹，通常可以写成自闭标签，例如：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span>/&gt;</span> <span class="tag">&lt;<span class="name">br</span>/&gt;</span> <span class="tag">&lt;<span class="name">hr</span>/&gt;</span> <span class="tag">&lt;<span class="name">input</span>/&gt;</span> <span class="tag">&lt;<span class="name">img</span>/&gt;</span>等</span><br></pre></td></tr></table></figure>

<p><strong>2、html属性</strong></p>
<p>在标签上可以声明属性(属性不能独立存在,必须声明在标签上)</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"d1"</span> <span class="attr">class</span>=<span class="string">"c1"</span> <span class="attr">style</span>=<span class="string">"color:red;"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>标签上可以声明多个属性，多个属性之间用空格分隔</p>
<p>标签上的属性的值可以使用单引号或者双引号引起来</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span> <span class="attr">id</span>=<span class="string">"m1"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">'UTF-8'</span> <span class="attr">id</span>=<span class="string">'m1'</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>3、html注释</strong></p>
<p>格式:</p>
<p>注释的作用: (1)为代码添加解释说明</p>
<p>(2)将一些暂时不需要执行的代码注释</p>
<p>浏览器对于注释中的内容不会解析，也不会显示！</p>
<p><strong>4、html空格和换行</strong></p>
<p>在浏览器中，多个连续的空白字符（空格、制表符tab、换行）会被浏览器显示为一个空格。那么：</p>
<p>如何在网页中做一个换行：可以使用 <code>&lt;br/&gt;</code> 标签做换行</p>
<p>如何在网页中做一个空格：可以使用<code>&amp;nbsp;</code>或<code>&amp;emsp;</code>做空格</p>
<p>补充: HTML中是不区分大小写的！</p>
<p>HTML中对语法要求非常不严格！（比如大小写混用，或者标签只有开始没有结束，或者标签的不合理嵌套），但是我们在书写HTML时要按照规范来写。</p>
<h2 id="HTML标签"><a href="#HTML标签" class="headerlink" title="HTML标签"></a>HTML标签</h2><h3 id="图像标签"><a href="#图像标签" class="headerlink" title="图像标签"></a>图像标签</h3><p>通过img标签可以在网页中插入一副图像</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"imgs/meinv.jpg"</span> <span class="attr">width</span>=<span class="string">"50%"</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>其中src属性用于指定图片的路径</p>
<p>width属性用于指定图片的宽度</p>
<p>height属性用于指定图片的高度</p>
<h3 id="超链接标签"><a href="#超链接标签" class="headerlink" title="超链接标签"></a>超链接标签</h3><p>超链接就是a标签，通过a标签可以在网页中创建指向另外一个文档的超链接</p>
<p>点击超链接可以跳转到另外一个网页(图片/下载路径等)，示例:</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 跳转到本地的一个网页 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"01-第一个网页.html"</span>&gt;</span>01-第一个网页.html<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 跳转到百度首页 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"http://www.baidu.com"</span>&gt;</span>百度一下，你就不知道<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 点击图片跳转到tmooc --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">target</span>=<span class="string">"_blank"</span> <span class="attr">href</span>=<span class="string">"http://www.tmooc.cn"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">alt</span>=<span class="string">"tmooc"</span> <span class="attr">src</span>=<span class="string">"imgs/tmooc.png"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>其中 href 属性用于指定点击超链接后将要跳转到的URL地址</p>
<p>target属性用于指定以何种方式打开超链接</p>
<p>_self：默认值, 表示在当前窗口中打开超链接</p>
<p>_blank：表示在新的窗口中打开超链接</p>
<h3 id="表格标签"><a href="#表格标签" class="headerlink" title="表格标签"></a>表格标签</h3><p><strong>1.案例：在网页中插入一个3*3的表格</strong></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>案例：在网页中插入一个3*3的表格<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">table</span>&gt;</span><span class="comment">&lt;!-- 用于在网页中定义一个表格 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span><span class="comment">&lt;!-- 用于定义一个表格行 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">th</span>&gt;</span>表头1<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">th</span>&gt;</span>表头2<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">th</span>&gt;</span>表头3<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>11<span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="comment">&lt;!-- 用于定义一个单元格 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>12<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>13<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>21<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>22<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>23<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>31<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>32<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>33<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>在浏览器中显示效果如下：</strong></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200315184602647-56f644c4d6a5453380cc0b619449fafc.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870627-a956036d89235e6014307d13cef6666d.png" alt="image-20200315184602647"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200315184602647-56f644c4d6a5453380cc0b619449fafc.png" target="_blank" rel="noopener">image-20200315184602647</a></p>
<p><strong>在head标签内添加如下内容：</strong></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="css">    <span class="comment">/* style标签内只能书写css注释和css代码 */</span></span></span><br><span class="line">    table&#123;</span><br><span class="line"><span class="css">        <span class="selector-tag">border</span>:*2<span class="selector-tag">px</span> <span class="selector-tag">solid</span> <span class="selector-tag">red</span>; <span class="comment">/* 为表格添加边框 */</span></span></span><br><span class="line"><span class="css">        <span class="selector-tag">border-collapse</span>: <span class="selector-tag">collapse</span>; <span class="comment">/* 设置边框合并 */</span></span></span><br><span class="line"><span class="css">        <span class="selector-tag">background-color</span>: <span class="selector-tag">pink</span>; <span class="comment">/* 为表格设置背景颜色 */</span></span></span><br><span class="line"><span class="css">        <span class="selector-tag">width</span>: 70%; <span class="comment">/* 为表格设置宽度 */</span></span></span><br><span class="line"><span class="css">        <span class="comment">/* margin-left: 15%; */</span></span></span><br><span class="line"><span class="css">        <span class="comment">/* 设置表格的左外边距和右外边距自适应(保证两者始终相等) */</span></span></span><br><span class="line">        margin-left: auto;</span><br><span class="line">        margin-right: auto;</span><br><span class="line">    &#125;</span><br><span class="line">    td,th&#123;</span><br><span class="line"><span class="css">        <span class="selector-tag">border</span><span class="selector-pseudo">:2px</span> <span class="selector-tag">solid</span> <span class="selector-tag">red</span>; <span class="comment">/* 为单元格添加边框 */</span></span></span><br><span class="line"><span class="css">        <span class="selector-tag">border-collapse</span>: *<span class="selector-tag">collapse</span>*; <span class="comment">/* 设置边框合并 */</span></span></span><br><span class="line"><span class="css">        <span class="selector-tag">padding</span>: 5<span class="selector-tag">px</span>; <span class="comment">/* 设置单元格边框和内容的距离(内边距) */</span></span></span><br><span class="line">    &#125;</span><br><span class="line">    h1&#123;</span><br><span class="line"><span class="css">        <span class="comment">/* border: 2px solid blue; */</span></span></span><br><span class="line"><span class="css">        <span class="selector-tag">text-align</span>: *<span class="selector-tag">center</span>*; <span class="comment">/* 设置元素中的内容水平居中 */</span></span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>再次刷新浏览器显示效果为：</strong></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/1ddd002a483c10386ecb086b0a9d3cc3-c7af9e76fe334c598f9d777f826169ab.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870627-4f659c2557925e136961ba35c3341aa1.png" alt="1ddd002a483c10386ecb086b0a9d3cc3"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/1ddd002a483c10386ecb086b0a9d3cc3-c7af9e76fe334c598f9d777f826169ab.png" target="_blank" rel="noopener">1ddd002a483c10386ecb086b0a9d3cc3</a></p>
<p><strong>2、表格标签介绍</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">table -- 用于在网页中定义一个表格</span><br><span class="line">tr -- 用于定义表格中的行</span><br><span class="line">td -- 用于定义表格中的单元格</span><br><span class="line">th -- 用于定义表头行中的单元格（th中的文本默认居中，并且加粗）</span><br></pre></td></tr></table></figure>

<p><strong>3、练习：使用表格标签在网页中生成一个表格，如下图：</strong></p>
<p>要求如下:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">(1) 表格内容如下图, 并设置表格边框</span><br><span class="line">(2) 设置单元格之间没有缝隙, 并设置单元格边框和内容之间的距离为5px</span><br><span class="line">(3) 设置表格的背景颜色为pink, 并设置表格的宽度为70%</span><br><span class="line">(4) 设置表格在网页中居中显示, 并为表格添加表头以及标题</span><br></pre></td></tr></table></figure>

<p><a href="https://www.zhangpeng.fun/upload/2020/06/9c1b6d984a6bbc1686b06afbe3f7c9eb-05e6d70d832642d3a5aa0225784bad7c.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870627-a948370ad97d12399466d67f2d67d4b1.png" alt="9c1b6d984a6bbc1686b06afbe3f7c9eb"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/9c1b6d984a6bbc1686b06afbe3f7c9eb-05e6d70d832642d3a5aa0225784bad7c.png" target="_blank" rel="noopener">9c1b6d984a6bbc1686b06afbe3f7c9eb</a></p>
<h3 id="表单标签"><a href="#表单标签" class="headerlink" title="表单标签"></a>表单标签</h3><p><strong>1、表单的作用: 用于向服务器提交数据</strong></p>
<p>向服务器提交数据的两种方式：</p>
<p><strong>(1)通过表单向服务器提交数据</strong></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/7ce4e5ec4aad8a37b48b07bf89e1fc81-438bd0e2bf4e439b8baac348419b99d4.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870627-36a01498e65b2a1899250fa618a220f6.png" alt="7ce4e5ec4aad8a37b48b07bf89e1fc81"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/7ce4e5ec4aad8a37b48b07bf89e1fc81-438bd0e2bf4e439b8baac348419b99d4.png" target="_blank" rel="noopener">7ce4e5ec4aad8a37b48b07bf89e1fc81</a></p>
<p>表单中可以包含表单项标签，在表单项中可以填写数据（比如用户名、密码等），填写完成后通过提交表单，可以将表单中的数据提交给相应的服务器。</p>
<p><strong>(2)通过超链接向服务器提交数据</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;www.baidu.com?username&#x3D;张三&amp;pwd&#x3D;123&amp;like&#x3D;篮球</span><br></pre></td></tr></table></figure>

<p>在地址栏URL地址的后面通过问号(?)可以拼接参数，参数可以有多个，多个参数之间用<code>&amp;</code>分隔，参数还分为参数名（例如：username/pwd/like）以及参数值(例如:张三/123/篮球)，在回车后访问百度服务器的同时，就可以将问号后面拼接的参数一并带给百度服务器。</p>
<p><strong>2、表单标签</strong></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"地址"</span> <span class="attr">method</span>=<span class="string">"提交方式"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>其中action属性用于**指定表单的提交地址，**例如，将action指向百度服务器，就意味着将来填写完表单后，提交表单将会把表单中的数据提交给百度服务器。</p>
<p>method=”GET/POST” 属性是用于<strong>指定表单的提交方式</strong>，常用的就是GET和POST提交。</p>
<h3 id="表单项标签"><a href="#表单项标签" class="headerlink" title="表单项标签"></a>表单项标签</h3><p>1、<code>input</code>元素：</p>
<p>(1)普通文本输入框(比如:用户名/昵称/邮箱/验证码等)</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"username"</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>(2)密码输入框(比如:密码/确认密码等)</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">name</span>=<span class="string">"pwd"</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>(3)单选框(比如:性别/部门等)</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"radio"</span> <span class="attr">name</span>=<span class="string">"gender"</span>/&gt;</span>男</span><br></pre></td></tr></table></figure>

<p>(4)复选框/多选框(比如:爱好/岗位等)</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">name</span>=<span class="string">"like"</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>(5)普通按钮(比如:换一张图片)</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"换一张"</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>普通按钮本身没有功能,但我们可以通过js为按钮添加功能或添加行为</p>
<p>(6)提交按钮(比如:提交/注册/登录)</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"提交/注册/登录"</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>提交按钮用于提交表单中的数据到服务器中!</p>
<p>2、<code>select、option</code>标签：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">name</span>=<span class="string">*</span>"<span class="attr">city</span>"*&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">"beijing"</span>&gt;</span>北京<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">"shanghai"</span>&gt;</span>上海<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">option</span> <span class="attr">selected</span>=<span class="string">"selected"</span>&gt;</span>广州<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">option</span>&gt;</span>深圳<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>select用于定义一个下拉选框</p>
<p>option用于定义下拉选框上的选项</p>
<p>selected设置当前option选项默认被选中</p>
<p>3、<code>textarea</code>多行文本输入区域：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">textarea</span> <span class="attr">name</span>=<span class="string">*</span>"<span class="attr">description</span>"* <span class="attr">cols</span>=<span class="string">*</span>"<span class="attr">30</span>"* <span class="attr">rows</span>=<span class="string">*</span>"<span class="attr">5</span>"*</span></span><br><span class="line"><span class="tag"><span class="attr">placeholder</span>=<span class="string">*</span>"请输入描述信息<span class="attr">...</span>"*&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>cols属性: 用于设置文本输入框的列数(宽度)</p>
<p>rows属性: 用于设置文本输入框的行数(高度)</p>
<p>placeholder属性: 设置输入框中的提示消息!</p>
<h3 id="表单细节问题"><a href="#表单细节问题" class="headerlink" title="表单细节问题"></a>表单细节问题</h3><p><strong>1、提交表单时，表单中的数据为什么没有被提交？</strong></p>
<p>对于表单中的表单项标签，只要是需要向服务器提交数据，该表单项上必须添加name属性；如果表单项标签上没有name属性，在表单提交时，该项将会别忽略。例如：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"username"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">name</span>=<span class="string">"pwd"</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>2、如何让多个单选框只能有一个被选中？</strong></p>
<p>要求多个单选框必须具有相同的name属性值，如果多个单选框name属性值相同，则说明是一个组的内容，一个组中的单选框只能选择其中的一个！</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">td</span>&gt;</span>性别:<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"radio"</span> <span class="attr">name</span>=<span class="string">"gender"</span>/&gt;</span>男</span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"radio"</span> <span class="attr">name</span>=<span class="string">"gender"</span>/&gt;</span>女</span><br><span class="line"><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>3、为什么单选框、复选框选择某一项后提交的值都是on?</strong></p>
<p>因为单选框、复选框只能选择，不同于用户名、密码输入框，可以输入内容。</p>
<p>因此我们需要通过value属性为单选框或复选框设置提交的值(如果不设置默认值都是on)，例如：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"radio"</span> <span class="attr">name</span>=<span class="string">"gender"</span> <span class="attr">value</span>=<span class="string">"male"</span>/&gt;</span>男</span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"radio"</span> <span class="attr">name</span>=<span class="string">"gender"</span> <span class="attr">value</span>=<span class="string">"female"</span>/&gt;</span>女</span><br></pre></td></tr></table></figure>

<p><strong>4、如何设置单选框或复选框默认选中某一项?</strong></p>
<p>可以在单选框或复选框标签上添加一个checked=”checked”属性，就可以让当前单选框或复选框默认被选中。例如：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"radio"</span> <span class="attr">checked</span>=<span class="string">"checked"</span> <span class="attr">name</span>=<span class="string">"gender"</span> <span class="attr">value</span>=<span class="string">"male"</span>/&gt;</span>男</span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"radio"</span> <span class="attr">name</span>=<span class="string">"gender"</span> <span class="attr">value</span>=<span class="string">"female"</span>/&gt;</span>女</span><br><span class="line"><span class="comment">&lt;!-- 爱好复选框/多选框 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">name</span>=<span class="string">"like"</span> <span class="attr">value</span>=<span class="string">"basketball"</span>/&gt;</span>篮球</span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">checked</span>=<span class="string">"checked"</span> <span class="attr">name</span>=<span class="string">"like"</span> <span class="attr">value</span>=<span class="string">"football"</span>/&gt;</span>足球</span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">name</span>=<span class="string">"like"</span> <span class="attr">value</span>=<span class="string">"volleyball"</span>/&gt;</span>排球</span><br></pre></td></tr></table></figure>

<p><strong>5、如何设置下拉选框默认选中某一项?</strong></p>
<p>在option标签上添加一个selected=”selected”属性，可以让当前option选项默认被选中，例：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">name</span>=<span class="string">*</span>"<span class="attr">city</span>"*&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">option</span>&gt;</span>北京<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">option</span>&gt;</span>上海<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">option</span> <span class="attr">selected</span>=<span class="string">"selected"</span>&gt;</span>广州<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">option</span>&gt;</span>深圳<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>6、下拉选框中option选项上的value属性的作用是什么？</strong></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">name</span>=<span class="string">"city"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">"beijing"</span>&gt;</span>北京<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">"shanghai"</span>&gt;</span>上海<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">option</span> <span class="attr">selected</span>=<span class="string">"selected"</span>&gt;</span>广州<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">option</span>&gt;</span>深圳<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>如果某一个选项被选中，并且该选项上添加了value属性，在提交表单时，将会提交value属性的值。</p>
<p>如果某一个选项被选中，该选项上没有添加value属性，在提交表单时，将会提交标签中的内容</p>
<h2 id="注册表单案例"><a href="#注册表单案例" class="headerlink" title="注册表单案例"></a>注册表单案例</h2><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Insert title here<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="css"><span class="comment">/* style标签内只能书写css注释和css代码 */</span></span></span><br><span class="line">table &#123;</span><br><span class="line"><span class="css">	<span class="selector-tag">border</span>: 2<span class="selector-tag">px</span> <span class="selector-tag">solid</span> <span class="selector-tag">red</span>; <span class="comment">/* 为表格添加边框 */</span></span></span><br><span class="line"><span class="css">	<span class="selector-tag">border-collapse</span>: <span class="selector-tag">collapse</span>; <span class="comment">/* 设置边框合并 */</span></span></span><br><span class="line"><span class="css">	<span class="selector-tag">background-color</span>: <span class="selector-tag">lightgrey</span>; <span class="comment">/* 为表格设置背景颜色 */</span></span></span><br><span class="line"><span class="css">	<span class="comment">/* margin-left: 15%; */</span></span></span><br><span class="line"><span class="css">	<span class="comment">/* 设置表格的左外边距和右外边距自适应(保证两者始终相等) */</span></span></span><br><span class="line">	margin-left: auto;</span><br><span class="line">	margin-right: auto;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">td, th &#123;</span><br><span class="line"><span class="css">	<span class="selector-tag">border</span>: 2<span class="selector-tag">px</span> <span class="selector-tag">solid</span> <span class="selector-tag">red</span>; <span class="comment">/* 为单元格添加边框 */</span></span></span><br><span class="line"><span class="css">	<span class="selector-tag">border-collapse</span>: <span class="selector-tag">collapse</span>; <span class="comment">/* 设置边框合并 */</span></span></span><br><span class="line"><span class="css">	<span class="selector-tag">padding</span>: 5<span class="selector-tag">px</span>; <span class="comment">/* 设置单元格边框和内容的距离(内边距) */</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">h1 &#123;</span><br><span class="line"><span class="css">	<span class="comment">/* border: 2px solid blue; */</span></span></span><br><span class="line"><span class="css">	<span class="selector-tag">text-align</span>: <span class="selector-tag">center</span>; <span class="comment">/* 设置元素中的内容水平居中 */</span></span></span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">h1</span>&gt;</span>欢迎注册<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"#"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">				<span class="comment">&lt;!-- 用户名输入框 --&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">td</span>&gt;</span>用户名:<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"username"</span> /&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">				<span class="comment">&lt;!-- 密码输入框 --&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">td</span>&gt;</span>密码:<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">name</span>=<span class="string">"pwd"</span> /&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">				<span class="comment">&lt;!-- 性别单选框 --&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">td</span>&gt;</span>性别:<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"radio"</span> <span class="attr">checked</span>=<span class="string">"checked"</span> <span class="attr">name</span>=<span class="string">"gender"</span></span></span><br><span class="line"><span class="tag">					<span class="attr">value</span>=<span class="string">"male"</span> /&gt;</span>男 <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"radio"</span> <span class="attr">name</span>=<span class="string">"gender"</span> <span class="attr">value</span>=<span class="string">"female"</span> /&gt;</span>女</span><br><span class="line">				<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">				<span class="comment">&lt;!-- 爱好复选框/多选框 --&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">td</span>&gt;</span>爱好:<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">name</span>=<span class="string">"like"</span> <span class="attr">value</span>=<span class="string">"basketball"</span> /&gt;</span>篮球</span><br><span class="line">					<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">checked</span>=<span class="string">"checked"</span> <span class="attr">name</span>=<span class="string">"like"</span></span></span><br><span class="line"><span class="tag">					<span class="attr">value</span>=<span class="string">"football"</span> /&gt;</span>足球 <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">name</span>=<span class="string">"like"</span></span></span><br><span class="line"><span class="tag">					<span class="attr">value</span>=<span class="string">"volleyball"</span> /&gt;</span>排球<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">				<span class="comment">&lt;!-- 城市下拉选框 --&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">td</span>&gt;</span>城市:<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">select</span> <span class="attr">name</span>=<span class="string">"city"</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">"beijing"</span>&gt;</span>北京<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">"shanghai"</span>&gt;</span>上海<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">option</span> <span class="attr">selected</span>=<span class="string">"selected"</span>&gt;</span>广州<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">option</span>&gt;</span>深圳<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;/<span class="name">select</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">				<span class="comment">&lt;!-- 自我描述 多行文本输入框 --&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">td</span>&gt;</span>自我描述:<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">textarea</span> <span class="attr">name</span>=<span class="string">"description"</span> <span class="attr">cols</span>=<span class="string">"30"</span> <span class="attr">rows</span>=<span class="string">"5"</span></span></span><br><span class="line"><span class="tag">						<span class="attr">placeholder</span>=<span class="string">"请输入描述信息..."</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">				<span class="comment">&lt;!-- 提交按钮 --&gt;</span></span><br><span class="line">				<span class="comment">&lt;!-- colspan: 设置单元格横跨的列数 --&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">td</span> <span class="attr">colspan</span>=<span class="string">"2"</span> <span class="attr">style</span>=<span class="string">"text-align: center;"</span>&gt;</span><span class="tag">&lt;<span class="name">input</span></span></span><br><span class="line"><span class="tag">					<span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"提交"</span> /&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="CSS概述"><a href="#CSS概述" class="headerlink" title="CSS概述"></a>CSS概述</h2><h3 id="什么是CSS？-了解"><a href="#什么是CSS？-了解" class="headerlink" title="什么是CSS？(了解)"></a>什么是CSS？(了解)</h3><p>CSS: 层叠样式表，用于修饰、渲染网页的一门技术</p>
<p>使用css样式修饰网页，可以实现将设置样式的css代码和展示数据的html代码进行分离，增强了网页的展示能力！</p>
<h3 id="在HTML中引入CSS"><a href="#在HTML中引入CSS" class="headerlink" title="在HTML中引入CSS"></a>在HTML中引入CSS</h3><p><strong>方式1：通过style属性引入css（不推荐）</strong></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">	1.通过标签上的style属性给div设置样式 </span></span><br><span class="line"><span class="comment">	边框:2px solid red </span></span><br><span class="line"><span class="comment">	字体大小:26px</span></span><br><span class="line"><span class="comment">	背景颜色为:pink</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"border:2px solid red;font-size:26px;background:pink;"</span>&gt;</span>这是一个div...<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>由于上面这种方式是将css属性代码，直接写在标签上的style属性内部，如果属性太多，容易造成页面结构的混乱，不利于后期的维护。</p>
<p>并且将样式代码写在标签上，样式代码只对当前标签生效，代码无法复用！</p>
<p>因此不推荐使用这种方式！（这种通过style属性添加的样式，叫做行内样式/内联样式）</p>
<p><strong>方式2：通过style标签引入css</strong></p>
<p>在head标签内部可以添加一个style标签，在style标签内部可以直接书写css样式</p>
<p>这种方式是将所有的css属性代码集中在一个style标签内部统一管理，这种方式不会造成页面结构的混乱，并且可以实现代码的复用！</p>
<p>代码示例 ：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 2.通过style标签给span设置样式如下： </span></span><br><span class="line"><span class="comment">	边框: 2px solid green</span></span><br><span class="line"><span class="comment">	字体大小: 30px</span></span><br><span class="line"><span class="comment">	字体加粗</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">"text/css"</span>&gt;</span></span><br><span class="line"><span class="css">	<span class="comment">/* ****** CSS样式 ****** */</span></span></span><br><span class="line"><span class="css">	<span class="selector-tag">span</span>&#123; <span class="comment">/* 为当前html中的所有span标签设置样式 */</span></span></span><br><span class="line"><span class="css">		<span class="selector-tag">border</span><span class="selector-pseudo">:2px</span> <span class="selector-tag">solid</span> <span class="selector-tag">green</span>;</span></span><br><span class="line"><span class="css">		<span class="selector-tag">font-size</span><span class="selector-pseudo">:30px</span>;</span></span><br><span class="line"><span class="css">		<span class="selector-tag">font-weight</span><span class="selector-pseudo">:bolder</span>; <span class="comment">/* bold/bolder */</span></span></span><br><span class="line">	&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>方式3：通过link链接引入外部的css文件</strong></p>
<p>在head标签内部，通过一个link标签可以引入外部的CSS文件</p>
<p>这种方式是将所有的css代码集中在一个单独的css文件中统一管理，真正的实现了将css代码和html代码的分离，实现了代码的复用。</p>
<p>代码示例：html中引入demo.css文件</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 3.通过link标签引入外部的css文件，为p元素设置样式如下： </span></span><br><span class="line"><span class="comment">	边框: 2px solid blue;</span></span><br><span class="line"><span class="comment">	字体颜色:red</span></span><br><span class="line"><span class="comment">	字体设置为华文琥珀</span></span><br><span class="line"><span class="comment">	设置首行文本缩进50px</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 引入demo.css文件(中的样式) --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span>  <span class="attr">href</span>=<span class="string">"demo.css"</span>  /&gt;</span></span><br></pre></td></tr></table></figure>

<p>demo.css文件</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="keyword">@charset</span> <span class="string">"UTF-8"</span>;</span><br><span class="line"><span class="selector-tag">p</span>&#123;</span><br><span class="line">	<span class="attribute">border</span>: <span class="number">2px</span> solid blue;</span><br><span class="line">	<span class="attribute">color</span>: red;</span><br><span class="line">	<span class="attribute">font-family</span>: 华文琥珀;</span><br><span class="line">	<span class="attribute">text-indent</span>: <span class="number">50px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="CSS选择器"><a href="#CSS选择器" class="headerlink" title="CSS选择器"></a>CSS选择器</h2><p>所谓的选择器就是能够在html中帮助我们选中元素进行修饰的一门技术。</p>
<h3 id="标签名选择器"><a href="#标签名选择器" class="headerlink" title="标签名选择器"></a>标签名选择器</h3><p>通过元素名称(或标签名称)选中指定名称的所有标签</p>
<p>格式: <strong>元素名/标签名{ css样式… }</strong></p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* ----- 1.标签名选择器练习 ----- </span></span><br><span class="line"><span class="comment">将所有span标签的背景颜色设置为#efbdef, 设置字体大小为22px，字体加粗；*/</span></span><br><span class="line"><span class="selector-tag">span</span>&#123; <span class="comment">/* 选中所有的span元素 */</span></span><br><span class="line">	<span class="attribute">background-color</span>:<span class="number">#efbdef</span>; </span><br><span class="line">	<span class="attribute">font-size</span>: <span class="number">22px</span>;</span><br><span class="line">	<span class="attribute">font-weight</span>: bolder;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="class选择器"><a href="#class选择器" class="headerlink" title="class选择器"></a>class选择器</h3><p>可以为元素添加一个通用的属性 – class，通过class属性为元素设置所属的组，class值相同的元素则为一组。通过class值可以选中这一组的元素，为元素添加样式。</p>
<p>格式：<strong>.class值{ css样式… }</strong></p>
<p>实例:</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* ----- 2.类选择器练习 ----- </span></span><br><span class="line"><span class="comment">(1)将所有的span（但是不包括div和p标签下的span）的背景颜色设置为#faf77b，边框改为2px solid cyan；</span></span><br><span class="line"><span class="comment">(2)将div下的span和内容为"span111"的span，背景颜色设置为#5eff1e、字体颜色设置</span></span><br><span class="line"><span class="comment">#ec0e7e；*/</span></span><br><span class="line"><span class="selector-class">.s1</span>&#123; <span class="comment">/* 选中所有class值为s1的元素 */</span></span><br><span class="line">	<span class="attribute">background</span>: <span class="number">#faf77b</span>;</span><br><span class="line">	<span class="attribute">border</span>: <span class="number">2px</span> solid cyan;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.s2</span>&#123; <span class="comment">/* 选中所有class值为s2的元素 */</span></span><br><span class="line">	<span class="attribute">background</span>: <span class="number">#5eff1e</span>;</span><br><span class="line">	<span class="attribute">color</span>: <span class="number">#ec0e7e</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>另外，一个元素也可以设置多个class值，多个class值中间用空格分隔，例如：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;span class&#x3D;&quot;s1 s2&quot; &gt;span111&lt;&#x2F;span&gt;</span><br></pre></td></tr></table></figure>

<p>表示当前元素同时属于多个分组，多个分组上设置的样式也会同时作用在当前元素上。</p>
<p>如果多个分组设置了相同的样式（但是值不一样），样式会发生冲突，写在后面的样式会覆盖前面的样式！</p>
<h3 id="id选择器"><a href="#id选择器" class="headerlink" title="id选择器"></a>id选择器</h3><p>通过标签上通用的属性id，可以为标签设置一个独一无二的编号（id值应该是唯一的），通过id值可以唯一的选中一个元素。</p>
<p>格式：<strong>#id值{ css样式 }</strong></p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* ----- 3.id选择器练习 -----</span></span><br><span class="line"><span class="comment">用id选择器将第一个p标签设置字体大小为24px，字体颜色为#a06649, 首行文本缩进20px。*/</span></span><br><span class="line"><span class="selector-id">#p1</span>&#123; <span class="comment">/* 选中id值为p1的元素 */</span></span><br><span class="line">	<span class="attribute">font-size</span>:<span class="number">24px</span>;</span><br><span class="line">	<span class="attribute">color</span>: <span class="number">#a06649</span>;</span><br><span class="line">	<span class="attribute">text-indent</span>: <span class="number">20px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="后代选择器"><a href="#后代选择器" class="headerlink" title="后代选择器"></a>后代选择器</h3><p>选中指定元素内部的指定后代元素</p>
<p>格式: <strong>祖先 后代{ css样式… }</strong></p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* ----- 4.后代选择器练习 ----- </span></span><br><span class="line"><span class="comment">为p元素内部的所有span元素，设置字体大小为18px,字体颜色为红色,背景颜色为pink;*/</span></span><br><span class="line"><span class="selector-tag">p</span> <span class="selector-tag">span</span>&#123; <span class="comment">/* 匹配所有p元素内部的所有span元素 */</span></span><br><span class="line">	<span class="attribute">font-size</span>:<span class="number">18px</span>;</span><br><span class="line">	<span class="attribute">color</span>: red;</span><br><span class="line">	<span class="attribute">background</span>: pink;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* p,span&#123;&#125; 匹配所有的p元素和所有的span元素 */</span></span><br></pre></td></tr></table></figure>

<h3 id="属性选择器"><a href="#属性选择器" class="headerlink" title="属性选择器"></a>属性选择器</h3><p>在选择器选中元素的基础上，根据元素的属性条件筛选/过滤元素</p>
<p>格式：<strong>选择器[属性条件]…{ css样式 }</strong></p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* ----- 5.属性选择器 ----- </span></span><br><span class="line"><span class="comment">为所有的文本输入框，设置背景颜色为#FF7CCC、字体大小22px，首行文本缩进15px；*/</span></span><br><span class="line"><span class="selector-tag">input</span><span class="selector-attr">[type=<span class="string">'text'</span>]</span>&#123; <span class="comment">/* 匹配所有的input并且type值为text的元素 */</span></span><br><span class="line">	<span class="attribute">background</span>: <span class="number">#FF7CCC</span>;</span><br><span class="line">	<span class="attribute">font-size</span>: <span class="number">22px</span>;</span><br><span class="line">	<span class="attribute">text-indent</span>: <span class="number">15px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">input</span><span class="selector-attr">[type=<span class="string">'text'</span>]</span><span class="selector-attr">[name=<span class="string">'email'</span>]</span>&#123; </span><br><span class="line">	<span class="comment">/* 选中所有的input并且type值为text、并且name为email的元素 */</span></span><br><span class="line">	<span class="attribute">background </span>: yellow;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="常用属性总结"><a href="#常用属性总结" class="headerlink" title="常用属性总结"></a>常用属性总结</h2><h3 id="文本属性"><a href="#文本属性" class="headerlink" title="文本属性"></a>文本属性</h3><p>1、<code>text-align</code>：设置元素中文本水平对齐方式，其常用取值为:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">left: 默认值。左对齐</span><br><span class="line">right: 右对齐</span><br><span class="line">center: 居中对齐</span><br><span class="line">justify: 两端对齐</span><br></pre></td></tr></table></figure>

<p>2、<code>text-decoration</code>：设置文本的下划线样式，其常用取值为:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">underline: 有下划线</span><br><span class="line">none: 没有下划线</span><br></pre></td></tr></table></figure>

<p>3、<code>text-indent</code>：设置文本首行缩进，单位: 像素/百分比</p>
<p>4、<code>letter-spacing</code>：设置字符间隔/间距，其常用取值为:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">normal</span><br><span class="line">像素值</span><br></pre></td></tr></table></figure>

<p>5、<code>text-shadow</code>：设置字体阴影，其取值为:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">像素值 像素值 像素值 颜色值</span><br><span class="line">第一个值为阴影水平位移，第二个值为阴影垂直位移，第三个值为阴影扩散值，第四个值为阴影颜色</span><br></pre></td></tr></table></figure>

<h3 id="字体属性"><a href="#字体属性" class="headerlink" title="字体属性"></a>字体属性</h3><p><code>font-size</code>：设置字体大小</p>
<p><code>font-weight</code>：设置字体粗细 bold、bolder、normal 100/200/300../900</p>
<p><code>font-family</code>：设置字体，比如微软雅黑、黑体、楷体等</p>
<p><code>color</code>：设置字体颜色</p>
<h3 id="背景属性"><a href="#背景属性" class="headerlink" title="背景属性"></a>背景属性</h3><p><code>background-color</code>：设置背景颜色</p>
<p><code>background-image</code>：设置背景图片，url(‘图片的路径’);</p>
<p><code>background-repeat</code>：设置或检索对象的背景图像是否及如何铺排，常用取值：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">repeat(默认值,重复排列)</span><br><span class="line">repeat-x(横向重复排列,但纵向不重复)</span><br><span class="line">repaet-y(纵向重复排列,但横向不重复)</span><br><span class="line">no-repeat(不重复)</span><br></pre></td></tr></table></figure>

<p><code>background-position</code>：设置或检索对象的背景图像位置</p>
<p><code>background</code>: 背景颜色 背景图片 背景图片是否重复 背景图片的位置</p>
<h3 id="边框（border）"><a href="#边框（border）" class="headerlink" title="边框（border）"></a>边框（border）</h3><p>border:2px solid red; – 设置元素的边框(可以同时设置边框的宽度、样式、颜色)</p>
<p>border属性可以拆分为如下设置:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">border-width: 2px; -- 设置元素边框的宽度</span><br><span class="line">border-style: solid; -- 设置元素边框的样式</span><br><span class="line">border-color: red; -- 设置元素边框的颜色</span><br></pre></td></tr></table></figure>

<p>其中border-width、border-style、border-color也可以按照上右下左方向进行拆分，以border-width为例：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">border-top-width: 2px; -- 设置上边框的宽度</span><br><span class="line">border-left-width: 2px; -- 设置左边框的宽度</span><br><span class="line">border-right-width: 2px; -- 设置右边框的宽度</span><br><span class="line">border-bottom-width: 2px; -- 设置下边框的宽度</span><br></pre></td></tr></table></figure>

<h3 id="其他属性"><a href="#其他属性" class="headerlink" title="其他属性"></a>其他属性</h3><p>width：设置元素的宽度</p>
<p>height：设置元素的高</p>
<h3 id="补充-颜色设置"><a href="#补充-颜色设置" class="headerlink" title="补充: 颜色设置"></a>补充: 颜色设置</h3><p>颜色取值方式常见的方式有三种:</p>
<p>方式一：设置颜色名，例如：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">red、green、blue、yellow、cyan、pink、white、black等</span><br></pre></td></tr></table></figure>

<p>方式二：设置#加上六位的十六进制数值</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#FF0000（red）、#00FF00（green）、#0000FF（blue）、#FFFF00（yellow）、#00FFFF（cyan）等</span><br></pre></td></tr></table></figure>

<p>方式三：设置rgb颜色值</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">rgb(255,0,0) 、rgb(0,255,0) 、rgb(0,0,255) 、rgb(255,255,0) 、rgb(0,255,255) 等</span><br><span class="line">（red） （green） （blue） （yellow） （cyan）</span><br></pre></td></tr></table></figure>

<h2 id="网页开发实战"><a href="#网页开发实战" class="headerlink" title="网页开发实战"></a>网页开发实战</h2><p>完成JT项目中的注册页面!(课下一定要自己独立完成!)</p>
<p>完成JT项目中的登录页面!(选作!)</p>
<h2 id="扩展内容"><a href="#扩展内容" class="headerlink" title="扩展内容"></a>扩展内容</h2><h3 id="display属性"><a href="#display属性" class="headerlink" title="display属性"></a>display属性</h3><p>display用来设置元素的类型，常用取值：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">block：块级元素的默认值</span><br><span class="line">    默认情况下独占一行</span><br><span class="line">    可以设置宽高</span><br><span class="line">inline：行内元素的默认值</span><br><span class="line">    默认情况下多个行内元素可以处在同一行</span><br><span class="line">    一般不能设置宽高</span><br><span class="line">inline-block：行内块元素</span><br><span class="line">    多个元素既可以显示在同一行, 也可以设置宽和高</span><br><span class="line">none：表示隐藏元素</span><br></pre></td></tr></table></figure>

<h3 id="元素类型-了解"><a href="#元素类型-了解" class="headerlink" title="元素类型(了解)"></a>元素类型(了解)</h3><p>div/span/p 都是一个容器标签，用于包裹其他内容（这些元素本身不具备太多的样式！）</p>
<p>p: 块级元素，默认独占一行，用于包裹一段文本（写文章时用于p标签包裹每一段内容）</p>
<p>div: 块级元素，默认独占一行，用于包裹其他内容，将样式设置在div上，就可以作用在div的内容上。</p>
<p>span：行内元素，默认可以和其他元素显示在同一行。</p>
<p><strong>(1)块级元素（block）</strong></p>
<p>默认情况下，块级元素独占一行</p>
<p>可以设置宽和高，如果设置了就是设置的宽和高</p>
<p>如果不设置宽和高，其中宽是默认填满父元素，而高是由内容决定(由内容支撑)</p>
<p>比如: div/p/h1~h6/form/table 等元素都是块级元素</p>
<p><strong>(2)行内元素（inline）</strong></p>
<p>默认情况下，多个行内元素可以处在同一行</p>
<p>不能设置宽和高</p>
<p>比如: span/input/img/i/b 等元素都是行内元素</p>
<p><strong>(3)行内块元素（inline-block）</strong></p>
<p>既具备行内元素的特征(可以同行显示)，还具备块级元素的特征(可以设置宽和高)</p>
<h1 id="html-javaweb-css"><a href="#html-javaweb-css" class="headerlink" title="html   javaweb   css"></a><a href="https://www.zhangpeng.fun/tags/html" target="_blank" rel="noopener">html</a>   <a href="https://www.zhangpeng.fun/tags/javaweb" target="_blank" rel="noopener">javaweb</a>   <a href="https://www.zhangpeng.fun/tags/css" target="_blank" rel="noopener">css</a></h1>]]></content>
      <categories>
        <category>JavaWeb</category>
      </categories>
      <tags>
        <tag>javaweb</tag>
        <tag>html</tag>
        <tag>css</tag>
      </tags>
  </entry>
  <entry>
    <title>01-MySQL</title>
    <url>/2020/06/11/01-MySQL/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="01-MySQL"><a href="#01-MySQL" class="headerlink" title="01-MySQL"></a>01-MySQL</h1><h1 id="unit-01-MySQL"><a href="#unit-01-MySQL" class="headerlink" title="unit 01-MySQL"></a>unit 01-MySQL</h1><h2 id="数据库概述"><a href="#数据库概述" class="headerlink" title="数据库概述"></a>数据库概述</h2><h3 id="什么是数据库？"><a href="#什么是数据库？" class="headerlink" title="什么是数据库？"></a>什么是数据库？</h3><p>所谓的数据库就是指存储和管理数据的仓库</p>
<p>扩展内容1：数据库有哪些分类？(了解)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">早期: 层次式数据库、网络型数据库</span><br><span class="line">现在：关系型数据库、非关系型数据库</span><br></pre></td></tr></table></figure>

<h3 id="什么是关系型数据库？"><a href="#什么是关系型数据库？" class="headerlink" title="什么是关系型数据库？"></a>什么是关系型数据库？</h3><p>底层以二维表的形式保存数据的库就是关系型数据库</p>
<p>stu-学生表</p>
<table>
<thead>
<tr>
<th>学生编号</th>
<th>姓名</th>
<th>年龄</th>
</tr>
</thead>
<tbody><tr>
<td>1001</td>
<td>刘沛霞</td>
<td>35</td>
</tr>
<tr>
<td>1002</td>
<td>陈子枢</td>
<td>18</td>
</tr>
</tbody></table>
<p><strong>扩展内容2：常见的关系型数据库有哪些？(了解)</strong></p>
<ul>
<li><p>Sql Server：微软提供，收费，适用于一些中型或大型的项目中，在java中的使用占比不高（.NET中使用的较多）</p>
</li>
<li><p>Oracle：甲骨文公司提供，收费，适用于一些大型或者超大型的项目中，在java中的使用占比非常高</p>
</li>
<li><p>mysql：瑞典MySQLAB公司提供，免费开源，适用于一些小型或者中型的项目中，在Java中的使用占比较高（小巧轻量）<br>mariadb其实就是MySQL的一个分支，用法和MySQL完全一样。</p>
</li>
<li><p>DB2：IBM公司提供，收费，在一些银行、金融等行业中使用较多。在java中的使用占比也不高。</p>
</li>
<li><p>Sqlite：迷你数据库，嵌入式设备中（安卓、苹果手机、pad）</p>
</li>
</ul>
<h3 id="数据库相关概念"><a href="#数据库相关概念" class="headerlink" title="数据库相关概念"></a>数据库相关概念</h3><p><strong>1、什么是数据库服务器</strong></p>
<p>数据库服务器就是一个软件（比如mysql软件）将数据库软件安装在电脑上，当前电脑就是一个数据库服务器。就可以对外提供存取数据的服务</p>
<p>在一个数据库服务器中可以创建多个数据库（dataBases），每一个数据库都是一个单独的仓库。</p>
<p><strong>2、什么是数据库</strong></p>
<p>数据库就是存储和管理数据的仓库，通常情况下，一个网站的中的所有数据会存放在一个数据库中。例如：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">jd.com 			db_jd(数据库)</span><br><span class="line">taobao.com 		db_taobao(数据库)</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p><strong>3、什么是表</strong></p>
<p>一个数据库中可以创建多张表，每张表用于存储一类信息（数据库），例如：</p>
<p>jd.com中的用户数据 tb_user(表)</p>
<p>jd.com中的商品数据 tb_product(表)</p>
<p>jd.com中的订单数据 tb_order(表)</p>
<p>…</p>
<p><strong>4、什么表记录</strong>·</p>
<p>一张表中可以包含多行表记录，每一行表记录用于存储某一个具体的数据</p>
<table>
<thead>
<tr>
<th>学生编号</th>
<th>姓名</th>
<th>年龄</th>
</tr>
</thead>
<tbody><tr>
<td>1001</td>
<td>刘沛霞</td>
<td>35</td>
</tr>
<tr>
<td>1002</td>
<td>陈子枢</td>
<td>18</td>
</tr>
<tr>
<td>。。。</td>
<td>。。。</td>
<td>。。。</td>
</tr>
</tbody></table>
<h3 id="什么是SQL语言？"><a href="#什么是SQL语言？" class="headerlink" title="什么是SQL语言？"></a>什么是SQL语言？</h3><p>SQL是一们用于操作关系型数据库的通用的语言（使用SQL可以操作所有的关系型数据库）</p>
<p>使用SQL可以操作数据库、表、表记录</p>
<p>(1)创建数据库、删除数据库、修改数据库、查询数据库</p>
<p>(2)创建表、删除表、修改表、查询表</p>
<p>(3)新增表记录、删除表记录、修改表记录、查询表记录</p>
<p>使用SQL也可以操作存储过程/视图/索引等。</p>
<p>提示：SQL是一个标准通用的操作关系型数据库的语言（普通话），每个数据库厂商为了增强自己数据库的功能，都提供了支持自己数据库的语言，称之为数据库的方言。方言不通用！</p>
<h2 id="连接mysql服务器"><a href="#连接mysql服务器" class="headerlink" title="连接mysql服务器"></a>连接mysql服务器</h2><p>通过命令行工具可以登录MySQL客户端，连接MySQL服务器，从而访问服务器中的数据。</p>
<p><strong>1、连接mysql服务器：</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql -uroot -p密码</span><br></pre></td></tr></table></figure>

<p>**-u：**后面的root是用户名，这里使用的是超级管理员root；</p>
<p>**-p：(小写的p)**后面的root是密码，这是在安装MySQL时就已经指定的密码；</p>
<p><strong>2、连接mysql服务器并指定IP和端口</strong>:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql -uroot -proot -h127.0.0.1 -P3306</span><br></pre></td></tr></table></figure>

<p>**-h：**后面给出的127.0.0.1是服务器主机名或ip地址，可以省略的，默认连接本机；</p>
<p>**-P：(大写的P)**后面的3306是连接端口，可以省略，默认连接3306端口；</p>
<p><strong>3、退出客户端命令：quit或exit或 \q</strong></p>
<p><strong>4、FAQ：常见问题:</strong></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/e23a06d3921d5d68c48d6e51024aae8a-35f7506e6016404484ce3a6c692889e0.jpg" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870476-ee84ca8ce5cd697e485384ddffce4133.jpg" alt="e23a06d3921d5d68c48d6e51024aae8a"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/e23a06d3921d5d68c48d6e51024aae8a-35f7506e6016404484ce3a6c692889e0.jpg" target="_blank" rel="noopener">e23a06d3921d5d68c48d6e51024aae8a</a></p>
<p>解决方法：复制mysql安装目录下的bin目录，将bin目录的路径添加到path环境变量中!!</p>
<p><strong>扩展内容3：</strong></p>
<p>(1)在cmd中连接mysql服务器之后，可以使用 #、/**/、– 等符号添加注释，例如:</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/7765164a8afaa8d26d9b31ff3356bc33-dd672006525e444e8d413dbc778e417e.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870476-481758b70bb48b22f4d86cb156627deb.png" alt="7765164a8afaa8d26d9b31ff3356bc33"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/7765164a8afaa8d26d9b31ff3356bc33-dd672006525e444e8d413dbc778e417e.png" target="_blank" rel="noopener">7765164a8afaa8d26d9b31ff3356bc33</a></p>
<p>(2)在cmd中连接mysql服务器之后，在书写SQL语句时，可以通过 \c 取消当前语句的执行。例如：</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/4c6edbd263d6c870ac745e34d4b207d0-c6e6f5d84f8f44828336ac49c86dd563.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870476-2504ee543331f7768c35a82a1dc39aeb.png" alt="4c6edbd263d6c870ac745e34d4b207d0"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/4c6edbd263d6c870ac745e34d4b207d0-c6e6f5d84f8f44828336ac49c86dd563.png" target="_blank" rel="noopener">4c6edbd263d6c870ac745e34d4b207d0</a></p>
<h2 id="数据库及表操作"><a href="#数据库及表操作" class="headerlink" title="数据库及表操作"></a>数据库及表操作</h2><h3 id="创建、删除、查看数据库"><a href="#创建、删除、查看数据库" class="headerlink" title="创建、删除、查看数据库"></a>创建、删除、查看数据库</h3><p>提示： (1)SQL语句对大小写不敏感。推荐关键字使用大写，自定义的名称（库名，表名，列名等）使用小写。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> <span class="keyword">DATABASES</span>; <span class="comment">-- 查看当前数据库服务器中的所有库</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> mydb1; <span class="comment">-- 创建mydb1库</span></span><br></pre></td></tr></table></figure>

<p>(2)并且在自定义名称时，针对多个单词不要使用驼峰命名，而是使用下划线连接。(例如：tab_name，而不是 tabName )</p>
<p>-- 01.查看mysql服务器中所有数据库</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">databases</span>;</span><br></pre></td></tr></table></figure>

<p>-- 02.进入某一数据库（进入数据库后，才能操作库中的表和表记录）</p>
<p>-- 语法：USE 库名;</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="keyword">test</span>;</span><br></pre></td></tr></table></figure>

<p>-- 查看已进入的库</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DATABASE</span>();</span><br></pre></td></tr></table></figure>

<p>-- 03.查看当前数据库中的所有表</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 先进入某一个库,再查看当前库中的所有表</span></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">tables</span>;</span><br></pre></td></tr></table></figure>

<p>-- 04.删除mydb1库</p>
<p>-- 语法：DROP DATABASE 库名;</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">database</span>  mydb1;</span><br></pre></td></tr></table></figure>

<p><code>-- 思考：当删除的库不存在时，如何避免错误产生?</code></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">database</span> <span class="keyword">if</span> <span class="keyword">exists</span> mydb1;</span><br></pre></td></tr></table></figure>

<p>-- 05.重新创建mydb1库，指定编码为utf8</p>
<p>-- 语法：CREATE DATABASE 库名 CHARSET 编码;</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 如果存在mydb1,则先删除,再重建</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">database</span> mydb1 <span class="keyword">charset</span> utf8;</span><br></pre></td></tr></table></figure>

<p>-- 如果不存在则创建mydb1;</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">database</span> mydb1 <span class="keyword">if</span> <span class="keyword">not</span> <span class="keyword">exists</span> <span class="keyword">charset</span> utf8;</span><br></pre></td></tr></table></figure>

<p>-- 06.查看建库时的语句（并验证数据库库使用的编码）</p>
<p>-- 语法：SHOW CREATE DATABASE 库名;</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">create</span> <span class="keyword">database</span> mydb1;</span><br></pre></td></tr></table></figure>

<h3 id="创建、删除、查看表"><a href="#创建、删除、查看表" class="headerlink" title="创建、删除、查看表"></a>创建、删除、查看表</h3><p>-- 07.进入mydb1库，删除stu学生表(如果存在)</p>
<p>-- 语法：DROP TABLE 表名;</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> mydb1</span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> stu;</span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> <span class="keyword">if</span> <span class="keyword">exists</span> stu;</span><br></pre></td></tr></table></figure>

<p>-- 08.创建stu学生表（编号[数值类型]、姓名、性别、出生年月、考试成绩[浮点型]），建表的语法：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> 表名(</span><br><span class="line">	列名 数据类型,</span><br><span class="line">	列名 数据类型,</span><br><span class="line">	...</span><br><span class="line">    列名 数据类型</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>SQL语句:</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> <span class="keyword">if</span> <span class="keyword">not</span> <span class="keyword">exists</span> stu(</span><br><span class="line">	<span class="keyword">id</span> <span class="built_in">int</span> primary <span class="keyword">key</span> auto_increment,</span><br><span class="line">	<span class="keyword">name</span> <span class="built_in">varchar</span>(<span class="number">20</span>),</span><br><span class="line">	genger <span class="built_in">varchar</span>(<span class="number">10</span>),</span><br><span class="line">	birthday <span class="built_in">date</span>,</span><br><span class="line">	score <span class="keyword">double</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>-- 09.查看stu学生表结构</p>
<p>-- 语法：desc 表名</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">create</span> <span class="keyword">table</span> stu;</span><br><span class="line">desc stu;</span><br></pre></td></tr></table></figure>

<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200316141717739-c97f1d3b3e4741bab5c1a1f5d2ef9298.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870476-9bb5065a49ff4a444848751bd3d41369.png" alt="image-20200316141717739"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200316141717739-c97f1d3b3e4741bab5c1a1f5d2ef9298.png" target="_blank" rel="noopener">image-20200316141717739</a></p>
<h2 id="新增、更新、删除表记录"><a href="#新增、更新、删除表记录" class="headerlink" title="新增、更新、删除表记录"></a>新增、更新、删除表记录</h2><p>-- 10.往学生表(stu)中插入记录(数据)</p>
<p>-- 语法：INSERT INTO 表名(列名1,列名2,列名3…) VALUES(值1,值2,值3…);</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 如果是在cmd中执行插入记录的语句,先 set names gbk; 再插入记录!</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> stu <span class="keyword">values</span>(<span class="literal">null</span>,<span class="string">'赵伟成'</span>,<span class="string">'女'</span>,<span class="string">'2018-3-9'</span>,<span class="number">33</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> stu <span class="keyword">values</span>(<span class="literal">null</span>,<span class="string">'张三'</span>,<span class="string">'男'</span>,<span class="string">'2018-3-9'</span>,<span class="number">11</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> stu <span class="keyword">values</span>(<span class="literal">null</span>,<span class="string">'卫程'</span>,<span class="string">'女'</span>,<span class="string">'2022-1-11'</span>,<span class="number">55</span>);</span><br></pre></td></tr></table></figure>

<p>提示：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">(1)当为所有列插入值时，可以省写列名，但值的个数和顺序必须和声明时列的个数和顺序保持一致！</span><br><span class="line">(2)SQL语句中的值为字符串或日期时，值的两边要加上单引号（有的版本的数据库双引号也可以，但推荐使用单引号）。</span><br><span class="line">(3)(针对cmd窗口)在插入数据之前，先设置编码：set names gbk;</span><br></pre></td></tr></table></figure>

<p>或者用一下命令连接mysql服务器：</p>
<p><code>mysql --default-character-set=gbk -uroot -proot</code></p>
<p>-- 11.查询stu表所有学生的信息</p>
<p>-- 语法：SELECT 列名 | * FROM 表名</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> stu;</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">id</span>,<span class="keyword">name</span> <span class="keyword">from</span> stu;</span><br></pre></td></tr></table></figure>

<p>-- 12.修改stu表中所有学生的成绩，加10分特长分</p>
<p>-- 修改语法: UPDATE 表名 SET 列=值,列=值,列=值…[WHERE子句];</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">update</span> stu <span class="keyword">set</span> score=score+<span class="number">10</span>;</span><br></pre></td></tr></table></figure>

<p>-- 13.修改stu表中编号为1的学生成绩，将成绩改为83分。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">update</span> stu <span class="keyword">set</span> score=<span class="number">83</span> <span class="keyword">where</span> <span class="keyword">id</span>=<span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<p>提示：where子句用于对记录进行筛选过滤，保留符合条件的记录，将不符合条件的记录剔除。</p>
<p>-- 14.删除stu表中所有的记录</p>
<p>-- 删除记录语法: DELETE FROM 表名 [where条件]</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> stu;</span><br></pre></td></tr></table></figure>

<p>-- 仅删除符合条件的</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> stu <span class="keyword">where</span> <span class="keyword">id</span>= <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<h2 id="查询表记录"><a href="#查询表记录" class="headerlink" title="查询表记录"></a>查询表记录</h2><p><strong>-- 准备数据： 以下练习将使用db10库中的表及表记录，请先进入db10数据库!!!</strong></p>
<h3 id="基础查询"><a href="#基础查询" class="headerlink" title="基础查询"></a>基础查询</h3><p>SELECT 语句用于从表中选取数据。结果被存储在一个结果表中（称为结果集）。</p>
<p>语法：SELECT 列名称 | * FROM 表名</p>
<p>提示：(1) *（星号）为通配符，表示查询所有列。</p>
<p>(2)但使用 *（星号）有时会把不必要的列也查出来了，并且效率不如直接指定列名</p>
<p>-- 15.查询emp表中的所有员工，显示姓名，薪资，奖金</p>
<p>-- 16.查询emp表中的所有部门和职位</p>
<p>思考：如果查询的结果中，存在大量重复的记录，如何剔除重复记录，只保留一条？ */</p>
<p>-- 在select之后、列名之前，使用DISTINCT 剔除重复的记录</p>
<h3 id="WHERE子句查询"><a href="#WHERE子句查询" class="headerlink" title="WHERE子句查询"></a>WHERE子句查询</h3><p>WHERE子句查询语法：SELECT 列名称 | * FROM 表名称 WHERE 列 运算符 值</p>
<p>WHERE子句后面跟的是条件，条件可以有多个，多个条件之间用连接词（or | and）进行连接</p>
<p>下面的运算符可在 WHERE 子句中使用：</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/7b2b5598fb3af3f96d552b5d9779d892-ee7b0e0a137d418e9d13c21e67559fb5.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870476-93982a04f225bdd4132be92856f64d9b.png" alt="7b2b5598fb3af3f96d552b5d9779d892"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/7b2b5598fb3af3f96d552b5d9779d892-ee7b0e0a137d418e9d13c21e67559fb5.png" target="_blank" rel="noopener">7b2b5598fb3af3f96d552b5d9779d892</a></p>
<p>-- 17.查询emp表中薪资大于3000的所有员工，显示员工姓名、薪资</p>
<p>-- 18.查询emp表中总薪资(薪资+奖金)大于3500的所有员工，显示员工姓名、总薪资</p>
<p>-- ifnull(列, 值)函数: 判断指定的列是否包含null值，如果有null值，用第二个值替换null值</p>
<p>-- 注意查看上面查询结果中的表头，如何将表头中的 sal+bonus 修改为 “总薪资”</p>
<p>-- 使用as可以为表头指定别名</p>
<p>-- 另外as可以省略</p>
<p>-- 19.查询emp表中薪资在3000和4500之间的员工，显示员工姓名和薪资</p>
<p>-- 提示: between…and… 在…之间</p>
<p>-- 20.查询emp表中薪资为 1400、1600、1800的员工，显示员工姓名和薪资</p>
<p>-- 或者</p>
<p>-- 21.查询薪资不为1400、1600、1800的员工</p>
<p>方式一:</p>
<p>方式二:</p>
<p>方式三:</p>
<p>-- 22.(自己完成) 查询emp表中薪资大于4000和薪资小于2000的员工，显示员工姓名、薪资。</p>
<p>-- 23.(自己完成) 查询emp表中薪资大于3000并且奖金小于600的员工，显示员工姓名、薪资、奖金。</p>
<p>-- 处理null值</p>
<p>-- 24.查询没有部门的员工（即部门列为null值）</p>
<p>-- 思考：如何查询有部门的员工（即部门列不为null值）</p>
<h3 id="模糊查询"><a href="#模糊查询" class="headerlink" title="模糊查询"></a>模糊查询</h3><p>LIKE 操作符用于在 WHERE 子句中搜索列中的指定模式。</p>
<p>可以和通配符（%、_）配合使用，其中”%”表示0或多个任意的字符。”_“表示一个任意的字符。</p>
<p>语法：SELECT 列 | * FROM 表名 WHERE 列名 LIKE 值</p>
<p>示例：</p>
<p>-- 25.查询emp表中姓名中包含”涛”字的员工，显示员工姓名。</p>
<p>-- 26.查询emp表中姓名中以”刘”字开头的员工，显示员工姓名。</p>
<p>-- 27.查询emp表中姓名以”刘”开头，并且姓名为两个字的员工，显示员工姓名。</p>
<h3 id="多行函数查询"><a href="#多行函数查询" class="headerlink" title="多行函数查询"></a>多行函数查询</h3><p>多行函数也叫做聚合(聚集)函数，根据某一列或所有列进行统计。</p>
<p>常见的多行函数有：</p>
<table>
<thead>
<tr>
<th>多行函数</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>COUNT( 列名</td>
<td>* )</td>
</tr>
<tr>
<td>MAX( 列名 )</td>
<td>统计结果集中某一列值中的最大值</td>
</tr>
<tr>
<td>MIN( 列名 )</td>
<td>统计结果集中某一列值中的最小值</td>
</tr>
<tr>
<td>SUM( 列名 )</td>
<td>统计结果集中某一列所有值的和</td>
</tr>
<tr>
<td>AVG( 列名 )</td>
<td>统计结果集中某一列值的平均值</td>
</tr>
</tbody></table>
<p>提示：(1)多行函数不能用在where子句中</p>
<p>(2)多行函数和是否分组有关，分组与否会直接影响多行函数执行的结果。</p>
<p>-- 28.统计emp表中薪资大于3000的员工个数</p>
<p>-- 29.求emp表中的最高薪资</p>
<p>-- 30.统计emp表中所有员工的薪资总和(不包含奖金)</p>
<p>-- 31.统计emp表员工的平均薪资(不包含奖金)</p>
<p><strong>多行函数需要注意的问题:</strong></p>
<ul>
<li><p>多行函数和是否分组有关，如果查询结果中的数据没有经过分组，默认整个查询结果是一个组，多行函数就会默认统计当前这一个组的数据。产生的结果只有一个。</p>
</li>
<li><p>如果查询结果中的数据经过分组（分的组不止一个），多行函数会根据分的组进行统计，有多少个组，就会统计出多少个结果。</p>
</li>
</ul>
<p>例如：统计CGB2002班的人数</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">count</span>(*) <span class="keyword">from</span> CGB2002;</span><br></pre></td></tr></table></figure>

<p>结果返回的就是CGB1912班的所有人数</p>
<p>再例如: 根据性别进行分组，再统计CGB1912每组的人数</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">count</span>(*) <span class="keyword">from</span> CGB1912 <span class="keyword">group</span> <span class="keyword">by</span> gender;</span><br></pre></td></tr></table></figure>

<h3 id="分组查询"><a href="#分组查询" class="headerlink" title="分组查询"></a>分组查询</h3><p>GROUP BY 语句根据一个或多个列对结果集进行分组。</p>
<p>在分组的列上我们可以使用 COUNT，SUM，AVG，MAX，MIN等函数。</p>
<p>语法：SELECT 列 | * FROM 表名 [WHERE子句] GROUP BY 列;</p>
<p>-- 32.对emp表按照部门对员工进行分组，查看分组后效果。</p>
<p>-- 33.对emp表按照职位进行分组，并统计每个职位的人数，显示职位和对应人数</p>
<p>-- 34.对emp表按照部门进行分组，求每个部门的最高薪资(不包含奖金)，显示部门名称和最高薪资</p>
<h3 id="排序查询"><a href="#排序查询" class="headerlink" title="排序查询"></a>排序查询</h3><p>使用 ORDER BY 子句将结果集中记录根据指定的列排序后再返回</p>
<p>语法：SELECT 列名 FROM 表名 <code>ORDER BY 列名 [ASC|DESC]</code></p>
<p>ASC(默认)升序，即从低到高；DESC 降序，即从高到低。</p>
<p>-- 35.对emp表中所有员工的薪资进行升序(从低到高)排序，显示员工姓名、薪资。</p>
<p>-- 36.对emp表中所有员工的奖金进行降序(从高到低)排序，显示员工姓名、奖金。</p>
<h3 id="分页查询"><a href="#分页查询" class="headerlink" title="分页查询"></a>分页查询</h3><p>在mysql中，通过limit进行分页查询：</p>
<p><code>limit (页码-1)*每页显示记录数, 每页显示记录数</code></p>
<p>-- 37.查询emp表中的所有记录，分页显示：每页显示3条记录，返回第 1 页。</p>
<p>-- 38.查询emp表中的所有记录，分页显示：每页显示3条记录，返回第 2 页。</p>
<p>-- 补充练习：求emp表中薪资最高的前3名员工的信息，显示姓名和薪资</p>
<h3 id="其他函数"><a href="#其他函数" class="headerlink" title="其他函数"></a>其他函数</h3><table>
<thead>
<tr>
<th>函数名</th>
<th>解释说明</th>
</tr>
</thead>
<tbody><tr>
<td>curdate()</td>
<td>获取当前日期，格式是：年月日</td>
</tr>
<tr>
<td>curtime()</td>
<td>获取当前时间 ，格式是：时分秒</td>
</tr>
<tr>
<td>sysdate()/now()</td>
<td>获取当前日期+时间，格式是：年月日 时分秒</td>
</tr>
<tr>
<td>year(date)</td>
<td>返回date中的年份</td>
</tr>
<tr>
<td>month(date)</td>
<td>返回date中的月份</td>
</tr>
<tr>
<td>day(date)</td>
<td>返回date中的天数</td>
</tr>
<tr>
<td>hour(date)</td>
<td>返回date中的小时</td>
</tr>
<tr>
<td>minute(date)</td>
<td>返回date中的分钟</td>
</tr>
<tr>
<td>second(date)</td>
<td>返回date中的秒</td>
</tr>
<tr>
<td>CONCAT(s1,s2..)</td>
<td>将s1,s2 等多个字符串合并为一个字符串</td>
</tr>
<tr>
<td>CONCAT_WS(x,s1,s2..)</td>
<td>同CONCAT(s1,s2,..)函数，但是每个字符串之间要加上x，x是分隔符</td>
</tr>
</tbody></table>
<p>-- 39.查询emp表中所有在1993和1995年之间出生的员工，显示姓名、出生日期。</p>
<p>-- 40.查询emp表中本月过生日的所有员工</p>
<p>-- 41.查询emp表中员工的姓名和薪资（薪资格式为: xxx(元) ）</p>
<p>-- 补充练习：查询emp表中员工的姓名和薪资（薪资格式为: xxx/元 ）</p>
<h2 id="mysql的数据类型"><a href="#mysql的数据类型" class="headerlink" title="mysql的数据类型"></a>mysql的数据类型</h2><h3 id="数值类型"><a href="#数值类型" class="headerlink" title="数值类型"></a>数值类型</h3><p>MySQL中支持多种整型，其实很大程度上是相同的，只是存储值的大小范围不同而已。</p>
<p><strong>tinyint</strong>：占用1个字节，相对于java中的byte</p>
<p><strong>smallint</strong>：占用2个字节，相对于java中的short</p>
<p><strong>int</strong>：占用4个字节，相对于java中的int</p>
<p><strong>bigint</strong>：占用8个字节，相对于java中的long</p>
<p>其次是浮点类型即：float和double类型</p>
<p><strong>float</strong>：4字节单精度浮点类型，相对于java中的float</p>
<p><strong>double</strong>：8字节双精度浮点类型，相对于java中的double</p>
<h3 id="字符串类型"><a href="#字符串类型" class="headerlink" title="字符串类型"></a>字符串类型</h3><p><strong>1、char(n)</strong> 定长字符串，最长255个字符。n表示字符数，例如：</p>
<p>-- 创建user表，指定用户名为char类型，字符长度不超过10</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> <span class="keyword">user</span>(</span><br><span class="line">    username <span class="built_in">char</span>(<span class="number">10</span>),</span><br><span class="line">    ...</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>所谓的定长，是当插入的值长度小于指定的长度时，剩余的空间会用空格填充。（这样会浪费空间）</p>
<p><strong>2、varchar(n)</strong> 变长字符串，最长不超过65535个字节，n表示字符数，一般超过255个字符，会使用text类型，例如：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">iso8859-1码表：一个字符占用1个字节，1*n &lt;&#x3D; 65535， n最多等于 65535</span><br><span class="line">utf8码表：一个中文汉字占用3个字节，3*n&lt;&#x3D;65535，n最多等于 65535&#x2F;3</span><br><span class="line">GBK码表：一个中文汉字占用2个字节，2*n&lt;65535，n最多等于 65535&#x2F;2</span><br></pre></td></tr></table></figure>

<p>-- 创建user表，指定用户名为varchar类型，长度不超过10</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> <span class="keyword">user</span>(</span><br><span class="line">	username <span class="built_in">varchar</span>(<span class="number">10</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>所谓的不定长，是当插入的值长度小于指定的长度时，剩余的空间可以留给别的数据使用。（节省空间）</p>
<p><strong>3、大文本（长文本）类型</strong></p>
<p>最长65535个字节，一般超过255个字符列的会使用text。</p>
<p>-- 创建user表：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> <span class="keyword">user</span>(</span><br><span class="line">	<span class="keyword">resume</span> <span class="built_in">text</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>另，text也分多种，其中bigtext存储数据的长度约为4GB。</p>
<p><strong>扩展内容3</strong>：(面试题)char(n)、varchar(n)、text都可以表示字符串类型，其区别在于：</p>
<p>(1)char(n)在保存数据时，如果存入的字符串长度小于指定的长度n，后面会用空格补全，因此可能会造成空间浪费，但是char类型的存储速度较varchar和text快。</p>
<p>因此char类型适合存储长度固定的数据，这样就不会有空间浪费，存储效率比后两者还快！</p>
<p>(2)varchar(n)保存数据时，按数据的真实长度存储，剩余的空间可以留给别的数据用，因此varchar不会浪费空间。</p>
<p>因此varchar适合存储长度不固定的数据，这样不会有空间的浪费。</p>
<p>(3)text是大文本类型，一般文本长度超过255个字符，就会使用text类型存储。</p>
<h3 id="日期类型"><a href="#日期类型" class="headerlink" title="日期类型"></a>日期类型</h3><p><strong>date</strong>：年月日</p>
<p><strong>time</strong>：时分秒</p>
<p><strong>datetime</strong>：年月日 时分秒</p>
<p><strong>timestamp</strong>：时间戳(实际存储的是一个时间毫秒值)，与datetime存储日期格式相同。两者的区别是:</p>
<ul>
<li><p>timestamp最大表示2038年，而datetime范围是1000~9999</p>
</li>
<li><p>timestamp在插入数据、修改数据时，可以自动更新成系统当前时间(后面用到时再做讲解)</p>
</li>
</ul>
<h2 id="mysql的字段约束"><a href="#mysql的字段约束" class="headerlink" title="mysql的字段约束"></a>mysql的字段约束</h2><p>字段约束/列约束 –&gt; 约束: 限制</p>
<h3 id="主键约束"><a href="#主键约束" class="headerlink" title="主键约束"></a>主键约束</h3><p>主键约束：如果为一个列添加了主键约束，那么这个列就是主键，主键的特点是唯一且不能为空。</p>
<p>主键的作用: 作为一个唯一标识，唯一的表示一条表记录（作用类似于人的身份证号，可以唯一的表示一个人一样。）</p>
<p>添加主键约束，例如将id设置为主键：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> stu(</span><br><span class="line">	<span class="keyword">id</span> <span class="built_in">int</span> primary <span class="keyword">key</span>,</span><br><span class="line">	...</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>如果主键是数值类型，为了方便插入主键（并且保证插入数据时，主键不会因为重复而报错），可以设置一个主键自增策略。</p>
<p>主键自增策略是指：设置了自增策略的主键，可以在插入记录时，不给id赋值，只需要设置一个null值，数据库会自动为id分配一个值（AUTO_INCREMENT变量，默认从1开始，后面依次+1），这样既可以保证id是唯一的，也省去了设置id的麻烦。</p>
<p>将id主键设置为自增：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> stu(</span><br><span class="line">	<span class="keyword">id</span> <span class="built_in">int</span> primary <span class="keyword">key</span> auto_increment,</span><br><span class="line">	...</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h3 id="非空约束"><a href="#非空约束" class="headerlink" title="非空约束"></a>非空约束</h3><p>非空约束：如果为一个列添加了非空约束，那么这个列的值就不能为空，但可以重复。</p>
<p>添加非空约束，例如为password添加非空约束：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> <span class="keyword">user</span>(</span><br><span class="line">	<span class="keyword">password</span> <span class="built_in">varchar</span>(<span class="number">50</span>) <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">	...</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h3 id="唯一约束"><a href="#唯一约束" class="headerlink" title="唯一约束"></a>唯一约束</h3><p>唯一约束：如果为一个列添加了唯一约束，那么这个列的值就必须是唯一的（即不能重复），但可以为空。</p>
<p>添加唯一约束，例如为username添加唯一约束及非空约束：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> <span class="keyword">user</span>(</span><br><span class="line">	username <span class="built_in">varchar</span>(<span class="number">50</span>) <span class="keyword">unique</span> <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">	...</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h3 id="外键约束"><a href="#外键约束" class="headerlink" title="外键约束"></a>外键约束</h3><p>外键其实就是用于通知数据库两张表数据之间对应关系的这样一个列。</p>
<p>这样数据库就会帮我们维护两张表中数据之间的关系。</p>
<p><strong>(1) 创建表的同时添加外键</strong></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> emp(</span><br><span class="line">	<span class="keyword">id</span> <span class="built_in">int</span>,</span><br><span class="line">	<span class="keyword">name</span> <span class="built_in">varchar</span>(<span class="number">50</span>),</span><br><span class="line">	dept_id <span class="built_in">int</span>,</span><br><span class="line">	<span class="keyword">foreign</span> <span class="keyword">key</span>(dept_id) <span class="keyword">references</span> dept(<span class="keyword">id</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p><a href="https://www.zhangpeng.fun/upload/2020/06/6b56c23ba5cf6a63d9f9e8a8b5fd8467-271e0d5e27f54321b94baf5f7f31dfef.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870476-20dc23b806e46cc1081e84b40fd06bc1.png" alt="6b56c23ba5cf6a63d9f9e8a8b5fd8467"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/6b56c23ba5cf6a63d9f9e8a8b5fd8467-271e0d5e27f54321b94baf5f7f31dfef.png" target="_blank" rel="noopener">6b56c23ba5cf6a63d9f9e8a8b5fd8467</a></p>
<p>（1）如果是要表示两张表的数据之间存在对应关系，只需要在其中的一张表中添加一个列，保存另外一张表的主键，就可以保存两张表数据之间的关系。</p>
<p>但是添加的这个列（dept_id）对于数据库来说就是一个普通列，数据不会知道两张表存在任何关系，因此数据库也不会帮我们维护这层关系。</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/27084a70275c2ea84221346785d9821b-a5f1d03e6ae240c6b4bed3e3ae5794a2.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870476-93b51e30f6193b683e84ef86df4cef39.png" alt="27084a70275c2ea84221346785d9821b"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/27084a70275c2ea84221346785d9821b-a5f1d03e6ae240c6b4bed3e3ae5794a2.png" target="_blank" rel="noopener">27084a70275c2ea84221346785d9821b</a></p>
<p>（2）如果将dept_id列设置为外键，等同于通知数据库，部门表和员工表之间存在对应关系，dept_id列中的数据要参考部门的主键，数据库一旦知道部门和员工表之间存在关系，就会帮我们维护这层关系型。</p>
<p>思考：如果在创建表时没有指定外键，那么后期该如何指定外键？以及如何删除外键？</p>
<h2 id="表关系"><a href="#表关系" class="headerlink" title="表关系"></a>表关系</h2><p><strong>常见的表关系分为以下三种：</strong></p>
<p>一对多(多对一)、一对一、多对多</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/1e4a36daf517c88d356cbc3c8dbd3ea8-7c190e0f34b549f99ed587340504d762.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870476-01ed46d089a5f834af52680958bf50b4.png" alt="1e4a36daf517c88d356cbc3c8dbd3ea8"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/1e4a36daf517c88d356cbc3c8dbd3ea8-7c190e0f34b549f99ed587340504d762.png" target="_blank" rel="noopener">1e4a36daf517c88d356cbc3c8dbd3ea8</a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/392ee4d4c0f8fdd86adc4b9abc3ad6f5-23598385334e47f3a04f48c02a9da2aa.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870476-1c67f3e326582d9e301106cacd68ed01.png" alt="392ee4d4c0f8fdd86adc4b9abc3ad6f5"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/392ee4d4c0f8fdd86adc4b9abc3ad6f5-23598385334e47f3a04f48c02a9da2aa.png" target="_blank" rel="noopener">392ee4d4c0f8fdd86adc4b9abc3ad6f5</a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/55f5505ecfd67ae14e8c81da6ad7fd55-046b0f3b71cd44ddb5bd5054fc53f580.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870476-1a0765095863bded7ac75e20d90c4997.png" alt="55f5505ecfd67ae14e8c81da6ad7fd55"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/55f5505ecfd67ae14e8c81da6ad7fd55-046b0f3b71cd44ddb5bd5054fc53f580.png" target="_blank" rel="noopener">55f5505ecfd67ae14e8c81da6ad7fd55</a></p>
<h2 id="多表查询"><a href="#多表查询" class="headerlink" title="多表查询"></a>多表查询</h2><p><strong>-- 准备数据： 以下练习将使用db30库中的表及表记录，请先进入db30数据库!!!</strong></p>
<h3 id="连接查询"><a href="#连接查询" class="headerlink" title="连接查询"></a>连接查询</h3><p>-- 42.查询部门和部门对应的员工信息</p>
<p>上面的查询中存在大量错误的数据，一般我们不会直接使用这种查询。</p>
<p>笛卡尔积查询：所谓笛卡尔积查询就是指，查询两张表，其中一张表有m条记录，另一张表有n条记录，查询的结果是m*n条。</p>
<p>虽然笛卡尔积查询中包含大量错误数据，但我们可以通过where子句将错误数据剔除，保留下来的就是正确数据。</p>
<p>通过where子句将笛卡尔积查询中的错误数据剔除,保留正确的数据,这就是连接查询!</p>
<p>上面的查询可以换成下面的查询：</p>
<h3 id="左外连接查询"><a href="#左外连接查询" class="headerlink" title="左外连接查询"></a>左外连接查询</h3><p>-- 43.查询_所有部门_和部门下的员工，如果部门下没有员工，员工显示为null</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/4b99494d167488239015cc857e68975c-0c6f238c39bb483b91c1a933f19d25e4.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870476-60497ef6238ad0548ac0f7fd67b91d74.png" alt="4b99494d167488239015cc857e68975c"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/4b99494d167488239015cc857e68975c-0c6f238c39bb483b91c1a933f19d25e4.png" target="_blank" rel="noopener">4b99494d167488239015cc857e68975c</a></p>
<p>左外连接查询：可以将左边表中的所有记录都查询出来，右边表只显示和左边相对应的数据，如果左边表中某些记录在右边没有对应的数据，右边显示为null即可。</p>
<h3 id="右外连接查询"><a href="#右外连接查询" class="headerlink" title="右外连接查询"></a>右外连接查询</h3><p>-- 44.查询部门和_所有员工_，如果员工没有所属部门，部门显示为null</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/790074e2ba156f1083de74b3efd1e2ba-4eb93a73b570411eb2aba35291f5be47.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870476-dda5751e01f7a87ae5e093a3f36e6c9a.png" alt="790074e2ba156f1083de74b3efd1e2ba"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/790074e2ba156f1083de74b3efd1e2ba-4eb93a73b570411eb2aba35291f5be47.png" target="_blank" rel="noopener">790074e2ba156f1083de74b3efd1e2ba</a></p>
<p>右外连接查询：可以将右边表中的所有记录都查询出来，左边表只显示和右边相对应的数据，如果右边表中某些记录在左边没有对应的数据，可以显示为null。</p>
<p>扩展：如果想将两张表中的所有数据都查询出来(左外+右外并去除重复记录)，可以使用全外连接查询，但是mysql又不支持全外连接查询。</p>
<p>可以使用union将左外连接查询的结果和右外连接查询的结果合并在一起，并去除重复的记录。例如：</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/d0c3a3d4ad4f48d4779d1d40cac31755-485221e4f0c2456caf9e7e4d287c37fe.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870476-dce7e946438a0f909e43777a0977c050.png" alt="d0c3a3d4ad4f48d4779d1d40cac31755"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/d0c3a3d4ad4f48d4779d1d40cac31755-485221e4f0c2456caf9e7e4d287c37fe.png" target="_blank" rel="noopener">d0c3a3d4ad4f48d4779d1d40cac31755</a></p>
<p>需要注意的是：union可以将两条SQL语句执行的结果合并有前提:</p>
<p>(1)两条SQL语句查询的结果列数必须一致</p>
<p>(2)两条SQL语句查询的结果列名、顺序也必须一致</p>
<p>并且union默认就会将两个查询中重复的记录去除(如果不希望去除重复记录，可以使用union all)</p>
<h3 id="子查询练习"><a href="#子查询练习" class="headerlink" title="子查询练习"></a>子查询练习</h3><p><strong>-- 准备数据：以下练习将使用db40库中的表及表记录，请先进入db40数据库!!!</strong></p>
<p>-- 45.列出薪资比’王海涛’的薪资高的所有员工，显示姓名、薪资</p>
<p>-- 46.列出与’刘沛霞’从事相同职位的所有员工，显示姓名、职位。</p>
<p>-- 47.列出薪资比’大数据部’部门(已知部门编号为30)所有员工薪资都高的员工信息，显示员工姓名、薪资和部门名称。</p>
<p>如果不考虑没有部门的员工</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 1、连接查询员工和部门</span></span><br><span class="line"><span class="comment">-- 2、求出大数据部门的最高薪资(查询员工表中部门编号为30的最高薪资)</span></span><br><span class="line"><span class="comment">-- 3、求出比大数据部门最高薪资还高的员工信息</span></span><br></pre></td></tr></table></figure>

<p>如果加上没有部门的员工</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 1、用左外连接查询所有员工和对应的部门</span></span><br><span class="line"><span class="comment">-- 2、求出大数据部门的最高薪资</span></span><br><span class="line"><span class="comment">-- 3、求出比大数据部门最高薪资还高的员工信息</span></span><br></pre></td></tr></table></figure>

<h3 id="多表查询练习"><a href="#多表查询练习" class="headerlink" title="多表查询练习"></a>多表查询练习</h3><p>-- 48.列出在’培优部’任职的员工，假定不知道’培优部’的部门编号，显示部门名称，员工名称。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 关联查询两张表</span></span><br><span class="line"><span class="comment">-- 求出在培优部的员工</span></span><br></pre></td></tr></table></figure>

<p>-- 49.(自查询)列出所有员工及其直接上级，显示员工姓名、上级编号，上级姓名</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* emp e1 员工表, emp e2 上级表 (一张表起两个别名,可以当作两张表来查)</span></span><br><span class="line"><span class="comment"> * 查询的列: e1.name, e2.id, e2.name</span></span><br><span class="line"><span class="comment"> * 查询的表: emp e1, emp e2</span></span><br><span class="line"><span class="comment"> * 连接条件: e1.topid=e2.id</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure>

<p>-- 50.列出最低薪资大于1500的各种职位，显示职位和该职位最低薪资</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 根据职位进行分组，求出每种职位的最低薪资</span></span><br><span class="line"><span class="comment">-- 求出最低薪资大于1500的职位</span></span><br></pre></td></tr></table></figure>

<p><strong>补充内容：where和having子句的区别:</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">(1)相同点: where和having都可以对记录进行筛选过滤。</span><br><span class="line">(2)区别：where是在分组之前,对记录进行筛选过滤,并且where子句中不能使用多行函数以及列别名(但是可以使用表别名)</span><br><span class="line">(3)区别：having是在分组之后,对记录进行筛选过滤,并且having子句中可以使用多行函数以及列别名、表别名。</span><br></pre></td></tr></table></figure>

<p>-- 51.列出在每个部门就职的员工数量、平均工资。显示部门编号、员工数量，平均薪资。</p>
<p>-- 52.查出至少有一个员工的部门，显示部门编号、部门名称、部门位置、部门人数。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 连接查询部门表和员工表</span></span><br><span class="line"><span class="comment">-- 按照部门进行分组,统计部门人数</span></span><br></pre></td></tr></table></figure>

<p>-- 53.列出受雇日期早于直接上级的所有员工的编号、姓名、部门名称。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* emp e1 表示员工表  emp e2 表示上级表  dept d 部门表</span></span><br><span class="line"><span class="comment"> * 显示的列: e1.id, e1.name, d.name</span></span><br><span class="line"><span class="comment"> * 查询的表: emp e1, emp e2, dept d</span></span><br><span class="line"><span class="comment"> * 连接条件: e1.topid=e2.id  e1.dept_id=d.id</span></span><br><span class="line"><span class="comment"> * 筛选条件: e1.hdate&lt;e2.hdate</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure>

<h2 id="数据库备份与恢复"><a href="#数据库备份与恢复" class="headerlink" title="数据库备份与恢复"></a>数据库备份与恢复</h2><h3 id="备份数据库"><a href="#备份数据库" class="headerlink" title="备份数据库"></a>备份数据库</h3><p>在cmd窗口中(未登录的状态下)，可以通过如下命令对指定的数据库进行备份：</p>
<p><code>mysqldump -u用户名 -p 数据库的名字 &gt; 备份文件的位置</code></p>
<p>示例1: 对db40库中的数据(表，表记录)进行备份，备份到 d:/db40.sql文件中</p>
<p><code>mysqldump -uroot -p db40 &gt; d:/db40.sql</code></p>
<p>键入密码，如果没有提示，即表示备份成功！</p>
<p>也可以一次性备份所有库，例如：</p>
<p>对mysql服务器中所有的数据库进行备份，备份到 d:/all.sql文件中</p>
<p><code>mysqldump -uroot -p --all-database &gt; d:/all.sql</code></p>
<p>键入密码，如果没有提示错误(警告信息不是错误，可以忽略)，即表示备份成功！</p>
<h3 id="恢复数据库"><a href="#恢复数据库" class="headerlink" title="恢复数据库"></a>恢复数据库</h3><p><strong>1、恢复数据库方式一：</strong></p>
<p>在cmd窗口中(未登录的状态下)，可以通过如下命令对指定的数据库进行恢复：</p>
<p><code>mysql -u用户名 -p 数据库的名字 &lt; 备份文件的位置</code></p>
<p>示例：将d:/db40.sql文件中的数据恢复到db60库中</p>
<p>-- 在cmd窗口中（已登录的状态下），先创建db60库：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">database</span> db60 <span class="keyword">charset</span> utf8;</span><br></pre></td></tr></table></figure>

<p>-- 在cmd窗口中（未登录的状态下）</p>
<p><code>mysql -uroot -p db60 &lt; d:/db40.sql</code></p>
<p><strong>2、恢复数据库方式二：</strong></p>
<p>在cmd窗口中(已登录的状态下)，可以通过source执行指定位置的SQL文件：</p>
<p><code>source sql文件的位置</code></p>
<p>示例：将d:/db40.sql文件中的数据恢复到db80库中</p>
<p>-- 在cmd窗口中（已登录的状态下），先创建db80库，进入db80库：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">database</span> db80 <span class="keyword">charset</span> utf8;</span><br><span class="line"><span class="keyword">use</span> db80;</span><br></pre></td></tr></table></figure>

<p>-- 再通过source执行指定位置下的sql文件：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">source d:/db40.sql</span><br></pre></td></tr></table></figure>

<h2 id="Navicat软件的使用"><a href="#Navicat软件的使用" class="headerlink" title="Navicat软件的使用"></a>Navicat软件的使用</h2><p>Navicat Premium是一套带图形用户界面的数据库管理工具，让你从单一应用程序中同时连接MySQL、MariaDB、MongoDB、SQL Server、Oracle、PostgreSQL 和 SQLite数据库。使用Navicat可以快速、轻松地创建、管理和维护数据库。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1、使用navicat连接mysql服务器（使用cmd连接mysql服务器）</span><br><span class="line">2、查看所有库、进入数据库、创建数据库、删除数据库、修改数据库</span><br><span class="line">3、创建表、查看表、修改表、删除表</span><br><span class="line">4、新增表记录、查询表记录、修改表记录、删除表记录</span><br><span class="line">5、使用navicat书写SQL语句操作数据库、表和表记录</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h2 id="扩展内容"><a href="#扩展内容" class="headerlink" title="扩展内容"></a>扩展内容</h2><p>现创建学生表：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">use test; -- 进入test库</span><br><span class="line">drop table if exists stu; -- 删除学生表(如果存在)</span><br><span class="line">create table stu( -- 创建学生表</span><br><span class="line">    id int, -- 学生id</span><br><span class="line">    name varchar(20), -- 学生姓名</span><br><span class="line">    gender char(1), -- 学生性别</span><br><span class="line">    birthday date -- 出生年月</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h3 id="修改表—新增列"><a href="#修改表—新增列" class="headerlink" title="修改表—新增列"></a>修改表—新增列</h3><p>语法：ALTER TABLE tabname ADD col_name datatype [DEFAULT expr][,ADD col_name datatype…];</p>
<p>1、往stu表中添加score列，double类型</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> stu <span class="keyword">add</span> score <span class="keyword">double</span>;</span><br></pre></td></tr></table></figure>

<h3 id="修改表—修改列"><a href="#修改表—修改列" class="headerlink" title="修改表—修改列"></a>修改表—修改列</h3><p>语法：ALTER TABLE tabname MODIFY (col_name datatype [DEFAULT expr][,MODIFY col_name datatype]…);</p>
<p>1、修改id列，将id设置为主键</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> stu <span class="keyword">modify</span> <span class="keyword">id</span> <span class="built_in">int</span> primary <span class="keyword">key</span>;</span><br></pre></td></tr></table></figure>

<p>2、修改id列，将id主键设置为自动增长</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> stu <span class="keyword">modify</span> <span class="keyword">id</span> <span class="built_in">int</span> auto_increment;</span><br></pre></td></tr></table></figure>

<h3 id="修改表—删除列"><a href="#修改表—删除列" class="headerlink" title="修改表—删除列"></a>修改表—删除列</h3><p>语法：ALTER TABLE tabname DROP [COLUMN] col_name;</p>
<p>1、删除stu表中的score列</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> stu <span class="keyword">drop</span> score;</span><br></pre></td></tr></table></figure>

<h3 id="添加或删除主键及自增"><a href="#添加或删除主键及自增" class="headerlink" title="添加或删除主键及自增"></a>添加或删除主键及自增</h3><p>思考：a) 在建表时，如何为id指定主键约束和自增?</p>
<p>b) 建好的表，如何通过修改添加主键约束和自增?</p>
<p>c) 如何删除表中的主键约束和自增?</p>
<p>1、创建stu学生表，不添加主键自增, 查看表结果</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> mydb1; <span class="comment">-- 切换到mydb1库</span></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> <span class="keyword">if</span> <span class="keyword">exists</span> stu; <span class="comment">-- 删除stu学生表(如果存在)</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> stu( <span class="comment">-- 重建stu学生表，没有主键自增</span></span><br><span class="line">    <span class="keyword">id</span> <span class="built_in">int</span>,</span><br><span class="line">    <span class="keyword">name</span> <span class="built_in">varchar</span>(<span class="number">20</span>),</span><br><span class="line">    gender <span class="built_in">char</span>(<span class="number">1</span>),</span><br><span class="line">    birthday <span class="built_in">date</span></span><br><span class="line">);</span><br><span class="line">desc stu; <span class="comment">-- 查看表结构</span></span><br></pre></td></tr></table></figure>

<p>表结构如下: 没有主键约束和自增。</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/4f7cf015ff7829f26d326b6f443628cc-cf5ea837991844c98383e5808fea67f3.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870476-a17c6d15bd5144db7c3e2a1b71822f12.png" alt="4f7cf015ff7829f26d326b6f443628cc"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/4f7cf015ff7829f26d326b6f443628cc-cf5ea837991844c98383e5808fea67f3.png" target="_blank" rel="noopener">4f7cf015ff7829f26d326b6f443628cc</a></p>
<p>2、如果表没有创建，或者要删除重建，在创建时可以指定主键或主键自增</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> <span class="keyword">if</span> <span class="keyword">exists</span> stu; <span class="comment">-- 删除stu表</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> stu( <span class="comment">-- 重新创建stu表时，指定主键自增</span></span><br><span class="line">    <span class="keyword">id</span> <span class="built_in">int</span> primary <span class="keyword">key</span> auto_increment,</span><br><span class="line">    <span class="keyword">name</span> <span class="built_in">varchar</span>(<span class="number">20</span>),</span><br><span class="line">    gender <span class="built_in">char</span>(<span class="number">1</span>),</span><br><span class="line">    birthday <span class="built_in">date</span></span><br><span class="line">);</span><br><span class="line">desc stu; <span class="comment">-- 查看表结构</span></span><br></pre></td></tr></table></figure>

<p>表结构如下: 已经添加了主键约束和自增。</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/1606d49b391f6e0d23b526912dbb22cf-e1e2d1f977b34d51af42b780080d067e.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870476-812bdf21a3e69009286a5364a240b457.png" alt="1606d49b391f6e0d23b526912dbb22cf"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/1606d49b391f6e0d23b526912dbb22cf-e1e2d1f977b34d51af42b780080d067e.png" target="_blank" rel="noopener">1606d49b391f6e0d23b526912dbb22cf</a></p>
<p>3、如果不想删除重建表，也可以通过修改表添加主键或主键自增</p>
<p>再次执行第1步，创建stu学生表，不添加主键自增，查看表结果</p>
<p>-- 例如: 将stu学生表中的id设置为主键和自动增长</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> stu <span class="keyword">modify</span> <span class="keyword">id</span> <span class="built_in">int</span> primary <span class="keyword">key</span> auto_increment;</span><br><span class="line">desc stu; <span class="comment">-- 查看表结构</span></span><br></pre></td></tr></table></figure>

<p><a href="https://www.zhangpeng.fun/upload/2020/06/1606d49b391f6e0d23b526912dbb22cf-e1e2d1f977b34d51af42b780080d067e.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870476-812bdf21a3e69009286a5364a240b457.png" alt="1606d49b391f6e0d23b526912dbb22cf"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/1606d49b391f6e0d23b526912dbb22cf-e1e2d1f977b34d51af42b780080d067e.png" target="_blank" rel="noopener">1606d49b391f6e0d23b526912dbb22cf</a></p>
<p>如果只添加主键约束，不设置自增</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> stu <span class="keyword">modify</span> <span class="keyword">id</span> <span class="built_in">int</span> **primary <span class="keyword">key</span>**;</span><br></pre></td></tr></table></figure>

<p>如果已经添加主键约束，仅仅设置自增，但需注意:</p>
<p>(1)如果没有设置主键，不可添加自增</p>
<p>(2)只有当主键是数值时，才可以添加自增</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> stu <span class="keyword">modify</span> <span class="keyword">id</span> <span class="built_in">int</span> **auto_increment**;</span><br></pre></td></tr></table></figure>

<p>4、如果想删除主键自增</p>
<p>-- 删除主键自增时，要先删除自增</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> stu <span class="keyword">modify</span> <span class="keyword">id</span> <span class="built_in">int</span>;</span><br></pre></td></tr></table></figure>

<p>-- 再删除主键约束</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> stu <span class="keyword">drop</span> primary <span class="keyword">key</span>;</span><br><span class="line">desc stu; <span class="comment">-- 查看表结构</span></span><br></pre></td></tr></table></figure>

<p><a href="https://www.zhangpeng.fun/upload/2020/06/4f7cf015ff7829f26d326b6f443628cc-cf5ea837991844c98383e5808fea67f3.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870476-a17c6d15bd5144db7c3e2a1b71822f12.png" alt="4f7cf015ff7829f26d326b6f443628cc"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/4f7cf015ff7829f26d326b6f443628cc-cf5ea837991844c98383e5808fea67f3.png" target="_blank" rel="noopener">4f7cf015ff7829f26d326b6f443628cc</a></p>
<h3 id="添加外键约束"><a href="#添加外键约束" class="headerlink" title="添加外键约束"></a>添加外键约束</h3><p><strong>1、添加外键方式一：建表时添加外键</strong></p>
<p>现有部门表如下：</p>
<p>-- 创建部门表</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> dept(</span><br><span class="line">	<span class="keyword">id</span> <span class="built_in">int</span> primary <span class="keyword">key</span> auto_increment, <span class="comment">-- 部门编号</span></span><br><span class="line">	<span class="keyword">name</span> <span class="built_in">varchar</span>(<span class="number">20</span>) <span class="comment">-- 部门名称</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>要求创建员工表，并在员工表中添加外键关联部门主键</p>
<p>-- 创建员工表</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> emp(</span><br><span class="line">    <span class="keyword">id</span> <span class="built_in">int</span> primary <span class="keyword">key</span> auto_increment, <span class="comment">-- 员工编号</span></span><br><span class="line">    <span class="keyword">name</span> <span class="built_in">varchar</span>(<span class="number">20</span>), <span class="comment">-- 员工姓名</span></span><br><span class="line">    dept_id <span class="built_in">int</span>, <span class="comment">-- 部门编号</span></span><br><span class="line">    <span class="keyword">foreign</span> <span class="keyword">key</span>(dept_id) <span class="keyword">references</span> dept(<span class="keyword">id</span>) <span class="comment">-- 指定dept_id为外键</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p><strong>2、添加外键方式二：建表后添加外键</strong></p>
<p>现有部门表和员工表：</p>
<p>-- 创建部门表</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> dept(</span><br><span class="line">    <span class="keyword">id</span> <span class="built_in">int</span> primary <span class="keyword">key</span> auto_increment, <span class="comment">-- 部门编号</span></span><br><span class="line">    <span class="keyword">name</span> <span class="built_in">varchar</span>(<span class="number">20</span>) <span class="comment">-- 部门名称</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>-- 创建员工表</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> emp(</span><br><span class="line">    <span class="keyword">id</span> <span class="built_in">int</span> primary <span class="keyword">key</span> auto_increment, <span class="comment">-- 员工编号</span></span><br><span class="line">    <span class="keyword">name</span> <span class="built_in">varchar</span>(<span class="number">20</span>), <span class="comment">-- 员工姓名</span></span><br><span class="line">    dept_id <span class="built_in">int</span> <span class="comment">-- 部门编号</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>-- 如果表已存在，可以使用下面这种方式：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> emp <span class="keyword">add</span> <span class="keyword">constraint</span> fk_dept_id <span class="keyword">foreign</span> <span class="keyword">key</span>(dept_id) <span class="keyword">references</span> dept(<span class="keyword">id</span>);</span><br></pre></td></tr></table></figure>

<p>其中 <strong>fk_dept_id</strong> (名字由自己定义)，是指外键约束名称，也可以将【constraint fk_dept_id】省略，MySQL会自动分配一个外键名称，将来可以通过该名称删除外键。</p>
<p>foreign key(dept_id)中的dept_id为外键</p>
<h3 id="删除外键约束"><a href="#删除外键约束" class="headerlink" title="删除外键约束"></a>删除外键约束</h3><p>1、首先通过 “show create table 表名”语法，查询含有外键表的建表语句，例如：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">create</span> <span class="keyword">table</span> emp;</span><br></pre></td></tr></table></figure>

<p>显示结果如下：</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/e5ad1306d0985dadf8ffbbd3eff61174-75a4e55ff4c347b79519b147887e483b.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870476-49806cc3a2a71d073ffdd54dfdcb9080.png" alt="e5ad1306d0985dadf8ffbbd3eff61174"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/e5ad1306d0985dadf8ffbbd3eff61174-75a4e55ff4c347b79519b147887e483b.png" target="_blank" rel="noopener">e5ad1306d0985dadf8ffbbd3eff61174</a></p>
<p>其中，emp_ibfk_1是在创建表时，数据库为外键约束指定的一个名字，删除这个名字即可删除外键关系，例如：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> emp <span class="keyword">drop</span> <span class="keyword">foreign</span> <span class="keyword">key</span> emp_ibfk_1;</span><br></pre></td></tr></table></figure>

<p><a href="https://www.zhangpeng.fun/upload/2020/06/d909d9ba24215a4632db6c43cb156ce4-669b463b28db4701ab65386021cb90c2.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870476-40117eab7185cb0e6aeaab5ba31cc4e9.png" alt="d909d9ba24215a4632db6c43cb156ce4"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/d909d9ba24215a4632db6c43cb156ce4-669b463b28db4701ab65386021cb90c2.png" target="_blank" rel="noopener">d909d9ba24215a4632db6c43cb156ce4</a></p>
<p>外键删除成功！</p>
<h3 id="添加外键约束-多对多"><a href="#添加外键约束-多对多" class="headerlink" title="添加外键约束(多对多)"></a>添加外键约束(多对多)</h3><p>-- 现有学生(stu)表和教师(tea)表：</p>
<p>-- 创建学生表</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> stu(</span><br><span class="line">    stu_id <span class="built_in">int</span> primary <span class="keyword">key</span> auto_increment, <span class="comment">-- 学生编号</span></span><br><span class="line">    <span class="keyword">name</span> <span class="built_in">varchar</span>(<span class="number">20</span>) <span class="comment">-- 学生姓名</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>-- 创建教师表</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> tea(</span><br><span class="line">	tea_id <span class="built_in">int</span> primary <span class="keyword">key</span> auto_increment, <span class="comment">-- 教师编号</span></span><br><span class="line">	<span class="keyword">name</span> <span class="built_in">varchar</span>(<span class="number">20</span>) <span class="comment">-- 教师姓名</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>-- 添加第三方表(stu_tea)表示学生表和教师表关系</p>
<p>-- 创建学生和教师关系表</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> stu_tea(</span><br><span class="line">    stu_id <span class="built_in">int</span>, <span class="comment">-- 学生编号</span></span><br><span class="line">    tea_id <span class="built_in">int</span>, <span class="comment">-- 教师编号</span></span><br><span class="line">    primary <span class="keyword">key</span>(stu_id,tea_id), <span class="comment">-- 设置联合主键</span></span><br><span class="line">    <span class="keyword">foreign</span> <span class="keyword">key</span>(stu_id) <span class="keyword">references</span> stu(stu_id), <span class="comment">-- 添加外键</span></span><br><span class="line">    <span class="keyword">foreign</span> <span class="keyword">key</span>(tea_id) <span class="keyword">references</span> tea(tea_id) <span class="comment">-- 添加外键</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>其中为了防止重复数据，将stu_id和tea_id设置为联合主键。</p>
<p>将stu_id设置为外键，参考stu表中的stu_id列</p>
<p>并将tea_id设置为外键，参考tea表中的tea_id列</p>
<h3 id="级联更新、级联删除"><a href="#级联更新、级联删除" class="headerlink" title="级联更新、级联删除"></a>级联更新、级联删除</h3><p>-- 创建db20库、dept表、emp表并插入记录</p>
<p>-- 删除db20库(如果存在)，并重新创建db20库</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">database</span> <span class="keyword">if</span> <span class="keyword">exists</span> db20;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">database</span> db20 <span class="keyword">charset</span> utf8;</span><br><span class="line"><span class="keyword">use</span> db20;</span><br></pre></td></tr></table></figure>

<p>-- 创建部门表, 要求id, name字段</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> dept(</span><br><span class="line">	<span class="keyword">id</span> <span class="built_in">int</span> primary <span class="keyword">key</span> auto_increment, <span class="comment">-- 部门编号</span></span><br><span class="line">	<span class="keyword">name</span> <span class="built_in">varchar</span>(<span class="number">20</span>) <span class="comment">-- 部门名称</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>-- 往部门表中插入记录</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> dept <span class="keyword">values</span>(<span class="literal">null</span>, <span class="string">'财务部'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> dept <span class="keyword">values</span>(<span class="literal">null</span>, <span class="string">'人事部'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> dept <span class="keyword">values</span>(<span class="literal">null</span>, <span class="string">'科技部'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> dept <span class="keyword">values</span>(<span class="literal">null</span>, <span class="string">'销售部'</span>);</span><br></pre></td></tr></table></figure>

<p>-- 创建员工表, 要求id, name, dept_id</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> emp(</span><br><span class="line">    <span class="keyword">id</span> <span class="built_in">int</span> primary <span class="keyword">key</span> auto_increment, <span class="comment">-- 员工编号</span></span><br><span class="line">    <span class="keyword">name</span> <span class="built_in">varchar</span>(<span class="number">20</span>), <span class="comment">-- 员工姓名</span></span><br><span class="line">    dept_id <span class="built_in">int</span>, <span class="comment">-- 部门编号</span></span><br><span class="line">    <span class="keyword">foreign</span> <span class="keyword">key</span>(dept_id) <span class="keyword">references</span> dept(<span class="keyword">id</span>) <span class="comment">-- 指定外键</span></span><br><span class="line">    <span class="keyword">on</span> <span class="keyword">update</span> <span class="keyword">cascade</span> <span class="comment">-- 级联更新</span></span><br><span class="line">    <span class="keyword">on</span> <span class="keyword">delete</span> <span class="keyword">cascade</span> <span class="comment">-- 级联删除</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> emp <span class="keyword">values</span>(<span class="literal">null</span>, <span class="string">'张三'</span>, <span class="number">1</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> emp <span class="keyword">values</span>(<span class="literal">null</span>, <span class="string">'李四'</span>, <span class="number">2</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> emp <span class="keyword">values</span>(<span class="literal">null</span>, <span class="string">'老王'</span>, <span class="number">3</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> emp <span class="keyword">values</span>(<span class="literal">null</span>, <span class="string">'赵六'</span>, <span class="number">4</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> emp <span class="keyword">values</span>(<span class="literal">null</span>, <span class="string">'刘能'</span>, <span class="number">4</span>);</span><br></pre></td></tr></table></figure>

<p>级联更新：主表(dept表)中的主键发生更新时（例如将销售部的id改为40），从表（emp表）中的记录的外键数据也会跟着该表(即赵六和刘能的部门编号也会更新为40)</p>
<p>级联删除：如果不添加级联删除，当删除部门表中的某一个部门时（例如删除4号部门），若该部门在员工表中有对应的员工（赵六和刘能），删除会失败！</p>
<p>若果添加了级联删除，当删除部门表中的某一个部门时，若该部门在员工表中有对应的员工，会在删除部门的同时，将员工表中对应的员工也删除！</p>
<h3 id="where中不能使用列别名"><a href="#where中不能使用列别名" class="headerlink" title="where中不能使用列别名"></a>where中不能使用列别名</h3><p>SQL语句的书写顺序:</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> * | 列名 <span class="comment">-- 确定要查询的列有哪些</span></span><br><span class="line"><span class="keyword">from</span> 表名 <span class="comment">-- 确定查询哪张表</span></span><br><span class="line"><span class="keyword">where</span> 条件 <span class="comment">-- 通过筛选过滤，剔除不符合条件的记录</span></span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> 分组的列 <span class="comment">-- 指定根据哪一列进行分组</span></span><br><span class="line"><span class="keyword">having</span> 条件 <span class="comment">-- 通过条件对分组后的数据进行筛选过滤</span></span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> 排序的列 <span class="comment">-- 指定根据哪一列进行排序</span></span><br><span class="line"><span class="keyword">limit</span> (countPage<span class="number">-1</span>)*rowCount, rowCount <span class="comment">-- 指定返回第几页记录以及每页显示多少条</span></span><br></pre></td></tr></table></figure>

<p>SQL语句的执行顺序:</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">from 表名 <span class="comment">-- 确定查询哪张表</span></span><br><span class="line">where 条件 <span class="comment">-- 通过筛选过滤，剔除不符合条件的记录</span></span><br><span class="line"><span class="keyword">select</span> * | 列名 列别名 <span class="comment">-- 确定要查询的列有哪些，</span></span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> 分组的列 <span class="comment">-- 指定根据哪一列进行分组</span></span><br><span class="line"><span class="keyword">having</span> 条件 <span class="comment">-- 通过条件对分组后的数据进行筛选过滤</span></span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> 排序的列 <span class="comment">-- 指定根据哪一列进行排序</span></span><br><span class="line"><span class="keyword">limit</span> (countPage<span class="number">-1</span>)*rowCount, rowCount</span><br></pre></td></tr></table></figure>

<p>**** 关于where中不能使用列别名但是可以使用表别名?**</p>
<p>是因为，表别名是声明在from中，from先于where执行，先声明再使用没有问题，但是列别名是声明在select中，where先于select执行，如果先使用列别名，再声明，这样执行会报错!!</p>
<h1 id="mysql-javaweb"><a href="#mysql-javaweb" class="headerlink" title="mysql   javaweb"></a><a href="https://www.zhangpeng.fun/tags/mysql" target="_blank" rel="noopener">mysql</a>   <a href="https://www.zhangpeng.fun/tags/javaweb" target="_blank" rel="noopener">javaweb</a></h1>]]></content>
      <categories>
        <category>JavaWeb</category>
      </categories>
      <tags>
        <tag>javaweb</tag>
        <tag>mysql</tag>
      </tags>
  </entry>
  <entry>
    <title>04-JavaScript</title>
    <url>/2020/06/11/04-JavaScript/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="04-JavaScript"><a href="#04-JavaScript" class="headerlink" title="04-JavaScript"></a>04-JavaScript</h1><h1 id="unit04-JavaScript"><a href="#unit04-JavaScript" class="headerlink" title="unit04-JavaScript"></a>unit04-JavaScript</h1><h2 id="JavaScript简介"><a href="#JavaScript简介" class="headerlink" title="JavaScript简介"></a>JavaScript简介</h2><h3 id="什么是JavaScript-了解"><a href="#什么是JavaScript-了解" class="headerlink" title="什么是JavaScript(了解)"></a>什么是JavaScript(了解)</h3><p>全称叫做JavaScript，简称叫做JS</p>
<p>由NetScape(网景)公司提供，是一门专门嵌入在浏览器中执行的脚本语言</p>
<p>JS运行在浏览器中，负责实现网页中的动画效果</p>
<p>或者是实现表单校验等功能</p>
<h3 id="JS特点和优势-了解"><a href="#JS特点和优势-了解" class="headerlink" title="JS特点和优势(了解)"></a>JS特点和优势(了解)</h3><p><strong>1、特点：</strong></p>
<p>(1)JS是一门直译式的语言(边解释边执行，没有编译的过程)</p>
<p>(2)JS是一门基于对象的语言(JS中没有类的概念,也没有编译的过程)</p>
<p>JS中是有对象的(内置对象、自定义对象)</p>
<p>(3)JS是一门弱类型的语言(Java:强类型)</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">在java中:</span><br><span class="line"><span class="built_in">String</span> s = <span class="string">"abc"</span>;</span><br><span class="line">int n = <span class="number">100</span>;</span><br><span class="line">在JS中:</span><br><span class="line"><span class="keyword">var</span> s = <span class="number">100</span>;</span><br><span class="line">s = <span class="string">"abc"</span>;</span><br><span class="line">s = <span class="literal">true</span>;</span><br><span class="line">s = [];</span><br><span class="line">s = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<p><strong>2、优势：</strong></p>
<p>(1)JS具有良好的交互性</p>
<p>(2)JS具有一定的安全性(只能在浏览器内部运行,不能访问浏览器以外的资源)</p>
<p>(3)JS具有跨平台性(JS 浏览器)</p>
<p>( JS语言是跨平台的，是因为有浏览器，但浏览器不跨平台</p>
<p>Java语言是跨平台的，是因为有虚拟机，但虚拟主机不跨平台 )</p>
<h3 id="在HTML书写JS的方式"><a href="#在HTML书写JS的方式" class="headerlink" title="在HTML书写JS的方式"></a>在HTML书写JS的方式</h3><p><strong>1、在script标签内部可以书写JS代码：</strong></p>
<p>在head或者body标签内部可以添加一个script标签，在script标签内部可以直接书写JS代码！</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 在script标签内部可以书写JS注释和JS代码 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span></span><br><span class="line"><span class="actionscript">  <span class="comment">//JS的单行注释</span></span></span><br><span class="line"><span class="actionscript">  <span class="comment">/* JS的多行注释 */</span></span></span><br><span class="line"><span class="actionscript">	alert( <span class="string">"在html中引入JS的第一种方式..."</span> );</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>2、通过script标签引入外部的JS文件</strong></p>
<p>在head或body标签内部，可以通过script标签引入外部的JS文件。例如：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 通过script标签可以引入外部的JS文件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"demo.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>注意：(1)在引入js文件的script标签内部不要书写JS代码,例如:</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"demo.js"</span>&gt;</span></span><br><span class="line"><span class="actionscript">	alert( <span class="number">111</span> ); <span class="comment">//这里的代码不会执行</span></span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>(2)不要将引入JS文件的script标签自闭，因为可能会导致文件引入失败，如下：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"demo.js"</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>扩展内容：也可以直接在元素上书写JS代码</strong></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 直接在元素上书写JS代码：</span></span><br><span class="line"><span class="comment">onclick属性用于给当前元素绑定点击事件：点击元素就会触发事件，执行相应函数</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"点我~"</span> <span class="attr">onclick</span>=<span class="string">"alert('叫你点你还真敢点啊!!!')"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"别点我"</span>  <span class="attr">onclick</span>=<span class="string">"console.log( new Date() )"</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="JavaScript语法"><a href="#JavaScript语法" class="headerlink" title="JavaScript语法"></a>JavaScript语法</h2><h3 id="注释格式"><a href="#注释格式" class="headerlink" title="注释格式"></a>注释格式</h3><p>JS的注释符号和Java的注释符号相同，如下：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 单行注释内容</span></span><br><span class="line"><span class="comment">/* 多行注释内容 */</span></span><br></pre></td></tr></table></figure>

<h3 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h3><p><strong>1、基本数据类型</strong></p>
<p><strong>(1)数值类型(number)</strong></p>
<p>在JS中，所有的数值在底层都是浮点型，但是在处理和显示的过程中会自动的和整型进行转换。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">例如：2.4+3.6&#x3D;6</span><br><span class="line">特殊值：Infinity(无穷大) &#x2F; -Infinity(负无穷大) &#x2F; NaN(非数字)</span><br></pre></td></tr></table></figure>

<p><strong>(2)字符串类型(string)</strong></p>
<p>在JS中，字符串类型属于基本数据类型，字符串常量可以使用单引号或者使用双引号引起来。例如：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> s1 = <span class="string">"Hello JS"</span>;</span><br><span class="line"><span class="keyword">var</span> s2 = <span class="string">'Hello JS'</span>;</span><br></pre></td></tr></table></figure>

<p>另外，JS中字符串类型有对应的包装对象（String），在需要时会自动的和包装对象进行转换。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> s1 = <span class="string">"Hello JS"</span>;</span><br><span class="line"><span class="built_in">console</span>.log( <span class="keyword">typeof</span> s1 ); <span class="comment">//string</span></span><br><span class="line"><span class="keyword">var</span> s2 = <span class="keyword">new</span> <span class="built_in">String</span>(<span class="string">"Hello JS"</span>);</span><br><span class="line"><span class="built_in">console</span>.log( <span class="keyword">typeof</span> s2 ); <span class="comment">//object</span></span><br><span class="line"><span class="comment">//不管是基本数据类型s1, 还是对象类型s2, 都可以当作对象来用</span></span><br><span class="line"><span class="built_in">console</span>.log( s1.valueOf() ); <span class="comment">//s1是基本数据类型, 会转成对象, 调用valueOf函数</span></span><br><span class="line"><span class="built_in">console</span>.log( s2.valueOf() );</span><br></pre></td></tr></table></figure>

<p><strong>(3)布尔类型(boolean)</strong></p>
<p>布尔类型的值有两个，分别为true和false。</p>
<p>(4)undefined</p>
<p>undefined类型的值只有一个，就是undefined，表示变量未定义(但不是指对象没有声明)。</p>
<p>是指声明了变量，但没有为变量赋值，该变量的值就是undefined。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* 1.undefined类型 */</span></span><br><span class="line"><span class="keyword">var</span> x;</span><br><span class="line">alert( x ); <span class="comment">//undefined</span></span><br><span class="line">alert( y ); <span class="comment">//抛异常</span></span><br></pre></td></tr></table></figure>

<p>(5)null</p>
<p>null类型的值也只有一个，就是null，表示空值。</p>
<p>可以作为函数的返回值，表示函数返回的是一个空的对象。</p>
<p>注意：null和undefined类型的变量是不能调用函数或属性的，会抛异常！</p>
<p><strong>2、复杂数据类型</strong></p>
<p>主要指对象(JS的内置对象、自定义的对象、函数、数组)</p>
<h3 id="变量声明"><a href="#变量声明" class="headerlink" title="变量声明"></a>变量声明</h3><p>JS中是通过var关键字声明变量，声明的变量是不区分类型，可以指向任意的数据。例如：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> x = <span class="number">100</span>;</span><br><span class="line">x = <span class="string">"abc"</span>;</span><br><span class="line">x = <span class="literal">true</span>;</span><br><span class="line">x = [];</span><br><span class="line">x = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line">x = <span class="keyword">new</span> <span class="built_in">Object</span>();</span><br><span class="line">x = &#123;&#125;;</span><br></pre></td></tr></table></figure>

<p>另外，JS中多次声明同名的变量不会出现语法错误，例如：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* 2.变量的定义 */</span></span><br><span class="line"><span class="keyword">var</span> s = <span class="string">"Hello"</span>; <span class="comment">// var s; s="Hello";</span></span><br><span class="line"><span class="keyword">var</span> s = <span class="number">123</span>; <span class="comment">// var s; s=123; 第二次声明变量x没有生效</span></span><br><span class="line">alert( s ); <span class="comment">//123</span></span><br></pre></td></tr></table></figure>

<h3 id="JS运算符"><a href="#JS运算符" class="headerlink" title="JS运算符"></a>JS运算符</h3><p>JS和Java中的运算符大致相同，例如：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">算术运算符: +，-，*，&#x2F;，%，++，--</span><br><span class="line">赋值运算符: &#x3D;，+&#x3D;，-&#x3D;，*&#x3D;，&#x2F;&#x3D;，%&#x3D;</span><br><span class="line">比较运算符: &#x3D;&#x3D;，!&#x3D;，&gt;，&gt;&#x3D;，&lt;，&lt;&#x3D;</span><br><span class="line">位运算符: &amp; ， |</span><br><span class="line">逻辑运算符: &amp;&amp; ，||</span><br><span class="line">前置逻辑运算符: ! (not)</span><br><span class="line">三元运算符: 表达式 ? 表达式 : 表达式</span><br><span class="line">。。。</span><br></pre></td></tr></table></figure>

<h3 id="JS语句"><a href="#JS语句" class="headerlink" title="JS语句"></a>JS语句</h3><p>JS中的语句和Java中的语句也大致相同</p>
<p><strong>1、if分支结构</strong></p>
<p>if分支结构用于基于不同的条件来执行不同的动作。语法结构如下：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (条件 <span class="number">1</span>)&#123;</span><br><span class="line">	当条件 <span class="number">1</span> 为 <span class="literal">true</span> 时执行的代码</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span> (条件 <span class="number">2</span>)&#123;</span><br><span class="line">	当条件 <span class="number">2</span> 为 <span class="literal">true</span> 时执行的代码</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">	当条件 <span class="number">1</span> 和 条件 <span class="number">2</span> 都不为 <span class="literal">true</span> 时执行的代码</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>2、switch语句</strong></p>
<p>使用 switch 语句来选择要执行的多个代码块之一。语法结构如下：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">switch</span>(n)&#123;</span><br><span class="line">	<span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">		执行代码块 <span class="number">1</span></span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">        执行代码块 <span class="number">2</span></span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">    ...</span><br><span class="line">	<span class="keyword">default</span>:</span><br><span class="line">		与 <span class="keyword">case</span> <span class="number">1</span> 和 <span class="keyword">case</span> <span class="number">2</span> 不同时执行的代码</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>执行原理：首先设置表达式 n（通常是一个变量）。随后表达式的值会与结构中的每个case 的值做比较。如果存在匹配，则与该 case 关联的代码块会被执行。请使用 break来阻止代码自动地向下一个 case 运行。</p>
<p><strong>3、for循环语句</strong> – 循环代码块一定的次数</p>
<p>for 循环的语法结构如下：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> (语句 <span class="number">1</span>; 语句 <span class="number">2</span>; 语句 <span class="number">3</span>)&#123;</span><br><span class="line">	被执行的代码块</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>4、while循环</strong> – 在指定条件为真时循环执行代码块</p>
<p>JS中while循环也分为while和do/while循环，下面为while循环语法结构:</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">while</span> (条件)&#123;</span><br><span class="line">	需要执行的代码</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>while 循环会在指定条件为真时循环执行代码块。</p>
<p><code>案例1：if分支案例: 接收用户输入的成绩，判断成绩所属的等级</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">80~100(包括80，也包括100) 优秀</span><br><span class="line">60~80(包括60，但不包括80) 中等</span><br><span class="line">0~60(包括0，但不包括60) 不及格</span><br></pre></td></tr></table></figure>

<p>其他值 输入有误</p>
<p>代码实现如下：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> score = prompt(<span class="string">"请输入您的成绩: "</span>);</span><br><span class="line"><span class="keyword">if</span>( score &gt;= <span class="number">80</span> &amp;&amp; score &lt;=<span class="number">100</span> )&#123;</span><br><span class="line">	alert(<span class="string">"您的成绩属于: 优秀!"</span>);</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>( score &gt;= <span class="number">60</span> &amp;&amp; score &lt; <span class="number">80</span> )&#123;</span><br><span class="line">	alert(<span class="string">"您的成绩属于: 中等!"</span>);</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>( score &gt;= <span class="number">0</span> &amp;&amp; score &lt; <span class="number">60</span> )&#123;</span><br><span class="line">	alert(<span class="string">"您的成绩属于: 不及格!"</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">	alert(<span class="string">"您的输入有误, 请重新输入!"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>案例2：switch语句案例—实现一个简易的计算器：</p>
<p>可以接收用户输入的两个数值和一个操作符(+、-、*、/)，根据操作符号的不同，对两个数值执行不同的运算。</p>
<p>代码实现如下：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//1.接收用户输入的数值和运算符, 中间用空格分隔</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> str = prompt(<span class="string">"请输入数值1、运算符、数值2，中间用空格分隔："</span>); <span class="comment">//"10 + 5"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//2.对用户输入的内容进行切割(以空格作为分隔符切割)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> arr = str.split(<span class="string">" "</span>); <span class="comment">// ["10", "+", "5"]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> num1 = arr[<span class="number">0</span>] - <span class="number">0</span> ;</span><br><span class="line"><span class="keyword">var</span> opt = arr[<span class="number">1</span>];</span><br><span class="line"><span class="keyword">var</span> num2 = arr[<span class="number">2</span>] - <span class="number">0</span> ;</span><br><span class="line"><span class="comment">//3.通过switch分支实现计算器</span></span><br><span class="line"><span class="keyword">switch</span>( opt )&#123;</span><br><span class="line">	<span class="keyword">case</span> <span class="string">"+"</span>:</span><br><span class="line">		alert( <span class="string">"两个数的和为: "</span>+( num1+num2 ) );</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">case</span> <span class="string">"-"</span>:</span><br><span class="line">		alert( <span class="string">"两个数的差为: "</span>+( num1-num2 ) );</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">case</span> <span class="string">"*"</span>:</span><br><span class="line">		alert( <span class="string">"两个数的乘积为: "</span>+( num1*num2 ) );</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">case</span> <span class="string">"/"</span>:</span><br><span class="line">		alert( <span class="string">"两个数的商为: "</span>+( num1/num2 ) );</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">default</span>:</span><br><span class="line">		alert( <span class="string">"您输入的运算符有误, 请重新输入!"</span> );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>案例3：for循环语句案例</p>
<p>遍历1<del>100之间的所有整数，求1</del>100之间所有整数的和，并输出到控制台;</p>
<p>代码实现如下：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//--------------------------------------</span></span><br><span class="line"><span class="keyword">var</span> i = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">var</span> sum = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span>( i &lt;= <span class="number">100</span> )&#123;</span><br><span class="line">    sum += i;</span><br><span class="line">    i++;</span><br><span class="line">&#125;</span><br><span class="line">alert( <span class="string">"1~100之间所有整数的和为: "</span>+sum );</span><br><span class="line"><span class="comment">//--------------------------------------</span></span><br><span class="line"><span class="keyword">var</span> sum = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>( <span class="keyword">var</span> i=<span class="number">0</span>; i&lt;=<span class="number">100</span>; i++)&#123;</span><br><span class="line">	sum += i;</span><br><span class="line">&#125;</span><br><span class="line">alert( <span class="string">"1~100之间所有整数的和为: "</span>+sum );</span><br><span class="line"><span class="comment">//--------------------------------------</span></span><br></pre></td></tr></table></figure>

<p>案例4：while循环语句案例</p>
<p>遍历下面数组中的元素，将元素输出到控制台。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">var arr &#x3D; [123, &quot;abc&quot;, false, new Object() ];</span><br></pre></td></tr></table></figure>

<p>代码实现如下：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="number">123</span>, <span class="string">"abc"</span>, <span class="literal">false</span>, <span class="keyword">new</span> <span class="built_in">Object</span>() ];</span><br><span class="line"><span class="keyword">var</span> index = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span>( index &lt; arr.length )&#123;</span><br><span class="line">	<span class="built_in">console</span>.log( arr[index] );</span><br><span class="line">	index++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>( <span class="keyword">var</span> i=<span class="number">0</span>; i&lt;arr.length; i++ )&#123;</span><br><span class="line">	<span class="built_in">console</span>.log( arr[i] );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="JS数组"><a href="#JS数组" class="headerlink" title="JS数组"></a>JS数组</h3><p>Array 对象用于在单个的变量中存储多个值。</p>
<p><strong>JS数组的声明方式一:</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//声明一个空数组,长度为零</span></span><br><span class="line"><span class="keyword">var</span> arr1 = [];</span><br><span class="line"><span class="comment">//声明一个数组，并为数组设置初始值</span></span><br><span class="line"><span class="keyword">var</span> arr2 = [<span class="string">"Hello"</span>, <span class="number">111</span>, <span class="literal">false</span>, <span class="keyword">new</span> <span class="built_in">Object</span>() ];</span><br></pre></td></tr></table></figure>

<p><strong>JS数组的声明方式二:</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//声明一个空数组，长度为零</span></span><br><span class="line"><span class="keyword">var</span> arr3 = <span class="keyword">new</span> <span class="built_in">Array</span>();</span><br><span class="line"><span class="comment">//声明一个数组，并为数组设置初始值</span></span><br><span class="line"><span class="keyword">var</span> arr4 = <span class="keyword">new</span> <span class="built_in">Array</span>(<span class="string">"Hello"</span>, <span class="number">111</span>, <span class="literal">false</span>, <span class="keyword">new</span> <span class="built_in">Object</span>());</span><br></pre></td></tr></table></figure>

<p><strong>数组中的细节问题:</strong></p>
<p>(1)JS中的数组可以存储任意类型的数据</p>
<p>(2)JS中的数组长度是可以被任意改变的</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> arr1 = [];</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"此处数组的长度为: "</span>+arr1.length ); <span class="comment">// 0</span></span><br><span class="line">arr1.length = <span class="number">5</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"此处数组的长度为: "</span>+arr1.length ); <span class="comment">// 5</span></span><br><span class="line">arr1[<span class="number">9</span>] = <span class="string">"a"</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"此处数组的长度为: "</span>+arr1.length ); <span class="comment">// 10</span></span><br><span class="line">arr1[<span class="number">99</span>] = <span class="string">"b"</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"此处数组的长度为: "</span>+arr1.length ); <span class="comment">// 100</span></span><br></pre></td></tr></table></figure>

<h3 id="JS函数"><a href="#JS函数" class="headerlink" title="JS函数"></a>JS函数</h3><p>函数就是一个具有功能的代码块, 可以反复调用</p>
<p>函数就是包裹在花括号中的代码块，前面使用了关键词 function。</p>
<p><strong>JS中声明函数的方式为:</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">function 函数名称([参数列表])&#123;</span><br><span class="line">	函数体</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>或者：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">var 变量名&#x2F;函数名 &#x3D; function([参数列表])&#123;</span><br><span class="line">	函数体</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>调用函数: 函数名称([参数列表]);</p>
<h3 id="综合练习"><a href="#综合练习" class="headerlink" title="综合练习"></a>综合练习</h3><p>(自己完成)声明一个函数fn，在函数中实现：遍历指定的两个数值(例如1和100)之间的整数，将是3的倍数的数值存入到一个数组中，并将数组返回。</p>
<p>1、声明fn函数</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params">x,y</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> arr = [];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i=x,j=<span class="number">0</span>;i&lt;y;i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(i%<span class="number">3</span>==<span class="number">0</span>)&#123;</span><br><span class="line">        	arr[j] = i;</span><br><span class="line">        	j++;</span><br><span class="line">    	&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> arr;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2、调用fn函数, 获取1~100之间是3的倍数的数值组成的数组</p>
<p>var arr = fn(1,100);</p>
<p>3、遍历数组中的元素, 输出在网页上(提示: document.write(“输出的内容”) )</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;arr.length;i++)&#123;</span><br><span class="line">	<span class="built_in">document</span>.write(arr[i]+<span class="string">" "</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="DOM操作"><a href="#DOM操作" class="headerlink" title="DOM操作"></a>DOM操作</h2><p>DOM: Document Object Model，文档对象模型，其实就是JS专门为访问html元素提供的一套API。</p>
<h3 id="案例：电灯开关"><a href="#案例：电灯开关" class="headerlink" title="案例：电灯开关"></a>案例：电灯开关</h3><p>点击电灯可以实现开/关灯，代码实现如下：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> flag = <span class="string">"off"</span>; <span class="comment">//flag表示灯的状态, off表示灯是关闭的!</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">changeImg</span>(<span class="params"> </span>)</span>&#123;</span><br><span class="line">    <span class="comment">//1.通过id获取img元素(返回是一个JS对象)</span></span><br><span class="line">    <span class="keyword">var</span> imgObj = <span class="built_in">document</span>.getElementById(<span class="string">"img1"</span>);</span><br><span class="line">    <span class="keyword">if</span>( flag == <span class="string">"off"</span> )&#123; <span class="comment">// 表明灯是关闭状态, 点击后则需要打开</span></span><br><span class="line">    	imgObj.src = <span class="string">"imgs/on.gif"</span>;</span><br><span class="line">    	flag = <span class="string">"on"</span>; <span class="comment">// 更新灯的状态为开灯</span></span><br><span class="line">    &#125;<span class="keyword">else</span>&#123; <span class="comment">// flag="on" 表名灯是打开状态, 点击后则需要关闭</span></span><br><span class="line">    	imgObj.src = <span class="string">"imgs/off.gif"</span>;</span><br><span class="line">    	flag = <span class="string">"off"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="案例：增删改元素"><a href="#案例：增删改元素" class="headerlink" title="案例：增删改元素"></a>案例：增删改元素</h3><p>点击网页中的按钮对html元素进行操作</p>
<p>练习1、添加元素:添加一个div元素到body中</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addNode</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">//1.创建一个新的div元素(返回的是一个JS对象, 表示新创建的div元素)</span></span><br><span class="line">    <span class="keyword">var</span> newDivObj = <span class="built_in">document</span>.createElement(<span class="string">"div"</span>); <span class="comment">// \&lt;div\&gt;\&lt;/div\&gt;</span></span><br><span class="line">    newDivObj.innerHTML = <span class="string">"我是新来的...."</span>;</span><br><span class="line">    <span class="comment">//2.获取body元素(body是父元素)</span></span><br><span class="line">    <span class="keyword">var</span> bodyObj = <span class="built_in">document</span>.body;</span><br><span class="line">    <span class="comment">//3.通过父元素(body)添加子元素(newDivObj)</span></span><br><span class="line">    bodyObj.appendChild( newDivObj );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>练习2、删除元素: 删除id为div_2的元素</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">deleteNode</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">//1.获取要删除的元素(id为div_2)</span></span><br><span class="line">    <span class="keyword">var</span> div2 = <span class="built_in">document</span>.getElementById(<span class="string">"div_2"</span>);</span><br><span class="line">    <span class="comment">//2.获取id为div_2的元素的父元素</span></span><br><span class="line">    <span class="keyword">var</span> parent = div2.parentNode;</span><br><span class="line">    <span class="comment">//3.通过父元素删除子元素</span></span><br><span class="line">    parent.removeChild( div2 );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>练习3、更新元素内容：将div_3的内容更新为当前时间</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">updateNode</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">//1.获取id为div_3的元素</span></span><br><span class="line">    <span class="keyword">var</span> div3 = <span class="built_in">document</span>.getElementById(<span class="string">"div_3"</span>);</span><br><span class="line">    <span class="comment">//2.获取表示当前时间的字符串</span></span><br><span class="line">    <span class="keyword">var</span> dateStr = <span class="keyword">new</span> <span class="built_in">Date</span>().toLocaleString();</span><br><span class="line">    <span class="comment">//3.将div_3元素的内容更新为当前时间</span></span><br><span class="line">    div_3.innerHTML = dateStr;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="案例：网页换肤"><a href="#案例：网页换肤" class="headerlink" title="案例：网页换肤"></a>案例：网页换肤</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/** 练习1：执行下面的函数，切换字体大小 */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">resize</span>(<span class="params"> selector </span>)</span>&#123;</span><br><span class="line">	<span class="comment">//获取id为newstext元素</span></span><br><span class="line">	<span class="keyword">var</span> div = <span class="built_in">document</span>.getElementById(<span class="string">"newstext"</span>);</span><br><span class="line">	<span class="comment">//将id为newstext元素的class属性值设置为 selector</span></span><br><span class="line">	div.className = selector;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** 练习2：执行下面的函数，为页面切换不同的皮肤</span></span><br><span class="line"><span class="comment">	点击换肤链接时,执行changeStyle函数，将link标签的href属性值指向</span></span><br><span class="line"><span class="comment">	不同的css文件的路径，就会使用不同的css文件中的样式 */</span></span><br><span class="line"><span class="comment">//定义数组，存放不同的皮肤（css文件的路径）</span></span><br><span class="line"><span class="keyword">var</span> styleArr = [<span class="string">"css/red.css"</span>, <span class="string">"css/green.css"</span>, <span class="string">"css/blue.css"</span>];</span><br><span class="line"><span class="keyword">var</span> index = <span class="number">0</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">changeStyle</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="comment">//获取head中的link标签(id=link)</span></span><br><span class="line">	<span class="keyword">var</span> link = <span class="built_in">document</span>.getElementById(<span class="string">"link"</span>);</span><br><span class="line">	<span class="comment">//	将link标签的href属性值指向css文件的路径</span></span><br><span class="line">	link.href = styleArr[index];</span><br><span class="line">	index++;</span><br><span class="line">	<span class="keyword">if</span>( index == styleArr.length )&#123; <span class="comment">//如果下标等于数组长度</span></span><br><span class="line">		index = <span class="number">0</span>; <span class="comment">//则将下标重置为0</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="总结：JS获取元素"><a href="#总结：JS获取元素" class="headerlink" title="总结：JS获取元素"></a>总结：JS获取元素</h3><p><code>document.getElementById( id值 )</code> – 通过元素的id值，获取一个元素。返回的是表示该元素的js对象。</p>
<p><code>document.getElementsByTagName( 元素名 )</code> – 通过元素名称获取当前文档中的所有指定名称的元素，返回的是一个数组，其中包含了所有指定名称的元素。</p>
<p><code>document.body</code> – 获取当前文档中的body元素</p>
<p><code>ele.parentNode</code> – 获取当前元素的父元素。ele表示当前元素</p>
<h3 id="总结：JS增删改元素"><a href="#总结：JS增删改元素" class="headerlink" title="总结：JS增删改元素"></a>总结：JS增删改元素</h3><p><code>document.createElement( 元素名称 )</code> – 根据元素名称创建指定名称的元素，返回的是表示新创建元素的js对象</p>
<p><code>parent.appendChild( child )</code> – 通过父元素添加子元素，其中parent表示父元素，child表示子元素</p>
<p><code>parent.removeChild( child )</code>-- 通过父元素删除子元素，其中parent表示父元素，child表示子元素</p>
<p><code>ele.innerHTML</code> – 获取当前元素的html内容(从开始标签到结束标签之间的所有内容)，还可以设置当前元素的html内容(如果元素内部有内容，将会覆盖原有内容)</p>
<h1 id="javaweb-javascript"><a href="#javaweb-javascript" class="headerlink" title="javaweb   javascript"></a><a href="https://www.zhangpeng.fun/tags/javaweb" target="_blank" rel="noopener">javaweb</a>   <a href="https://www.zhangpeng.fun/tags/javascript" target="_blank" rel="noopener">javascript</a></h1>]]></content>
      <categories>
        <category>JavaWeb</category>
      </categories>
      <tags>
        <tag>javaweb</tag>
        <tag>javascript</tag>
      </tags>
  </entry>
  <entry>
    <title>02-JDBC</title>
    <url>/2020/06/11/02-JDBC/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="02-JDBC"><a href="#02-JDBC" class="headerlink" title="02-JDBC"></a>02-JDBC</h1><h1 id="unit-02-JDBC"><a href="#unit-02-JDBC" class="headerlink" title="unit 02-JDBC"></a>unit 02-JDBC</h1><h2 id="JDBC概述"><a href="#JDBC概述" class="headerlink" title="JDBC概述"></a>JDBC概述</h2><h3 id="什么是JDBC？为什么要学习JDBC？"><a href="#什么是JDBC？为什么要学习JDBC？" class="headerlink" title="什么是JDBC？为什么要学习JDBC？"></a>什么是JDBC？为什么要学习JDBC？</h3><p>JDBC(Java Database Connectivity) Java数据库连接</p>
<p>其实就是利用Java语言/程序连接并访问数据库的一门技术</p>
<p>之前我们可以通过CMD或者navicat等工具连接数据库</p>
<p>但在企业开发中，更多的是通过程序（Java程序）连接并访问数据库，通过Java程序访问数据库，就需要用到JDBC这门技术。</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/5fa0f308f5ff06beac3c7f18614c9ff3-36646ee82ae54b7598c113a5e46b2793.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870560-cee5faeba555e58abf9e043de84f01e4.png" alt="5fa0f308f5ff06beac3c7f18614c9ff3"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/5fa0f308f5ff06beac3c7f18614c9ff3-36646ee82ae54b7598c113a5e46b2793.png" target="_blank" rel="noopener">5fa0f308f5ff06beac3c7f18614c9ff3</a></p>
<h3 id="如何通过JDBC程序访问数据库"><a href="#如何通过JDBC程序访问数据库" class="headerlink" title="如何通过JDBC程序访问数据库?"></a>如何通过JDBC程序访问数据库?</h3><p><strong>1、提出需求：</strong></p>
<p>创建一个 jt_db 数据库，在库中创建一个account表，并插入三条记录，然后利用Java程序查询出account表中所有的记录，并将查询的结果打印在控制台上。</p>
<p><strong>2、开发步骤:</strong></p>
<p>(1)准备数据, 创建jt_db库, 创建account表</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">drop database if exists jt_db;</span><br><span class="line">create database jt_db charset utf8;</span><br><span class="line">    use jt_db;</span><br><span class="line">    create table account(</span><br><span class="line">    id int primary key auto_increment,</span><br><span class="line">    name varchar(50),</span><br><span class="line">    money double</span><br><span class="line">);</span><br><span class="line">insert into account values(null, &#39;tom&#39;, 1000);</span><br><span class="line">insert into account values(null, &#39;andy&#39;, 1000);</span><br><span class="line">insert into account values(null, &#39;tony&#39;, 1000);</span><br></pre></td></tr></table></figure>

<p>如果已经执行过课前资料中的”SQL脚本文件”，此步骤可以跳过。</p>
<p>(2)创建JAVA工程：</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200318153229937-6d6d876ffb7f4c85864e1fdb9e717760.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870560-4371bb5d2e510f12cd8f085d61e0e2be.png" alt="image-20200318153229937"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200318153229937-6d6d876ffb7f4c85864e1fdb9e717760.png" target="_blank" rel="noopener">image-20200318153229937</a></p>
<p>(3)导入jar包——mysql驱动包：</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200318153627820-7cab5f474b3944a3800b7a5166a3e0c8.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870560-0856f3316fbaccf0652584bfb8b776bb.png" alt="image-20200318153627820"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200318153627820-7cab5f474b3944a3800b7a5166a3e0c8.png" target="_blank" rel="noopener">image-20200318153627820</a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/6ba3042ef2947f314836128a5c19e2c2-50a469974ae14538a65c6aeee25510fe.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870560-50ec741be1eb7b08ba930d3a0f0c4222.png" alt="6ba3042ef2947f314836128a5c19e2c2"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/6ba3042ef2947f314836128a5c19e2c2-50a469974ae14538a65c6aeee25510fe.png" target="_blank" rel="noopener">6ba3042ef2947f314836128a5c19e2c2</a></p>
<p>(4)创建类并实现JDBC程序(六个步骤)</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/dccd4a8163b4835b74e77f945d106683-95c22103a92448a68229581864b5a96c.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870560-a56ad0e89b3ddbd0842eece6792671fb.png" alt="dccd4a8163b4835b74e77f945d106683"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/dccd4a8163b4835b74e77f945d106683-95c22103a92448a68229581864b5a96c.png" target="_blank" rel="noopener">dccd4a8163b4835b74e77f945d106683</a></p>
<p>代码实现:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="comment">//1.注册数据库驱动</span></span><br><span class="line">    Class.forName(<span class="string">"com.mysql.jdbc.Driver"</span>);</span><br><span class="line">    <span class="comment">//2.获取数据库连接</span></span><br><span class="line">    Connection conn = DriverManager.getConnection(</span><br><span class="line">        <span class="string">"jdbc:mysql://localhost:3306/jt_db?characterEncoding=utf-8"</span>,</span><br><span class="line">        <span class="string">"root"</span>, <span class="string">"root"</span>);</span><br><span class="line">    <span class="comment">//3.获取传输器</span></span><br><span class="line">    Statement stat = conn.createStatement();</span><br><span class="line">    <span class="comment">//4.发送SQL到服务器执行并返回执行结果</span></span><br><span class="line">    String sql = <span class="string">"select * from account"</span>;</span><br><span class="line">    ResultSet rs = stat.executeQuery( sql );</span><br><span class="line">    <span class="comment">//5.处理结果</span></span><br><span class="line">    <span class="keyword">while</span>( rs.next() ) &#123;</span><br><span class="line">        <span class="keyword">int</span> id = rs.getInt(<span class="string">"id"</span>);</span><br><span class="line">        String name = rs.getString(<span class="string">"name"</span>);</span><br><span class="line">        <span class="keyword">double</span> money = rs.getDouble(<span class="string">"money"</span>);</span><br><span class="line">        System.out.println(id+<span class="string">" : "</span>+name+<span class="string">" : "</span>+money);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//6.释放资源</span></span><br><span class="line">    rs.close();</span><br><span class="line">    stat.close();</span><br><span class="line">    conn.close();</span><br><span class="line">    System.out.println(<span class="string">"TestJdbc.main()...."</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>3、执行结果:</strong></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/a37ab7234bb1beb988f4b9c01c8cee2f-451bed389d2b43b5849c80244c088cd8.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870560-1e772876b8c1a0cbd80c1a0d69c8007d.png" alt="a37ab7234bb1beb988f4b9c01c8cee2f"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/a37ab7234bb1beb988f4b9c01c8cee2f-451bed389d2b43b5849c80244c088cd8.png" target="_blank" rel="noopener">a37ab7234bb1beb988f4b9c01c8cee2f</a></p>
<h3 id="JDBC-API总结"><a href="#JDBC-API总结" class="headerlink" title="JDBC API总结"></a>JDBC API总结</h3><p><strong>1、注册数据库驱动</strong></p>
<p>Class.forName(“com.mysql.jdbc.Driver”);</p>
<p>所谓的注册驱动，就是让JDBC程序加载mysql驱动程序，并管理驱动</p>
<p>驱动程序实现了JDBC API定义的接口以及和数据库服务器交互的功能，加载驱动是为了方便使用这些功能。</p>
<p><strong>2、获取连接之数据库URL</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Connection conn = DriverManager.getConnection(</span><br><span class="line">    <span class="string">"jdbc:mysql://localhost:3306/jt_db?characterEncoding=utf-8"</span>,</span><br><span class="line">    <span class="string">"root"</span>, <span class="string">"root"</span> );</span><br></pre></td></tr></table></figure>

<p>DriverManager.getConnection() 用于获取数据连接，返回的Connection连接对象是JDBC程序连接数据库至关重要的一个对象。</p>
<p><strong>参数2</strong>和<strong>参数3</strong>分别是所连接数据库的用户名和密码。</p>
<p><strong>参数1</strong>：”jdbc:mysql://localhost:3306/jt_db” 是连接数据库的URL，用于指定访问哪一个位置上的数据库服务器及服务器中的哪一个数据库，其写法为:</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/7edb0faa5fac5f29cd19411909c708cb-4c7e5b40334646668d3c2cd10b2d7cf4.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870560-5fa1e779a6392c9120c9d4b03cddec32.png" alt="7edb0faa5fac5f29cd19411909c708cb"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/7edb0faa5fac5f29cd19411909c708cb-4c7e5b40334646668d3c2cd10b2d7cf4.png" target="_blank" rel="noopener">7edb0faa5fac5f29cd19411909c708cb</a></p>
<p>当连接本地数据库，并且端口为3306，可以简写为如下形式：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">jdbc:mysql:&#x2F;&#x2F;&#x2F;jt_db</span><br></pre></td></tr></table></figure>

<p><strong>3、Statement传输器对象</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Statement stat &#x3D; conn.createStatement();</span><br><span class="line">该方法返回用于向数据库服务器发送sql语句的Statement传输器对象</span><br></pre></td></tr></table></figure>

<p>该对象上提供了发送sql的方法：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">executeQuery(String sql) --</span><br><span class="line">用于向数据库发送查询类型的sql语句，返回一个ResultSet对象中</span><br><span class="line">executeUpdate(String sql) --</span><br><span class="line">用于向数据库发送更新(增加、删除、修改)类型的sql语句，返回一个int值，表示影响的记录行数</span><br></pre></td></tr></table></figure>

<p><strong>4、ResultSet结果集对象</strong></p>
<p>ResultSet对象用于封装sql语句查询的结果，也是一个非常重要的对象。该对象上提供了遍历数据及获取数据的方法。</p>
<p>(1)遍历数据行的方法</p>
<p>next() – 使指向数据行的箭头向下移动一行，并返回一个布尔类型的结果，true表示箭头指向了一行数据，false表示箭头没有指向任何数据（后面也没有数据了）</p>
<p>(2)获取数据的方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">getInt(<span class="keyword">int</span> columnIndex)</span><br><span class="line">getInt(String columnLable)</span><br><span class="line">getString(<span class="keyword">int</span> columnIndex)</span><br><span class="line">getString(String columnLable)</span><br><span class="line">getDouble(<span class="keyword">int</span> columnIndex)</span><br><span class="line">getDouble(String columnLable)</span><br><span class="line">getObject(<span class="keyword">int</span> columnIndex)</span><br><span class="line">getObject(String columnLable)</span><br></pre></td></tr></table></figure>

<p><strong>5、释放资源</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">rs.close();</span><br><span class="line">stat.close();</span><br><span class="line">conn.close();</span><br></pre></td></tr></table></figure>

<p>此处释放资源必须按照一定的顺序释放，越晚获取的越先关闭。所以先关闭<br>rs对象，再关闭stat对象，最后关闭conn对象。</p>
<p>另，为了避免上面的程序抛出异常，释放资源的代码不会执行，应该把释放资源的代码放在finally块中.</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">	...</span><br><span class="line">&#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">	...</span><br><span class="line">&#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (rs != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">        	rs.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            rs = <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (stat != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">        	stat.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            stat = <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (conn != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">        	conn.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            conn = <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="增删改查"><a href="#增删改查" class="headerlink" title="增删改查"></a>增删改查</h2><p><strong>1、新增:往account表中添加一个名称为john、money为3500的记录</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* 1、新增:往account表中添加一个名称为john、money为3500的记录 */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testInsert</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	Connection conn = <span class="keyword">null</span>;</span><br><span class="line">	Statement stat = <span class="keyword">null</span>;</span><br><span class="line">	ResultSet rs = <span class="keyword">null</span>;</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		<span class="comment">//注册驱动并获取连接</span></span><br><span class="line">		conn = JdbcUtil.getConn();</span><br><span class="line">		<span class="comment">//获取传输器</span></span><br><span class="line">		stat = conn.createStatement();</span><br><span class="line">		<span class="comment">//发送sql语句到服务器执行,并返回执行结果</span></span><br><span class="line">		String sql = <span class="string">"insert into account values(null, 'john', 3500)"</span>;</span><br><span class="line">		<span class="keyword">int</span> rows = stat.executeUpdate( sql );</span><br><span class="line">		<span class="comment">//处理结果</span></span><br><span class="line">		System.out.println( <span class="string">"影响行数: "</span>+rows );</span><br><span class="line">	&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">		e.printStackTrace();</span><br><span class="line">	&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">		<span class="comment">//通过JdbcUtil工具类中的close方法释放资源</span></span><br><span class="line">		JdbcUtil.close(conn, stat, rs);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>2、修改:将account表中名称为john的记录，money修改为1500</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* 2、修改:将account表中名称为john的记录，money修改为1500 */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testUpdate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	Connection conn = <span class="keyword">null</span>;</span><br><span class="line">	Statement stat = <span class="keyword">null</span>;</span><br><span class="line">	ResultSet rs = <span class="keyword">null</span>;</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		<span class="comment">//注册驱动并获取连接</span></span><br><span class="line">		conn = JdbcUtil.getConn();</span><br><span class="line">		<span class="comment">//获取传输器</span></span><br><span class="line">		stat = conn.createStatement();</span><br><span class="line">		<span class="comment">//发送sql语句到服务器执行,并返回执行结果</span></span><br><span class="line">		String sql = <span class="string">"update account set money=1500 where name='john'"</span>;</span><br><span class="line">		<span class="keyword">int</span> rows = stat.executeUpdate( sql );</span><br><span class="line">		<span class="comment">//处理结果</span></span><br><span class="line">		System.out.println( <span class="string">"影响行数: "</span>+rows );</span><br><span class="line">	&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">		e.printStackTrace();</span><br><span class="line">	&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">		<span class="comment">//通过JdbcUtil工具类中的close方法释放资源</span></span><br><span class="line">		JdbcUtil.close(conn, stat, rs);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>3、查询:查询account表中名称为john的记录</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* 3、查询:查询account表中id为1的记录 */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindById</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	Connection conn = <span class="keyword">null</span>;</span><br><span class="line">	Statement stat = <span class="keyword">null</span>;</span><br><span class="line">	ResultSet rs = <span class="keyword">null</span>;</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		<span class="comment">//注册驱动并获取连接</span></span><br><span class="line">		conn = JdbcUtil.getConn();</span><br><span class="line">		<span class="comment">//获取传输器</span></span><br><span class="line">		stat = conn.createStatement();</span><br><span class="line">		<span class="comment">//执行sql语句,返回执行结果</span></span><br><span class="line">		String sql = <span class="string">"select * from account where id=1"</span>;</span><br><span class="line">		rs = stat.executeQuery( sql );</span><br><span class="line">		<span class="comment">//处理结果</span></span><br><span class="line">		<span class="keyword">if</span>( rs.next() ) &#123;</span><br><span class="line">			<span class="keyword">int</span> id = rs.getInt(<span class="string">"id"</span>);</span><br><span class="line">			String name = rs.getString(<span class="string">"name"</span>);</span><br><span class="line">			<span class="keyword">double</span> money = rs.getDouble(<span class="string">"money"</span>);</span><br><span class="line">			System.out.println( id+<span class="string">" : "</span>+name+<span class="string">" : "</span>+money);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">		e.printStackTrace();</span><br><span class="line">	&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">		JdbcUtil.close(conn, stat, rs);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>4、删除:删除account表中名称为john的记录</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* 4、删除:删除account表中名称为john的记录 */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testDelete</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	Connection conn = <span class="keyword">null</span>;</span><br><span class="line">	Statement stat = <span class="keyword">null</span>;</span><br><span class="line">	ResultSet rs = <span class="keyword">null</span>;</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		<span class="comment">//注册驱动并获取连接</span></span><br><span class="line">		conn = JdbcUtil.getConn();</span><br><span class="line">		<span class="comment">//获取传输器</span></span><br><span class="line">		stat = conn.createStatement();</span><br><span class="line">		<span class="comment">//发送sql语句到服务器执行,并返回执行结果</span></span><br><span class="line">		String sql = <span class="string">"delete from account where name='john'"</span>;</span><br><span class="line">		<span class="keyword">int</span> rows = stat.executeUpdate( sql );</span><br><span class="line">		<span class="comment">//处理结果</span></span><br><span class="line">		System.out.println( <span class="string">"影响行数: "</span>+rows );</span><br><span class="line">	&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">		e.printStackTrace();</span><br><span class="line">	&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">		<span class="comment">//通过JdbcUtil工具类中的close方法释放资源</span></span><br><span class="line">		JdbcUtil.close(conn, stat, rs);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>内容补充：使用单元测试测试上面的方法</p>
<p>单元测试：不用创建新的类，也不用提供main函数，也不用创建类的实例，就可以直接执行一个方法。能使用单元测试测试的方法需要满足以下几点：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">（1）方法必须是公共的</span><br><span class="line">（2）方法必须是非静态的</span><br><span class="line">（3）方法必须是无返回值的</span><br><span class="line">（4）方法必须是无参数的</span><br></pre></td></tr></table></figure>

<h2 id="PreparedStatement"><a href="#PreparedStatement" class="headerlink" title="PreparedStatement"></a>PreparedStatement</h2><p>在上面的增删改查的操作中，使用的是Statement传输器对象，而在开发中我们用的更多的传输器对象是PreparedStatement对象，PreparedStatement是Statement的子接口，比Statement更加安全，并且能够提高程序执行的效率。</p>
<p>Statement 父对象</p>
<p>PreparedStatement 子对象</p>
<h3 id="模拟用户登录案例"><a href="#模拟用户登录案例" class="headerlink" title="模拟用户登录案例"></a>模拟用户登录案例</h3><p>(1)准备数据</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> jt_db;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> <span class="keyword">user</span>(</span><br><span class="line">    <span class="keyword">id</span> <span class="built_in">int</span> primary <span class="keyword">key</span> auto_increment,</span><br><span class="line">    username <span class="built_in">varchar</span>(<span class="number">50</span>),</span><br><span class="line">    <span class="keyword">password</span> <span class="built_in">varchar</span>(<span class="number">50</span>)</span><br><span class="line">);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">user</span> <span class="keyword">values</span>(<span class="literal">null</span>,<span class="string">'张三'</span>,<span class="string">'123'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">user</span> <span class="keyword">values</span>(<span class="literal">null</span>,<span class="string">'李四'</span>,<span class="string">'234'</span>);</span><br></pre></td></tr></table></figure>

<p>(2)创建LoginUser 类，提供 main 方法 和 login 方法。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">	<span class="comment">/* 1、提示用户登录，提示用户输入用户名并接收用户名</span></span><br><span class="line"><span class="comment">	 *  2、提示用户输入密码并接收密码</span></span><br><span class="line"><span class="comment">	 *  3、根据用户名和密码查询用户信息</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="comment">// 1、提示用户登录，提示用户输入用户名并接收用户名</span></span><br><span class="line">	Scanner sc = <span class="keyword">new</span> Scanner(System.in);</span><br><span class="line">	System.out.println( <span class="string">"请登录："</span> );</span><br><span class="line">	System.out.println( <span class="string">"请输入用户名："</span> );</span><br><span class="line">	String user = sc.nextLine();</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 2、提示用户输入密码并接收密码</span></span><br><span class="line">	System.out.println( <span class="string">"请输入密码："</span> );</span><br><span class="line">	String pwd = sc.nextLine();</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 3、根据用户名和密码查询用户信息</span></span><br><span class="line">	login( user, pwd );</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据用户名和密码查询用户信息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> user 用户名</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> pwd 密码</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">login</span><span class="params">(String user, String pwd)</span> </span>&#123;</span><br><span class="line">	Connection conn = <span class="keyword">null</span>;</span><br><span class="line">	Statement stat = <span class="keyword">null</span>;</span><br><span class="line">	ResultSet rs = <span class="keyword">null</span>;</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		<span class="comment">//1.注册驱动并获取连接</span></span><br><span class="line">		conn = JdbcUtil.getConn();</span><br><span class="line">		<span class="comment">//2.获取传输器，执行sql并返回执行结果</span></span><br><span class="line">		stat = conn.createStatement();</span><br><span class="line">		String sql = <span class="string">"select * from user where username='"</span>+user+<span class="string">"' and password='"</span>+pwd+<span class="string">"'"</span>;</span><br><span class="line">		rs = stat.executeQuery(sql);</span><br><span class="line">		System.out.println( sql );</span><br><span class="line">		<span class="comment">//3.处理结果</span></span><br><span class="line">		<span class="keyword">if</span>( rs.next() ) &#123; <span class="comment">//有数据 -- 用户名密码都正确</span></span><br><span class="line">			System.out.println(<span class="string">"恭喜您登录成功!"</span>);</span><br><span class="line">		&#125;<span class="keyword">else</span> &#123; <span class="comment">//没数据 -- 用户名或密码不正确</span></span><br><span class="line">			System.out.println(<span class="string">"登录失败, 用户名或密码不正确!"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">		e.printStackTrace();</span><br><span class="line">	&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">		<span class="comment">//4.释放资源</span></span><br><span class="line">		JdbcUtil.close(conn, stat, rs);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>执行时，输入：</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">请登录：</span><br><span class="line">请输入用户名：</span><br><span class="line">张飞&#39;#&#39;</span><br><span class="line">请输入密码：</span><br><span class="line"></span><br><span class="line">select * from user where username&#x3D;&#39;张飞&#39;#&#39;&#39; and password&#x3D;&#39;&#39;</span><br><span class="line">恭喜您登录成功了!</span><br></pre></td></tr></table></figure>

<p><strong>或输入</strong>：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">请登录：</span><br><span class="line">请输入用户名：</span><br><span class="line">张飞&#39; or &#39;1&#x3D;1</span><br><span class="line">请输入密码：</span><br><span class="line"></span><br><span class="line">select * from user where username&#x3D;&#39;张飞&#39; or &#39;1&#x3D;1&#39; and password&#x3D;&#39;&#39;</span><br><span class="line">恭喜您登录成功了!</span><br></pre></td></tr></table></figure>

<p><strong>或输入</strong>：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">请登录：</span><br><span class="line">请输入用户名：</span><br><span class="line"></span><br><span class="line">请输入密码：</span><br><span class="line">&#39; or &#39;2&#x3D;2</span><br><span class="line">select * from user where username&#x3D;&#39;&#39; and password&#x3D;&#39;&#39; or &#39;2&#x3D;2&#39;</span><br><span class="line">恭喜您登录成功了!</span><br></pre></td></tr></table></figure>

<h3 id="SQL注入攻击"><a href="#SQL注入攻击" class="headerlink" title="SQL注入攻击"></a>SQL注入攻击</h3><p>通过上面的案例，我们发现在执行时，不输入密码只输入用户名也可以登陆成功。这就是SQL注入攻击。</p>
<p>SQL注入攻击产生的原因: 由于后台执行的SQL语句是拼接而来的：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">select * from user where username&#x3D;&#39;&quot;+user+&quot;&#39; and password&#x3D;&#39;&quot;+pwd+&quot;&#39;</span><br></pre></td></tr></table></figure>

<p>其中的参数是用户提交过来的，如果用户在提交参数时，在参数中掺杂了一些SQL关键字（比如or）或者特殊符号（#、– 、’ 等），就可能会导致SQL语句语义的变化，从而执行一些意外的操作（用户名或密码不正确也能登录成功）！</p>
<h3 id="防止SQL注入攻击"><a href="#防止SQL注入攻击" class="headerlink" title="防止SQL注入攻击"></a>防止SQL注入攻击</h3><p>如何防止SQL注入攻击？</p>
<p>(1)使用正则表达式对用户提交的参数进行校验。如果参数中有（# – ‘ or等）这些符号就直接结束程序，通知用户输入的参数不合法</p>
<p>(2)使用PreparedStatement对象来替代Statement对象。</p>
<p>下面通过第二种方式解决SQL注入攻击：添加loginByPreparedSatement方法，在方法中，使用PreparedStatement来代替Statement作为传输器对象使用，代码示例：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据用户名和密码查询用户信息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> user 用户名</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> pwd 密码</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">login</span><span class="params">(String user, String pwd)</span> </span>&#123;</span><br><span class="line">	Connection conn = <span class="keyword">null</span>;</span><br><span class="line">	PreparedStatement ps = <span class="keyword">null</span>;</span><br><span class="line">	ResultSet rs = <span class="keyword">null</span>;</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		<span class="comment">//1.注册驱动并获取连接</span></span><br><span class="line">		conn = JdbcUtil.getConn();</span><br><span class="line">		<span class="comment">//2.获取传输器，执行sql并返回执行结果</span></span><br><span class="line">		String sql = <span class="string">"select * from user where username=? and password=?"</span>;</span><br><span class="line">		ps = conn.prepareStatement( sql );</span><br><span class="line">		<span class="comment">//设置SQL语句中的参数</span></span><br><span class="line">		ps.setString( <span class="number">1</span> , user );</span><br><span class="line">		ps.setString( <span class="number">2</span> , pwd );</span><br><span class="line">		<span class="comment">//执行SQL语句</span></span><br><span class="line">		rs = ps.executeQuery();<span class="comment">//这里不要再传输SQL语句</span></span><br><span class="line">		</span><br><span class="line">		<span class="comment">//3.处理结果</span></span><br><span class="line">		<span class="keyword">if</span>( rs.next() ) &#123; <span class="comment">//有数据 -- 用户名密码都正确</span></span><br><span class="line">			System.out.println(<span class="string">"恭喜您登录成功!"</span>);</span><br><span class="line">		&#125;<span class="keyword">else</span> &#123; <span class="comment">//没数据 -- 用户名或密码不正确</span></span><br><span class="line">			System.out.println(<span class="string">"登录失败, 用户名或密码不正确!"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">		e.printStackTrace();</span><br><span class="line">	&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">		<span class="comment">//4.释放资源</span></span><br><span class="line">		JdbcUtil.close(conn, ps, rs);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>再次执行程序，按照上面的操作登录。此时，已经成功的防止了SQL注入攻击问题了。</p>
<p>PreparedStatement对象是如何防止SQL注入攻击的：</p>
<p>使用PreparedStatement对象是先将SQL语句的骨架发送给服务器编译，编译之后SQL语句的骨架和语义就不会再被改变了，再将SQL语句中的参数发送给服务器，即使参数中再包含SQL关键字或者特殊符号，也不会导致SQL的骨架或语义被改变，只会被当作普通的文本来处理！</p>
<hr>
<p>使用PreparedStatement对象可以防止SQL注入攻击</p>
<p>而且通过方法设置参数更加的方便且不易出错!</p>
<p>还可以从某些方面提高程序执行的效率!</p>
<h3 id="单元测试补充："><a href="#单元测试补充：" class="headerlink" title="单元测试补充："></a>单元测试补充：</h3><p>加了@Test注解的方法，可以通过单元测试（junit）框架测试该方法。底层会创建该方法所在类的实例，通过实例调用该方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testInsert</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	System.out.println(<span class="string">"TestPreparedStatement.testInsert()"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>能够使用@Test单元测试测试的方法必须满足如下几个条件:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">(1)方法必须是公共的</span><br><span class="line">(2)方法必须是非静态的</span><br><span class="line">(3)方法必须是无返回值的</span><br><span class="line">(4)方法必须是无参数的</span><br></pre></td></tr></table></figure>

<h2 id="数据库连接池"><a href="#数据库连接池" class="headerlink" title="数据库连接池"></a>数据库连接池</h2><h3 id="什么是连接池"><a href="#什么是连接池" class="headerlink" title="什么是连接池"></a>什么是连接池</h3><p>池：指内存中的一片空间（容器，比如数组、集合）</p>
<p>连接池：就是将连接存放在容器中，供整个程序共享，可以实现连接的复用，减少连接创建和关闭的次数，从而提高程序执行的效率！</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/d30da01edb7ccc007425c91328373339-9c919d411a8c4048a46b5f873a988a41.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870560-3e67de30be635d8631be96ec95fa316a.png" alt="d30da01edb7ccc007425c91328373339"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/d30da01edb7ccc007425c91328373339-9c919d411a8c4048a46b5f873a988a41.png" target="_blank" rel="noopener">d30da01edb7ccc007425c91328373339</a></p>
<h3 id="为什么要使用连接池"><a href="#为什么要使用连接池" class="headerlink" title="为什么要使用连接池"></a>为什么要使用连接池</h3><p><strong>1、传统方式操作数据库</strong></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/ed6ceb2908a9c2a66c3336a651056ce0-3a68c4bb5a094c9fb065d6c9b84d9133.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870560-0c3d285b25776a4ba1094f7d6e9994c9.png" alt="ed6ceb2908a9c2a66c3336a651056ce0"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/ed6ceb2908a9c2a66c3336a651056ce0-3a68c4bb5a094c9fb065d6c9b84d9133.png" target="_blank" rel="noopener">ed6ceb2908a9c2a66c3336a651056ce0</a></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Connection conn &#x3D; DriverManager.getConnection( url, user, pwd ); </span><br><span class="line">&#x2F;&#x2F;创建连接对象</span><br><span class="line">conn.close(); &#x2F;&#x2F;关闭连接, 销毁连接</span><br></pre></td></tr></table></figure>

<p>在传统方式中，每次用户需要连接访问数据库时，都是创建一个连接对象，基于这个连接对象访问数据库，用完连接后，会将连接关闭（conn.close）。</p>
<p>由于每次创建连接和关闭连接非常的耗时间而且耗资源因此效率低下。</p>
<p><strong>2、使用连接池操作数据库</strong></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/b7566731966b48e3d918bbd205d30030-06a67c0256f14746af53b0ed3d360b26.jpg" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870560-ef71c7f4efe2c45720ed00205423dffd.jpg" alt="b7566731966b48e3d918bbd205d30030"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/b7566731966b48e3d918bbd205d30030-06a67c0256f14746af53b0ed3d360b26.jpg" target="_blank" rel="noopener">b7566731966b48e3d918bbd205d30030</a></p>
<p>可以在程序一启动时，就创建一批连接放在一个连接池中（容器），当用户需要连接时，就从连接池中获取一个连接对象，用完连接后，不要关闭，而是将连接再还回连接池中，这样一来，用来用去都是池中的这一批连接，实现了连接的服用，减少了连接创建和关闭的次数，从而提高了程序执行的效率！</p>
<h3 id="如何使用C3P0连接池"><a href="#如何使用C3P0连接池" class="headerlink" title="如何使用C3P0连接池"></a>如何使用C3P0连接池</h3><p>dbcp/c3p0/druid</p>
<p>使用C3P0连接池开发步骤：</p>
<p><strong>1、导入开发包</strong></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/d9837a8227847f3e22aa28a9e5bf6aa5-0928bb9ea4e147be8fd15072a5ed8663.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870560-2133c13e332a2b5b4d862da851795f0a.png" alt="d9837a8227847f3e22aa28a9e5bf6aa5"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/d9837a8227847f3e22aa28a9e5bf6aa5-0928bb9ea4e147be8fd15072a5ed8663.png" target="_blank" rel="noopener">d9837a8227847f3e22aa28a9e5bf6aa5</a></p>
<p><strong>2、创建数据库连接池(对象)</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">ComboPooledDataSource cpds = <span class="keyword">new</span> ComboPooledDataSource();</span><br></pre></td></tr></table></figure>

<p><strong>3、设置连接数据库的基本信息</strong></p>
<p>(1)方式一：(不推荐) 直接将参数通过 pool.setXxx方法设置给c3p0程序</p>
<p>这种方式直接将参数写死在了程序中，后期一旦参数发生变化，就要修改程序，要重新编译项目、重新发布项目，非常麻烦。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//设置连接数据库的基本信息</span></span><br><span class="line">pool.setDriverClass( <span class="string">"com.mysql.jdbc.Driver"</span> );</span><br><span class="line">pool.setJdbcUrl( <span class="string">"jdbc:mysql:///jt_db?characterEncoding=utf-8"</span> );</span><br><span class="line">pool.setUser( <span class="string">"root"</span> );</span><br><span class="line">pool.setPassword( <span class="string">"root"</span> );</span><br></pre></td></tr></table></figure>

<p>(2)方式二：将连接参数提取到properties文件中(推荐)</p>
<p>在类目录下(开发时可以放在src或者类似的源码目录下)，添加一个c3p0.properties文件，配置内容如下：</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="meta">c3p0.driverClass</span>=<span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="meta">c3p0.jdbcUrl</span>=<span class="string">jdbc:mysql:///jt_db?characterEncoding=utf-8</span></span><br><span class="line"><span class="meta">c3p0.user</span>=<span class="string">root</span></span><br><span class="line"><span class="meta">c3p0.password</span>=<span class="string">root</span></span><br></pre></td></tr></table></figure>

<p>这种方式由于是c3p0到指定的位置下寻找指定名称的properties文件，所以文件的位置必须是放在src或其他源码根目录下，文件名必须是c3p0.properties。</p>
<p>(3)方式三：(推荐)</p>
<p>在类目录下(开发时可以放在src或者类似的源码目录下)，添加一个c3p0-config.xml文件，配置内容如下：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">c3p0-config</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">default-config</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClass"</span>&gt;</span>com.mysql.jdbc.Driver<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span></span></span><br><span class="line"><span class="tag">        <span class="attr">name</span>=<span class="string">"jdbcUrl"</span>&gt;</span>jdbc:mysql:///jt_db?characterEncoding=utf-8<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"user"</span>&gt;</span>root<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span>&gt;</span>root<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">default-config</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">c3p0-config</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这种方式由于是c3p0到指定的位置下寻找指定名称的xml文件，所以文件的位置必须是放在src或其他源码根目录下，文件名必须是c3p0-config.xml。</p>
<p><strong>4、从连接池中获取一个连接对象并进行使用</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Connection conn = pool.getConnection();</span><br></pre></td></tr></table></figure>

<p><strong>5、用完连接后将连接还回连接池中</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">JdbcUtil.*close*(conn, ps, rs);</span><br><span class="line"><span class="comment">/* 如果是自己创建的连接对象，这个连接对象没有经过任何的改动，调用</span></span><br><span class="line"><span class="comment">* conn.close方法，是将连接对象关闭</span></span><br><span class="line"><span class="comment">* 如果是从连接池中获取的连接对象，该连接对象在返回时就已经被连接池</span></span><br><span class="line"><span class="comment">* 改造了，将连接对象的close方法改为了还连接到连接池中</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<h2 id="扩展：切换工作空间，修改默认编码"><a href="#扩展：切换工作空间，修改默认编码" class="headerlink" title="扩展：切换工作空间，修改默认编码"></a>扩展：切换工作空间，修改默认编码</h2><h3 id="切换新的工作空间，设置工作空间编码为utf-8"><a href="#切换新的工作空间，设置工作空间编码为utf-8" class="headerlink" title="切换新的工作空间，设置工作空间编码为utf-8"></a>切换新的工作空间，设置工作空间编码为utf-8</h3><p>(1)切换到新的工作空间目的:<br>若旧的工作空间内容过多，可能会导致eclipse不编译，甚至进入休眠状态。</p>
<p>(2)设置工作空间编码为utf-8，此后在当前工作空间下创建的项目编码也默认是utf-8。</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/eabc894e645afd2837f6fdbcd735eb89-de9ed383140848e08fc09cee4655641d.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870560-f39998cb8d770c8d705746e5fd3fc67d.png" alt="eabc894e645afd2837f6fdbcd735eb89"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/eabc894e645afd2837f6fdbcd735eb89-de9ed383140848e08fc09cee4655641d.png" target="_blank" rel="noopener">eabc894e645afd2837f6fdbcd735eb89</a></p>
<h3 id="设置JSP文件的编码为utf-8"><a href="#设置JSP文件的编码为utf-8" class="headerlink" title="设置JSP文件的编码为utf-8"></a>设置JSP文件的编码为utf-8</h3><p><a href="https://www.zhangpeng.fun/upload/2020/06/8c92de12e98e8b773abbb41133baef4e-f22ce5799ba243f99003193443c9c722.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870560-16087e804b69b1ab0712d163c58fa37c.png" alt="8c92de12e98e8b773abbb41133baef4e"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/8c92de12e98e8b773abbb41133baef4e-f22ce5799ba243f99003193443c9c722.png" target="_blank" rel="noopener">8c92de12e98e8b773abbb41133baef4e</a></p>
<h2 id="扩展：JDBC实现学生信息管理系统"><a href="#扩展：JDBC实现学生信息管理系统" class="headerlink" title="扩展：JDBC实现学生信息管理系统"></a>扩展：JDBC实现学生信息管理系统</h2><h3 id="准备数据"><a href="#准备数据" class="headerlink" title="准备数据"></a>准备数据</h3><p>建库建表语句如下：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 1、创建数据库jt_db数据库(如果不存在才创建)</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">database</span> <span class="keyword">if</span> <span class="keyword">not</span> <span class="keyword">exists</span> jt_db <span class="keyword">charset</span> utf8;</span><br><span class="line"><span class="keyword">use</span> jt_db; <span class="comment">-- 选择jt_db数据库</span></span><br><span class="line"><span class="comment">-- 2、在 jt_db 库中创建 stu 表(学生表)</span></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> <span class="keyword">if</span> <span class="keyword">exists</span> stu;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> stu(</span><br><span class="line">    <span class="keyword">id</span> <span class="built_in">int</span>,</span><br><span class="line">    <span class="keyword">name</span> <span class="built_in">varchar</span>(<span class="number">50</span>),</span><br><span class="line">    gender <span class="built_in">char</span>(<span class="number">2</span>),</span><br><span class="line">    addr <span class="built_in">varchar</span>(<span class="number">50</span>),</span><br><span class="line">    score <span class="keyword">double</span></span><br><span class="line">);</span><br><span class="line"><span class="comment">-- 3、往 stu 表中, 插入记录</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> stu <span class="keyword">values</span>(<span class="number">1001</span>,<span class="string">'张三'</span>,<span class="string">'男'</span>, <span class="string">'北京'</span>, <span class="number">86</span>);</span><br></pre></td></tr></table></figure>

<h3 id="功能实现"><a href="#功能实现" class="headerlink" title="功能实现"></a>功能实现</h3><p>运行程序控制台提示如下：</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/4b9ad722dca6065b01a5202f85e2d89c-182a896372ee4ee4bd49583dd80b7bd9.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870560-7d8e6e4c4930d7648836090674fcd9ff.png" alt="4b9ad722dca6065b01a5202f85e2d89c"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/4b9ad722dca6065b01a5202f85e2d89c-182a896372ee4ee4bd49583dd80b7bd9.png" target="_blank" rel="noopener">4b9ad722dca6065b01a5202f85e2d89c</a></p>
<p>输入a：查询所有学生信息</p>
<p>输入b：添加学生信息</p>
<p>输入c：根据id修改学生信息</p>
<p>输入d：根据id删除学生信息</p>
<h3 id="查询所有学生信息"><a href="#查询所有学生信息" class="headerlink" title="查询所有学生信息"></a>查询所有学生信息</h3><p>在控制台中输入操作代码”a”，效果如下：</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/55a1ab054846de0d92525b6292f7b930-24e69efc97fa410382864e98e56cfc8d.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870560-d99e79967582a868584931572efc0e11.png" alt="55a1ab054846de0d92525b6292f7b930"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/55a1ab054846de0d92525b6292f7b930-24e69efc97fa410382864e98e56cfc8d.png" target="_blank" rel="noopener">55a1ab054846de0d92525b6292f7b930</a></p>
<h3 id="添加学生信息"><a href="#添加学生信息" class="headerlink" title="添加学生信息"></a>添加学生信息</h3><p>在控制台中输入操作代码”b”，效果如下：</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/c9f2e18f2a41668cd39ddaccd712290c-54b6cc48ddfe4e91aeada2239e95d17c.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870560-6271a128c8a88ec52f0ede88625dc8ee.png" alt="c9f2e18f2a41668cd39ddaccd712290c"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/c9f2e18f2a41668cd39ddaccd712290c-54b6cc48ddfe4e91aeada2239e95d17c.png" target="_blank" rel="noopener">c9f2e18f2a41668cd39ddaccd712290c</a></p>
<h3 id="根据id修改学生信息"><a href="#根据id修改学生信息" class="headerlink" title="根据id修改学生信息"></a>根据id修改学生信息</h3><p>在控制台中输入操作代码”c”，效果如下：</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/40de75c8a4f08fc4a4b581b358be6a87-ba847310e5544893b59fa7d80c3a14e2.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870560-b51d50ed00b76525e7553b1d7969b0a7.png" alt="40de75c8a4f08fc4a4b581b358be6a87"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/40de75c8a4f08fc4a4b581b358be6a87-ba847310e5544893b59fa7d80c3a14e2.png" target="_blank" rel="noopener">40de75c8a4f08fc4a4b581b358be6a87</a></p>
<h3 id="根据id删除学生信息"><a href="#根据id删除学生信息" class="headerlink" title="根据id删除学生信息"></a>根据id删除学生信息</h3><p>在控制台中输入操作代码”d”，效果如下：</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/9eda8bae1797eced35a1e4907009db83-9607136f386a4d789b2a73795afee68e.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870560-2082bdd7cd527b875e1ff5fdc1c0bc19.png" alt="9eda8bae1797eced35a1e4907009db83"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/9eda8bae1797eced35a1e4907009db83-9607136f386a4d789b2a73795afee68e.png" target="_blank" rel="noopener">9eda8bae1797eced35a1e4907009db83</a></p>
<h1 id="javaweb-jdbc"><a href="#javaweb-jdbc" class="headerlink" title="javaweb   jdbc"></a><a href="https://www.zhangpeng.fun/tags/javaweb" target="_blank" rel="noopener">javaweb</a>   <a href="https://www.zhangpeng.fun/tags/jdbc" target="_blank" rel="noopener">jdbc</a></h1>]]></content>
      <categories>
        <category>JavaWeb</category>
      </categories>
      <tags>
        <tag>javaweb</tag>
        <tag>jdbc</tag>
      </tags>
  </entry>
  <entry>
    <title>06-tomcat、HTTP</title>
    <url>/2020/06/11/06-tomcat%E3%80%81HTTP/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="06-tomcat、HTTP"><a href="#06-tomcat、HTTP" class="headerlink" title="06-tomcat、HTTP"></a>06-tomcat、HTTP</h1><h1 id="unit06-tomcat、HTTP"><a href="#unit06-tomcat、HTTP" class="headerlink" title="unit06-tomcat、HTTP"></a>unit06-tomcat、HTTP</h1><h2 id="服务器概述"><a href="#服务器概述" class="headerlink" title="服务器概述"></a>服务器概述</h2><h3 id="什么是服务器"><a href="#什么是服务器" class="headerlink" title="什么是服务器?"></a>什么是服务器?</h3><p>服务器：分为服务器硬件 和 服务器软件。在硬件服务器（计算机）上安装了服务器软件，才可以对外提供服务。</p>
<p>比如：让其他的计算机来访问当前服务器，为其他的计算机提供服务。</p>
<p>(1) 服务器硬件：是指在互联网上具有独立IP地址的计算机，比如我们自己用的计算机也可以作为服务器使用。</p>
<p>(2) 服务器软件：就是一个计算机程序，比如MySQL服务器软件，tomcat服务器软件。服务器软件分为很多类型，比如：ftp服务器，数据库服务器，web服务器软件，邮件服务器等。</p>
<h3 id="什么是Web服务器"><a href="#什么是Web服务器" class="headerlink" title="什么是Web服务器?"></a>什么是Web服务器?</h3><p>(1) web服务器是指驻留在互联网上的某种类型的计算机程序。当浏览器访问服务器，请求服务器上的文件时，服务器将会处理该请求，并将请求的文件响应给浏览器，并会附带一些信息告诉浏览器如何查看该文件（即文件的类型）</p>
<p>(2) web服务器是可以向 “发出请求的浏览器提供文档” 的程序，比如在访问百度时，其实就是在访问百度的服务器。</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/14bcab6ec3d58f3fea59d35a1c618a16-8a5b25279f4d4e29a0a4eff04270a917.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870809-e967e1c39a1bcb36fad98ec78ef3672b.png" alt="14bcab6ec3d58f3fea59d35a1c618a16"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/14bcab6ec3d58f3fea59d35a1c618a16-8a5b25279f4d4e29a0a4eff04270a917.png" target="_blank" rel="noopener">14bcab6ec3d58f3fea59d35a1c618a16</a></p>
<p>tomcat就是一个web服务器软件，是由apache组织提供的一款服务器软件，特点：小巧灵活，免费开源，简单易用。</p>
<h2 id="tomcat下载、安装、启动、配置"><a href="#tomcat下载、安装、启动、配置" class="headerlink" title="tomcat下载、安装、启动、配置"></a>tomcat下载、安装、启动、配置</h2><h3 id="下载tomcat服务器"><a href="#下载tomcat服务器" class="headerlink" title="下载tomcat服务器"></a>下载tomcat服务器</h3><p>下载地址：<a href="http://tomcat.apache.org/" target="_blank" rel="noopener">http://tomcat.apache.org/</a></p>
<p>tomcat有很多版本，有解压版 和 安装版，还分windows （还分为32位和64位版）和<br>linux版，根据自己的需求，选择对应的版本下载。</p>
<p>tomcat服务器运行需要jdk的支持，版本对应为：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">tomcat5 需要jdk4以上支持</span><br><span class="line">tomcat6 需要jdk5以上支持</span><br><span class="line">tomcat7 需要jdk6以上支持</span><br><span class="line">tomcat8 需要jdk7以上支持</span><br></pre></td></tr></table></figure>

<h3 id="安装、启动tomcat服务器"><a href="#安装、启动tomcat服务器" class="headerlink" title="安装、启动tomcat服务器"></a>安装、启动tomcat服务器</h3><p><strong>1、安装tomcat服务器</strong></p>
<p>绿色版解压之后就可以使用(原则：安装的路径中不要包含中文和空格)</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/609168f9983f96449b7c33f3ebe1890a-a81bacb2bf0a48fe8983608ae441e6b2.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870809-12085f1690b3fd2e2dca866e486ed9dc.png" alt="609168f9983f96449b7c33f3ebe1890a"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/609168f9983f96449b7c33f3ebe1890a-a81bacb2bf0a48fe8983608ae441e6b2.png" target="_blank" rel="noopener">609168f9983f96449b7c33f3ebe1890a</a></p>
<p>解压后还需要配置JAVA_HOME环境变量，该变量指向jdk的根目录，指定tomcat启动时使用哪一个位置的jdk。</p>
<p><strong>2、启动tomcat服务器</strong></p>
<hr>
<p><strong>如何配置JAVA_HOME环境变量：</strong></p>
<p>变量名: JAVA_HOME</p>
<p>变量值: C:\Program Files\Java\jdk1.8.0_45</p>
<p>-——————————————————————————-</p>
<p>（扩展内容）配置Path变量的两种方式：</p>
<p>方式一：</p>
<p>Path=**C:\Program Files\Java\jdk1.8.0_45\bin;**xxx;xxx;xxx;</p>
<p>方式二：</p>
<p>JAVA_HOME=C:\Program Files\Java\jdk1.8.0_45</p>
<p>Path=%JAVA_HOME%\bin;xxx;xxx;xxx;</p>
<p>-——————————————————————————-</p>
<p><strong>启动、关闭tomcat服务器：</strong></p>
<p>通过 [tomcat根目录]\bin\startup.bat 可以启动tomcat服务器；</p>
<p>通过 [tomcat根目录]\bin\shutdown.bat 可以关闭tomcat服务器；</p>
<p><strong>访问测试服务器：</strong></p>
<p>在tomcat服务器启动后，服务器会默认监听8080端口，可以通过如下地址访问tomcat服务器的主页：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;localhost:8080</span><br></pre></td></tr></table></figure>

<h3 id="修改tomcat默认端口"><a href="#修改tomcat默认端口" class="headerlink" title="修改tomcat默认端口"></a>修改tomcat默认端口</h3><p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200218164109285-d8522652b8bd492f93d8802709b4872a.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870809-75b24290444aaaf196648d6351003a66.png" alt="image-20200218164109285"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200218164109285-d8522652b8bd492f93d8802709b4872a.png" target="_blank" rel="noopener">image-20200218164109285</a></p>
<p>tomcat服务器在启动时，默认监听的端口是8080，这意味着，我们在访问tomcat服务器时，就需要在主机名（localhost）或者IP地址（127.0.0.1）等后面加上端口。这样非常不方便。</p>
<p>可以将<code>8080</code>端口改为<code>80</code>端口，因为80端口非常特殊，可以省略不写（只有80端口可以省略，其他端口可在访问时必须得加上）</p>
<p>修改方法：找到 [tomcat安装目录]\conf\server.xml 文件并打开该文件，将文件中的 69 行的 标签上的 port 属性的值改为 80即可。</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Connector</span> <span class="attr">port</span>=<span class="string">"80"</span> <span class="attr">protocol</span>=<span class="string">"HTTP/1.1"</span></span></span><br><span class="line"><span class="tag">           <span class="attr">connectionTimeout</span>=<span class="string">"20000"</span></span></span><br><span class="line"><span class="tag">           <span class="attr">redirectPort</span>=<span class="string">"8443"</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>改完后，保存文件，重新启动服务器（只有在服务器启动时，才会重新加载server.xml文件）再次启动的服务器就会监听新的端口。</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200218164951343-64e514d1b3de4bc190110a65d602c489.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870809-a56cb9d82fd61edd36001d2629f5c021.png" alt="image-20200218164951343"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200218164951343-64e514d1b3de4bc190110a65d602c489.png" target="_blank" rel="noopener">image-20200218164951343</a></p>
<p><strong>** 扩展问题：FAQ端口占用问题 **：</strong></p>
<p>在启动tomcat服务器时，可能会遇到端口占用问题，如下图：</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/c6008ed65c694512f4b81a2d9fe1877f-428d9cc38bd34b46b12fed33e7c54902.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870809-f1b6061c34c18f7396e336be85b0977d.png" alt="c6008ed65c694512f4b81a2d9fe1877f"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/c6008ed65c694512f4b81a2d9fe1877f-428d9cc38bd34b46b12fed33e7c54902.png" target="_blank" rel="noopener">c6008ed65c694512f4b81a2d9fe1877f</a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200218165319049-d96c5c66c3b5454d98a1666a8f4d1514.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870809-15f2e9749c38e275db5855571f8afeb4.png" alt="image-20200218165319049"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200218165319049-d96c5c66c3b5454d98a1666a8f4d1514.png" target="_blank" rel="noopener">image-20200218165319049</a></p>
<p>原因分析:</p>
<p>**情况一：**可能是之前的tomcat服务器没有完全关闭，仍然在占用80端口，导致服务器再次启动时，启动失败。</p>
<blockquote>
<p>解决方式：运行shutdown.bat文件，将tomcat按照正常流程再关闭一次即可。如果再次启动服务器成功，说明问题已解决，否则看情况二。</p>
</blockquote>
<p>**情况二：**可能是其他程序占用了80端口，导致服务器启动失败。</p>
<blockquote>
<p>解决方式：打开一个cmd窗口，通过 netstat -ano 命令查看当前系统中活动的进程，找到80端口对应的进程编号（PID），根据进程编号将进程结束即可！</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">netstat -ano</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">协议  本地地址         外部地址        状态           PID</span><br><span class="line">TCP  0.0.0.0:80      0.0.0.0:0      LISTENING     6520</span><br><span class="line">TCP  0.0.0.0:135     0.0.0.0:0      LISTENING     448</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">taskkill &#x2F;f &#x2F;pid 进程编号</span><br></pre></td></tr></table></figure>

<h2 id="tomcat目录结构"><a href="#tomcat目录结构" class="headerlink" title="tomcat目录结构"></a>tomcat目录结构</h2><p>tomcat目录结构介绍</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/af86c51c1b50075b001b791487750003-b97d45949f45447795b71d68be4b7c45.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870809-00424fb147e8dc1ebadecabe8efac138.png" alt="af86c51c1b50075b001b791487750003"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/af86c51c1b50075b001b791487750003-b97d45949f45447795b71d68be4b7c45.png" target="_blank" rel="noopener">af86c51c1b50075b001b791487750003</a></p>
<p>tomcat服务器安装根目录下有很多子目录，这些目录的作用是：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">bin：用于存放tomcat服务器中批处理文件的目录(xx.bat&#x2F;xx.sh)</span><br><span class="line">conf：用于存放tomcat服务器中的配置文件的目录(其中server.xml文件是tomcat服务器中非常重要的一个文件。)</span><br><span class="line">lib：用于存放tomcat服务器运行时所依赖的jar包。</span><br><span class="line">logs：用于存放tomcat服务器运行时产生的日志文件(启动tomcat服务器时会打印很多日志信息,这些日志信息还会以文件形式保存到logs目录下)</span><br><span class="line">temp：用于存放tomcat服务器产生的临时文件，tomcat会自己清理，可以忽略该目录</span><br><span class="line">webapps：是localhost【虚拟主机】默认管理的目录，将开发好的【web应用】程序放在webapps目录下，就可以通过浏览器访问localhost主机中的Web资源文件了。</span><br><span class="line">可以简单的理解为：webapps目录就是web资源（html、css、js、图片、jsp等）的存放目录，将web资源文件放在该目录下，就可以通过浏览器来访问。</span><br><span class="line"></span><br><span class="line">work：用于存放tomcat服务器产生的工作文件（JSP翻译后的Servlet文件会放在work目录下；session对象序列化后产生的文件也会放在work目录下；）</span><br></pre></td></tr></table></figure>

<h2 id="虚拟主机和Web应用"><a href="#虚拟主机和Web应用" class="headerlink" title="虚拟主机和Web应用"></a>虚拟主机和Web应用</h2><p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200328095145558-ad7280a7401b4cdb94a03f79fc9c0855.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870809-aaf2cd7dde386c96c48b24a29e578f9f.png" alt="image-20200328095145558"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200328095145558-ad7280a7401b4cdb94a03f79fc9c0855.png" target="_blank" rel="noopener">image-20200328095145558</a></p>
<p>总结：</p>
<p>（1）虚拟主机就是tomcat服务器中配置的一个站点，在tomcat服务器中默认提供了一个localhost虚拟主机，这个主机的发布目录是webapps目录，这样意味着，将Web应用放在webapps目录下，就表示发不到了localhost虚拟主机中。</p>
<p>（2）Web应用就是一个存放了很多Web资源（html、css、js、jsp、servlet、图片等）的目录，将Web应用发布到虚拟主机中，就可以通过浏览器来访问Web资源中的资源文件了。</p>
<h2 id="web应用"><a href="#web应用" class="headerlink" title="web应用"></a>web应用</h2><h3 id="web应用的目录结构"><a href="#web应用的目录结构" class="headerlink" title="web应用的目录结构"></a>web应用的目录结构</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">news(目录,web应用)</span><br><span class="line">  |-- 其他目录, 放在news根目录或者其他目录中的资源文件,浏览器可以直接访问</span><br><span class="line">  |-- WEB-INF目录, 放在这个目录下的资源文件是受保护的,浏览器不能直接访问(不是不能访问,是不能直接访问) </span><br><span class="line">  		 |-- classes目录, 用于存放编译后的class文件</span><br><span class="line">  		 |-- lib目录, 用于存放web应用所依赖的jar包</span><br><span class="line">  		 |-- web.xml文件, 用于存放和web应用相关的一些配置（配置Servlet、配置主页、配置session的超时时间等）</span><br></pre></td></tr></table></figure>

<p>其中news就是一个目录, 同时也是一个web应用程序, 其中可以包含很多的资源文件。</p>
<h3 id="部署web应用到虚拟主机中"><a href="#部署web应用到虚拟主机中" class="headerlink" title="部署web应用到虚拟主机中"></a>部署web应用到虚拟主机中</h3><p>直接将Web应用的目录拷贝到虚拟主机所管理的目录下，就发布到了虚拟主机中</p>
<p>例如：将news目录拷贝webapps目录下，由于webapps目录是localhost主机默认管理的目录，所以就相当于将news应用发布到 了localhost主机中。</p>
<p>通过如下路径规则就可以访问localhost主机下的news应用下的资源文件：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;localhost:端口&#x2F;news&#x2F;xxx</span><br></pre></td></tr></table></figure>

<h2 id="扩展内容（了解）"><a href="#扩展内容（了解）" class="headerlink" title="扩展内容（了解）"></a>扩展内容（了解）</h2><p>访问tomcat服务器主页：<a href="http://localhost/" target="_blank" rel="noopener">http://localhost</a></p>
<p>访问news/hello.html：<a href="http://localhost/news/hello.html" target="_blank" rel="noopener">http://localhost/news/hello.html</a></p>
<p>能否将访问 news/hello.html 的路径缩短一些（比如只通过主机名就可以访问news/hello.html这个网页）</p>
<h3 id="配置WEB应用的主页"><a href="#配置WEB应用的主页" class="headerlink" title="配置WEB应用的主页"></a>配置WEB应用的主页</h3><p>如果没有将 hello.html 配置为当前Web应用的主页，在访问 hello.html 时的路径为：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;localhost&#x2F;news&#x2F;hello.html</span><br></pre></td></tr></table></figure>

<p>如果将 hello.html 配置为当前Web应用的主页，再次访问 hello.html 时的路径为：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;localhost&#x2F;news</span><br></pre></td></tr></table></figure>

<p>在上的路径中，/hello.html 这个路径可以加，也可以省略。</p>
<p>将 hello.html 配置为当前应用的主页，方式为：找到 [当前Web应用]/WEB-INF/web.xml文件并打开，在web.xml文件的根标签内部添加如下配置：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns</span>=<span class="string">"http://xmlns.jcp.org/xml/ns/javaee"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://xmlns.jcp.org/xml/ns/javaee</span></span></span><br><span class="line"><span class="tag"><span class="string">                      http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">version</span>=<span class="string">"3.1"</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>/hello.html<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>/hello1.html<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>/hello2.html<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;/<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>配置完后，需要重启服务器，配置才会生效。</p>
<h3 id="配置缺省的-默认的-WEB应用"><a href="#配置缺省的-默认的-WEB应用" class="headerlink" title="配置缺省的(默认的)WEB应用"></a>配置缺省的(默认的)WEB应用</h3><p>上面已经将news/hello.html配置为news应用的主页，访问hello.html时路径为：<a href="http://localhost/news/" target="_blank" rel="noopener">http://localhost/news/</a></p>
<p>如果不将 news 应用配置为默认的Web应用，在访问 news 下的 hello.html(主页)时的访问路径为:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;localhost&#x2F;news&#x2F;</span><br></pre></td></tr></table></figure>

<p>如果将 news 应用配置为缺省的（默认的）Web应用，在访问 hello.html(主页)时的路径就变成了：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;localhost&#x2F;</span><br></pre></td></tr></table></figure>

<p>如何将 news 配置为缺省的（默认的）Web应用（缺省Web应用只能有一个）？：</p>
<p><strong>将Web应用的名字改为一个大写的ROOT</strong>，当前Web应用就是一个默认的Web应用，再访问这个Web应用下的资源文件时，访问的路径中就可以不用写Web应用的名称了。</p>
<h3 id="打war包"><a href="#打war包" class="headerlink" title="打war包"></a>打war包</h3><p>war包和jar包都是java程序中的一种压缩包格式，如果开发一个Java基础工程，可以将其中编译后的class文件和相关的配置文件打成一个jar包。</p>
<p>可以将一个Web应用打成一个war包，这样做的好处有：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">(1) 将web应用打成一个war包，传输起来更加方便，而且文件体积会变小。</span><br><span class="line">(2) 将war包发布到服务器中，服务器能识别war包格式，会自动将war包解压发布！</span><br></pre></td></tr></table></figure>

<p><strong>打war包的方法是：</strong></p>
<p>进入到web应用的目录下，将Web应用目录下的所有子目录和文件全部选中，右键压缩成一个 xxx.zip 包，再把 xxx.zip 改为 xxx.war即可!!</p>
<p>需要注意的是，如果有以下问题，可能会导致war不会自动解压：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">(1) 在将Web应用打成一个压缩包时，没有打成一个 xxx.zip，而是使用 rar格式或者其他格式,会导致自动解压失败!</span><br><span class="line">(2) 打成的war包的名字 和 已发布的web应用的名字不能冲突,会导致自动解压失败!</span><br><span class="line">(3) war包中包含的目录名和文件名是中文的,也会导致自动解压失败!</span><br></pre></td></tr></table></figure>

<h2 id="HTTP协议概述"><a href="#HTTP协议概述" class="headerlink" title="HTTP协议概述"></a>HTTP协议概述</h2><h3 id="什么是HTTP协议"><a href="#什么是HTTP协议" class="headerlink" title="什么是HTTP协议?"></a>什么是HTTP协议?</h3><p><a href="https://www.zhangpeng.fun/upload/2020/06/14bcab6ec3d58f3fea59d35a1c618a16-8a5b25279f4d4e29a0a4eff04270a917.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870809-e967e1c39a1bcb36fad98ec78ef3672b.png" alt="14bcab6ec3d58f3fea59d35a1c618a16"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/14bcab6ec3d58f3fea59d35a1c618a16-8a5b25279f4d4e29a0a4eff04270a917.png" target="_blank" rel="noopener">14bcab6ec3d58f3fea59d35a1c618a16</a></p>
<p>HTTP协议是用于规定浏览器和服务器之间的通信方式/规则</p>
<p>主要规定了浏览器给服务器发送的请求信息的格式</p>
<p>以及规定了服务器给浏览器发送响应信息的格式</p>
<p>HTTP协议在工作时所遵循的基本原则：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">（1）一次请求，只对应一次响应</span><br><span class="line">（2）请求只能由浏览器发起，服务器只能被动的等待请求，根据请求作出回应。</span><br></pre></td></tr></table></figure>

<h2 id="HTTP协议详解"><a href="#HTTP协议详解" class="headerlink" title="HTTP协议详解"></a>HTTP协议详解</h2><p>IE浏览器的插件：HttpWatch，可以监听浏览器和服务器通信的内容。</p>
<h3 id="HTTP请求"><a href="#HTTP请求" class="headerlink" title="HTTP请求"></a>HTTP请求</h3><p><a href="https://www.zhangpeng.fun/upload/2020/06/169364c50b950ea4df4647e274a7298d-808cfabfef514ca386a51afcf5b59bec.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870809-65df22ba71d31f95eaf8555566646c88.png" alt="169364c50b950ea4df4647e274a7298d"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/169364c50b950ea4df4647e274a7298d-808cfabfef514ca386a51afcf5b59bec.png" target="_blank" rel="noopener">169364c50b950ea4df4647e274a7298d</a></p>
<p><strong>1、请求行</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">GET  &#x2F;news&#x2F;hello.html  HTTP&#x2F;1.1</span><br></pre></td></tr></table></figure>

<p>（1）GET：表示请求方式，在HTTP协议中一共定义了7种提交方式，但是我们只用GET和POST。</p>
<p>（2）/news/hello.html：请求资源路径，表示浏览器请求的是哪一个Web应用以及哪一个web资源文件。</p>
<p>（3）HTTP/1.1：请求所遵循的协议和版本。</p>
<p><strong>2、若干请求头</strong></p>
<p>请求头都是Key-Value结构,例如：</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200219143453111-e6c22e0eed8048cf8ee95463afcb217f.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870809-aa482dd22a885e6dcb28cfa144e50196.png" alt="image-20200219143453111"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200219143453111-e6c22e0eed8048cf8ee95463afcb217f.png" target="_blank" rel="noopener">image-20200219143453111</a></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Host：localhost -- 通知服务器，浏览器要请求的是哪一台虚拟主机。</span><br><span class="line">Accept：text&#x2F;html, appliaction&#x2F;xhtml+xml,...  -- 通知服务器，浏览器能接收的响应数据类型。</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>（空白行，用于分隔请求头和请求实体）</p>
<p><strong>3、请求实体内容</strong></p>
<p>如果请求方式为 GET 提交，请求实体是没有内容的！</p>
<p>如果请求方式为 POST 提交，并且请求中携带了数据，请求实体中才会有内容！</p>
<h3 id="HTTP响应"><a href="#HTTP响应" class="headerlink" title="HTTP响应"></a>HTTP响应</h3><p><a href="https://www.zhangpeng.fun/upload/2020/06/08e49b1b985988b040fe437d4aab7e62-364817632b19431ea8498e2858a8213c.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870809-b768924a62e780c29d8ff2b70e61db27.png" alt="08e49b1b985988b040fe437d4aab7e62"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/08e49b1b985988b040fe437d4aab7e62-364817632b19431ea8498e2858a8213c.png" target="_blank" rel="noopener">08e49b1b985988b040fe437d4aab7e62</a></p>
<p><strong>1、状态行</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">HTTP&#x2F;1.1 200 OK</span><br></pre></td></tr></table></figure>

<p>（1）HTTP/1.1：表示响应所遵循的协议和版本</p>
<p>（2）200：状态码，三位的数字，表示服务器对请求处理的结果。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">200: 表示请求处理成功</span><br><span class="line">302: 表示请求重定向(即需要再进一步请求才可以获取到相应的资源)</span><br><span class="line">304&#x2F;307: 表示通知浏览器使用缓存</span><br><span class="line">404: 表示浏览器请求的资源不存在(浏览器的问题, 请求路径错误)</span><br><span class="line">500: 表示服务器在处理请求的过程中抛出了异常。</span><br></pre></td></tr></table></figure>

<p>（3）OK：描述短语（可以忽略），也表示服务器对请求处理的结果，和状态码表示的结果一致。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">200：OK</span><br><span class="line">404：Not Found</span><br><span class="line">500: Internal Server Error</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p><strong>2、若干响应头</strong>：也是key-value格式</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Content-Type: 表示服务器响应的数据类型，text&#x2F;html,  image&#x2F;*...</span><br><span class="line">Content-Length: 表示服务器响应数据的长度, 例如: 384 &#x2F;字节</span><br><span class="line">Set-Cookie: 和cookie技术相关的一个头, 后面会提到。</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p><strong>3、响应实体内容</strong></p>
<p>响应实体就是浏览器所请求文件的内容。例如：浏览器向服务器请求一个hello.html文件，服务器会找到hello.html文件，将文件的内容作为响应实体发送给浏览器。</p>
<h3 id="内容补充"><a href="#内容补充" class="headerlink" title="内容补充"></a>内容补充</h3><p><strong>1、问题1：请求方式什么时候是GET提交？什么时候是POST提交？</strong></p>
<p>只有当使用表单（form），并且在表单上明确的通过method指定提交方式为POST时，请求方式才是POST提交，其他方式都是GET提交（AJAX除外）</p>
<p><strong>思考：判断以下请求方式是GET还是POST?</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">(1)&lt;form action&#x3D;&quot;#&quot;&gt;&lt;&#x2F;form&gt;											--- GET提交</span><br><span class="line">(2)&lt;form action&#x3D;&quot;#&quot; method&#x3D;&quot;GET&quot;&gt;&lt;&#x2F;form&gt;				--- GET提交</span><br><span class="line">(3)&lt;form action&#x3D;&quot;#&quot; method&#x3D;&quot;POST&quot;&gt;&lt;&#x2F;form&gt;				--- POST提交</span><br><span class="line">(4)点击超链接访问服务器，例如：</span><br><span class="line">	&lt;a href&#x3D;&quot;http:&#x2F;&#x2F;www.baidu.com&quot;&gt;百度一下&lt;&#x2F;a&gt;		--- GET提交</span><br><span class="line">(5)直接在浏览器的地址栏中书写URL地址访问服务器				--- GET提交</span><br></pre></td></tr></table></figure>

<p><strong>2、问题2：GET提交和POST提交有什么区别？</strong></p>
<p>主要体现在请求参数传输过程的不相同</p>
<p>GET提交：</p>
<ul>
<li>将数据通过问号拼接在地址栏URL地址的后面，相对非常不安全。</li>
<li>将数据拼接在地址栏URL地址的后面，数据量是有限制的，通常不能超过1KB或者4KB。</li>
</ul>
<p>POST提交：（form）</p>
<ul>
<li>POST提交是通过请求实体将数据提交给服务器，不会显示在地址栏上，因此相对更加安全。</li>
<li>POST提交通过请求实体提交数据，数据量理论上是没有限制的。</li>
</ul>
<p><strong>3、总结：</strong></p>
<ul>
<li>如果只是单纯做一个跳转，请求中没有数据，尽量使用GET提交。</li>
<li>如果在请求中有数据，但数据量不大，并且数据没有隐私性，也尽量使用GET提交。</li>
<li>如果在请求中有数据，数据量比较大或者数据较为隐私，此时推荐使用POST提交。</li>
</ul>
<h2 id="将Tomcat整合到Eclipse中"><a href="#将Tomcat整合到Eclipse中" class="headerlink" title="将Tomcat整合到Eclipse中"></a>将Tomcat整合到Eclipse中</h2><p>将Tomcat服务器整合到Eclipse工具中，可以通过Eclipse启动、关闭tomcat服务器，更重要的是，可以非常方便的将在Eclipse中创建的Web项目发布到Tomcat服务器中运行。</p>
<h3 id="方式一：在window偏好设置中配置Tomcat"><a href="#方式一：在window偏好设置中配置Tomcat" class="headerlink" title="方式一：在window偏好设置中配置Tomcat"></a>方式一：在window偏好设置中配置Tomcat</h3><p>1、点击Window –&gt; Preferences(偏好设置):</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200311184907773-c068f75e117b452e96eacdda3629290b.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870809-33d99beadbe4e2bd83eaa817be08d928.png" alt="image-20200311184907773"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200311184907773-c068f75e117b452e96eacdda3629290b.png" target="_blank" rel="noopener">image-20200311184907773</a></p>
<p>2、在偏好设置窗口中点击 Server –&gt; Runtime Environments –&gt; add:</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200311184913436-efcc98f4a38b4540be01b86a52ef8a3a.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870809-3085434e0e2f84d7c2d79f925bb0083b.png" alt="image-20200311184913436"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200311184913436-efcc98f4a38b4540be01b86a52ef8a3a.png" target="_blank" rel="noopener">image-20200311184913436</a></p>
<p>3、在弹出的窗口中选择 –&gt; Apache –&gt; Apache Tomcat v8.5，需要注意的是，这里得根据自己安装的tomcat版本进行选择，比如我安装是8.5版本的tomcat，所以这里选择Apache Tomcat v8.5。</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200311184921087-a96d03ec4d474e03b5fd86e8517cb2ed.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870809-29e56e2b3ba174cc0dff1e2ce3327b08.png" alt="image-20200311184921087"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200311184921087-a96d03ec4d474e03b5fd86e8517cb2ed.png" target="_blank" rel="noopener">image-20200311184921087</a></p>
<p>4、在下面的窗口中配置tomcat服务器的安装根目录，可以直接把路径复制到第二个输入框中；也可以点击后面的 Browse按钮在文件管理器中选择tomcat服务器安装根目录。</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200311184932405-f372a9ec30174fe19950188f1e87a40b.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870809-1eff52cf1f2eff60e277a97a7c758762.png" alt="image-20200311184932405"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200311184932405-f372a9ec30174fe19950188f1e87a40b.png" target="_blank" rel="noopener">image-20200311184932405</a></p>
<p>最后点击finish即可完成将Tomcat整合到Eclipse中的配置。</p>
<h3 id="方式二：在创建Web项目时配置Tomcat"><a href="#方式二：在创建Web项目时配置Tomcat" class="headerlink" title="方式二：在创建Web项目时配置Tomcat"></a>方式二：在创建Web项目时配置Tomcat</h3><p>1、如果在创建Web项目时，Target runtime选项中没有配置可选的服务器，可以点击右面的选项进行配置</p>
<p>点击后进入下一步操作。</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200311184950046-d4f074a8f9df4014b1cc242e93f8bf0f.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870809-5cdd343b130239fb7eccacd5c8b55bd7.png" alt="image-20200311184950046"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200311184950046-d4f074a8f9df4014b1cc242e93f8bf0f.png" target="_blank" rel="noopener">image-20200311184950046</a></p>
<p>2、在弹出的窗口中选择 –&gt; Apache –&gt; Apache Tomcat v8.5，需要注意的是，这里得根据自己安装的tomcat版本进行选择，比如我安装是8.5版本的tomcat，所以这里选择Apache Tomcat v8.5。</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200311185003036-6aad122dd03941f3a2eff0a732a15ff2.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870809-bc3360238f05f4f0032170d31a58ba40.png" alt="image-20200311185003036"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200311185003036-6aad122dd03941f3a2eff0a732a15ff2.png" target="_blank" rel="noopener">image-20200311185003036</a></p>
<p>3、在下面的窗口中配置tomcat服务器的安装根目录，可以直接把路径复制到第二个输入框中；也可以点击后面的 Browse按钮在文件管理器中选择tomcat服务器安装根目录。</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200311185013454-a249195912554ead9a0dbbc0dda8f636.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870809-651a82b55796779593a3b1a367a439e8.png" alt="image-20200311185013454"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200311185013454-a249195912554ead9a0dbbc0dda8f636.png" target="_blank" rel="noopener">image-20200311185013454</a></p>
<p>最后点击finish即可完成将Tomcat整合到Eclipse中的配置。</p>
<p>4、上一步完成后，回到Web项目创建的视图窗口，再查看”Target runtime”选项，如下：</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200311185028965-c67fb892887348bfbe14aa6455aae23e.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870809-98fad052a1f2266ce673bb6613d5abea.png" alt="image-20200311185028965"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200311185028965-c67fb892887348bfbe14aa6455aae23e.png" target="_blank" rel="noopener">image-20200311185028965</a></p>
<h3 id="将整合到Eclipse中的tomcat从Eclipse中删除"><a href="#将整合到Eclipse中的tomcat从Eclipse中删除" class="headerlink" title="将整合到Eclipse中的tomcat从Eclipse中删除"></a>将整合到Eclipse中的tomcat从Eclipse中删除</h3><p>如果要将整合到Eclipse中的tomcat从Eclipse删除：点击Windows –&gt; Preferences –&gt; Server –&gt; Runtime Environments，选中要删除的服务器，点击右侧的删除按钮即可删除，最后点击Apply and Close保存设置即可！</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200311185037713-8f23f4070ceb406f97699b50c9016b07.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870809-0da77b21e4ca2ecdd1e9539aff12634e.png" alt="image-20200311185037713"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200311185037713-8f23f4070ceb406f97699b50c9016b07.png" target="_blank" rel="noopener">image-20200311185037713</a></p>
<h3 id="在Eclipse中创建Server及移除Server"><a href="#在Eclipse中创建Server及移除Server" class="headerlink" title="在Eclipse中创建Server及移除Server"></a>在Eclipse中创建Server及移除Server</h3><p>上面讲解了如何将Tomcat整合到Eclipse中，整合之后，需要在Eclipse中创建一个Server才可以进行启动tomcat、关闭tomcat等操作。</p>
<p>1、Eclipse中找到Servers窗口：</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/53ee068642a0174e038b8d61fe0791e8-15fab5c3242e486389fe2048d5ec5e00.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870809-7273efca193ac912d12ca67bc82940e8.png" alt="53ee068642a0174e038b8d61fe0791e8"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/53ee068642a0174e038b8d61fe0791e8-15fab5c3242e486389fe2048d5ec5e00.png" target="_blank" rel="noopener">53ee068642a0174e038b8d61fe0791e8</a></p>
<p>2、如果没有可以到Window –&gt; Show View –&gt; Other中搜索”servers”，如下图:</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/4c3f46765ddae7d3cac4287efe14fa6e-69e222c9ff48445ebeda58bc97e1e8e5.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870809-0448735b945dc1d7c5d7d22c80f159f3.png" alt="4c3f46765ddae7d3cac4287efe14fa6e"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/4c3f46765ddae7d3cac4287efe14fa6e-69e222c9ff48445ebeda58bc97e1e8e5.png" target="_blank" rel="noopener">4c3f46765ddae7d3cac4287efe14fa6e</a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/cf2948fcf3af5900fc2b70f8769e9b05-815e4a1603514b5da570b985fde82a58.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870809-e854b4ab5e577a8cea26651af679a26b.png" alt="cf2948fcf3af5900fc2b70f8769e9b05"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/cf2948fcf3af5900fc2b70f8769e9b05-815e4a1603514b5da570b985fde82a58.png" target="_blank" rel="noopener">cf2948fcf3af5900fc2b70f8769e9b05</a></p>
<p>3、在Server窗口中点击“No servers are available…”链接：</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/ba09d4090bccbc59c3d1057bcab8d07d-673d8cb391264bd59bb01238e0391722.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870809-1cca5c521038ed45ec3e564746dc9596.png" alt="ba09d4090bccbc59c3d1057bcab8d07d"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/ba09d4090bccbc59c3d1057bcab8d07d-673d8cb391264bd59bb01238e0391722.png" target="_blank" rel="noopener">ba09d4090bccbc59c3d1057bcab8d07d</a></p>
<p>4、在弹出的窗口中，保持默认配置，直接点击完成</p>
<p>如果弹出的窗口中默认的服务器不是tomcat，则说明在此之前没有将Tomcat整合到Eclipse中。</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/08e1747f402c1be68ae9cf62ee7719e0-61c84d2c21064e8382518164daa5943b.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870809-7044d4c4d201212f2e9316955ff257d8.png" alt="08e1747f402c1be68ae9cf62ee7719e0"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/08e1747f402c1be68ae9cf62ee7719e0-61c84d2c21064e8382518164daa5943b.png" target="_blank" rel="noopener">08e1747f402c1be68ae9cf62ee7719e0</a></p>
<p>5、在上一步点完成后，Eclipses左侧会多出一个Servers项目，Servers窗口中会出现创建的Server，也就是tomcat服务器。</p>
<p>注意：①处的Servers项目不能关闭（close），更不能删除（delete）</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/dfd52724dc14ed43f7c48ca16ac85da4-426cb96dad9a4630b963ad781f445ef4.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870809-8ac5ce091b3ed554c8c204833d438563.png" alt="dfd52724dc14ed43f7c48ca16ac85da4"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/dfd52724dc14ed43f7c48ca16ac85da4-426cb96dad9a4630b963ad781f445ef4.png" target="_blank" rel="noopener">dfd52724dc14ed43f7c48ca16ac85da4</a></p>
<p>6、在创建完Server后，双击tomcat，可以修改Tomcat服务器配置</p>
<p>(1)将Server Locations中的选项切换为第二个选项</p>
<p>(2)将Deploy Path右侧的输入框中的内容改为webapps。ctrl+s保存配置即可</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200328164951699-9d3014ff11e84ed7bf347805f43c9440.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870809-cd3d3aa2535f802c2ce880db3a378125.png" alt="image-20200328164951699"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200328164951699-9d3014ff11e84ed7bf347805f43c9440.png" target="_blank" rel="noopener">image-20200328164951699</a></p>
<p>以上配置是为了保证在Eclipse中发布Web应用到tomcat服务器中时，可以将项目发布到tomcat服务器的webapps目录下。</p>
<p>如果不配置，会导致tomcat服务器中webapps下的Web应用无法访问。</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/28b8712f4f5114a24acde35017275a93-f7e18dcf2d8244c4bdfa2421f648163b.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870809-8f41c7b847d1f53f73a7afc7e04d51c6.png" alt="28b8712f4f5114a24acde35017275a93"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/28b8712f4f5114a24acde35017275a93-f7e18dcf2d8244c4bdfa2421f648163b.png" target="_blank" rel="noopener">28b8712f4f5114a24acde35017275a93</a></p>
<p>7、如果要移除添加的Server，需要同时删除①处的Servers项目（右键delete，要彻底从硬盘上删除），以及删除②处的tomcat服务器（右键delete）</p>
<p><a href="file:///C:/Users/zhangsz/Desktop/media/dfd52724dc14ed43f7c48ca16ac85da4.png"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870809-ea14d98ed2b80ac2593fb1a77f193aa5.png" alt=""></a></p>
<h3 id="tomcat右键选项介绍"><a href="#tomcat右键选项介绍" class="headerlink" title="tomcat右键选项介绍"></a>tomcat右键选项介绍</h3><p><a href="https://www.zhangpeng.fun/upload/2020/06/1eec7770246693752b0eaa984ca7e92c-1584273824888-75751560e3e74ca8944a28d988efcfeb.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870809-fad667a8f8880123d7db41692fd54854.png" alt="1eec7770246693752b0eaa984ca7e92c-1584273824888"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/1eec7770246693752b0eaa984ca7e92c-1584273824888-75751560e3e74ca8944a28d988efcfeb.png" target="_blank" rel="noopener">1eec7770246693752b0eaa984ca7e92c-1584273824888</a></p>
<p>a) Start：用于启动tomcat服务器，如果已启动，则显示 ReStart，作用是重启服务器</p>
<p>b) Stop：用于停止服务器</p>
<p>c) Add and Remove：将Web应用部署到tomcat服务器中，或者移除服务器中部署的Web应用</p>
<p>d) Clean：作用是将发布到Eclipse自己的webapps目录中的项目删除再重新部署</p>
<p>e) Clean Tomcat Work Directory：作用是将在tomcat运行过程中存入work目录的文件删除</p>
<h3 id="tomcat启动失败常见原因"><a href="#tomcat启动失败常见原因" class="headerlink" title="tomcat启动失败常见原因"></a>tomcat启动失败常见原因</h3><p><strong>问题1：tomcat服务器启动失败-1</strong></p>
<p>如果在启动服务器时，服务器启动失败，并弹出窗口显示如下异常信息：</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/25c037cb7399daf7127195a451115c07-1584273824889-50d107a30e4e4a78a904456bf8a511b7.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870809-29719217619a9c0b37efb754177dd69a.png" alt="25c037cb7399daf7127195a451115c07-1584273824889"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/25c037cb7399daf7127195a451115c07-1584273824889-50d107a30e4e4a78a904456bf8a511b7.png" target="_blank" rel="noopener">25c037cb7399daf7127195a451115c07-1584273824889</a></p>
<p>根据上面的描述信息，可以看出是8005、8080、8009端口被同时占用了，此时只有一种可能，就是之前已经启动了tomcat或者之前开启的tomcat没有完全关闭导致的。</p>
<p>解决方式：到tomcat安装目录找到bin目录中的shutdown.bat文件，双击运行将服务器关闭，再到Eclipse中启动服务器即可！</p>
<p><strong>问题2：tomcat服务器启动失败-2</strong></p>
<p>如果在启动服务器时，服务器启动失败，并弹出窗口显示如下异常信息：</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/d4e3c02075eb7f39ac1ea72e31aab137-1584273824889-de964102d6cd42ed813fef227bd04270.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870809-9bcd99b737ebc8d341fe8145232c0598.png" alt="d4e3c02075eb7f39ac1ea72e31aab137-1584273824889"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/d4e3c02075eb7f39ac1ea72e31aab137-1584273824889-de964102d6cd42ed813fef227bd04270.png" target="_blank" rel="noopener">d4e3c02075eb7f39ac1ea72e31aab137-1584273824889</a></p>
<p><strong>解决方法：</strong></p>
<p>(1) 可以先将服务器中所有的Web应用移除（在服务器上右键，<strong>Add and Remove</strong>--&gt;<strong>Remove All</strong>--&gt;<strong>Finish</strong>）</p>
<p>(2) 再分别执行服务器右键选项中的<strong>clean</strong>和<strong>Clean Tomcat Work Directory</strong></p>
<p>(3)再次启动服务器，如果启动没有报错，则说明tomcat服务器本身没有问题，再将要运行的项目发布到tomcat中，再次启动服务器，观察是否有错误。如果有则说明是项目本身的问题。</p>
<p>(4)如果移除了所有的Web应用，启动tomcat服务器报错，则说明tomcat本身就有问题，可以将tomcat服务器重新配置一次到Eclipse中(将tomcat和Server项目删除，再点击链接重新创建Server)</p>
<h1 id="javaweb-tomcat-http"><a href="#javaweb-tomcat-http" class="headerlink" title="javaweb   tomcat   http"></a><a href="https://www.zhangpeng.fun/tags/javaweb" target="_blank" rel="noopener">javaweb</a>   <a href="https://www.zhangpeng.fun/tags/tomcat" target="_blank" rel="noopener">tomcat</a>   <a href="https://www.zhangpeng.fun/tags/http" target="_blank" rel="noopener">http</a></h1>]]></content>
      <categories>
        <category>JavaWeb</category>
      </categories>
      <tags>
        <tag>javaweb</tag>
        <tag>http</tag>
        <tag>tomcat</tag>
      </tags>
  </entry>
  <entry>
    <title>05-jQuery</title>
    <url>/2020/06/11/05-jQuery/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="05-jQuery"><a href="#05-jQuery" class="headerlink" title="05-jQuery"></a>05-jQuery</h1><h1 id="unit05-jQuery"><a href="#unit05-jQuery" class="headerlink" title="unit05-jQuery"></a>unit05-jQuery</h1><h2 id="jQuery简介"><a href="#jQuery简介" class="headerlink" title="jQuery简介"></a>jQuery简介</h2><h3 id="什么是jQuery-了解"><a href="#什么是jQuery-了解" class="headerlink" title="什么是jQuery(了解)"></a>什么是jQuery(了解)</h3><p>jQuery: JavaScript Query JS查询</p>
<p>jQuery是一门轻量的、免费开源的JS函数库（就是JS的简单框架）</p>
<p>jQuery可以极大的简化JS代码</p>
<p>jQuery的核心思想：“写的更少，但做的更多”</p>
<p><em>轻量的：是指一个技术对代码或程序的侵入程度是比较低的。</em></p>
<p><em>或者说代码对该技术依赖程度越低，这个技术越轻。对该技术的依赖程度越高，这个技术越重。</em></p>
<p><em>jQuery本质就是一个包含了很多函数的JS文件，如果要在某一个HTML中使用这个JS文件中的函数，就必须得将JS文件引入到HTML中</em></p>
<h3 id="jQuery的优势-了解"><a href="#jQuery的优势-了解" class="headerlink" title="jQuery的优势(了解)"></a>jQuery的优势(了解)</h3><p>(1) 可以极大的简化JS代码</p>
<p>(2) 可以像CSS选择器一样获取html元素</p>
<p>css中获取所有的div,给div添加样式:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">div&#123; css属性... &#125;</span><br></pre></td></tr></table></figure>

<p>jQuery中获取所有div,给div添加边框样式:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$(&quot;div&quot;).css(&quot;border&quot;, &quot;2px solid red&quot;);</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">JS获取id为div1的元素: document.getElementById(&quot;div1&quot;)</span><br><span class="line">jQuery获取id为div1的元素: $(&quot;#div1&quot;)</span><br></pre></td></tr></table></figure>

<p>(3) 可以通过修改css属性控制页面的效果</p>
<p>(4) 可以兼容常用的浏览器</p>
<p>比如: JS中的innerText属性、removeNode()函数、replaceNode( )函数 这些函数在某些浏览器中是无法使用的。</p>
<p>jQuery中提供了相应的函数（ text函数、remove函数、replaceWith函数 ）</p>
<p>常用浏览器：谷歌浏览器、火狐浏览器、苹果浏览器、欧朋浏览器等</p>
<h3 id="jQuery引入"><a href="#jQuery引入" class="headerlink" title="jQuery引入"></a>jQuery引入</h3><p>jQuery的函数库文件就是一个普通的JS文件，引入jQuery和引入JS文件的方式一样。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;!-- 在使用jQuery之前，必须先引入jQuery的函数库文件 --&gt;</span><br><span class="line">&lt;script src=<span class="string">"js/jquery-1.8.3.js"</span>&gt;&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure>

<p>在引入jQuery函数库文件时，如果文件引入路径错误，则会导致文件引入失败，如下图：</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200217103533313-8e1ac59d625745479b4d5082b6745f4b.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870741-60d8fdf8e624fd55b17587b006775bc2.png" alt="image-20200217103533313"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200217103533313-8e1ac59d625745479b4d5082b6745f4b.png" target="_blank" rel="noopener">image-20200217103533313</a></p>
<h3 id="文档就绪事件函数"><a href="#文档就绪事件函数" class="headerlink" title="文档就绪事件函数"></a>文档就绪事件函数</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 在使用jQuery之前，必须先引入jQuery的函数库文件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"js/jquery-1.8.3.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript">	<span class="comment">//1.获取id为demo的h1元素</span></span></span><br><span class="line"><span class="javascript">	<span class="keyword">var</span> h1 = <span class="built_in">document</span>.getElementById( <span class="string">"demo"</span> );</span></span><br><span class="line"><span class="actionscript">	<span class="comment">//2.获取h1元素中的内容( innerHTML )</span></span></span><br><span class="line">	alert( h1.innerHTML );</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">h1</span> <span class="attr">id</span>=<span class="string">"demo"</span>&gt;</span>jQuery的引入示例...<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>问题描述：上面的代码在执行时，会报一个错误：</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200217105525351-eba46d071c4f4f4e8071eb09f139847c.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870741-a19b529a1de4695ac6d00da9d37714f0.png" alt="image-20200217105525351"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200217105525351-eba46d071c4f4f4e8071eb09f139847c.png" target="_blank" rel="noopener">image-20200217105525351</a></p>
<p>原因描述：在执行获取id为demo的元素时, h1元素还没有被浏览器加载到，所以获取不到h1元素。</p>
<p><strong>解决方式一：</strong></p>
<p>将script标签移到body内部，也就是h1元素的后面</p>
<p>这样浏览器在加载时，会先加载h1元素，再执行获取h1元素的代码，由于在获取h1元素之前，h1元素已经被浏览器加载过了，所以后面再获取就能够获取到！</p>
<p>代码示例：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">h1</span> <span class="attr">id</span>=<span class="string">"demo"</span>&gt;</span>jQuery的引入示例...<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript">		<span class="comment">//1.获取id为demo的h1元素</span></span></span><br><span class="line"><span class="javascript">		<span class="keyword">var</span> h1 = <span class="built_in">document</span>.getElementById( <span class="string">"demo"</span> );</span></span><br><span class="line"><span class="actionscript">		<span class="comment">//2.获取h1元素中的内容( innerHTML )</span></span></span><br><span class="line">		alert( h1.innerHTML );</span><br><span class="line">	<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>解决方式二：</strong></p>
<p>将获取元素的代码放在文档就绪事件函数中，文档就绪事件函数会在浏览器加载完所有的html元素后（也就是加载完最后一个html元素时）会立即执行。</p>
<p>由于整个html网页都被加载了，h1元素肯定也被加载了，此时再获取h1元素就一定能获取到。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 在使用jQuery之前，必须先引入jQuery的函数库文件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"js/jquery-1.8.3.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">	$(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="actionscript">		<span class="comment">//1.获取id为demo的h1元素</span></span></span><br><span class="line"><span class="javascript">		<span class="keyword">var</span> h1 = <span class="built_in">document</span>.getElementById( <span class="string">"demo"</span> );</span></span><br><span class="line"><span class="actionscript">		<span class="comment">//2.获取h1元素中的内容( innerHTML )</span></span></span><br><span class="line">		alert( h1.innerHTML );</span><br><span class="line">	&#125;);</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">h1</span> <span class="attr">id</span>=<span class="string">"demo"</span>&gt;</span>jQuery的引入示例...<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>解决方式三：</strong></p>
<p>将获取元素的代码放在一个自定义的函数中，并将该函数绑定在h1元素的点击事件上，当我们点击h1元素时会执行自定义的函数，函数执行时才获取h1元素，此时就能够获取到h1元素。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 在使用jQuery之前，必须先引入jQuery的函数库文件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"js/jquery-1.8.3.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript">	<span class="function"><span class="keyword">function</span> <span class="title">fn1</span><span class="params">()</span></span>&#123;</span></span><br><span class="line"><span class="actionscript">		<span class="comment">//1.获取id为demo的h1元素</span></span></span><br><span class="line"><span class="javascript">		<span class="keyword">var</span> h1 = <span class="built_in">document</span>.getElementById( <span class="string">"demo"</span> );</span></span><br><span class="line"><span class="actionscript">		<span class="comment">//2.获取h1元素中的内容( innerHTML )</span></span></span><br><span class="line">		alert( h1.innerHTML );</span><br><span class="line">	&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">h1</span> <span class="attr">id</span>=<span class="string">"demo"</span> <span class="attr">onclick</span>=<span class="string">"fn1()"</span>&gt;</span>jQuery的引入示例...<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>总结：什么时候该使用文档就绪事件函数?</strong></p>
<p>如果在获取元素时，获取元素的代码执行的时机，比元素本身加载的时间还要早，如果元素还没有加载就获取，必然是获取不到的。</p>
<p>可以将获取元素的代码放在文档就绪事件函数中，等浏览器加载完整个网页后，文档就绪事件函数才会执行，此时所有的元素都被加载了，再获取任何元素都能获取到！</p>
<p>jQuery提供的文档就绪事件函数（简写形式）：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">	$(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="actionscript">		<span class="comment">//在浏览器加载完整个html网页后立即执行</span></span></span><br><span class="line">  &#125;);</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>其完整写法为：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">	$(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="actionscript">		<span class="comment">//在浏览器加载完整个html网页后立即执行</span></span></span><br><span class="line">	&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>JS也为我们提供了文档就绪事件函数，其写法为：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">	<span class="built_in">window</span>.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="actionscript">		<span class="comment">//在浏览器加载完整个html网页后立即执行</span></span></span><br><span class="line">	&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="jQuery选择器-重点掌握"><a href="#jQuery选择器-重点掌握" class="headerlink" title="jQuery选择器(重点掌握)"></a>jQuery选择器(重点掌握)</h2><h3 id="基本选择器"><a href="#基本选择器" class="headerlink" title="基本选择器"></a>基本选择器</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">(<span class="number">1</span>)元素名选择器</span><br><span class="line">$(<span class="string">"div"</span>) -- 选中所有的div元素</span><br><span class="line">$(<span class="string">"span"</span>) -- 选中所有的span元素</span><br><span class="line"></span><br><span class="line">(<span class="number">2</span>)<span class="class"><span class="keyword">class</span>/类选择器</span></span><br><span class="line">$(".s1") -- 选中所有class值为s1的元素(class值为s1的元素可能是任何元素)</span><br><span class="line">$(<span class="string">"span.s1"</span>) -- 选中所有<span class="class"><span class="keyword">class</span>值为<span class="title">s1</span>的<span class="title">span</span>元素</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">(3)<span class="title">id</span>选择器</span></span><br><span class="line">$("#one") -- 选中id为one的元素</span><br><span class="line"></span><br><span class="line">(<span class="number">4</span>)多元素选择器</span><br><span class="line">$(<span class="string">"div,span,.s1,#one"</span>) -- 选中所有的div元素,以及所有的span元素,以及所有<span class="class"><span class="keyword">class</span>值为<span class="title">s1</span>的元素,以及<span class="title">id</span>为<span class="title">one</span>的元素</span></span><br></pre></td></tr></table></figure>

<h3 id="层级选择器"><a href="#层级选择器" class="headerlink" title="层级选择器"></a>层级选择器</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$(<span class="string">"div span"</span>) -- 选中所有div内部的所有span元素</span><br><span class="line">$(<span class="string">"#one span"</span>) -- 选中id为one的元素内部的所有span元素</span><br><span class="line"></span><br><span class="line">$(<span class="string">"#two+span"</span>) -- 选中id为two的元素后面紧邻的span兄弟元素</span><br><span class="line">$(<span class="string">"#two"</span>).next(<span class="string">"span"</span>) -- 选中id为two的元素后面紧邻的span兄弟元素</span><br><span class="line">$(<span class="string">"#two"</span>).prev(<span class="string">"span"</span>) -- 选中id为two的元素前面紧邻的span兄弟元素</span><br><span class="line"></span><br><span class="line">$(<span class="string">"#two~span"</span>) -- 选中id为two的元素后面所有的span兄弟元素</span><br><span class="line">$(<span class="string">"#two"</span>).nextAll(<span class="string">"span"</span>) -- 选中id为two的元素后面所有的span兄弟元素</span><br><span class="line">$(<span class="string">"#two"</span>).prevAll(<span class="string">"span"</span>) -- 选中id为two的元素前面所有的span兄弟元素</span><br><span class="line"></span><br><span class="line">$(<span class="string">"#two"</span>).siblings(<span class="string">"span"</span>) -- 选中id为two的元素前、后所有的span兄弟元素</span><br></pre></td></tr></table></figure>

<h3 id="基本过滤选择器"><a href="#基本过滤选择器" class="headerlink" title="基本过滤选择器"></a>基本过滤选择器</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">(<span class="number">1</span>) 选中第一个div元素</span><br><span class="line">$(<span class="string">"div:first"</span>)</span><br><span class="line">$(<span class="string">"div:eq(0)"</span>)</span><br><span class="line">$(<span class="string">"div"</span>).eq(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">(<span class="number">2</span>) 选中最后一个div元素</span><br><span class="line">$(<span class="string">"div:last"</span>)</span><br><span class="line">$(<span class="string">"div:eq(-1)"</span>)</span><br><span class="line">$(<span class="string">"div"</span>).eq(<span class="number">-1</span>)</span><br><span class="line"></span><br><span class="line">(<span class="number">3</span>) 选中第n+<span class="number">1</span>个div元素(n从零开始)</span><br><span class="line">$(<span class="string">"div:eq(n)"</span>)</span><br><span class="line">$(<span class="string">"div"</span>).eq(n)</span><br></pre></td></tr></table></figure>

<h2 id="综合案例"><a href="#综合案例" class="headerlink" title="综合案例"></a>综合案例</h2><h3 id="创建表格元素"><a href="#创建表格元素" class="headerlink" title="创建表格元素"></a>创建表格元素</h3><p><strong>练习1：创建单行单列的表格</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createTable1</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="comment">//1.创建一个table元素</span></span><br><span class="line">	<span class="keyword">var</span> $tab = $(<span class="string">"&lt;table&gt;&lt;/table&gt;"</span>);</span><br><span class="line">	<span class="comment">//2.创建一个tr元素</span></span><br><span class="line">	<span class="keyword">var</span> $tr = $(<span class="string">"&lt;tr&gt;&lt;/tr&gt;"</span>);</span><br><span class="line">	<span class="comment">//3.创建一个td元素, 并为td添加内容</span></span><br><span class="line">	<span class="keyword">var</span> $td = $(<span class="string">"&lt;td&gt;&lt;/td&gt;"</span>);</span><br><span class="line">	$td.html(<span class="string">"Hello TD~~"</span>);</span><br><span class="line">	<span class="comment">//4.将td添加到tr元素内部</span></span><br><span class="line">	$tr.append( $td );</span><br><span class="line">	<span class="comment">//5.将tr添加到table元素内部</span></span><br><span class="line">	$tab.append( $tr );</span><br><span class="line">	<span class="comment">//6.将table添加到body元素内部</span></span><br><span class="line">	$(<span class="string">"body"</span>).append( $tab ); </span><br><span class="line">	</span><br><span class="line">	<span class="comment">//$("body").append( "&lt;table&gt;&lt;tr&gt;&lt;td&gt;Hello~~TD...&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;" );</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>练习2.1：创建单行6列的表格</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createTable2</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="comment">//1.创建一个table元素</span></span><br><span class="line">	<span class="keyword">var</span> $tab = $(<span class="string">"&lt;table&gt;&lt;/table&gt;"</span>);</span><br><span class="line">	<span class="comment">//2.创建一个tr元素</span></span><br><span class="line">	<span class="keyword">var</span> $tr = $(<span class="string">"&lt;tr&gt;&lt;/tr&gt;"</span>);</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;<span class="number">6</span>;i++)&#123; </span><br><span class="line">		<span class="comment">//3.创建一个td元素, 并为td添加内容</span></span><br><span class="line">		<span class="keyword">var</span> $td = $(<span class="string">"&lt;td&gt;&lt;/td&gt;"</span>);</span><br><span class="line">		$td.html(<span class="string">"Hello TD~~"</span>);</span><br><span class="line">		<span class="comment">//4.将td添加到tr元素内部</span></span><br><span class="line">		$tr.append( $td );</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//5.将tr添加到table元素内部</span></span><br><span class="line">	$tab.append( $tr );</span><br><span class="line">	<span class="comment">//6.将table添加到body元素内部</span></span><br><span class="line">	$(<span class="string">"body"</span>).append( $tab ); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>练习2.2：创建5行6列的表格</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createTable2</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="comment">//1.创建一个table元素</span></span><br><span class="line">	<span class="keyword">var</span> $tab = $(<span class="string">"&lt;table&gt;&lt;/table&gt;"</span>);</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">var</span> j=<span class="number">0</span>;j&lt;<span class="number">5</span>;j++)&#123; <span class="comment">//外层循环:控制行数</span></span><br><span class="line">		<span class="comment">//2.创建一个tr元素</span></span><br><span class="line">		<span class="keyword">var</span> $tr = $(<span class="string">"&lt;tr&gt;&lt;/tr&gt;"</span>);</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;<span class="number">6</span>;i++)&#123; <span class="comment">//内层循环:控制列数</span></span><br><span class="line">			<span class="comment">//3.创建一个td元素, 并为td添加内容</span></span><br><span class="line">			<span class="keyword">var</span> $td = $(<span class="string">"&lt;td&gt;&lt;/td&gt;"</span>);</span><br><span class="line">			$td.html(<span class="string">"Hello TD~~"</span>);</span><br><span class="line">			<span class="comment">//4.将td添加到tr元素内部</span></span><br><span class="line">			$tr.append( $td );</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//5.将tr添加到table元素内部</span></span><br><span class="line">		$tab.append( $tr );</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//6.将table添加到body元素内部</span></span><br><span class="line">	$(<span class="string">"body"</span>).append( $tab ); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>练习3：创建指定行和列的表格</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createTable3</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="comment">//获取用户输入的行数和列数(js方式)</span></span><br><span class="line">	<span class="comment">//var rows = document.getElementById("rows").value;</span></span><br><span class="line">	<span class="comment">//var cols = document.getElementById("cols").value;</span></span><br><span class="line">	<span class="keyword">var</span> rows = $(<span class="string">"#rows"</span>).val();</span><br><span class="line">	<span class="keyword">var</span> cols = $(<span class="string">"#cols"</span>).val();</span><br><span class="line">	<span class="built_in">console</span>.log(rows+<span class="string">" : "</span>+cols);</span><br><span class="line">	<span class="comment">//1.创建一个table元素</span></span><br><span class="line">	<span class="keyword">var</span> $tab = $(<span class="string">"&lt;table&gt;&lt;/table&gt;"</span>);</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">var</span> j=<span class="number">0</span>;j&lt;rows;j++)&#123; <span class="comment">//外层循环:控制行数</span></span><br><span class="line">		<span class="comment">//2.创建一个tr元素</span></span><br><span class="line">		<span class="keyword">var</span> $tr = $(<span class="string">"&lt;tr&gt;&lt;/tr&gt;"</span>);</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;cols;i++)&#123; <span class="comment">//内层循环:控制列数</span></span><br><span class="line">			<span class="comment">//3.创建一个td元素, 并为td添加内容</span></span><br><span class="line">			<span class="keyword">var</span> $td = $(<span class="string">"&lt;td&gt;&lt;/td&gt;"</span>);</span><br><span class="line">			$td.html(<span class="string">"Hello TD~~"</span>);</span><br><span class="line">			<span class="comment">//4.将td添加到tr元素内部</span></span><br><span class="line">			$tr.append( $td );</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//5.将tr添加到table元素内部</span></span><br><span class="line">		$tab.append( $tr );</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//6.将table添加到body元素内部</span></span><br><span class="line">	$(<span class="string">"body"</span>).append( $tab ); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="仿QQ好友列表"><a href="#仿QQ好友列表" class="headerlink" title="仿QQ好友列表"></a>仿QQ好友列表</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/** 通过jQuery实现仿QQ列表好友列表 */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">openDiv</span>(<span class="params">thisobj</span>)</span>&#123; <span class="comment">//thisobj是一个js对象 --转成--&gt; jQuery对象</span></span><br><span class="line">	<span class="comment">//先将其他三个分组关闭( 将其他三个分组内的div设置为隐藏 )</span></span><br><span class="line">	$(<span class="string">"table span"</span>).not(thisobj).next(<span class="string">"div"</span>).hide(); <span class="comment">//css("display", "none")</span></span><br><span class="line">	<span class="comment">//根据被点击的分组找到分组内的好友列表, 切换好友列表的展示状态</span></span><br><span class="line">	$(thisobj).next(<span class="string">"div"</span>).toggle(); <span class="comment">//如果元素显示则切换为隐藏, 如果隐藏则切换为显示</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="模拟员工信息管理系统"><a href="#模拟员工信息管理系统" class="headerlink" title="模拟员工信息管理系统"></a>模拟员工信息管理系统</h3><p>练习1：添加员工信息</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addEmp</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="comment">//1.获取要添加的员工信息(id, name, email, salary)</span></span><br><span class="line">	<span class="keyword">var</span> id = $(<span class="string">"#box1 input[name='id']"</span>).val().trim();</span><br><span class="line">	<span class="keyword">var</span> name = $(<span class="string">"#box1 input[name='name']"</span>).val().trim();</span><br><span class="line">	<span class="keyword">var</span> email = $(<span class="string">"#box1 input[name='email']"</span>).val().trim();</span><br><span class="line">	<span class="keyword">var</span> salary = $(<span class="string">"#box1 input[name='salary']"</span>).val().trim();</span><br><span class="line">	<span class="built_in">console</span>.log(id+<span class="string">" : "</span>+name+<span class="string">" : "</span>+email+<span class="string">" : "</span>+salary);</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//2.校验员工信息</span></span><br><span class="line">	<span class="comment">//2.1.添加的员工信息不能为空!</span></span><br><span class="line">	<span class="keyword">if</span>( id == <span class="string">""</span> || name == <span class="string">""</span> || email == <span class="string">""</span> || salary == <span class="string">""</span> )&#123;</span><br><span class="line">		alert( <span class="string">"添加的员工信息不能为空!"</span> );</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//2.2.添加的员工id不能重复! (id=3)</span></span><br><span class="line">	<span class="comment">//获取所有的tr元素, 并遍历所有的tr元素</span></span><br><span class="line">	<span class="keyword">var</span> flag = <span class="literal">false</span>; <span class="comment">//false表示id是不存在的!!!</span></span><br><span class="line">	$(<span class="string">"table tr"</span>).each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="comment">//this(JS对象)表示当前被遍历的元素 </span></span><br><span class="line">		<span class="comment">// this --转换为jQuery对象--&gt; $( this ) </span></span><br><span class="line">		<span class="keyword">var</span> _id = $(<span class="keyword">this</span>).find(<span class="string">"td:eq(1)"</span>).text();</span><br><span class="line">		<span class="comment">//拿着用户输入的id和当前员工的id进行比较</span></span><br><span class="line">		<span class="keyword">if</span>( id == _id )&#123; <span class="comment">//只要有一个相等,就说明id已存在,则停止添加</span></span><br><span class="line">			alert(<span class="string">"您输入的员工ID已存在, 请重新添加!"</span>);</span><br><span class="line">			flag = <span class="literal">true</span>; <span class="comment">//true表示id已存在!!</span></span><br><span class="line">			<span class="comment">//return; 放在这里的return不能终止程序的执行</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;);</span><br><span class="line">	<span class="keyword">if</span>( flag )&#123; <span class="comment">//true表示id已存在!!</span></span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//3.将员工信息添加到页面上(添加到table中)</span></span><br><span class="line">	<span class="comment">//&gt;&gt;创建一个tr元素</span></span><br><span class="line">	<span class="keyword">var</span> $tr = $(<span class="string">"&lt;tr&gt;&lt;/tr&gt;"</span>);</span><br><span class="line">	<span class="comment">//&gt;&gt;创建5个td元素,并将员工信息添加到td中</span></span><br><span class="line">	<span class="keyword">var</span> $td1 = $(<span class="string">"&lt;td&gt;&lt;input type='checkbox'/&gt;&lt;/td&gt;"</span>); <span class="comment">//复选框</span></span><br><span class="line">	<span class="keyword">var</span> $td2 = $(<span class="string">"&lt;td&gt;"</span>+id+<span class="string">"&lt;/td&gt;"</span>); <span class="comment">//ID</span></span><br><span class="line">	<span class="keyword">var</span> $td3 = $(<span class="string">"&lt;td&gt;"</span>+name+<span class="string">"&lt;/td&gt;"</span>); <span class="comment">//name</span></span><br><span class="line">	<span class="keyword">var</span> $td4 = $(<span class="string">"&lt;td&gt;"</span>+email+<span class="string">"&lt;/td&gt;"</span>); <span class="comment">//email</span></span><br><span class="line">	<span class="keyword">var</span> $td5 = $(<span class="string">"&lt;td&gt;"</span>+salary+<span class="string">"&lt;/td&gt;"</span>); <span class="comment">//email</span></span><br><span class="line">	<span class="comment">//&gt;&gt;将td元素添加到tr中</span></span><br><span class="line">	$tr.append( $td1 ).append( $td2 ).append( $td3 ).append( $td4 ).append( $td5 );</span><br><span class="line">			</span><br><span class="line">	<span class="comment">//&gt;&gt;将tr元素添加到table中</span></span><br><span class="line">	$(<span class="string">"table"</span>).append( $tr );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>练习2：删除员工信息</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">delEmp</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="comment">//1.获取所选中员工所在的tr行 (获取所有被选中的复选框)</span></span><br><span class="line">	<span class="comment">//$("input:checked").parents("tr").remove(); //会连接表头一起删除</span></span><br><span class="line">	$(<span class="string">"input:checked"</span>).parent(<span class="string">"td"</span>).parent(<span class="string">"tr"</span>).remove();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>练习3：修改员工信息（自己完成）</p>
<p>练习4：实现全选或全不选</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkAll</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="comment">//1.获取全选复选框的选中状态( 选中(true)?  没选中(false)? )</span></span><br><span class="line">	<span class="keyword">var</span> isCheck = $(<span class="string">"#all"</span>).prop(<span class="string">"checked"</span>); <span class="comment">//true|false</span></span><br><span class="line">	<span class="comment">//2.获取所有普通复选框, 将全选框的选中状态设置给所有普通复选框</span></span><br><span class="line">	$(<span class="string">"input[type='checkbox'][id!='all']"</span>).prop(<span class="string">"checked"</span>,isCheck);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="jQuery总结"><a href="#jQuery总结" class="headerlink" title="jQuery总结"></a>jQuery总结</h2><h3 id="html元素操作"><a href="#html元素操作" class="headerlink" title="html元素操作"></a>html元素操作</h3><p><strong>1、创建元素</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$(<span class="string">"&lt;div&gt;&lt;/div&gt;"</span>) -- 创建一个div元素，返回的是一个表示div元素的jQuery对象</span><br><span class="line">$(<span class="string">"&lt;div&gt;xxxx&lt;/div&gt;"</span>) -- 创建一个包含内容的div元素，返回的是一个表示div元素的jQuery对象</span><br></pre></td></tr></table></figure>

<p><strong>2、添加子元素</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$parent.append( $child ) -- 父元素调用方法添加子元素</span><br><span class="line">$(<span class="string">"body"</span>).append( <span class="string">"&lt;div&gt;我是新来的...&lt;/div&gt;"</span> ); -- 往body元素内部追加一个div子元素</span><br></pre></td></tr></table></figure>

<p><strong>3、删除元素</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$(<span class="string">"div"</span>).remove() -- 删除所有的div元素</span><br><span class="line"></span><br><span class="line">JS删除所有div元素：</span><br><span class="line"><span class="comment">//获取所有的div元素(返回的是所有div组成的数组)</span></span><br><span class="line"><span class="keyword">var</span> divArr = <span class="built_in">document</span>.getElementsByTagName(<span class="string">"div"</span>); <span class="comment">//div数组</span></span><br><span class="line"><span class="comment">//遍历div数组,依次删除每一个div元素</span></span><br><span class="line"><span class="keyword">var</span> len = divArr.length;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;len;i++)&#123;</span><br><span class="line">    <span class="comment">//通过当前元素的父元素删除当前元素(始终删除第一个)</span></span><br><span class="line">    divArr[<span class="number">0</span>].parentNode.removeChild( divArr[<span class="number">0</span>] );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>4、替换元素</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$(<span class="string">"div"</span>).replaceWith(<span class="string">"&lt;p&gt;我是来替换的…&lt;/p&gt;"</span>)</span><br></pre></td></tr></table></figure>

<h3 id="html元素内容和值的操作"><a href="#html元素内容和值的操作" class="headerlink" title="html元素内容和值的操作"></a>html元素内容和值的操作</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">  	这是一个div11元素</span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span>&gt;</span>这是一个span元素<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    这是一个div1111元素</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>1、html()函数 (类似于js中的innerHTML属性)</strong></p>
<p>-- 用于获取或设置元素的内容，比如为div、span、p、h1、table、tr、td等元素设置内容</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$(<span class="string">"div"</span>).html() -- 获取所有div中的第一个div的内容</span><br><span class="line">$(<span class="string">"div"</span>).html(<span class="string">"xxxx"</span>) -- 为所有div设置内容</span><br></pre></td></tr></table></figure>

<p><strong>2、text()函数 (类似于js中的innerText属性，innerText在部分浏览器中不兼容)</strong></p>
<p>-- 用于获取或设置元素的文本内容</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$(&quot;div&quot;).text() -- 获取所有div中的所有文本内容</span><br><span class="line">$(&quot;div&quot;).text(&quot;xxxx&quot;) -- 为所有div设置文本内容</span><br></pre></td></tr></table></figure>

<p><strong>3、val()函数</strong> (类似于js中的value属性)</p>
<p>-- 获取或设置表单项元素的value值(input/select/option/textarea)</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$(<span class="string">"input"</span>).val() -- 获取所有input元素中的第一个input元素的value值</span><br><span class="line">$(<span class="string">"input"</span>).val(值) -- 为所有的input元素设置value值</span><br></pre></td></tr></table></figure>

<h3 id="元素属性和css属性操作"><a href="#元素属性和css属性操作" class="headerlink" title="元素属性和css属性操作"></a>元素属性和css属性操作</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">id</span>=<span class="string">"inp"</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>1、prop()函数</strong> – 用于获取或设置元素的属性值</p>
<p>在jQuery1.6版本之后才有这个函数，1.6之前版本的jQuery可以使用attr()函数</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$(<span class="string">"input[type='checkbox']"</span>).prop(<span class="string">"checked"</span>)</span><br><span class="line">-- 获取input复选框的选中状态, 返回<span class="literal">true</span>表示复选框为选中状态,返回<span class="literal">false</span>表示复选框为取消选中状态</span><br><span class="line">$(<span class="string">"input[type='checkbox']"</span>).prop(<span class="string">"checked"</span>, <span class="literal">true</span>)</span><br><span class="line">-- 设置所匹配的复选框元素为选中状态</span><br><span class="line"></span><br><span class="line">$(<span class="string">"#inp"</span>).prop(<span class="string">"name"</span>); <span class="comment">//获取id为inp元素的name属性值, 返回useranme</span></span><br><span class="line">$(<span class="string">"#inp"</span>).prop(<span class="string">"name"</span>,<span class="string">"user"</span>); <span class="comment">//为id为inp的元素设置name属性值, name属性值就会变成user</span></span><br></pre></td></tr></table></figure>

<p><strong>2、css()函数</strong> – 用于获取或设置元素的css属性值</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$(<span class="string">"#div1"</span>).css(<span class="string">"width"</span>) -- 获取id为div1元素的宽度</span><br><span class="line">$(<span class="string">"#div1"</span>).css(<span class="string">"width"</span>,<span class="string">"200px"</span>) -- 设置id为div1元素的宽度为<span class="number">200</span>px</span><br><span class="line">$(<span class="string">"#div1"</span>).css(&#123;</span><br><span class="line">	<span class="string">"width"</span> : <span class="string">"200px"</span>,</span><br><span class="line">	<span class="string">"height"</span> : <span class="string">"150px"</span>,</span><br><span class="line">	<span class="string">"border"</span> : <span class="string">"5px solid red"</span>,</span><br><span class="line">	<span class="string">"background"</span> : <span class="string">"pink"</span></span><br><span class="line">&#125;); <span class="comment">// 设置id为div1元素的宽度为200px、高度为150px、边框以及背景颜色等样式</span></span><br></pre></td></tr></table></figure>

<h3 id="其他函数"><a href="#其他函数" class="headerlink" title="其他函数"></a>其他函数</h3><p><strong>1、each() 函数</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$(selector).each(function( index,element )&#123;&#125;)</span><br><span class="line">-- each()函数可以遍历$(selector)选择器选中的所有元素(即每次都选择器选中的元素中获取一个元素,并执行function 函数)</span><br><span class="line">-- function中的index -- 表示遍历的元素的下标</span><br><span class="line">-- function中的element -- 表示当前正在遍历的元素(也可以通过this获取)</span><br></pre></td></tr></table></figure>

<p><strong>2、show()/hide() 函数</strong></p>
<p>show() – 设置元素由隐藏变为显示</p>
<p>hide() – 设置元素由显示变为隐藏</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$(<span class="string">"div"</span>).show() -- 设置所有的div元素为显示</span><br></pre></td></tr></table></figure>

<p>等价于:</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$(<span class="string">"div"</span>).css(<span class="string">"display"</span>, <span class="string">"block"</span>);</span><br><span class="line"></span><br><span class="line">$(<span class="string">"div"</span>).hide() -- 设置所有的div元素为隐藏</span><br></pre></td></tr></table></figure>

<p>等价于:</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$(<span class="string">"div"</span>).css(<span class="string">"display"</span>, <span class="string">"none"</span>)</span><br></pre></td></tr></table></figure>

<p><strong>2、toggle()/slideToggle()</strong></p>
<p>toggle() – 切换元素的显示状态, 如果元素是显示的, 则切换为隐藏, 否则切换为显示</p>
<p>slidToggle() –切换元素的显示状态, 如果元素是显示的, 则切换为隐藏，否则切换为显示，切换为显示为下拉状态，隐藏为收缩状态。</p>
<h2 id="扩展-为元素绑定点击事件"><a href="#扩展-为元素绑定点击事件" class="headerlink" title="扩展:为元素绑定点击事件"></a>扩展:为元素绑定点击事件</h2><p>以点击事件为例，为元素绑定点击事件的方式为:</p>
<p><strong>方式1(js版)：</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    alert(<span class="string">"input按钮被点击了..."</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp">&lt;body&gt;</span></span><br><span class="line"><span class="regexp">	&lt;input onclick="fn()" type="button" value="点我~!" /</span>&gt;</span><br><span class="line">&lt;<span class="regexp">/body&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>方式2(js版)：</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">	<span class="built_in">window</span>.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		<span class="comment">//获取id为btn的元素</span></span><br><span class="line">		<span class="keyword">var</span> btn = <span class="built_in">document</span>.getElementById(<span class="string">"btn"</span>);</span><br><span class="line">		btn.onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">			alert(<span class="string">"input按钮被点击了..."</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp">&lt;body&gt;</span></span><br><span class="line"><span class="regexp">	&lt;input id="btn" type="button" value="点我~!" /</span>&gt;</span><br><span class="line">&lt;<span class="regexp">/body&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>方式3(jQuery版)：</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">$(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">//当点击btn按钮时,触发点击事件执行其中的函数</span></span><br><span class="line">    $(<span class="string">"#btn"</span>).click( <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        alert(<span class="string">"input按钮被点击了..."</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp">&lt;body&gt;</span></span><br><span class="line"><span class="regexp">	&lt;input id="btn" type="button" value="点我~!" /</span>&gt;</span><br><span class="line">&lt;<span class="regexp">/body&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="javaweb-jquery"><a href="#javaweb-jquery" class="headerlink" title="javaweb   jquery"></a><a href="https://www.zhangpeng.fun/tags/javaweb" target="_blank" rel="noopener">javaweb</a>   <a href="https://www.zhangpeng.fun/tags/jquery" target="_blank" rel="noopener">jquery</a></h1>]]></content>
      <categories>
        <category>JavaWeb</category>
      </categories>
      <tags>
        <tag>javaweb</tag>
        <tag>jquery</tag>
      </tags>
  </entry>
  <entry>
    <title>07-Servlet</title>
    <url>/2020/06/11/07-Servlet/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="07-Servlet"><a href="#07-Servlet" class="headerlink" title="07-Servlet"></a>07-Servlet</h1><h1 id="unit07-Servlet"><a href="#unit07-Servlet" class="headerlink" title="unit07-Servlet"></a>unit07-Servlet</h1><h2 id="Servlet概述"><a href="#Servlet概述" class="headerlink" title="Servlet概述"></a>Servlet概述</h2><h3 id="什么是Servlet"><a href="#什么是Servlet" class="headerlink" title="什么是Servlet?"></a>什么是Servlet?</h3><p>Servlet是由SUN公司提供的一门动态Web资源开发技术</p>
<p>Servlet本质上是一段Java程序，和之前的Java程序不同的是，Servlet程序无法独立运行，需要将Servlet程序放在服务器中（比如tomcat服务器），由服务器调用才可以执行。</p>
<p>Servlet: 服务器端的Java程序.</p>
<p>Servlet是运行在服务器端的Java程序，其作用是什么？</p>
<p>其作用是对服务器接收过来的请求进行处理（作用为处理请求）</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/329ebdac1b25e0943488cf41428e6552-f964411718354eefa88805e4d852a2c2.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870862-807efa250b09ad2859dfe12787a17181.png" alt="329ebdac1b25e0943488cf41428e6552"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/329ebdac1b25e0943488cf41428e6552-f964411718354eefa88805e4d852a2c2.png" target="_blank" rel="noopener">329ebdac1b25e0943488cf41428e6552</a></p>
<h2 id="开发Servlet程序"><a href="#开发Servlet程序" class="headerlink" title="开发Servlet程序"></a>开发Servlet程序</h2><h3 id="开发Servlet程序的步骤"><a href="#开发Servlet程序的步骤" class="headerlink" title="开发Servlet程序的步骤"></a>开发Servlet程序的步骤</h3><p>第一步: 写一个类，实现一个Servlet接口或者继承Servlet接口的子类（GenericServlet/HttpServlet），并实现其中的方法</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Servlet接口</span><br><span class="line">	|-- GenericServlet类(抽象类)</span><br><span class="line">				|-- HttpServlet类</span><br></pre></td></tr></table></figure>

<p>第二步: 在web应用的web.xml文件中配置Servlet程序对外访问的路径。</p>
<p>Eclipse在创建一个Servlet时，会在web.xml文件中生成Servlet配置，所以不需要我们手动配置。</p>
<h3 id="使用Eclipse创建Web项目"><a href="#使用Eclipse创建Web项目" class="headerlink" title="使用Eclipse创建Web项目"></a>使用Eclipse创建Web项目</h3><p><a href="https://www.zhangpeng.fun/upload/2020/06/22432d0ee6fe5616365ecb77f5748b37-1b9cb7b3e0104334a772b535f9e21070.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870862-f572f5d5c2a6695723de5b3b247791d0.png" alt="22432d0ee6fe5616365ecb77f5748b37"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/22432d0ee6fe5616365ecb77f5748b37-1b9cb7b3e0104334a772b535f9e21070.png" target="_blank" rel="noopener">22432d0ee6fe5616365ecb77f5748b37</a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/46a097af287c3d455ace4644c98ad27b-3b64c8e9cc14433b96ab71a4294851e6.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870862-17923ca722a306147b53d5ec832c4f32.png" alt="46a097af287c3d455ace4644c98ad27b"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/46a097af287c3d455ace4644c98ad27b-3b64c8e9cc14433b96ab71a4294851e6.png" target="_blank" rel="noopener">46a097af287c3d455ace4644c98ad27b</a></p>
<p>以上是Web项目在工程视图(Project)和包视图（package）下结构，推荐使用包视图！</p>
<p><strong>1、创建一个Web工程:</strong> 在左侧窗口中, 点击<strong>鼠标右键</strong> —&gt; <strong>New</strong> —&gt;<br><strong>Dynamic Web Project</strong>。</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/22fa5f600a0bdd2206b028c42d7feab3-bad3eb0adbed40c3b52c9fc9626f7dac.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870862-0f0c8533cee626148ef088525f0d59fe.png" alt="22fa5f600a0bdd2206b028c42d7feab3"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/22fa5f600a0bdd2206b028c42d7feab3-bad3eb0adbed40c3b52c9fc9626f7dac.png" target="_blank" rel="noopener">22fa5f600a0bdd2206b028c42d7feab3</a></p>
<p><strong>2、接着会弹出如下窗口:</strong></p>
<p>![创建Web项目](JAVAWEB-<a href="https://www.zhangpeng.fun/upload/2020/06/f534b2420e73dc56b14042eb95c91cc0-04c191c180a149e180f288412e4d95ea.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870862-adc04b51186c6441922501660c634b39.png" alt="f534b2420e73dc56b14042eb95c91cc0"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/f534b2420e73dc56b14042eb95c91cc0-04c191c180a149e180f288412e4d95ea.png" target="_blank" rel="noopener">f534b2420e73dc56b14042eb95c91cc0</a></p>
<p><strong>注意：</strong></p>
<p>(1) 3.0版本不会创建web.xml文件,<br>并且创建Servlet时也不会在web.xml文件中生成Servlet相关的配置信息, 记得改为2.5。</p>
<p>(2) Target runtime选项中如果没有可选的服务器，可点击右侧的”New<br>Runtime…”进行配置。</p>
<p>详细操作步骤在《5.2配置Target runtime（Web项目运行环境）》</p>
<p><strong>3、Eclipse中创建的Web工程的目录结构：</strong></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200219170618551-9dcf6085bf7f4f9f817810e945cfff61.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870862-975fbadb92e09e21717af2b35a68d5e1.png" alt="image-20200219170618551"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200219170618551-9dcf6085bf7f4f9f817810e945cfff61.png" target="_blank" rel="noopener">image-20200219170618551</a></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">(1) day09: 工程名称&#x2F;项目名称</span><br><span class="line">(2) src: 源码目录, 创建的java源文件、配置文件（properties、xml文件等）都可以放在src源码目录下</span><br><span class="line">(3) build&#x2F;classes: 编译文件的输出目录, src源码目录中的文件编译后会输出到classes目录下。</span><br><span class="line">	其中的classes目录在发布时会放在WEB-INF目录下，随着项目一起发布到服务器中</span><br><span class="line">(4) WebContent: 就是Web应用的目录，其中可以存放 html、css、js、jsp、图片以及编译后的class文件、jar包、web.xml文件等. 将来发布项目到服务器，其实就是将WebContent中的所有内容一起发布到服务器中。</span><br><span class="line">(5) WebContent&#x2F;WEB-INF&#x2F;lib: 用于存放当前项目所依赖的jar包。比如要访问mysql数据库，需要导入mysql驱动包，直接将jar包拷贝到lib目录下即可！（也不用再去做 build path --&gt; add to build path）</span><br></pre></td></tr></table></figure>

<h3 id="使用Eclipse创建Servlet"><a href="#使用Eclipse创建Servlet" class="headerlink" title="使用Eclipse创建Servlet"></a>使用Eclipse创建Servlet</h3><p>1、选中项目中的src目录，鼠标右键 —&gt; New —&gt; Servlet</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/b363459bbe88da812109f0863d80b552-e2721bcb77dd4300b07b471e82efd5c3.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870862-0013c7081ea7b392e58430962f4d9bc2.png" alt="b363459bbe88da812109f0863d80b552"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/b363459bbe88da812109f0863d80b552-e2721bcb77dd4300b07b471e82efd5c3.png" target="_blank" rel="noopener">b363459bbe88da812109f0863d80b552</a></p>
<p>2、在弹出的窗口中，根据提示填写内容：</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/4226a1514a967a42ec6d49e23b725939-0c86f3dd515b4cfe90638c60067a8c12.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870862-000ccd9bc84b97aed7790668baf520cb.png" alt="4226a1514a967a42ec6d49e23b725939"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/4226a1514a967a42ec6d49e23b725939-0c86f3dd515b4cfe90638c60067a8c12.png" target="_blank" rel="noopener">4226a1514a967a42ec6d49e23b725939</a></p>
<p>3、点击finish即可完成Servlet创建过程, 创建好的Servlet如下:</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/3d2214e9146db1b26b6038f61c3a8014-ae0a79e472744cdcbeccaddd234e215c.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870862-1992d2943f200d10c6ab911cc04600f0.png" alt="3d2214e9146db1b26b6038f61c3a8014"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/3d2214e9146db1b26b6038f61c3a8014-ae0a79e472744cdcbeccaddd234e215c.png" target="_blank" rel="noopener">3d2214e9146db1b26b6038f61c3a8014</a></p>
<p>通过Eclipse创建Servlet，默认继承HttpServlet。由于HttpServlet也是Servlet接口的子类，让HelloServlet继承HttpServlet，相当于间接实现了Servlet接口。</p>
<p>继承HttpServlet类，默认会覆盖doGet方法和doPost方法，两个方法的作用为：</p>
<p>*** doGet方法：**当浏览器发送请求的方式为GET提交时, 将会调用doGet方法来处理请求</p>
<p>*** doPost方法：**当浏览器发送请求的方式为POST提交时,<br>将会调用doPost方法来处理请求</p>
<p>提示：如果当GET提交和POST提交处理代码相同时，可以将代码写在其中一个方法里（例如写在doGet中），并在另外一个方法（例如doPost）中调这个方法。这样一来,不管是GET提交还是POST提交,最终doGet方法都会执行,都会对请求进行处理!!</p>
<h3 id="Servlet在web-xml中的配置"><a href="#Servlet在web-xml中的配置" class="headerlink" title="Servlet在web.xml中的配置"></a>Servlet在web.xml中的配置</h3><p>在通过Eclipse创建Servlet时，会自动在web.xml文件中进行Servlet相关信息的配置</p>
<p>（注意：如果是复制Servlet类文件，但配置信息不会跟着复制，需要自己手动添加配置，否则复制的Servlet将无法访问！）</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>HelloServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>com.tedu.HelloServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>HelloServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/HelloServlet<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>关于上面的配置信息：</strong></p>
<p><strong>a)</strong> Eclipse每创建一个Servlet,<br>就会在web.xml文件中添加两个标签：<servlet>和<servlet-mapping>标签（可以将这两个标签看成一个组的标签）</p>
<p><strong>b)</strong><br><servlet>和<servlet-mapping>标签内都会有一个<servlet-name>标签，标签的内容可以更改，但要求更改后的这两个<servlet-name>标签的内容也必须一致。</p>
<p><strong>c)</strong> <servlet-class>标签用于配置Servlet类的全路径名(即包名+类名)</p>
<p>需要注意：如果在创建Servlet后修改了Servlet类的名称，这个地方也要一起更改，否则将会出现”ClassNotFoundException”<br>即类找不到异常</p>
<p><strong>d)</strong><br><url-pattern>标签用于配置浏览器以什么路径访问当前Servlet（即Servlet对外访问的路径），默认的路径是：/类名</p>
<p>例如：上面为HelloServlet配置的<url-pattern>为<br><strong>/HelloServlet</strong>，因此我们在浏览器中的访问路径则为：</p>
<p><a href="http://xn--tiqt5l0ys/web" target="_blank" rel="noopener">http://主机名/web</a>项目访问路径**/HelloServlet**</p>
<h3 id="运行Servlet程序、访问测试"><a href="#运行Servlet程序、访问测试" class="headerlink" title="运行Servlet程序、访问测试"></a>运行Servlet程序、访问测试</h3><p><strong>1、访问Servlet方式一：</strong></p>
<p>若是第一次运行，需要先创建tomcat服务器，即在Servers窗口中点击链接可创建一个tomcat服务器，且只需创建一次即可！</p>
<p>(1)发布项目到服务器：在服务器上右键 –&gt; 点击 “<strong>add and remove”</strong> 将当前web项目发布到服务器中，并点击完成。</p>
<p>(2)启动tomcat服务器：在服务器上右键 Start 即可启动服务器</p>
<p>(3)通过浏览器访问Servlet：打开本地浏览器，通过路径访问，即可访问Servlet程序</p>
<p><code>http://localhost:8080/项目名称/HelloServlet</code></p>
<p><strong>2、访问Servlet方式二：</strong></p>
<p><strong>(1) 在运行的Servlet上点击右键 –</strong>-&gt; <strong>“Run As”</strong> —&gt; <strong>“1 Run on Server”</strong></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/329006b7629a8f0b0c9bddfc90fba675-53536761ae5e4f7d907b34e4cc28cbec.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870862-9443fa750e65f7d6a8e4cabc7188aa33.png" alt="329006b7629a8f0b0c9bddfc90fba675"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/329006b7629a8f0b0c9bddfc90fba675-53536761ae5e4f7d907b34e4cc28cbec.png" target="_blank" rel="noopener">329006b7629a8f0b0c9bddfc90fba675</a></p>
<p>(2) 在弹出的窗口中，直接点击完成即可！！！</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/6340e1bd76974184a91c55595864123b-1e8d1e17b16a426a936d986f54a54740.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870862-1dfcb44f193229513b7eda1f22456ef7.png" alt="6340e1bd76974184a91c55595864123b"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/6340e1bd76974184a91c55595864123b-1e8d1e17b16a426a936d986f54a54740.png" target="_blank" rel="noopener">6340e1bd76974184a91c55595864123b</a></p>
<p>(3) 运行结果如下：</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/f478e638564b90f44fdd1ef210c11f30-2a3d5087f9c64026bbb063fac5a8c61b.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870862-57cfb0a2937a10c3bfbe650542c68207.png" alt="f478e638564b90f44fdd1ef210c11f30"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/f478e638564b90f44fdd1ef210c11f30-2a3d5087f9c64026bbb063fac5a8c61b.png" target="_blank" rel="noopener">f478e638564b90f44fdd1ef210c11f30</a></p>
<p>或者打开浏览器，复制上图中的路径：</p>
<p><a href="http://localhost:8080/Hello/HelloServlet%EF%BC%8C%E7%B2%98%E8%B4%B4%E5%88%B0%E6%B5%8F%E8%A7%88%E5%99%A8%E7%9A%84%E5%9C%B0%E5%9D%80%E6%A0%8F%E4%B8%AD%EF%BC%8C%E5%9B%9E%E8%BD%A6%E8%AE%BF%E9%97%AE%EF%BC%9A" target="_blank" rel="noopener">http://localhost:8080/Hello/HelloServlet，粘贴到浏览器的地址栏中，回车访问：</a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/12910389bb2a950777329cc3568e8ec7-2dca77be31254d629aa4f07dc0eb1740.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870862-f51b4860c486c6d04fde5fe3fbe8dc7f.png" alt="12910389bb2a950777329cc3568e8ec7"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/12910389bb2a950777329cc3568e8ec7-2dca77be31254d629aa4f07dc0eb1740.png" target="_blank" rel="noopener">12910389bb2a950777329cc3568e8ec7</a></p>
<h3 id="Eclipse默认发布Web应用的位置"><a href="#Eclipse默认发布Web应用的位置" class="headerlink" title="Eclipse默认发布Web应用的位置"></a>Eclipse默认发布Web应用的位置</h3><p>Tomcat服务器中默认只有一台虚拟主机,叫做localhost主机</p>
<p>而localhost主机发布web应用的位置是webapps。</p>
<p>将day09发布到localhost主机中,但为什么day09项目没有在webapps目录下?</p>
<p>-——————————————————————————————————-</p>
<p>默认情况下,发布一个Web应用到localhost主机中，只需要将Web应用的目录拷贝到webapps目录下即可完成发布!</p>
<p>而将Eclipse和Tomcat整合之后，通过Eclipse发布一个web应用到tomcat服务器中，发布的路径默认被改成了:</p>
<p>[工作空间]\.metadata\.plugins\org.eclipse.wst.server.core\tmp0\wtpwebapps</p>
<p><strong>如何修改Eclipse默认发布Web应用的目录位置:</strong></p>
<p>(1)关闭服务器,将服务器中的所有应用移除</p>
<p>(2)在服务器上右键 –&gt; clean</p>
<p>(3)双击tomcat服务器,在弹出窗口中找到 Server location, 选择第二个选项</p>
<p>并将下方的Deploy Path改为: webapps 改完后，Ctrl+s保存配置即可!!</p>
<h3 id="Eclipse如何发布一个Web应用"><a href="#Eclipse如何发布一个Web应用" class="headerlink" title="Eclipse如何发布一个Web应用"></a>Eclipse如何发布一个Web应用</h3><p>当通过eclipse将day09项目发布到服务器中,是直接将day09拷贝到服务器中对应的目录下吗?</p>
<p>发布的过程如下：</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/66b1236906843df1bfc1d002a36a0ea7-7ebdde9fe46d442c9da59b3de916bae9.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870862-a88df68eddb40967e63c566fc7451fe9.png" alt="66b1236906843df1bfc1d002a36a0ea7"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/66b1236906843df1bfc1d002a36a0ea7-7ebdde9fe46d442c9da59b3de916bae9.png" target="_blank" rel="noopener">66b1236906843df1bfc1d002a36a0ea7</a></p>
<h2 id="Servlet调用过程"><a href="#Servlet调用过程" class="headerlink" title="Servlet调用过程"></a>Servlet调用过程</h2><p>通过浏览器访问服务器中的一个Servlet程序，这个Servlet程序是如何执行的？又是如何被调用的？</p>
<p>localhost/Hello/HelloServlet</p>
<p>参考&lt;&lt;Servlet调用过程图&gt;&gt;</p>
<h2 id="扩展-修改Servlet模版"><a href="#扩展-修改Servlet模版" class="headerlink" title="扩展:修改Servlet模版"></a>扩展:修改Servlet模版</h2><p>通过Eclipse可以直接创建一个Servlet类，这相比通过记事本等文本编辑工具创建Servlet，可以节省配置Servlet的时间，提高了我们的开发效率。</p>
<p>但是通过Eclipse生成的Servlet类中包含了许多我们不需要的注释和默认实现代码，这些每次都删除也非常占用时间。</p>
<p>接下来可以通过添加模版代码的形式，来生成Servlet的内容，以便于提高我们的开发效率。</p>
<p><strong>1、先创建一个Servlet，将其中的内容修改为自己期望的模版格式，并复制其中的内容，例如：</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> $&#123;enclosing_package&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * author: bjzhangsz@tedu.cn</span></span><br><span class="line"><span class="comment"> * datetime: $&#123;date&#125; $&#123;time&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> $</span>&#123;primary_type_name&#125; extends HttpServlet &#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">       </span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		response.setContentType(<span class="string">"text/html;charset=utf-8"</span>);</span><br><span class="line">		PrintWriter out = response.getWriter();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		doGet(request, response);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>2、点击菜单栏中的window –&gt; Preferences</strong>：</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/61ff91aedf878c76b0e51b94ffdca92a-a960f07128a9403eb327f0527a2d3806.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870862-2fd5822deeeb97fd7ac112de242e35fc.png" alt="61ff91aedf878c76b0e51b94ffdca92a"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/61ff91aedf878c76b0e51b94ffdca92a-a960f07128a9403eb327f0527a2d3806.png" target="_blank" rel="noopener">61ff91aedf878c76b0e51b94ffdca92a</a></p>
<p><strong>3、在出现的窗口左侧依次点击：Java –&gt; Editor –&gt; templates<br>--&gt;(在右边的窗口中) 点击New… ：</strong></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/35b3781ebd2acd7a178db29783dc5a6a-4368c51b7f69471aaa86d3974b69bc0d.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870862-9829655c651b49ea32a47d61ba39134c.png" alt="35b3781ebd2acd7a178db29783dc5a6a"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/35b3781ebd2acd7a178db29783dc5a6a-4368c51b7f69471aaa86d3974b69bc0d.png" target="_blank" rel="noopener">35b3781ebd2acd7a178db29783dc5a6a</a></p>
<p><strong>4、在出现的新窗口中填写如下内容：</strong></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/7dcab79636bff53d51b35d449adffebd-8057c04f7b9c41958bdbfb8fcadd5f75.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870862-8cd10a148213fbcafa3117b662a33729.png" alt="7dcab79636bff53d51b35d449adffebd"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/7dcab79636bff53d51b35d449adffebd-8057c04f7b9c41958bdbfb8fcadd5f75.png" target="_blank" rel="noopener">7dcab79636bff53d51b35d449adffebd</a></p>
<p><strong>5、替换包路径和类名（作用是在新建Servlet生成的Servlet模版中使用当前类的包路径和类型）</strong></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/cfc14076c3b3e9187afa6594a5ba08a8-24eb50edfee64770a568922126ad4162.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870862-dff1df92e083b59dbfdab17253aab1d8.png" alt="cfc14076c3b3e9187afa6594a5ba08a8"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/cfc14076c3b3e9187afa6594a5ba08a8-24eb50edfee64770a568922126ad4162.png" target="_blank" rel="noopener">cfc14076c3b3e9187afa6594a5ba08a8</a></p>
<p>效果如下：</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/82d8ec98345ff6e99c7caf7fce40c38f-a34f30a37e5a4323a682e652de6c5d12.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870862-6b710a9ecf07989021544a7037ca794a.png" alt="82d8ec98345ff6e99c7caf7fce40c38f"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/82d8ec98345ff6e99c7caf7fce40c38f-a34f30a37e5a4323a682e652de6c5d12.png" target="_blank" rel="noopener">82d8ec98345ff6e99c7caf7fce40c38f</a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/3e4ab784b24d0682572a1d92ec58098e-ed1e4e21d24e4e4d8d7ceef01be8a2dd.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870862-7722bbb501224cdc43430b18c480d416.png" alt="3e4ab784b24d0682572a1d92ec58098e"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/3e4ab784b24d0682572a1d92ec58098e-ed1e4e21d24e4e4d8d7ceef01be8a2dd.png" target="_blank" rel="noopener">3e4ab784b24d0682572a1d92ec58098e</a></p>
<p>效果如下：</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/a7026f1287e078eb5561ff5ff7ff2ebe-a98eb751a3c94a20b3efed4c5e6a3091.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870862-8663e66338a57724878f2c187a9f8394.png" alt="a7026f1287e078eb5561ff5ff7ff2ebe"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/a7026f1287e078eb5561ff5ff7ff2ebe-a98eb751a3c94a20b3efed4c5e6a3091.png" target="_blank" rel="noopener">a7026f1287e078eb5561ff5ff7ff2ebe</a></p>
<p><strong>6、点击OK保存，创建新的Servlet文件，测试</strong>：</p>
<p>将Servlet中的所有内容全选删除，并输入”servlet”，接着按 “Alt+ /“<br>提示即可生成自己想要的Servlet模版内容!</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/0f1925b9e96b93a6e13e7aa674ec2e35-9e7236f75bec45c0ab5667ff211e7f2b.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870862-9d6d7338a67ae46df4d23ce6ad770a16.png" alt="0f1925b9e96b93a6e13e7aa674ec2e35"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/0f1925b9e96b93a6e13e7aa674ec2e35-9e7236f75bec45c0ab5667ff211e7f2b.png" target="_blank" rel="noopener">0f1925b9e96b93a6e13e7aa674ec2e35</a></p>
<p>效果如下:</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/a5ada366c84bcef88e797f7126db4433-e0810f481f4a40f4962ba0e0161a85b7.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870862-f22d89ffc587b13cb2be603a600db7b6.png" alt="a5ada366c84bcef88e797f7126db4433"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/a5ada366c84bcef88e797f7126db4433-e0810f481f4a40f4962ba0e0161a85b7.png" target="_blank" rel="noopener">a5ada366c84bcef88e797f7126db4433</a></p>
<h2 id="request和response介绍"><a href="#request和response介绍" class="headerlink" title="request和response介绍"></a>request和response介绍</h2><p>request是代表HTTP请求信息的对象，response是代表HTTP响应信息的对象。</p>
<p>当浏览器发请求访问服务器中的某一个Servlet时，服务器将会调用Servlet中的service方法来处理请求。在调用service方法之前会创建出request和response对象。</p>
<p>其中request对象中封装了浏览器发送给服务器的请求信息（请求行、请求头、请求实体等），response对象中将会封装服务器要发送给浏览器的响应信息（状态行、响应头、响应实体），在service方法执行完后，服务器再将response中的数据取出，按照HTTP协议的格式发送给浏览器。</p>
<p>每次浏览器访问服务器，服务器在调用service方法处理请求之前都会创建request和response对象。（即，服务器每次处理请求都会创建request和response对象）</p>
<p>在请求处理完，响应结束时，服务器会销毁request和response对象。</p>
<h2 id="request对象"><a href="#request对象" class="headerlink" title="request对象"></a>request对象</h2><h3 id="获取请求参数"><a href="#获取请求参数" class="headerlink" title="获取请求参数"></a>获取请求参数</h3><p><strong>问题1、什么是请求参数？</strong></p>
<p>所谓的请求参数，就是浏览器发送给服务器的数据（不区分请求方式），例如：通过表单向服务器提交的用户名、密码等，或者在超链接后面通过问号提交的数据，都是请求参数。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;localhost&#x2F;day10&#x2F;TestParam?user&#x3D;zhangsan&amp;pwd&#x3D;123&amp;like&#x3D;篮球&amp;like&#x3D;足球</span><br></pre></td></tr></table></figure>

<p><strong>问题2、如何获取请求参数？</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">(1)request.getParameter(String paramName)</span><br><span class="line">-- 根据请求参数的名字获取对应的参数值，返回值是一个字符串；</span><br><span class="line">-- 如果一个参数有多个值，该方法只会返回第一个值。</span><br><span class="line">-- 如果获取的是一个不存在的参数，返回值为null</span><br><span class="line">(2)request.getParameterValues(String paramName)</span><br><span class="line">-- 根据请求参数的名字获取该名字对应的所有参数值组成的数组，返回值是一个字符串数组，其中包含了这个参数名对应的所有参数值</span><br><span class="line">-- 如果获取的是一个不存在的参数，返回值为null</span><br></pre></td></tr></table></figure>

<p>代码示例：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//1.获取请求参数中的用户名(user)</span></span><br><span class="line">String user = request.getParameter(<span class="string">"user"</span>);</span><br><span class="line">System.out.println( <span class="string">"user="</span>+user );</span><br><span class="line"></span><br><span class="line"><span class="comment">//2.获取请求参数中的爱好(like)</span></span><br><span class="line">String[] like = request.getParameterValues( <span class="string">"like"</span> );</span><br><span class="line">System.out.println( <span class="string">"like="</span>+Arrays.toString( like ) );</span><br></pre></td></tr></table></figure>

<p><strong>问题3、获取请求参数时的中文乱码问题？</strong></p>
<p>在获取中文的请求参数时，可能会出现乱码问题（和请求方式、tomcat服务器版本有关），具体可以分为以下三种情况：</p>
<p>（1）如果请求是GET提交，并且tomcat是8.0及以后的版本，GET提交的中文参数，在获取时不会出现乱码问题！（8.0以后的tomcat包括8.0在获取GET提交的中文参数时，已经处理中文乱码问题。）</p>
<p>（2）如果请求是POST提交，不管是哪个版本的tomcat服务器，在获取中文参数时，都会出现乱码问题。因为tomcat底层在接收POST提交的参数时，默认会使用iso8859-1编码接收，而这个编码中没有中文字符，所以在接收中文参数时，一定会出现中文乱码问题！</p>
<p>解决方法是：通知服务器在接收POST提交的参数时，使用utf-8编码来接收!</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">request.setCharacterEncoding(<span class="string">"utf-8"</span>);</span><br></pre></td></tr></table></figure>

<p>注意：这行代码不会影响GET提交，只对POST提交有效！</p>
<p>这行代码要放在任何获取参数的代码之前执行！</p>
<p>（3）如果请求是GET提交，并且tomcat是7.0及以前的版本，GET提交的中文参数，在获取时会出现乱码问题！</p>
<p>解决方法：在[tomcat安装目录]/ conf/server.xml文件的(修改端口的)Connector标签上，添加一个 URIEncoding=”utf-8” 属性，如下：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Connector</span> <span class="attr">port</span>=<span class="string">"80"</span> <span class="attr">protocol</span>=<span class="string">"HTTP/1.1"</span></span></span><br><span class="line"><span class="tag">           <span class="attr">connectionTimeout</span>=<span class="string">"20000"</span></span></span><br><span class="line"><span class="tag">           <span class="attr">redirectPort</span>=<span class="string">"8443"</span></span></span><br><span class="line"><span class="tag">           <span class="attr">URIEncoding</span>=<span class="string">"utf-8"</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>同时在[Eclipse]/Servers/[当前tomcat服务器对应的配置目录]/server.xml文件中，在Connector标签上，添加一个 URIEncoding=”utf-8” 属性，同上！</p>
<h3 id="实现请求转发"><a href="#实现请求转发" class="headerlink" title="实现请求转发"></a>实现请求转发</h3><p>请求转发是服务器内部资源的一种跳转方式，即当浏览器发送请求访问服务器中的某一个资源（A）时，该资源将请求转交给另外一个资源（B）进行处理并且由资源B做出响应的过程，就叫做请求转发。</p>
<p>请求转发和重定向都是资源的跳转方式，但是跳转的过程有所不同。</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200304232156159-8747e37f805240129ebe3ceed345a095.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870862-663ab0d1b8c024707c7fa05070e94092.png" alt="image-20200304232156159"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200304232156159-8747e37f805240129ebe3ceed345a095.png" target="_blank" rel="noopener">image-20200304232156159</a></p>
<p><strong>请求转发的特点：</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">（1）转发是一次请求，一次响应</span><br><span class="line">（2）请求转发前后，浏览器的地址栏地址不会发生变化。（浏览器--访问--&gt; A --转发--&gt; B，地址栏地址始终指向A的地址）</span><br><span class="line">（3）请求转发前后的request对象是同一个（转发前在A中的request和转发到B后，B中的request对象和A中的request对象是同一个。基于这一点，可以通过request从A带数据到B）</span><br><span class="line">（4）请求转发前后的两个资源必须属于同一个Web应用，否则将无法进行转发。（A--转发--&gt;B，A和B必须属于同一个Web应用！）</span><br></pre></td></tr></table></figure>

<p><strong>请求转发实现:</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">request.getRequestDispatcher(url地址/转发到资源的地址).forward(req, res);</span><br></pre></td></tr></table></figure>

<p><strong>代码示例：</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//从当前Servlet转发到 index.jsp(http://localhost/day10/index.jsp)</span></span><br><span class="line"><span class="comment">//request.getRequestDispatcher("/index.jsp").forward(request, response);</span></span><br><span class="line">request.getRequestDispatcher(<span class="string">"index.jsp"</span>).forward(request, response);</span><br></pre></td></tr></table></figure>

<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200221171059404-8b77b5154ad44577b2a9161e40561bbe.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870862-adc72a02bae2898118bccf91a1ed40fe.png" alt="image-20200221171059404"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200221171059404-8b77b5154ad44577b2a9161e40561bbe.png" target="_blank" rel="noopener">image-20200221171059404</a></p>
<h3 id="作为域对象使用"><a href="#作为域对象使用" class="headerlink" title="作为域对象使用"></a>作为域对象使用</h3><p>request在实现转发时，通过request.setAttribute方法和request.getAttribute方法带数据到目的地时，就是通过request对象中的map集合带数据，这个request对象上的map集合以及request对象所在的范围即称之为是一个域对象。</p>
<p>如果一个对象具备可以被访问的范围，通过这个对象上的map集合可以在整个范围内实现数据的共享。这样的对象就叫做域对象。</p>
<p>在request对象上提供了往域对象(map)中存数据的方法以及取数据的方法：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">request.setAttribute(String attrName, Object attrValue);</span><br><span class="line">-- 往request域中存入一个域属性，属性名（key）只能是字符串,属性值(value)可以是任意类型。</span><br><span class="line">request.getAttribute(String attrName);</span><br><span class="line">-- 根据属性名(key)获取对应的属性值(value)。返回的是一个Object类型的对象。</span><br></pre></td></tr></table></figure>

<p><strong>request域对象所具备的三大特征:</strong></p>
<p>**生命周期：**在服务器调用Servlet程序的service方法之前，会创建代表请求的request对象，在请求处理完，响应结束时，会销毁request对象。</p>
<p>**作用范围：**在一次请求范围内，都可以获取到同一个request对象。</p>
<p>**主要功能：**和请求转发配合使用，从Servlet带数据到JSP（带数据到目的地）</p>
<p>**扩展内容：**request对象的getParameter和getAttribute方法有什么区别?</p>
<ul>
<li>getParameter()方法是用于获取(从浏览器发送过来的)请求参数的，请求参数不能设置，只能是浏览器发送给服务器，在服务器端再通过getParameter方法获取请求中的参数</li>
<li>getAttribute()方法是用于从request域中获取域属性时用的，域属性得先存入到域中（即得先通过setAttribute方法将数据存入request域中），再通过getAttribute()方法从域中获取。</li>
</ul>
<h3 id="案例-模拟查询所有门店功能"><a href="#案例-模拟查询所有门店功能" class="headerlink" title="案例:模拟查询所有门店功能"></a>案例:模拟查询所有门店功能</h3><p><strong>1、创建一个Servlet程序，用于处理查询所有门店信息请求</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DoorListServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse</span></span></span><br><span class="line"><span class="function"><span class="params">response)</span></span></span><br><span class="line"><span class="function"><span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        response.setContentType(<span class="string">"text/html;charset=utf-8"</span>);</span><br><span class="line">        PrintWriter out = response.getWriter();</span><br><span class="line">        <span class="comment">//1.模拟查询数据库, 查询所有门店集合</span></span><br><span class="line">        List&lt;String&gt; doorList = <span class="keyword">new</span> ArrayList();</span><br><span class="line">        doorList.add(<span class="string">"01, 永和北三环西路店, 010-67676767"</span>);</span><br><span class="line">        doorList.add(<span class="string">"02, 永和西直门店, 010-68976347"</span>);</span><br><span class="line">        doorList.add(<span class="string">"03, 永和东直门店, 010-78397647"</span>);</span><br><span class="line">        doorList.add(<span class="string">"04, 永和北京西店, 010-78764397"</span>);</span><br><span class="line">        doorList.add(<span class="string">"05, 永和天安门店, 010-78769743"</span>);</span><br><span class="line">        <span class="comment">//2.将数据存入request域中</span></span><br><span class="line">        request.setAttribute( <span class="string">"list"</span>, doorList );</span><br><span class="line">        <span class="comment">//3.将请求转发到 door_list.jsp 中, 取出所有门店显示在页面中</span></span><br><span class="line">        request.getRequestDispatcher(<span class="string">"door_list.jsp"</span>)</span><br><span class="line">        .forward(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>2、创建一个JSP，用于显示所有门店信息</strong></p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h3&gt;显示所有门店信息&lt;/h3&gt;</span><br><span class="line">    &lt;%</span><br><span class="line">        <span class="comment">//获取request域中的门店信息集合</span></span><br><span class="line">        List&lt;String&gt; list =(List&lt;String&gt;)request.getAttribute(<span class="string">"list"</span>);</span><br><span class="line">        <span class="comment">//遍历门店集合, 将门店信息输出在网页上</span></span><br><span class="line">        <span class="keyword">for</span>( String door : list )&#123;</span><br><span class="line">        	out.write( door +<span class="string">"&lt;br/&gt;"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    %&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></table></figure>

<h2 id="response对象"><a href="#response对象" class="headerlink" title="response对象"></a>response对象</h2><p>response是代表HTTP响应信息的对象。</p>
<h3 id="向客户端发送数据"><a href="#向客户端发送数据" class="headerlink" title="向客户端发送数据"></a>向客户端发送数据</h3><p>PrintWriter out = response.getWriter();</p>
<p>由于服务器在通过response获取的流发送数据时，默认使用iso8859-1编码，而这个编码中没有中文字符，所以在通过response获取的流发送中文数据时，会出现乱码问题。</p>
<p>解决方法是：在响应数据之前，通知服务器使用utf-8发送数据。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*  通知服务器在响应数据时,使用utf-8编码</span></span><br><span class="line"><span class="comment"> * 也能通知浏览器使用utf-8接收服务器发送的数据 */</span></span><br><span class="line">response.setContentType( <span class="string">"text/html;charset=utf-8"</span> );</span><br><span class="line">PrintWriter out = response.getWriter();</span><br><span class="line">out.write( <span class="string">"你好"</span> );</span><br></pre></td></tr></table></figure>

<h3 id="实现重定向"><a href="#实现重定向" class="headerlink" title="实现重定向"></a>实现重定向</h3><p>当浏览器向服务器发请求访问某一个资源A，资源A在响应时通知浏览器需要再进一步请求才能获取到对应的资源，浏览器再次发请求访问服务器中的资源B，最终由资源B响应浏览器要获取的资源，这个过程叫做重定向。</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200304232136926-9055888036a44411ba51d9249c3a5e61.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870862-1277161a985e177f7296e41d5f5229e1.png" alt="image-20200304232136926"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200304232136926-9055888036a44411ba51d9249c3a5e61.png" target="_blank" rel="noopener">image-20200304232136926</a></p>
<p><strong>重定向的特点：</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">（1）重定向是两次请求、两次响应</span><br><span class="line">（2）重定向前后，浏览器的地址栏地址会发生变化。（因为两次请求都是通过浏览器发起，浏览器知道这个跳转的过程，因此地址栏地址会变化）</span><br><span class="line">（3）重定向前后的request对象不是同一个（因为重定向是两次请求，服务器会根据两次请求创建两个不同的request对象，request对象不是同一个，也就不能在重定向时通过request带数据到目的地。）</span><br><span class="line">（4）重定向前后的两个资源可以是来自不同的web应用，甚至可以是来自不同的服务器。(进行跳转的两个资源之间没有限制)</span><br></pre></td></tr></table></figure>

<p><strong>实现代码：</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">response.sendRedirect(所重定向到资源的URL地址);</span><br></pre></td></tr></table></figure>

<p><strong>代码示例：</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//测试1: 从当前Servlet（day10/TestRedirect）重定向到day10/index.jsp</span></span><br><span class="line"><span class="comment">// http://localhost/day10/TestRedirect</span></span><br><span class="line"><span class="comment">// http://localhost/day10/index.jsp</span></span><br><span class="line">response.sendRedirect( <span class="string">"http://localhost/day10/index.jsp"</span> );</span><br><span class="line">response.sendRedirect( <span class="string">"/day10/index.jsp"</span> );</span><br><span class="line">response.sendRedirect( <span class="string">"/index.jsp"</span> ); <span class="comment">//错误路径</span></span><br><span class="line">response.sendRedirect( <span class="string">"index.jsp"</span> ); <span class="comment">//正确路径</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//测试2: 从当前Servlet重定向到day09/index.jsp</span></span><br><span class="line">response.sendRedirect( <span class="string">"http://localhost/day09/index.jsp"</span> );</span><br><span class="line"></span><br><span class="line"><span class="comment">//测试3: 从当前Servlet重定向到百度首页</span></span><br><span class="line">response.sendRedirect( <span class="string">"http://www.baidu.com"</span> );</span><br></pre></td></tr></table></figure>

<p>总结：什么时候用转发（forward）？什么时候用重定向（redirect）？</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">(1)如果希望跳转前后地址栏地址不会发生变化, 只能使用转发; 如果希望跳转前后地址栏地址会发生变化, 只能使用重定向</span><br><span class="line">(2)如果希望在跳转前后, 能够通过request对象带数据到目的地, 只能使用转发</span><br><span class="line">(3)如果仅仅是做一个跳转,没有其他要求,此时推荐使用转发(转发是一次请求,一次响应,可以减少访问服务器的次数,降低服务器的压力)</span><br></pre></td></tr></table></figure>

<h1 id="javaweb-servlet"><a href="#javaweb-servlet" class="headerlink" title="javaweb   servlet"></a><a href="https://www.zhangpeng.fun/tags/javaweb" target="_blank" rel="noopener">javaweb</a>   <a href="https://www.zhangpeng.fun/tags/servlet" target="_blank" rel="noopener">servlet</a></h1>]]></content>
      <categories>
        <category>JavaWeb</category>
      </categories>
      <tags>
        <tag>javaweb</tag>
        <tag>servlet</tag>
      </tags>
  </entry>
  <entry>
    <title>08-JSP、EL、JSTL</title>
    <url>/2020/06/11/08-JSP%E3%80%81EL%E3%80%81JSTL/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="08-JSP、EL、JSTL"><a href="#08-JSP、EL、JSTL" class="headerlink" title="08-JSP、EL、JSTL"></a>08-JSP、EL、JSTL</h1><h1 id="unit08-JSP、EL、JSTL"><a href="#unit08-JSP、EL、JSTL" class="headerlink" title="unit08-JSP、EL、JSTL"></a>unit08-JSP、EL、JSTL</h1><h2 id="JSP概述"><a href="#JSP概述" class="headerlink" title="JSP概述"></a>JSP概述</h2><h3 id="什么是JSP"><a href="#什么是JSP" class="headerlink" title="什么是JSP"></a>什么是JSP</h3><p>JSP和Servlet都是由SUN公司提供的动态Web资源开发技术。</p>
<p>JSP看起来像一个HTML，但和HTML不同的是，JSP中可以书写Java代码，可以通过Java代码展示动态的数据。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">静态Web资源：任何人在任何条件下访问时，看到的都是相同的效果，这样的资源叫做静态Web资源。（html、css、js等）</span><br><span class="line">动态Web资源：不同的人，在不同的条件下访问时，看到的都是不同的效果，这样的资源叫做动态Web资源。（Servlet、jsp、php、.NET等）</span><br></pre></td></tr></table></figure>

<p>JSP本质上是一个Servlet程序</p>
<p><strong>思考1：为什么要学习JSP?</strong></p>
<ul>
<li>Servlet是一段Java程序，适合处理业务逻辑，但是Servlet不适合向浏览器输出一个html网页。</li>
<li>html可以作为页面返回，但是html是一个静态Web资源，无法展示动态数据。</li>
<li>而JSP也是页面的开发技术，也可以作为页面返回，并且JSP中可以书写Java代码，可以通过Java代码展示动态的数据。</li>
<li>因此，JSP的出现即解决了Servlet不适合输出页面的问题，也解决了HTML无法展示动态数据的问题！</li>
</ul>
<p><strong>思考2：为什么说JSP本质是一个Servlet?</strong></p>
<p>在JSP第一次被访问时，会翻译成一个Servlet程序。访问JSP后看到的html网页，其实是翻译后的Servlet执行的结果。（也就是说，访问JSP后看到的网页，是JSP翻译后的Servlet输出到浏览器的。）</p>
<h3 id="JSP执行过程"><a href="#JSP执行过程" class="headerlink" title="JSP执行过程"></a>JSP执行过程</h3><p><strong>访问服务器中的JSP文件，其执行过程为</strong>:</p>
<ol>
<li>当浏览器请求服务器中的某一个JSP文件（例如：localhost/09-jsp/test.jsp），服务器会根据请求资源的路径去寻找该文件：</li>
<li>如果找到了，JSP翻译引擎会将JSP翻译成一个Servlet程序（JSP—-&gt; xxx.java—-&gt; xxx.class）,然后Servlet程序再执行，执行的结果是向浏览器输出一个HTML网页！</li>
<li>如果没有找到，服务器将会响应一个404页面，通知浏览器请求的资源不存在。</li>
</ol>
<p><strong>访问服务器中的HTML文件，其执行过程为</strong>:</p>
<ol>
<li>当浏览器请求服务器中的某一个HTML文件时（例如：localhost/09-jsp/test.html），服务器会根据请求资源的路径去寻找该文件：</li>
<li>如果找到了，服务器会将html文件的内容作为响应实体发送给浏览器，浏览器再解析html并显示在网页上。</li>
<li>如果没有找到，服务器将会响应一个404页面，通知浏览器请求的资源不存在。</li>
</ol>
<h3 id="修改JSP模版"><a href="#修改JSP模版" class="headerlink" title="修改JSP模版"></a>修改JSP模版</h3><p>修改JSP模版步骤: 点击菜单栏中的 window –&gt; Preferences，出现如下窗口:</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/4ff5d1a10bfe557a7ab921485a8ec375-3f5559f861104bccbe2033fc21ddc15c.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870963-6d8cc0ff65c06061232162ea089fdb13.png" alt="4ff5d1a10bfe557a7ab921485a8ec375"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/4ff5d1a10bfe557a7ab921485a8ec375-3f5559f861104bccbe2033fc21ddc15c.png" target="_blank" rel="noopener">4ff5d1a10bfe557a7ab921485a8ec375</a></p>
<p>点击edit编辑JSP模版，修改为如下:</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=<span class="string">"utf-8"</span>/&gt;</span><br><span class="line">&lt;title&gt;&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">$&#123;cursor&#125;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h2 id="JSP语法"><a href="#JSP语法" class="headerlink" title="JSP语法"></a>JSP语法</h2><h3 id="模版元素"><a href="#模版元素" class="headerlink" title="模版元素"></a>模版元素</h3><p>模板元素是指写在JSP中的html内容</p>
<p>或者除了JSP特有内容以外的其他内容称之为模板元素</p>
<p>模板元素在翻译后的Servlet中，被out.write原封不动的发送给浏览器，由浏览器负责解析并显示。</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200331114124004-5c6f0f6ce5c847e88145975b66c0d719.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870963-ff355fcf29243ce2c6a97f2780a31ecf.png" alt="image-20200331114124004"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200331114124004-5c6f0f6ce5c847e88145975b66c0d719.png" target="_blank" rel="noopener">image-20200331114124004</a></p>
<h3 id="JSP表达式"><a href="#JSP表达式" class="headerlink" title="JSP表达式"></a>JSP表达式</h3><p>格式：<code>&lt;%= 常量、变量、表达式 %&gt;</code></p>
<p>作用：计算表达式的结果，将结果输出到浏览器中，由浏览器负责解析并显示。</p>
<figure class="highlight jsp"><table><tr><td class="code"><pre><span class="line">&lt;%= <span class="string">"Hello JSP..."</span> %&gt;</span><br><span class="line">&lt;% String name = <span class="string">"林青霞"</span>; %&gt;</span><br><span class="line">&lt;%= name %&gt;</span><br><span class="line">&lt;%= <span class="number">100</span>+<span class="number">123</span> %&gt;</span><br><span class="line">&lt;%= Math.random() %&gt;</span><br></pre></td></tr></table></figure>

<h3 id="JSP脚本片段"><a href="#JSP脚本片段" class="headerlink" title="JSP脚本片段"></a>JSP脚本片段</h3><p>格式：<code>&lt;% 若干Java语句 %&gt;</code></p>
<p>作用：在翻译后的Servlet中，将脚本片段中的Java语句复制粘贴到Servlet的对应的位置执行。例如：</p>
<p>在JSP中代码如下：</p>
<figure class="highlight jsp"><table><tr><td class="code"><pre><span class="line">&lt;!-- 在页面上输出<span class="number">5</span>行<span class="string">"hello JSP"</span> --&gt;</span><br><span class="line">&lt;%</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">5</span>; i++)&#123;</span><br><span class="line">		out.write(<span class="string">"Hello JSP...&lt;br/&gt;"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure>

<p>在翻译后的Servlet中代码如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">5</span>; i++)&#123;</span><br><span class="line">	out.write(<span class="string">"Hello JSP...&lt;br/&gt;"</span>);</span><br><span class="line">&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>另外，在某一个脚本片段中的Java代码可以是不完整的，但是在JSP中所有的脚本片段加在一起，必须是完整符合Java语法。例如，在JSP中代码如下：</p>
<figure class="highlight jsp"><table><tr><td class="code"><pre><span class="line">&lt;% <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">5</span>;i++)&#123; %&gt;</span><br><span class="line">		Hello JSP~~~&lt;br/&gt;</span><br><span class="line">&lt;% &#125; %&gt;</span><br></pre></td></tr></table></figure>

<p>在翻译后的Servlet中：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">5</span>;i++)&#123; </span><br><span class="line">  out.write(<span class="string">"\r\n"</span>);</span><br><span class="line">  out.write(<span class="string">"\t\t\tHello JSP~~~&lt;br/&gt;\r\n"</span>);</span><br><span class="line">  out.write(<span class="string">"\t"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="JSP注释"><a href="#JSP注释" class="headerlink" title="JSP注释"></a>JSP注释</h3><p>格式：&lt;%– JSP注释内容 –%&gt;</p>
<p>作用：（1）为代码添加解释说明 （2）将一些暂时不需要执行的代码注释掉。</p>
<p>在JSP翻译时，注释内容不会参与翻译，而是直接被丢弃</p>
<p>面试题：考察JSP中的JSP注释、Java注释、html注释</p>
<figure class="highlight jsp"><table><tr><td class="code"><pre><span class="line">&lt;%-- </span><br><span class="line">&lt;% out.write( <span class="string">"aaaaa&lt;br/&gt;"</span> ); %&gt;</span><br><span class="line"> --%&gt;</span><br><span class="line">&lt;% <span class="comment">//out.write( "bbbbb&lt;br/&gt;" ); %&gt;</span></span><br><span class="line">&lt;!-- </span><br><span class="line">&lt;% out.write( <span class="string">"ccccc&lt;br/&gt;"</span> ); %&gt;</span><br><span class="line"> --&gt;</span><br></pre></td></tr></table></figure>

<p>问题：（1）上面输出的三行内容，在访问时，会显示哪一行内容？</p>
<p>第一行被JSP注释给注释了，JSP注释的内容不会参与翻译，也不会执行，更不会发送给浏览器，也不会在浏览器上显示。</p>
<p>第二行被Java注释给注释了，放在脚本片段中的内容会参与翻译，会将其中的Java代码复制到翻译后的Servlet中，但由于代码被注释了，所以不会执行，也不会发送给浏览器，更不会在浏览器上显示。</p>
<p>第三行被html注释给注释了，html注释在JSP中是模板元素，注释本身会发送给浏览器，注释中的脚本片段会参与翻译，其中的java代码也会执行，也会将内容（ccccc）发送给浏览器，但由于发送到浏览器后的ccccc被html注释包裹，因此也不会显示在浏览器上。</p>
<p>（2）上面输出的三行内容，哪一行会发送到浏览器中？（不管是否显示）</p>
<p>其中第三行内容会发送到浏览器中，但不会显示，因为前后有html注释。</p>
<h3 id="JSP指令"><a href="#JSP指令" class="headerlink" title="JSP指令"></a>JSP指令</h3><p>指令的格式：<code>&lt;%@ 指令名称 若干属性声明... %&gt;</code></p>
<p>指令的作用：用于指挥JSP解析引擎如何将一个JSP翻译成一个Servlet程序。</p>
<p><strong>1、page指令</strong>：用于声明JSP的基本属性信息（比如JSP使用的编码，JSP使用的开发语言等）</p>
<figure class="highlight jsp"><table><tr><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span>%&gt;</span><br><span class="line">-- language属性用于指定当前JSP使用的开发语言，目前只有java语言支持</span><br><span class="line"></span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">"java.util.Date"</span>%&gt;</span><br><span class="line">-- <span class="keyword">import</span>属性用于导入包，如果不导入包，在使用其他包下的类时，就需要在类名前面加上包路径，例如： java.util.Date date = <span class="keyword">new</span> java.util.Date();</span><br><span class="line"></span><br><span class="line">&lt;%@ page pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">-- pageEncoding属性是用于指定当前JSP使用的编码，Eclipse工具会根据这个编码保存JSP文件。</span><br><span class="line">保证pageEncoding属性指定的编码和JSP文件保存时使用的编码相同,可以避免JSP文件出现乱码!</span><br></pre></td></tr></table></figure>

<p><strong>2、taglib指令</strong>：用于引入JSTL标签库或者其他的自定义标签库</p>
<p>后面讲解JSTL标签库时会讲解！</p>
<h2 id="JSP标签技术"><a href="#JSP标签技术" class="headerlink" title="JSP标签技术"></a>JSP标签技术</h2><p>在JSP页面中写入大量的java代码会导致JSP页面中html代码和java代码混杂在一起，会造成jsp页面结构的混乱，导致后期难于维护，并且代码难以复用。</p>
<p>于是在JSP的2.0版本中，sun提出了JSP标签技术，推荐使用标签来代替JSP页面中java代码，并且推荐，JSP2.0以后不要在JSP页面中出现任何一行java代码。</p>
<h3 id="EL表达式"><a href="#EL表达式" class="headerlink" title="EL表达式"></a>EL表达式</h3><p>格式：<code>${ 常量/表达式/变量 }</code> （放在EL中的变量得先存入域中，才可以获取变量的值）</p>
<p>作用：（1）计算放在其中的表达式的结果，将结果输出在当前位置。</p>
<p>（2）主要作用：用于从域对象中获取数据，将获取到的数据输出在当前位置。</p>
<p>域对象：pageContext、request、session、application</p>
<p><strong>1、获取常量、表达式、变量的值（变量得先存入域中）</strong></p>
<figure class="highlight jsp"><table><tr><td class="code"><pre><span class="line">$&#123; <span class="string">"hello el"</span> &#125; </span><br><span class="line">hello el	&lt;br/&gt;</span><br><span class="line">$&#123; <span class="number">100</span>+<span class="number">123</span> &#125;</span><br><span class="line">$&#123; <span class="number">12</span>*<span class="number">12</span> &gt; <span class="number">143</span> ? <span class="string">"yes"</span> : <span class="string">"no"</span> &#125; &lt;br/&gt;</span><br><span class="line"></span><br><span class="line">&lt;% </span><br><span class="line">	String name = <span class="string">"马云"</span>;</span><br><span class="line">	request.setAttribute( <span class="string">"name123"</span> , name );</span><br><span class="line">%&gt;</span><br><span class="line">$&#123; name123 &#125;</span><br><span class="line">&lt;%= request.getAttribute(<span class="string">"name123"</span>) %&gt;</span><br><span class="line">&lt;%-- 在EL表达式中书写变量,底层会根据变量名到四个作用域中寻找该名称的属性值</span><br><span class="line">	如果找到对应的属性值, 就直接返回, 输出到当前位置; 如果找不到就接着寻找</span><br><span class="line">	直到找完四个作用域, 最后还找不到就什么都不输出!</span><br><span class="line">	到四个作用域中寻找的顺序为: pageContext-&gt;request-&gt;session-&gt;application</span><br><span class="line"> --%&gt;</span><br></pre></td></tr></table></figure>

<p><strong>2、获取作用域中数组或集合中的元素</strong></p>
<p>Servlet中的代码：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//声明一个数组, 为数组添加元素, 并将数组存入到域中</span></span><br><span class="line">String[] names = &#123;<span class="string">"刘德华"</span>, <span class="string">"郭富城"</span>, <span class="string">"张学友"</span>, <span class="string">"黎明"</span> &#125;;</span><br><span class="line">request.setAttribute( <span class="string">"names"</span>, names );</span><br><span class="line"><span class="comment">//将请求转发到jsp, 在JSP中获取域中的数组中的元素</span></span><br><span class="line">request.getRequestDispatcher( <span class="string">"/02-el.jsp"</span> ).forward(request, response);</span><br></pre></td></tr></table></figure>

<p>JSP中的代码：</p>
<figure class="highlight jsp"><table><tr><td class="code"><pre><span class="line">&lt;%-- 获取从Servlet转发带过来的域中的数组中的元素 --%&gt;</span><br><span class="line">$&#123; names[<span class="number">0</span>] &#125; &lt;%-- 刘德华 --%&gt;</span><br><span class="line">$&#123; names[<span class="number">1</span>] &#125; &lt;%-- 郭富城  --%&gt;</span><br><span class="line">$&#123; names[<span class="number">2</span>] &#125; &lt;%-- 张学友 --%&gt;</span><br><span class="line">$&#123; names[<span class="number">3</span>] &#125; &lt;%-- 黎明 --%&gt;</span><br></pre></td></tr></table></figure>

<p><strong>3、获取作用域中map集合中的元素</strong></p>
<p>Servlet中的代码：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//声明一个map集合,为集合添加元素, 并将map集合存入到域中</span></span><br><span class="line">Map map = <span class="keyword">new</span> HashMap();</span><br><span class="line">map.put( <span class="string">"name"</span> , <span class="string">"尼古拉斯赵四"</span> );</span><br><span class="line">map.put( <span class="string">"age"</span> ,  <span class="number">28</span> );</span><br><span class="line">map.put( <span class="string">"addr"</span>, <span class="string">"中国"</span> );</span><br><span class="line">request.setAttribute( <span class="string">"map1"</span>, map );</span><br><span class="line"><span class="comment">//将请求转发到jsp, 在JSP中获取域中的数组中的元素</span></span><br><span class="line">request.getRequestDispatcher( <span class="string">"/02-el.jsp"</span> ).forward(request, response);</span><br></pre></td></tr></table></figure>

<p>JSP中的代码：</p>
<figure class="highlight jsp"><table><tr><td class="code"><pre><span class="line">$&#123; map1.name &#125; &lt;%-- 尼古拉斯赵四 --%&gt;</span><br><span class="line">$&#123; map1.age &#125; &lt;%-- <span class="number">28</span> --%&gt;</span><br><span class="line">$&#123; map1.addr &#125; &lt;%-- 中国 --%&gt;</span><br></pre></td></tr></table></figure>

<p><strong>4、获取作用域中JavaBean对象的属性值</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Bean：指可重用的组件</span><br><span class="line">JavaBean：指Java中可重用的组件</span><br><span class="line">业务Bean：专门用于处理业务逻辑（例如：处理注册请求时，在将用户的注册信息保存到数据库之前，需要对注册薪资进行校验）</span><br><span class="line">实体Bean：是专门用于封装数据的（例如：User user &#x3D; new User() ...）</span><br></pre></td></tr></table></figure>

<p>Servlet中的代码：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//声明一个User对象, 为对象的属性赋值, 并将User对象存入到域中</span></span><br><span class="line">User u1 = <span class="keyword">new</span> User();</span><br><span class="line">u1.setName( <span class="string">"刘德华"</span> );</span><br><span class="line">u1.setAge( <span class="number">18</span> );</span><br><span class="line">u1.setAddr( <span class="string">"中国香港"</span> );</span><br><span class="line">request.setAttribute( <span class="string">"user"</span> , u1 );</span><br><span class="line"></span><br><span class="line"><span class="comment">//将请求转发到jsp, 在JSP中获取域中的数组中的元素</span></span><br><span class="line">request.getRequestDispatcher( <span class="string">"/02-el.jsp"</span> ).forward(request, response);</span><br></pre></td></tr></table></figure>

<p>JSP中的代码：</p>
<figure class="highlight jsp"><table><tr><td class="code"><pre><span class="line">&lt;%-- </span><br><span class="line">$&#123; user.getName() &#125;</span><br><span class="line">$&#123; user.getAge() &#125;</span><br><span class="line">$&#123; user.getAddr() &#125; --%&gt;</span><br><span class="line">&lt;hr/&gt;</span><br><span class="line">&lt;%-- user.name 底层调用的仍然是 getName()方法--%&gt;</span><br><span class="line">$&#123; user.name &#125;</span><br><span class="line">&lt;%-- user.age 底层调用的仍然是 getAge()方法--%&gt;</span><br><span class="line">$&#123; user.age &#125;</span><br><span class="line">&lt;%-- user.addr 底层调用的仍然是 getAddr()方法--%&gt;</span><br><span class="line">$&#123; user.addr &#125;</span><br></pre></td></tr></table></figure>

<h3 id="JSTL标签库"><a href="#JSTL标签库" class="headerlink" title="JSTL标签库"></a>JSTL标签库</h3><p>JSTL标签库是为JavaWeb开发人员提供的一套标准通用的标签库；</p>
<p>JSTL标签库和EL配合使用可以取代JSP中大部分的Java代码；</p>
<p>在使用JSTL标签库之前需要完成：</p>
<ul>
<li>导入JSTL的开发包</li>
</ul>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200401090204772-d189920485104ad0931ec9d4bb19c990.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870963-ac03fdf8669ee7824172e32954bd9fd0.png" alt="image-20200401090204772"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200401090204772-d189920485104ad0931ec9d4bb19c990.png" target="_blank" rel="noopener">image-20200401090204772</a></p>
<ul>
<li>在使用JSTL标签库的JSP中引入JSTL（taglib指令）</li>
</ul>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200401090301088-df57671a57554c4d9e0c17b2ed085c8f.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591870963-0b433120735bfdcd37c4abf000d1d841.png" alt="image-20200401090301088"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200401090301088-df57671a57554c4d9e0c17b2ed085c8f.png" target="_blank" rel="noopener">image-20200401090301088</a></p>
<hr>
<p><strong>其中常用的标签如下:</strong></p>
<p><code>1、&lt;c:set&gt;&lt;/c:set&gt;</code> – 用于往域中添加属性，或者修改域中已有的属性值</p>
<p><strong>c:set 标签属性总结:</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">(1)var -- 指定存入作用域中的属性名称</span><br><span class="line">(2)value -- 指定存入作用域中属性的值</span><br><span class="line">(3)scope -- 指定将属性存入哪一个作用域中,默认值是page,表示pageContext域</span><br><span class="line">可取值: a)page表示pageContext域 b)request表示request域</span><br><span class="line">	c)session表示session域 d)application表示ServletContext域</span><br></pre></td></tr></table></figure>

<p>代码示例：</p>
<figure class="highlight jsp"><table><tr><td class="code"><pre><span class="line">&lt;%-- request.setAttribute(<span class="string">"name"</span>, <span class="string">"张三"</span>); --%&gt;</span><br><span class="line">&lt;c:set <span class="keyword">var</span>=<span class="string">"name"</span> value=<span class="string">"张三"</span> scope=<span class="string">"request"</span>/&gt;</span><br><span class="line">$&#123; name &#125;</span><br><span class="line"></span><br><span class="line">&lt;% String job = <span class="string">"java开发工程师"</span>; %&gt;</span><br><span class="line">&lt;c:set <span class="keyword">var</span>=<span class="string">"job"</span> value=<span class="string">"&lt;%= job %&gt;"</span> scope=<span class="string">"request"</span>/&gt;</span><br><span class="line">$&#123; job &#125;</span><br><span class="line"></span><br><span class="line">&lt;c:set <span class="keyword">var</span>=<span class="string">"name"</span> value=<span class="string">"张三丰"</span> scope=<span class="string">"request"</span>/&gt;</span><br><span class="line">$&#123; name &#125;</span><br></pre></td></tr></table></figure>

<p><code>2、&lt;c:if&gt;&lt;/c:if&gt;</code> – 构造简单的 if…else…结构语句</p>
<p><strong>c:if 标签属性总结:</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">test属性 -- 指定一个布尔表达式，当表达式的结果为true时，将会执行（输出）c:if标签中的内容，如果表达式结果为false,将不会输出c:if标签中的内容</span><br></pre></td></tr></table></figure>

<p>代码示例：往域中存入一个成绩, 根据成绩判断成绩所属的等级</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&lt;c:if test="$&#123; 3&gt;5 &#125;"&gt;yes&lt;/c:if&gt;</span><br><span class="line">&lt;c:if test="$&#123; 3&lt;=5 &#125;"&gt;no&lt;/c:if&gt;</span><br><span class="line">&lt;hr&gt;</span><br><span class="line">&lt;!-- 根据成绩判断成绩所属的等级 --&gt;</span><br><span class="line">&lt;c:set <span class="keyword">var</span>=<span class="string">"score"</span> value=<span class="string">"-35"</span>/&gt;</span><br><span class="line">&lt;c:if test="$&#123; score&gt;=80 and score&lt;=100 &#125;"&gt;您的成绩属于: 优秀!&lt;/c:if&gt;</span><br><span class="line">&lt;c:if test="$&#123; score&gt;=60 and score&lt;80 &#125;"&gt;您的成绩属于: 中等!&lt;/c:if&gt;</span><br><span class="line">&lt;c:if test="$&#123; score&gt;=0 and score&lt;60 &#125;"&gt;您的成绩属于: 不及格!&lt;/c:if&gt;</span><br><span class="line">&lt;c:if test="$&#123; score&lt;0 or score&gt;100 &#125;"&gt;您的成绩有误!&lt;/c:if&gt;</span><br></pre></td></tr></table></figure>

<p><code>3、&lt;c:forEach&gt;&lt;/c:forEach&gt;</code> – 对集合或数组等中元素进行循环遍历或者是执行指定次数的循环.</p>
<p>(1) 遍历域中数组或集合中的元素</p>
<p>(2) 遍历域中map集合中的元素</p>
<p>(3) 遍历0~100之间的整数，将是3的倍数的数值输出到浏览器中</p>
<p><strong>c:forEach 标签属性总结:</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">(1)items: 指定需要遍历的集合或数组</span><br><span class="line">(2)var: 指定用于接收遍历过程中的每一个元素</span><br><span class="line">(3)begin: 指定循环从哪儿开始</span><br><span class="line">(4)end: 指定循环到哪儿结束</span><br><span class="line">(5)step: 指定循环时的步长, 默认值是1</span><br><span class="line">(6)varStatus: 用于表示循环遍历状态信息的对象, 这个对象上有如下属性:</span><br><span class="line">	first属性: 表示当前遍历是否是第一次, 若是, 则返回true;</span><br><span class="line">	last属性: 表示当前遍历是否是最后一次, 若是, 则返回true;</span><br><span class="line">	count属性: 记录当前遍历是第几次</span><br></pre></td></tr></table></figure>

<p>代码示例：</p>
<h1 id="javaweb-jsp-el-jstl"><a href="#javaweb-jsp-el-jstl" class="headerlink" title="javaweb   jsp   el   jstl"></a><a href="https://www.zhangpeng.fun/tags/javaweb" target="_blank" rel="noopener">javaweb</a>   <a href="https://www.zhangpeng.fun/tags/jsp" target="_blank" rel="noopener">jsp</a>   <a href="https://www.zhangpeng.fun/tags/el" target="_blank" rel="noopener">el</a>   <a href="https://www.zhangpeng.fun/tags/jstl" target="_blank" rel="noopener">jstl</a></h1><h3 id="喜欢这篇文章？打赏一下作者吧"><a href="#喜欢这篇文章？打赏一下作者吧" class="headerlink" title="喜欢这篇文章？打赏一下作者吧"></a>喜欢这篇文章？打赏一下作者吧</h3><p>支付宝捐赠 微信捐赠</p>
<p><a href="https://www.zhangpeng.fun/archives/09-maven" target="_blank" rel="noopener">09-Maven</a></p>
<p><a href="https://www.zhangpeng.fun/archives/07-servlet" target="_blank" rel="noopener">07-Servlet</a></p>
<h3 id="评论"><a href="#评论" class="headerlink" title="评论"></a>评论</h3>]]></content>
      <categories>
        <category>JavaWeb</category>
      </categories>
      <tags>
        <tag>javaweb</tag>
        <tag>jsp</tag>
        <tag>el</tag>
        <tag>jstl</tag>
      </tags>
  </entry>
  <entry>
    <title>10-Cookie、Session</title>
    <url>/2020/06/11/10-Cookie%E3%80%81Session/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="10-Cookie、Session"><a href="#10-Cookie、Session" class="headerlink" title="10-Cookie、Session"></a>10-Cookie、Session</h1><h1 id="unit10-Cookie、Session"><a href="#unit10-Cookie、Session" class="headerlink" title="unit10-Cookie、Session"></a>unit10-Cookie、Session</h1><h2 id="什么是会话"><a href="#什么是会话" class="headerlink" title="什么是会话"></a>什么是会话</h2><p>什么是会话：当浏览器发请求访问服务器开始，一直到访问服务器结束，浏览器关闭为止，这期间浏览器和服务器之间产生的所有请求和响应加在一起，就称之为浏览器和服务器之间的一次会话。</p>
<p>在一次会话中往往会产生一些数据，而这些数据往往是需要我们保存起来的，如何保存会话中产生的这些数据呢？</p>
<ul>
<li>比如在购物过程中，将商品加入购物车，其实就是将商品信息保存到数据库中。（不讨论）</li>
<li>如果在没有登录时，将商品加入购物车，其实就是将商品信息保存到了cookie或session中。</li>
</ul>
<p>可以使用cookie或者session保存会话中产生的数据。</p>
<p>如何将会话中产生的数据保存到cookie或者是session中？</p>
<h2 id="cookie原理及应用"><a href="#cookie原理及应用" class="headerlink" title="cookie原理及应用"></a>cookie原理及应用</h2><h3 id="cookie的工作原理"><a href="#cookie的工作原理" class="headerlink" title="cookie的工作原理"></a>cookie的工作原理</h3><p><a href="https://www.zhangpeng.fun/upload/2020/06/35f0bd1bfc616e3bfcc9e96c189444ee-03acd5c8f7554c8aa6aee2bf6aabf42c.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871092-28bc9f1df1e0b02f693d6002321cb7a3.png" alt="35f0bd1bfc616e3bfcc9e96c189444ee"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/35f0bd1bfc616e3bfcc9e96c189444ee-03acd5c8f7554c8aa6aee2bf6aabf42c.png" target="_blank" rel="noopener">35f0bd1bfc616e3bfcc9e96c189444ee</a></p>
<ol>
<li>Cookie是将会话中产生的数据保存在客户端，是客户端技术。</li>
<li>Cookie是基于两个头进行工作的：分别是Set-Cookie响应头和Cookie请求头</li>
<li>通过Set-Cookie响应头将cookie从服务器端发送给浏览器，让浏览器保存到内部；而浏览器一旦保存了cookie，以后浏览器每次访问服务器时，都会通过cookie请求头，将cookie信息再带回服务器中。在需要时，在服务器端可以获取请求中的cookie中的数据，从而实现某些功能。</li>
</ol>
<h3 id="cookie的API及应用"><a href="#cookie的API及应用" class="headerlink" title="cookie的API及应用"></a>cookie的API及应用</h3><p><strong>1、创建Cookie对象</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Cookie c = <span class="keyword">new</span> Cookie(String name, String value);</span><br><span class="line"><span class="comment">// 创建cookie的同时需要指定cookie的名字和cookie要保存的值</span></span><br></pre></td></tr></table></figure>

<p><strong>2、将Cookie添加到response响应中</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">response.addCookie( Cookie c );</span><br><span class="line"><span class="comment">// 将cookie添加到响应中，由服务器负责将cookie信息发送给浏览器，再由浏览器保存到内部（可以多次调用该方法，添加一个以上的cookie）</span></span><br></pre></td></tr></table></figure>

<p><strong>3、获取请求中的所有cookie对象组成的数组</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Cookie[] cs = request.getCookies();</span><br><span class="line"><span class="comment">// 获取请求中携带的所有cookie组成的cookie对象数组，如果请求中没有携带任何cookie，调用该方法会返回null。</span></span><br></pre></td></tr></table></figure>

<p><strong>4、删除浏览器中的Cookie</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// cookie的API中没有提供直接删除cookie的方法，可以通过别的方式间接删除cookie</span></span><br><span class="line"><span class="comment">// 删除名称为cart的cookie：可以向浏览器再发送一个同名的cookie（即名称也叫做cart），并设置cookie的最大生存时间为零，由于浏览器是根据cookie的名字来区分cookie，如果前后两次向浏览器发送同名的cookie，后发送的cookie会覆盖之前发送的cookie。而后发送的cookie设置了生存时间为零，因此浏览器收到后也会立即删除！</span></span><br></pre></td></tr></table></figure>

<p>代码示例：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//创建一个名称为cart的cookie</span></span><br><span class="line">Cookie c = <span class="keyword">new</span> Cookie(<span class="string">"cart"</span>, <span class="string">""</span>);</span><br><span class="line"><span class="comment">//设置cookie的最大生存时间为零</span></span><br><span class="line">c.setMaxAge( <span class="number">0</span> );</span><br><span class="line"><span class="comment">//将cookie添加到响应中,发送给浏览器</span></span><br><span class="line">response.addCookie( c );</span><br><span class="line">out.write( <span class="string">"成功删除了名称为cart的cookie..."</span> );</span><br></pre></td></tr></table></figure>

<p><strong>5、Cookie的常用方法</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">cookie.getName(); <span class="comment">// 获取cookie的名字</span></span><br><span class="line">cookie.getValue(); <span class="comment">// 获取cookie中保存的值</span></span><br><span class="line">cookie.setValue(); <span class="comment">// 设置/修改cookie中保存的值(没有setName方法,因为cookie的名字无法修改)</span></span><br><span class="line">cookie.setMaxAge(); <span class="comment">//设置cookie的最大生存时间</span></span><br></pre></td></tr></table></figure>

<p><strong>6、setMaxAge方法</strong>：设置cookie的最大生存时间</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">如果不设置该方法，cookie默认是会话级别的cookie，即生存时间是一次会话。当浏览器关闭，会话结束时，cookie也会被销毁（cookie默认存在浏览器的内存中，当浏览器关闭，内存释放，cookie也会随着内存的释放而销毁。）</span><br><span class="line">如果设置了该方法，cookie将不会保存到浏览器的内存中，而是以文件形式保存到浏览器的临时文件夹中（也就是硬盘上），这样再关闭浏览器，内存释放，保存到硬盘上的cookie文件不会销毁，再次打开浏览器，还可以获取硬盘上的cookie信息。</span><br></pre></td></tr></table></figure>

<p>代码示例：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//创建一个Cookie对象，将商品信息保存到cookie中</span></span><br><span class="line">Cookie cookie = <span class="keyword">new</span> Cookie( <span class="string">"cart"</span>, prod  );</span><br><span class="line"><span class="comment">//设置cookie的最大生存时间, 单位:秒</span></span><br><span class="line">cookie.setMaxAge( <span class="number">60</span>*<span class="number">60</span>*<span class="number">24</span> );</span><br><span class="line"><span class="comment">//将cookie对象添加到response响应中</span></span><br><span class="line">response.addCookie( cookie );</span><br></pre></td></tr></table></figure>

<h3 id="案例-使用cookie模拟购物车"><a href="#案例-使用cookie模拟购物车" class="headerlink" title="案例:使用cookie模拟购物车"></a>案例:使用cookie模拟购物车</h3><p><strong>1.index.html</strong></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">h3</span>&gt;</span>点击下面的商品链接, 可以将商品加入购物车<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">	http://localhost/day13-cookie/CartServlet</span></span><br><span class="line"><span class="comment">	http://localhost/day13-cookie/index.html</span></span><br><span class="line"><span class="comment">	 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"CartServlet?prod=iphone11"</span>&gt;</span>iphone11<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"CartServlet?prod=vivonex3"</span>&gt;</span>vivonex3<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"CartServlet?prod=xiaomishouji"</span>&gt;</span>xiaomishouji<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"CartServlet?prod=huaweip30"</span>&gt;</span>huaweip30<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"CartServlet?prod=海尔洗衣机"</span>&gt;</span>海尔洗衣机<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">h3</span>&gt;</span>点击下面的支付链接, 可以对购物车中的商品进行结算<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"PayServlet"</span>&gt;</span>支付<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p><strong>2.CartServlet</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">		<span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">	response.setContentType(<span class="string">"text/html;charset=utf-8"</span>);</span><br><span class="line">	PrintWriter out = response.getWriter();</span><br><span class="line">	<span class="comment">//-------------------------------------------------------</span></span><br><span class="line">	<span class="comment">//获取请求中携带的商品信息(将要加入购物车的商品信息)</span></span><br><span class="line">	String prod = request.getParameter( <span class="string">"prod"</span> );</span><br><span class="line">	<span class="comment">//创建一个Cookie对象，将商品信息保存到cookie中</span></span><br><span class="line">	Cookie cookie = <span class="keyword">new</span> Cookie( <span class="string">"cart"</span>, prod  );</span><br><span class="line">	<span class="comment">//设置cookie的最大生存时间, 单位:秒</span></span><br><span class="line">	cookie.setMaxAge( <span class="number">60</span>*<span class="number">60</span>*<span class="number">24</span> );</span><br><span class="line">	<span class="comment">//将cookie对象添加到response响应中</span></span><br><span class="line">	response.addCookie( cookie );</span><br><span class="line">	<span class="comment">//做出回应</span></span><br><span class="line">	out.write( <span class="string">"成功将"</span>+prod+<span class="string">"加入了购物车....."</span> );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>3.PayServlet</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">		<span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">	response.setContentType(<span class="string">"text/html;charset=utf-8"</span>);</span><br><span class="line">	PrintWriter out = response.getWriter();</span><br><span class="line">	<span class="comment">//------------------------------------------------------</span></span><br><span class="line">	<span class="comment">//获取请求中的所有cookie信息(null/cookie数组)</span></span><br><span class="line">	Cookie[] cs = request.getCookies();</span><br><span class="line">	<span class="comment">//遍历所有cookie数组, 找出名称为cart的cookie</span></span><br><span class="line">	String prod = <span class="keyword">null</span>;</span><br><span class="line">	<span class="keyword">if</span>( cs != <span class="keyword">null</span> ) &#123;</span><br><span class="line">		<span class="keyword">for</span> (Cookie c : cs) &#123;</span><br><span class="line">			<span class="keyword">if</span>( <span class="string">"cart"</span>.equals( c.getName() ) ) &#123;</span><br><span class="line">				<span class="comment">//获取cookie中保存的商品信息</span></span><br><span class="line">				prod = c.getValue();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//为商品进行结算</span></span><br><span class="line">	<span class="keyword">if</span>( prod == <span class="keyword">null</span> ) &#123;</span><br><span class="line">		out.write( <span class="string">"您还没有将商品加入购物车...."</span> );</span><br><span class="line">	&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">		out.write( <span class="string">"成功为"</span>+prod+<span class="string">"支付了1000.00元...."</span> );</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="session原理及应用"><a href="#session原理及应用" class="headerlink" title="session原理及应用"></a>session原理及应用</h2><h3 id="session的工作原理"><a href="#session的工作原理" class="headerlink" title="session的工作原理"></a>session的工作原理</h3><p><a href="https://www.zhangpeng.fun/upload/2020/06/9f99b30f96234a6bba48e37d6852a080-b234a7929d994756982e5666e5e6f024.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871092-91ae106542ca7ab2415d0d4ff29c8170.png" alt="9f99b30f96234a6bba48e37d6852a080"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/9f99b30f96234a6bba48e37d6852a080-b234a7929d994756982e5666e5e6f024.png" target="_blank" rel="noopener">9f99b30f96234a6bba48e37d6852a080</a></p>
<ol>
<li>Session是将会话中产生的数据保存在服务器端，是服务器端技术</li>
<li>Session是一个域对象，session中也保存了一个map集合，往session中存数据，其实就是将数据保存到session的map集合中。</li>
<li>通过session.setAttribute()方法可以将数据保存到session中，通过session.getAttribute()方法可以将数据从session中取出来。</li>
</ol>
<h3 id="session是一个域对象"><a href="#session是一个域对象" class="headerlink" title="session是一个域对象"></a>session是一个域对象</h3><p>获取session对象：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">request.getSession() </span><br><span class="line">&#x2F;&#x2F; 获取一个session对象；如果在服务器内部有当前浏览器对应的session，则直接返回该session对象；如果没有对应session，则会创建一个新的session对象再返回；</span><br></pre></td></tr></table></figure>

<p>Session是一个域对象，因此session中也提供了存取数据的方法。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">session.setAttribute(String attrName, Object attrValue); </span><br><span class="line"><span class="comment">// 往session域中添加一个域属性，属性名只能是字符串类型，属性值可以是任意类型。</span></span><br><span class="line">session.getAttribute(String attrName);</span><br><span class="line"><span class="comment">// 根据属性名获取域中的属性值，返回值是一个Object类型</span></span><br></pre></td></tr></table></figure>

<p>Session域对象的三大特征：</p>
<p><strong>(1)生命周期：</strong></p>
<p>**创建session：**第一次调用request.getSession()方法时，会创建一个session对象。（当浏览器在服务器端没有对应的session时，调用request.getSession()方法服务器会创建一个session对象。）</p>
<p><strong>销毁session：</strong></p>
<ol>
<li><p>超时销毁：默认情况下，当超过30分钟没有访问session，session就会超时销毁。（30分钟是默认时间，可以修改，但不推荐修改）</p>
</li>
<li><p>自杀：调用session的invalidate方法时，会立即销毁session。</p>
</li>
<li><p>意外身亡：当服务器非正常关闭时（硬件损坏，断电，内存溢出等导致服务器非正常关闭），session会随着服务器的关闭而销毁；</p>
<p>当服务器正常关闭，在关闭之前，服务器会将内部的session对象序列化保存到服务器的work目录下，变为一个文件。这个过程叫做session的钝化（序列化）；再次将服务器启动起来，钝化着的session会再次回到服务器，变为服务器中的对象，这个过程叫做session的活化（反序列化）。</p>
</li>
</ol>
<p>**(2)作用范围：**在一次会话范围内（获取到的都是同一个session对象）</p>
<p>**(3)主要功能：**在整个会话范围内实现数据的共享</p>
<h3 id="案例-使用session模拟购物车"><a href="#案例-使用session模拟购物车" class="headerlink" title="案例:使用session模拟购物车"></a>案例:使用session模拟购物车</h3><p><strong>1、index.html</strong></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">h3</span>&gt;</span>点击下面的商品链接, 可以将商品加入购物车<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">	http://localhost/day13-cookie/CartServlet</span></span><br><span class="line"><span class="comment">	http://localhost/day13-cookie/index.html</span></span><br><span class="line"><span class="comment">	 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"CartServlet?prod=iphone11"</span>&gt;</span>iphone11<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"CartServlet?prod=vivonex3"</span>&gt;</span>vivonex3<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"CartServlet?prod=xiaomishouji"</span>&gt;</span>xiaomishouji<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"CartServlet?prod=huaweip30"</span>&gt;</span>huaweip30<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"CartServlet?prod=海尔洗衣机"</span>&gt;</span>海尔洗衣机<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">h3</span>&gt;</span>点击下面的支付链接, 可以对购物车中的商品进行结算<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"PayServlet"</span>&gt;</span>支付<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>2、CartServlet</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">		<span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">	response.setContentType(<span class="string">"text/html;charset=utf-8"</span>);</span><br><span class="line">	PrintWriter out = response.getWriter();</span><br><span class="line">	<span class="comment">//------------------------------------------------------</span></span><br><span class="line">	<span class="comment">//获取将要添加到购物车的商品信息</span></span><br><span class="line">	String prod = request.getParameter( <span class="string">"prod"</span> );</span><br><span class="line">	<span class="comment">//获取一个session对象，将商品信息保存到session中</span></span><br><span class="line">	HttpSession session = request.getSession();</span><br><span class="line">	<span class="comment">//设置session的超时时间为30秒</span></span><br><span class="line">	<span class="comment">//session.setMaxInactiveInterval( 30 );</span></span><br><span class="line">	session.setAttribute( <span class="string">"cart"</span> , prod );</span><br><span class="line">	<span class="comment">//做出响应</span></span><br><span class="line">	out.write( <span class="string">"成功将 [ "</span>+prod+<span class="string">" ] 加入了购物车~~~"</span> );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>3、PayServlet</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class="line"><span class="function">		<span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">	response.setContentType(<span class="string">"text/html;charset=utf-8"</span>);</span><br><span class="line">	PrintWriter out = response.getWriter();</span><br><span class="line">	<span class="comment">//获取一个session对象(之前的session)</span></span><br><span class="line">	HttpSession session = request.getSession();</span><br><span class="line">	<span class="comment">//从session中获取到要结算的商品信息</span></span><br><span class="line">	String prod = (String)session.getAttribute( <span class="string">"cart"</span> );</span><br><span class="line">	<span class="comment">//对商品进行结算,做出回应</span></span><br><span class="line">	out.write( <span class="string">"成功为 [ "</span>+prod+<span class="string">" ] 支付了2000.00元~~~~"</span> );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="总结-两者的区别"><a href="#总结-两者的区别" class="headerlink" title="总结:两者的区别"></a>总结:两者的区别</h2><p>Cookie和session都属于会话技术，都可以保存会话中产生的数据，但由于cookie和session的工作原理和特点不同，因此两者的应用场景也不一样。</p>
<p><strong>Cookie的特点：</strong></p>
<ol>
<li><p>cookie是将会话中产生的数据保存在<strong>浏览器客户端</strong>, 是客户端技术（JS可以访问cookie）</p>
</li>
<li><p>cookie是将数据保存在客户端浏览器，容易随着用户的操作导致cookie丢失或者被窃取，因此cookie中保存的数据不太稳定，也不太安全。</p>
</li>
<li><p>但cookie将数据保存在客户端，对服务器端没有太多影响，可以将数据保存很长时间。</p>
</li>
<li><p>总结：因此cookie中适合存储需要长时间保存、但对安全性要求不高的数据。</p>
</li>
<li><p>浏览器对cookie的大小和个数都有限制，一般推荐每一个站点给浏览器发送的cookie数量不超过20个，每一个cookie的大小不超过1kb。</p>
</li>
<li><p>Cookie的应用：实现购物车、记住用户名、30天内自动登录等。</p>
</li>
</ol>
<p><strong>Session的特点</strong></p>
<ol>
<li>session是将会话中产生的数据保存在<strong>服务器端</strong>，是服务器端技术</li>
<li>session将数据存在服务器端的session对象中，相对更加的安全，而且更加稳定。不容易随着用户的操作而导致session中的数据丢失或者是被窃取。</li>
<li>但session是服务器端的对象，在并发量较高时每一个浏览器客户端在服务器端都要对应一个session对象，占用服务器的内存空间，影响效率。</li>
<li>总结：因此session中适合存储对安全性要求较高，但不需要长时间保存的数据。</li>
<li>Session的应用：保存登录状态、保存验证码</li>
</ol>
<h2 id="扩展内容"><a href="#扩展内容" class="headerlink" title="扩展内容"></a>扩展内容</h2><h3 id="cookie中保存中文数据的问题"><a href="#cookie中保存中文数据的问题" class="headerlink" title="cookie中保存中文数据的问题"></a>cookie中保存中文数据的问题</h3><p>以下问题是针对Tomcat8.0及8.0以下的版本，在Tomcat8.5及8.5以后的版本中已经解决了该问题！</p>
<p>HTTP协议中规定了请求信息和响应信息中不能包含中文数据！</p>
<p>因此通过浏览器向服务器发送中文数据时，浏览器会将中文数据进行URL编码，编码为下面这种格式：</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200225174146534-6e81b49c09de4cdb8e1872b76f371de7.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871092-fefe39822b462ca2114777cc519adfd6.png" alt="image-20200225174146534"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200225174146534-6e81b49c09de4cdb8e1872b76f371de7.png" target="_blank" rel="noopener">image-20200225174146534</a></p>
<p><a href="http://localhost/day13-cookie/index.html?user=%E5%BC%A0%E9%A3%9E%E9%A3%9E" target="_blank" rel="noopener">http://localhost/day13-cookie/index.html?user=%E5%BC%A0%E9%A3%9E%E9%A3%9E</a></p>
<p>将中文数据转成下面这种格式，叫做URL编码：</p>
<p><code>张飞飞 ---&gt; URL编码 ---&gt; %E5%BC%A0%E9%A3%9E%E9%A3%9E</code></p>
<p>将下面这种格式再次转回中文数据，叫做URL解码：</p>
<p><code>%E5%BC%A0%E9%A3%9E%E9%A3%9E ---&gt; URL解码---&gt; 张飞飞</code></p>
<p><strong>问题：当cookie中保存中文数据，将cookie添加到响应中时，会报一个500异常，如下：</strong></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200226095315873-3244b23abc9e45c280b699b611179ebc.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871092-696fad617eae9ffa282ebe302276723b.png" alt="image-20200226095315873"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200226095315873-3244b23abc9e45c280b699b611179ebc.png" target="_blank" rel="noopener">image-20200226095315873</a></p>
<p><strong>解决方法是：</strong></p>
<p>将存入cookie中的先进行URL编码，再存入Cookie中，例如：</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200225174242538-088ffe972caf4613b870f445acf24966.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871092-e6a4d1af555386008d2916d3406ae319.png" alt="image-20200225174242538"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200225174242538-088ffe972caf4613b870f445acf24966.png" target="_blank" rel="noopener">image-20200225174242538</a></p>
<p>从cookie取出来的数据是进行URL编码后的数据，在使用之前需要进行URL解码，例如：</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200225174252978-7a75a78273364f9ab679186725d5f6c9.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871092-0d4eef6ff91ee69b34c124f17a250943.png" alt="image-20200225174252978"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200225174252978-7a75a78273364f9ab679186725d5f6c9.png" target="_blank" rel="noopener">image-20200225174252978</a></p>
<h3 id="获取不到之前的session的问题"><a href="#获取不到之前的session的问题" class="headerlink" title="获取不到之前的session的问题"></a>获取不到之前的session的问题</h3><p>将商品保存到session中后，关闭浏览器再打开浏览器，访问服务器，此时获取不到之前的session。因为session是基于Cookie工作的。</p>
<p>在服务器创建一个session后，会为session分配一个独一无二的编号，称之为session的id，在此次响应时，服务器会将session的id以一个名称为JSESSIONID的cookie发送给浏览器保存到浏览器内部。</p>
<p>由于保存sessionid的cookie默认是会话级别的cookie，在浏览器关闭后，cookie会跟着销毁，sessionid也丢失了。因此下次访问服务器，没有session的id就获取不到之前的session。也获取不到session中的商品信息</p>
<p>解决方法：我们可以创建一个名称为JSESSIONID的cookie，其中保存session的ID，并设置cookie的最大存活时间，让cookie保存到硬盘上（即使浏览器关闭，cookie也不会销毁），这样下次访问服务器时，还可以将sessionid带给服务器，服务器可以通过sessionid获取到之前的session。 从session中获取到商品信息</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/9e195f495be5cc6e805c1185fcc753ad-87aaa34fd641452a91d817ffb20d14c1.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871092-4d210210457690bcb716d34a0e39054b.png" alt="9e195f495be5cc6e805c1185fcc753ad"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/9e195f495be5cc6e805c1185fcc753ad-87aaa34fd641452a91d817ffb20d14c1.png" target="_blank" rel="noopener">9e195f495be5cc6e805c1185fcc753ad</a></p>
<h1 id="javaweb-cookie-session"><a href="#javaweb-cookie-session" class="headerlink" title="javaweb   cookie   session"></a><a href="https://www.zhangpeng.fun/tags/javaweb" target="_blank" rel="noopener">javaweb</a>   <a href="https://www.zhangpeng.fun/tags/cookie" target="_blank" rel="noopener">cookie</a>   <a href="https://www.zhangpeng.fun/tags/session" target="_blank" rel="noopener">session</a></h1>]]></content>
      <categories>
        <category>JavaWeb</category>
      </categories>
      <tags>
        <tag>javaweb</tag>
        <tag>cookie</tag>
        <tag>session</tag>
      </tags>
  </entry>
  <entry>
    <title>09-Maven</title>
    <url>/2020/06/11/09-Maven/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="09-Maven"><a href="#09-Maven" class="headerlink" title="09-Maven"></a>09-Maven</h1><h1 id="unit09-Maven"><a href="#unit09-Maven" class="headerlink" title="unit09-Maven"></a>unit09-Maven</h1><p><strong>今日学习目标：</strong></p>
<ol>
<li><p>了解什么是Maven及Maven的作用</p>
</li>
<li><p>掌握Maven安装及整合到Eclipse中</p>
</li>
<li><p>掌握如何使用Maven构建Java项目和Web项目</p>
</li>
<li><p>掌握使用Eclipse导入现有的Maven项目</p>
</li>
<li><p>了解Maven的三种仓库(本地仓库、镜像仓库（私服）、中央仓库（公服）)</p>
</li>
<li><p>了解Maven如何管理依赖（即管理jar包）</p>
</li>
</ol>
<h2 id="Maven介绍"><a href="#Maven介绍" class="headerlink" title="Maven介绍"></a>Maven介绍</h2><h3 id="Maven是什么"><a href="#Maven是什么" class="headerlink" title="Maven是什么?"></a>Maven是什么?</h3><p><a href="https://www.zhangpeng.fun/upload/2020/06/29cb6062127316fbe9e659ec05108844-a40e0f33c0044de08c17829c522ed8a1.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871021-0cf5901e09e78fa93721884e7130d93e.png" alt="29cb6062127316fbe9e659ec05108844"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/29cb6062127316fbe9e659ec05108844-a40e0f33c0044de08c17829c522ed8a1.png" target="_blank" rel="noopener">29cb6062127316fbe9e659ec05108844</a></p>
<p><strong>Maven</strong>: 翻译为”专家”、”内行”，是<strong>Apache</strong>下的一个纯Java开发的一个开源项目。</p>
<p><strong>Maven</strong>是一个项目管理工具，使用Maven可以来管理企业级的Java项目开发及依赖的管理。</p>
<p>使用<strong>Maven</strong>开发，可以简化项目配置，统一项目结构。总之，Maven可以让开发者的工作变得更简单。</p>
<hr>
<p>什么是依赖管理？要明白依赖管理，首先要知道什么是依赖？</p>
<p>一个Java项目中往往会依赖一些第三方的jar包。比如JDBC程序中要依赖数据库驱动包，或者在使用c3p0连接池时，要依赖c3p0的jar包等。这时我们称这些Java项目依赖第三方jar包。</p>
<p>而所谓的依赖管理，其实就是对项目中所有依赖的jar包进行规范化管理。</p>
<h3 id="为什么要使用Maven"><a href="#为什么要使用Maven" class="headerlink" title="为什么要使用Maven?"></a>为什么要使用Maven?</h3><p>传统的项目（工程）中管理项目所依赖的jar包完全靠人工进行管理，而人工管理jar包可能会产生诸多问题。</p>
<p><strong>1、不使用Maven，采用传统方式管理jar包的弊端：</strong></p>
<p>(1)在一些大型项目中会使用一些框架，比如SSM或者SSH框架，而框架中所包含的jar包非常多（甚至还依赖其他第三方的jar包），如果这些jar包我们手动去网上寻找，有些jar包不容易找到，比较麻烦。</p>
<p>(2)传统方式会将jar包添加到工程中，比如Java工程中将jar包放在工程根目录或者放在自建的lib目录下；JavaWeb工程会将jar包放在:/WEB-INF/lib目录下，这样会导致项目文件的体积暴增（例如，有些项目代码本身体积可能仅仅几兆，而加入jar包后，工程的体积可能会达到几十兆甚至百兆）。</p>
<p>(3)在传统的Java项目中是将所有的jar包统一拷贝的同一目录中，可能会存在jar包文件名称冲突的问题！</p>
<p>(4)在进行项目整合时，可能会出现jar包版本冲突的问题。</p>
<p>(5)在传统java项目中通过编译（手动编译或者在eclipse保存自动编译）、测试（手动在main函数中测试、junit单元测试）、打包部署(手动打war包/手动发布)、运行(手动启动tomcat运行)，最终访问程序。</p>
<p><strong>2、使用Maven来管理jar包的优势：</strong></p>
<p>(1)Maven团队维护了一个非常全的Maven仓库(中央仓库)，其中几乎包含了所有的jar包，使用Maven创建的工程可以自动到Maven仓库中下载jar包，方便且不易出错。</p>
<p>另外，在Maven构建的项目中，如果要使用到一些框架，我们只需要引入框架的核心jar包，框架所依赖的其他第三方jar包，Maven也会一并去下载。</p>
<p>(2)在Maven构建的项目中，不会将项目所依赖的jar包拷贝到每一个项目中，而是将jar包统一放在仓库中管理，在项目中只需要引入jar包的位置(坐标)即可。这样实现了jar包的复用。</p>
<p>(3)Maven采用坐标来管理仓库中的jar包，其中的目录结构为【公司名称+项目/产品名称+版本号】，可以根据坐标定位到具体的jar包。即使使用不同公司中同名的jar包，坐标不同（目录结构不同），文件名也不会冲突。</p>
<p>(4)Maven构建的项目中，通过pom文件对项目中所依赖的jar包及版本进行统一管理，可避免版本冲突。</p>
<p>(5)在Maven项目中，通过一个命令或者一键就可以实现项目的编译（mvn complie）、测试（mvn test）、打包部署（mvn deploy）、运行（mvn install）等。</p>
<p>还有发布到tomcat服务器中运行: mvn tomcat7:run。如果想实现上面的所有过程，只需要记住一个命令：mvn install</p>
<p>总之，使用Maven遵循规范开发有利于提高大型团队的开发效率，降低项目的维护成本，大公司都会优先使用Maven来构建项目.</p>
<h2 id="Maven安装"><a href="#Maven安装" class="headerlink" title="Maven安装"></a>Maven安装</h2><h3 id="下载、安装Maven"><a href="#下载、安装Maven" class="headerlink" title="下载、安装Maven"></a>下载、安装Maven</h3><p>1、官方下载地址：<a href="http://maven.apache.org/download.cgi" target="_blank" rel="noopener">http://maven.apache.org/download.cgi</a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/53a1d2f3f17b247cd6d1690974484a38-5c9d0214239a4bbf99170ceadc3c04cc.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871021-a0ddfab7071d976f349667c83333cd7f.png" alt="53a1d2f3f17b247cd6d1690974484a38"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/53a1d2f3f17b247cd6d1690974484a38-5c9d0214239a4bbf99170ceadc3c04cc.png" target="_blank" rel="noopener">53a1d2f3f17b247cd6d1690974484a38</a></p>
<p>2、下载绿色版，解压之后就可以使用。</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/f053c9311f77b5a8d9f905fa3859e2c7-94a151d76a87436ca00b3b5fd9d3ea9c.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871021-8ccc96d7fcc04df81e77c4dd72488be2.png" alt="f053c9311f77b5a8d9f905fa3859e2c7"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/f053c9311f77b5a8d9f905fa3859e2c7-94a151d76a87436ca00b3b5fd9d3ea9c.png" target="_blank" rel="noopener">f053c9311f77b5a8d9f905fa3859e2c7</a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/9ab44a6351a1fd7320ae28eea7a0fa6b-a44fad125df54e6f9aa59d4904b9a698.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871021-17f2df2fcfa4a9d8c02e1e8fd631fd90.png" alt="9ab44a6351a1fd7320ae28eea7a0fa6b"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/9ab44a6351a1fd7320ae28eea7a0fa6b-a44fad125df54e6f9aa59d4904b9a698.png" target="_blank" rel="noopener">9ab44a6351a1fd7320ae28eea7a0fa6b</a></p>
<p>原则: 安装的路径中不要有中文和空格!!</p>
<p>3、若要下载旧版本Maven，可以访问：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;archive.apache.org&#x2F;dist&#x2F;maven&#x2F;maven-3&#x2F;</span><br></pre></td></tr></table></figure>

<p><a href="https://www.zhangpeng.fun/upload/2020/06/2125c89c33f029357b460c5f98edaed5-7412dd085cf84b1aa917d1392a1ae1df.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871021-6ff77b852ffd04bda6070a6e9ee08439.png" alt="2125c89c33f029357b460c5f98edaed5"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/2125c89c33f029357b460c5f98edaed5-7412dd085cf84b1aa917d1392a1ae1df.png" target="_blank" rel="noopener">2125c89c33f029357b460c5f98edaed5</a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/4465c83cfebe53f76a6e25e5e919402d-e0f2c796e86b4d3d92434bbfa23e9ad4.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871021-01045fd6f421e54d6ade64d42d7f6878.png" alt="4465c83cfebe53f76a6e25e5e919402d"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/4465c83cfebe53f76a6e25e5e919402d-e0f2c796e86b4d3d92434bbfa23e9ad4.png" target="_blank" rel="noopener">4465c83cfebe53f76a6e25e5e919402d</a></p>
<h2 id="Maven的相关配置"><a href="#Maven的相关配置" class="headerlink" title="Maven的相关配置"></a>Maven的相关配置</h2><p>在开发中更多是通过Eclipse+Maven来构建Maven项目，所以这里我们需要将Maven配置到Eclipse开发工具中。</p>
<p>在将安装好的Maven工具配置的Eclipse开发工具中之前，需要做一些相关的配置。</p>
<h3 id="配置本地仓库位置"><a href="#配置本地仓库位置" class="headerlink" title="配置本地仓库位置"></a>配置本地仓库位置</h3><p>本地仓库：其实就是本地硬盘上的某一目录，该目录中会包含maven项目中所需要的所有jar包及插件。当所需jar包在本地仓库没有时，从网络上下载下来的jar包也会存放在本地仓库中。</p>
<p>因此本地仓库其实就是一个存放jar包的目录，我们可以指定Maven仓库的位置。</p>
<p>如果不指定，maven本地仓库的默认位置是在c盘，在：</p>
<p><code>C:/Users/{当前用户}/.m2/repository</code>，例如:</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/d9d738475e447449e535cf7e6a735be8-4babfa99630d4b8d89d540374d58bfb7.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871021-d869c0a8436959e3b5de8221d69db123.png" alt="d9d738475e447449e535cf7e6a735be8"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/d9d738475e447449e535cf7e6a735be8-4babfa99630d4b8d89d540374d58bfb7.png" target="_blank" rel="noopener">d9d738475e447449e535cf7e6a735be8</a></p>
<p>可以保持默认，当然也可以修改本地仓库的位置到别的盘符路径。</p>
<p>修改方法：找到[MAVEN_HOME]/conf/目录中的配置文件settings.xml，修改maven仓库的路径。</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200401104914602-8ba45ccb3b3c445bbd89edcd91f15af1.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871021-39278864c09d0c9f55a07d159958622a.png" alt="image-20200401104914602"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200401104914602-8ba45ccb3b3c445bbd89edcd91f15af1.png" target="_blank" rel="noopener">image-20200401104914602</a></p>
<p>配置该目录后，以后通过maven下载的jar包将会保存在配置的目录下。</p>
<p><strong>以上内容可以总结为：</strong></p>
<ol>
<li>什么是本地仓库？</li>
<li>本地仓库的默认位置在哪儿？</li>
<li>配置和不配置本地仓库有什么区别？</li>
</ol>
<h3 id="配置镜像仓库-私服"><a href="#配置镜像仓库-私服" class="headerlink" title="配置镜像仓库(私服)"></a>配置镜像仓库(私服)</h3><p>当maven项目中需要依赖jar包时，如果本地仓库中没有，就会到远程仓库去下载jar包。</p>
<p>如果不配置镜像仓库，默认连接的是中央仓库，由于中央仓库面向的是全球用户，所以在下载jar包时，速度可能会比较慢，效率会比较低。</p>
<p>可以在settings.xml文件中配置连接达内镜像仓库（前提是在达内教室，连接的是达内内网）或者连接阿里云镜像仓库（需要有外网）。</p>
<p>1、如果连接的是达内内网，可以连接达内镜像仓库（如果不配置，默认连接中央仓库，没有外网，连接不了中央仓库，会导致jar包无法下载）。</p>
<p>需要做的是，在settings.xml文件中的<code>&lt;settings&gt;</code>标签下的<code>&lt;mirrors&gt;</code>标签内部添加如下配置，配置达内镜像仓库：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mirror</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus-tedu<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>Nexus tedu<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>central<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://maven.tedu.cn/nexus/content/groups/public/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>2、如果在家里、在公司连接的是外网，是无法连接达内的镜像仓库，可以选择什么都不配置，默认连接中央仓库，或者可以配置连接阿里云镜像仓库（不要使用手机热点网络连接），配置如下：</p>
<p>配置阿里云镜像仓库：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mirror</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus-aliyun<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">name</span>&gt;</span>Nexus aliyun<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>central<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">url</span>&gt;</span>http://maven.aliyun.com/nexus/content/groups/public/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>镜像仓库配置总结：</strong></p>
<ol>
<li><p>当所需jar包在本地仓库没有时，会从网络上下载。配置镜像仓库其实就是配置，去网络中哪个位置下载jar包到本地。</p>
</li>
<li><p>如果在公司，并且公司有搭建镜像服务器，推荐使用公司的镜像服务器下载jar包，速度会更快。（如果在达内，使用的是内网，只能配置达内的镜像仓库。否则，没有外网也连接不了中央仓库，下载jar包会失败！）</p>
</li>
<li><p>如果在家里，使用的是外网，可以不配置镜像仓库，默认连接中央仓库下载jar包，或者配置阿里云的镜像仓库。连接阿里云服务器下载jar包。（注意，如果配置阿里云镜像服务器，<strong>不可使用手机热点网络！</strong>）</p>
</li>
</ol>
<h3 id="配置JDK版本"><a href="#配置JDK版本" class="headerlink" title="配置JDK版本"></a>配置JDK版本</h3><p>通过 Maven创建的工程，JDK版本默认是JDK1.5，每次都需要手动改为更高的版本。</p>
<p>这里可以通过修改maven的settings.xml文件, 达到一劳永逸的效果。</p>
<p>配置方式为：打开 <code>{maven根目录}/conf/settings.xml</code> 文件并编辑，在 settings.xml文件内部的 <code>&lt;profiles&gt;</code> 标签内部添加如下配置：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">profile</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span>&gt;</span>development<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">activation</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">jdk</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">jdk</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">activeByDefault</span>&gt;</span>true<span class="tag">&lt;/<span class="name">activeByDefault</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">activation</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">maven.compiler.compilerVersion</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.compilerVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="将Maven配置到Eclipse中"><a href="#将Maven配置到Eclipse中" class="headerlink" title="将Maven配置到Eclipse中"></a>将Maven配置到Eclipse中</h3><p>将Maven工具配置到Eclipse中，就可以通过Eclipse和自己安装的Maven创建Maven项目了。</p>
<p><strong>1、window右键–&gt; Preferences：</strong></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/95e8c0d77e32611aa01c83fdfe9115bc-93081ff6f64549acbb6e58d0b525ada5.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871021-2520c862241a77b6670ac59e83d54c70.png" alt="95e8c0d77e32611aa01c83fdfe9115bc"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/95e8c0d77e32611aa01c83fdfe9115bc-93081ff6f64549acbb6e58d0b525ada5.png" target="_blank" rel="noopener">95e8c0d77e32611aa01c83fdfe9115bc</a></p>
<p><strong>2、点击Maven选项，在右侧选项中勾选 “Download Artifact Sources”：</strong></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/b8de69f1e0238506740120c3ac2761b2-a6c4f889a71c4875b0226c52e0228c12.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871021-dfcecf6591b7644c5c1c76ce8f1a24a9.png" alt="b8de69f1e0238506740120c3ac2761b2"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/b8de69f1e0238506740120c3ac2761b2-a6c4f889a71c4875b0226c52e0228c12.png" target="_blank" rel="noopener">b8de69f1e0238506740120c3ac2761b2</a></p>
<p><strong>3、点击add将自己安装的Maven添加进来：</strong></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/c75f99240250846b1009f595627fd48b-431f07b4b757482eb2175f3058a00298.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871021-6e4c6eaf49cb4f0af0e6830c378bc436.png" alt="c75f99240250846b1009f595627fd48b"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/c75f99240250846b1009f595627fd48b-431f07b4b757482eb2175f3058a00298.png" target="_blank" rel="noopener">c75f99240250846b1009f595627fd48b</a></p>
<p><strong>4、添加自己安装的Maven：</strong></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/1e470e51fcaec075f1d1e3475978325f-46b9da9295404ba7932746ef4aa7c033.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871021-19085d606d7704c325d4de6eaa9c76ca.png" alt="1e470e51fcaec075f1d1e3475978325f"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/1e470e51fcaec075f1d1e3475978325f-46b9da9295404ba7932746ef4aa7c033.png" target="_blank" rel="noopener">1e470e51fcaec075f1d1e3475978325f</a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/90ca91b942da7c2a58b6e38d234200c3-f05311174d2845c28268a2851ab27485.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871021-d2598f2c80c774d15d47385e4460847b.png" alt="90ca91b942da7c2a58b6e38d234200c3"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/90ca91b942da7c2a58b6e38d234200c3-f05311174d2845c28268a2851ab27485.png" target="_blank" rel="noopener">90ca91b942da7c2a58b6e38d234200c3</a></p>
<p>**一定要注意:**自己安装的Maven不要放在桌面上(容易丢失，并且路径中往往有空格)，maven的安装路径中也不要包含中文和空格!!</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/88bd59974c2d8f430ffab34336bb9f33-e44a9ae1768a4a7d976fe0e5fc04d71c.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871021-c662baabe97a6a0900db38c4d5169f49.png" alt="88bd59974c2d8f430ffab34336bb9f33"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/88bd59974c2d8f430ffab34336bb9f33-e44a9ae1768a4a7d976fe0e5fc04d71c.png" target="_blank" rel="noopener">88bd59974c2d8f430ffab34336bb9f33</a></p>
<p><strong>5、将默认的maven切换为自己配置的maven：</strong></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/3c3426a658642a9ca1c41e67e790f006-10442b44ec51472eb1e593d6477083b2.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871021-3ae67ae79f64e6ad9f532cdb4164ea73.png" alt="3c3426a658642a9ca1c41e67e790f006"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/3c3426a658642a9ca1c41e67e790f006-10442b44ec51472eb1e593d6477083b2.png" target="_blank" rel="noopener">3c3426a658642a9ca1c41e67e790f006</a></p>
<p><strong>6、设置maven的settings文件的位置：</strong></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/3290041ab768b3e7a6ee02ffd40f8c9e-9cd5955d746841a7860a2074562c30c2.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871021-ce04e5fffb86801dd778ad448697c96b.png" alt="3290041ab768b3e7a6ee02ffd40f8c9e"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/3290041ab768b3e7a6ee02ffd40f8c9e-9cd5955d746841a7860a2074562c30c2.png" target="_blank" rel="noopener">3290041ab768b3e7a6ee02ffd40f8c9e</a></p>
<p>**7、测试是否配置成功：**window—&gt; show view —&gt; other中搜索”maven”，点击下面的选框中的选项</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/facabede667d2edbead383cd5d725a75-179e39e49b724dbfb3edaa9ff3ba8f85.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871021-486c4371977b080ffcb904c28379ca17.png" alt="facabede667d2edbead383cd5d725a75"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/facabede667d2edbead383cd5d725a75-179e39e49b724dbfb3edaa9ff3ba8f85.png" target="_blank" rel="noopener">facabede667d2edbead383cd5d725a75</a></p>
<p>在弹出的窗口中，查看自己配置的本地仓库和远程仓库镜像:</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/e5fbbd21f05c86804f0656638784cba8-8b5758679c584a52884fee2ad044ee30.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871021-25633f3319349d160cc5e72a9c5b9bdf.png" alt="e5fbbd21f05c86804f0656638784cba8"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/e5fbbd21f05c86804f0656638784cba8-8b5758679c584a52884fee2ad044ee30.png" target="_blank" rel="noopener">e5fbbd21f05c86804f0656638784cba8</a></p>
<h2 id="Maven的项目构建"><a href="#Maven的项目构建" class="headerlink" title="Maven的项目构建"></a>Maven的项目构建</h2><p>通过Maven构建Java项目分为两种方式：</p>
<p>（1）创建Maven的简单Java工程以及创建Maven的简单Web工程</p>
<p>（2）创建使用模板的Java工程以及创建使用模板的Web工程</p>
<p>在利用Maven构建项目时分两种，第一种是：创建简单工程**（Create a simple<br>project）**，即在创建时勾选前面的框。</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/8888dd2dcf76aff253b16f4559f6df39-dd7e0f6145474ee08bf63e5065508bbb.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871021-dfc1ec5c375816415e4286d0f4eaecf8.png" alt="8888dd2dcf76aff253b16f4559f6df39"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/8888dd2dcf76aff253b16f4559f6df39-dd7e0f6145474ee08bf63e5065508bbb.png" target="_blank" rel="noopener">8888dd2dcf76aff253b16f4559f6df39</a></p>
<p><em>(不勾选前面的框，即创建使用骨架（其实就是模版）创建Maven工程)</em></p>
<p>另，在创建简单工程时，还分为创建<strong>Java工程</strong>和<strong>JavaWeb工程</strong>。下面分别进行演示。</p>
<h3 id="创建简单工程—Java工程"><a href="#创建简单工程—Java工程" class="headerlink" title="创建简单工程—Java工程"></a>创建简单工程—Java工程</h3><p><strong>1、空白处右键New —&gt; Maven Project：</strong></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/a21856795d5e9f4c4f63603c68711cbb-2e6f5b629c21409baccf79d92a5f7f28.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871021-2f66f7a8c2013096ce70db52b95c3dc5.png" alt="a21856795d5e9f4c4f63603c68711cbb"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/a21856795d5e9f4c4f63603c68711cbb-2e6f5b629c21409baccf79d92a5f7f28.png" target="_blank" rel="noopener">a21856795d5e9f4c4f63603c68711cbb</a></p>
<p><strong>2、在弹出的窗口中，勾选前面的框，创建一个简单工程（即不使用骨架），进入下一步。</strong></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/d8b1436aea89ddf1c2ee001333a9f56c-da18923d1e75493eafb2148d366edce1.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871021-7656297f729a37c5b179b801c4f8b3e0.png" alt="d8b1436aea89ddf1c2ee001333a9f56c"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/d8b1436aea89ddf1c2ee001333a9f56c-da18923d1e75493eafb2148d366edce1.png" target="_blank" rel="noopener">d8b1436aea89ddf1c2ee001333a9f56c</a></p>
<p><strong>3、在弹出的窗口中，填写内容(Package选择jar，即创建java工程)，点击完成即可。</strong></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/eb0b7c41231cc90448d85150fd76ce95-eab6be9f380948a18c8ab1e5d5fbf7d0.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871021-8c5a34cc19b58520d0d9714129c44e1d.png" alt="eb0b7c41231cc90448d85150fd76ce95"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/eb0b7c41231cc90448d85150fd76ce95-eab6be9f380948a18c8ab1e5d5fbf7d0.png" target="_blank" rel="noopener">eb0b7c41231cc90448d85150fd76ce95</a></p>
<p><strong>在上述内容中，必填的内容有四项：</strong></p>
<p>(1)<strong>Group Id</strong> – 组的名称，通常填写公司名称（比如com.tedu）或者组织名称(org.apache..)</p>
<p>(2)<strong>Artifact Id</strong> – 项目名称或者模块名称</p>
<p>(3)<strong>Version</strong> – 项目的版本，创建的项目默认是0.0.1-SNAPSHOT快照，也叫非正式版，正式版是RELEASE)</p>
<p>(4)<strong>Package</strong> – 项目的类型：jar表示创建的是Java工程，war表示创建的是web工程，pom表示创建的是父工程（当然相对的还有子工程）或者聚合工程，pom目前我们不讨论。</p>
<p>填写完毕后，点击完成即可完成创建简单Java工程</p>
<p><strong>4、切换工程视图为包视图：window –&gt; show view，在弹出的窗口中搜索：</strong></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/0578e41f1fad77ea0ed8509afd2d11d9-ab60d6950c1c437d8e7276b02acc0bd0.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871021-93ba6df6d2a54e3b4a1aa3e66e172cb4.png" alt="0578e41f1fad77ea0ed8509afd2d11d9"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/0578e41f1fad77ea0ed8509afd2d11d9-ab60d6950c1c437d8e7276b02acc0bd0.png" target="_blank" rel="noopener">0578e41f1fad77ea0ed8509afd2d11d9</a></p>
<h3 id="创建简单工程—Web工程"><a href="#创建简单工程—Web工程" class="headerlink" title="创建简单工程—Web工程"></a>创建简单工程—Web工程</h3><p><strong>1、空白处右键New —&gt; Maven Project：</strong></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/a21856795d5e9f4c4f63603c68711cbb-2e6f5b629c21409baccf79d92a5f7f28.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871021-2f66f7a8c2013096ce70db52b95c3dc5.png" alt="a21856795d5e9f4c4f63603c68711cbb"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/a21856795d5e9f4c4f63603c68711cbb-2e6f5b629c21409baccf79d92a5f7f28.png" target="_blank" rel="noopener">a21856795d5e9f4c4f63603c68711cbb</a></p>
<p><strong>2、在弹出的窗口中，勾选前面的框，创建一个简单工程（即不使用骨架），进入下一步。</strong></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/d8b1436aea89ddf1c2ee001333a9f56c-da18923d1e75493eafb2148d366edce1.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871021-7656297f729a37c5b179b801c4f8b3e0.png" alt="d8b1436aea89ddf1c2ee001333a9f56c"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/d8b1436aea89ddf1c2ee001333a9f56c-da18923d1e75493eafb2148d366edce1.png" target="_blank" rel="noopener">d8b1436aea89ddf1c2ee001333a9f56c</a></p>
<p><strong>3、在弹出的窗口中，填写内容(Package选择war，即创建web工程)，点击完成即可。</strong></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/e6f4239c8e4caba3a12fd2852be782bc-3e6987fb1c4242d8bb8071943e478493.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871021-2aa1de73713ec3fee6448ef73ed3935d.png" alt="e6f4239c8e4caba3a12fd2852be782bc"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/e6f4239c8e4caba3a12fd2852be782bc-3e6987fb1c4242d8bb8071943e478493.png" target="_blank" rel="noopener">e6f4239c8e4caba3a12fd2852be782bc</a></p>
<p><strong>4、创建完成后pom.xml文件会报错，说找不到web.xml文件，例如：</strong></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/ce00e7568eb6f3632ae14f0053e87451-8ac8d797eed74ea492c322442a047fbe.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871021-c029cbe69318d7861b049ba125f65fa7.png" alt="ce00e7568eb6f3632ae14f0053e87451"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/ce00e7568eb6f3632ae14f0053e87451-8ac8d797eed74ea492c322442a047fbe.png" target="_blank" rel="noopener">ce00e7568eb6f3632ae14f0053e87451</a></p>
<p><strong>手动添加(拷贝)即可，例如:</strong></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/9714b18c4003841a3bbf23062539f491-564aa85cb6924dc790db588226cde5da.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871021-36dc7380baa9a6eb985cc347264a5a42.png" alt="9714b18c4003841a3bbf23062539f491"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/9714b18c4003841a3bbf23062539f491-564aa85cb6924dc790db588226cde5da.png" target="_blank" rel="noopener">9714b18c4003841a3bbf23062539f491</a></p>
<p><strong>5、创建Servlet程序，测试运行环境。</strong></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/0185f08055d050b93aa6ed68f920bff8-35f3511003464eed8612447eab9198de.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871021-e4b0d34843f686988d23b91f3eebce90.png" alt="0185f08055d050b93aa6ed68f920bff8"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/0185f08055d050b93aa6ed68f920bff8-35f3511003464eed8612447eab9198de.png" target="_blank" rel="noopener">0185f08055d050b93aa6ed68f920bff8</a></p>
<p>上面的错误是因为运行环境中缺少Servlet的jar包，将tomcat运行环境添加过来即可！</p>
<p><strong>!!缺少Servlet运行环境解决方案：</strong></p>
<p>在项目上点击鼠标右键，选择 “Properties” —&gt; “Targeted Runtimes”:</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/e321e3569a1e0dc2d6a7ddc2d953204f-3ab656f0c30e4d96916e5228bfb35a64.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871021-3a10cb8d0fa8d8f69cac3f40450e1f3d.png" alt="e321e3569a1e0dc2d6a7ddc2d953204f"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/e321e3569a1e0dc2d6a7ddc2d953204f-3ab656f0c30e4d96916e5228bfb35a64.png" target="_blank" rel="noopener">e321e3569a1e0dc2d6a7ddc2d953204f</a></p>
<p>或者，在项目中的pom.xml文件中的根标签下添加Servlet的jar包的坐标，引入Servlet的jar包，如下：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jsp-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>添加后保存pom文件。若还报错，在项目上右键选择 <strong>“Maven”</strong> —&gt; <strong>“UpdateProject…”</strong> 更新工程即可！</p>
<p><strong>6、实现Servlet程序</strong></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/1bcc65d4c935093c915409cb865902bf-269960174cc347939101a6092652cc57.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871021-0d838ec80f1c713ae07dd5eda31ba93c.png" alt="1bcc65d4c935093c915409cb865902bf"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/1bcc65d4c935093c915409cb865902bf-269960174cc347939101a6092652cc57.png" target="_blank" rel="noopener">1bcc65d4c935093c915409cb865902bf</a></p>
<p>**7、测试访问：**打开浏览器访问地址：<a href="http://localhost:8080/MavenSimpleProJavaweb/HelloServlet" target="_blank" rel="noopener">http://localhost/MavenSimpleProJavaweb/HelloServlet</a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/7c9682115d7e105ccc587d511be921e1-cc6a016612d3447886f4d2090d043f22.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871021-18941b6d77b85e3a173855208e54c990.png" alt="7c9682115d7e105ccc587d511be921e1"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/7c9682115d7e105ccc587d511be921e1-cc6a016612d3447886f4d2090d043f22.png" target="_blank" rel="noopener">7c9682115d7e105ccc587d511be921e1</a></p>
<h3 id="Maven的目录结构"><a href="#Maven的目录结构" class="headerlink" title="Maven的目录结构"></a>Maven的目录结构</h3><p>使用Maven创建的工程我们称它为Maven工程，Maven工程具有一定的目录规范，对目录结构有严格的要求，一个Maven工程要具有如下目录结构：</p>
<p><a href="https://www.zhangpeng.fun/archives/JAVAWEB-NOTE03.assets/image-20200225092639227.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871021-1ce6b092f5467447a651af4adb76228d.png" alt="image-20200225092639227"></a></p>
<p><a href="https://www.zhangpeng.fun/archives/JAVAWEB-NOTE03.assets/image-20200225092639227.png" target="_blank" rel="noopener">image-20200225092639227</a></p>
<p>下面以Maven的Web项目为例，介绍Maven项目中的目录结构：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Maven项目名称(Web项目)</span><br><span class="line">  |-- src&#x2F;main&#x2F;java(源码目录)：用于存放程序&#x2F;项目所需要的java源码文件</span><br><span class="line">  |-- src&#x2F;main&#x2F;resources(源码目录)：用于存放程序&#x2F;项目所需要的配置文件</span><br><span class="line">  |-- src&#x2F;test&#x2F;java(源码目录)：用于存放测试程序的java源文件</span><br><span class="line">  |-- src&#x2F;test&#x2F;resources(源码目录)：用于存放测试程序所需要配置文件</span><br><span class="line">  |-- src&#x2F;main&#x2F;webapp：(Web应用的根目录，作用类似于WebContent)</span><br><span class="line">  				 				|-- WEB-INF：(受保护的目录)</span><br><span class="line">  				 							|-- web.xml：(Web应用的核心配置文件)</span><br><span class="line">  |-- target&#x2F;classes(类目录)：源码目录中的资源经过编译后，会输出到类目录下。</span><br><span class="line">  |-- pom.xml：Maven项目中非常重要的文件，将来项目需要任何jar包或插件，都可以通过pom文件来导入这些jar包或插件。</span><br></pre></td></tr></table></figure>

<h2 id="导入已有的Maven项目"><a href="#导入已有的Maven项目" class="headerlink" title="导入已有的Maven项目"></a>导入已有的Maven项目</h2><p>现将后面通过SSM框架实现的&lt;&lt;永和大王门店管理系统&gt;&gt;（Maven）项目导入到我们的Eclipse开发环境中。</p>
<p>在导入项目时我们通常会通过 “File” –&gt; “Import…” 来导入项目，但是这样能会产生环境问题=，例如：如果项目本身自带的环境和我们当前使用的开发环境不一致，就会产生问题。可以按照下面的方式来进行导入。</p>
<p>下面是导入的步骤：</p>
<p><strong>1、创建一个新的Maven工程（JavaWeb工程）</strong></p>
<p>确保已经配置好Maven的环境后，在Eclipse中创建一个新的Maven工程（Javaweb工程），新工程的名字和所导入的工程的名字可以相同也可以不同，例如：</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/ed42db71791984bdce6bbe04c3147120-dd9c493e907143578f4a77c21cfcfd80.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871021-22e8eaefea88d4984de071d8d3c304b6.png" alt="ed42db71791984bdce6bbe04c3147120"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/ed42db71791984bdce6bbe04c3147120-dd9c493e907143578f4a77c21cfcfd80.png" target="_blank" rel="noopener">ed42db71791984bdce6bbe04c3147120</a></p>
<p><strong>2、解压yonghe-ssm.zip压缩包</strong></p>
<p>将下发的 yonghe-ssm 项目解压出来，解压后的结构如下：</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200326195041536-f9ab7427e77844438ab4cb5c338eeef5.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871021-c658ce075d92bcc9c72143f7b9dce80b.png" alt="image-20200326195041536"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200326195041536-f9ab7427e77844438ab4cb5c338eeef5.png" target="_blank" rel="noopener">image-20200326195041536</a></p>
<p>打开 yonghe-ssm 目录：</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200326195147418-7ba8888f14d143e48395efa6e4f3cd22.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871021-e8ab05a88cc62bb5e8186102946d294f.png" alt="image-20200326195147418"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200326195147418-7ba8888f14d143e48395efa6e4f3cd22.png" target="_blank" rel="noopener">image-20200326195147418</a></p>
<p><strong>3、将解压后的目录中的src目录选中并复制。</strong></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/b9bf1d703dc2546c114b1a7832113233-70ad4363f1da46e69c6cd7a88b006d81.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871021-8ba3e6c6a56b36dd127374d84529327c.png" alt="b9bf1d703dc2546c114b1a7832113233"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/b9bf1d703dc2546c114b1a7832113233-70ad4363f1da46e69c6cd7a88b006d81.png" target="_blank" rel="noopener">b9bf1d703dc2546c114b1a7832113233</a></p>
<p><strong>4、点击新创建的Maven工程右键粘贴，将复制的src目录粘贴到新建的工程中</strong></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/fdc57a6cab8a89d634112760063efe18-d146c385c7e54029be429f5e77c76aa3.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871021-5b641e51af99b604a69cdffb164c47a6.png" alt="fdc57a6cab8a89d634112760063efe18"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/fdc57a6cab8a89d634112760063efe18-d146c385c7e54029be429f5e77c76aa3.png" target="_blank" rel="noopener">fdc57a6cab8a89d634112760063efe18</a></p>
<p><strong>5、打开解压后的目录中的pom.xml文件, 复制其中的内容：</strong></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/32b2d2e712857eb26fae448eecf7ce26-4f933f7f1c9440b9be887ba122d14801.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871021-f6eb296c56db549371bb30c3d4d76736.png" alt="32b2d2e712857eb26fae448eecf7ce26"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/32b2d2e712857eb26fae448eecf7ce26-4f933f7f1c9440b9be887ba122d14801.png" target="_blank" rel="noopener">32b2d2e712857eb26fae448eecf7ce26</a></p>
<p>如果复制后项目或pom文件仍然报错, 可以更新Maven工程</p>
<p>**更新Maven工程：**在项目上右键选择 <strong>“Maven”</strong> —&gt; <strong>“Update<br>Project…”</strong>，在弹出的窗口中直接点击OK即可！</p>
<p><strong>6、执行SQL脚本文件，导入数据</strong></p>
<p>打开cmd，连接mysql数据库，执行<strong>yonghedb.sql</strong>中的SQL语句，创建数据库、表及插入记录。</p>
<p><strong>7、部署项目到服务器并启动服务器，访问测试</strong></p>
<p>在正确完成上面的操作后，打开浏览器访问如下地址：<a href="http://localhost/yonghe-ssm/index" target="_blank" rel="noopener">http://localhost/yonghe-ssm/index</a><br>，可以看到如下界面：</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/770fe679ff527efa1f80fc4e57a96f79-b45af62dd5704ecf826b8018beebbdf6.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871021-8c83af6daea438c75f98797bb7c2dcc5.png" alt="770fe679ff527efa1f80fc4e57a96f79"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/770fe679ff527efa1f80fc4e57a96f79-b45af62dd5704ecf826b8018beebbdf6.png" target="_blank" rel="noopener">770fe679ff527efa1f80fc4e57a96f79</a></p>
<h2 id="Maven的依赖管理"><a href="#Maven的依赖管理" class="headerlink" title="Maven的依赖管理"></a>Maven的依赖管理</h2><h3 id="依赖-jar包-管理"><a href="#依赖-jar包-管理" class="headerlink" title="依赖(jar包)管理"></a>依赖(jar包)管理</h3><p>依赖管理即jar包的管理，那么通过Maven创建的工程是如何管理jar包的？</p>
<p><strong>1、在Maven项目中如何引入jar包？</strong></p>
<p>在Maven创建的项目中，如果需要引用jar包，只需要在项目的pom.xml文件中添加jar包的坐标(GroupID + ArtifactID + Version)即可将jar包引进项目中，之后就可以在项目中使用所引入的jar包了。</p>
<p>例如，现在我们在pom.xml文件中，添加servlet的jar包的坐标如下：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>2.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在pom.xml文件中，添加mysql驱动包的坐标如下：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.32<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>2、项目中引入的jar包存放在哪里？</strong></p>
<p>那么问题来了，在pom文件中添加的servlet的jar包坐标，添加的仅仅是一个jar包对应的坐标，而这个jar包到底存放在哪里呢?</p>
<p>了解Maven管理jar包的规则之后，我们可以找到jar包的存放位置是在<strong>本地仓库</strong>（仓库默认是在：C:\Users\{当前用户}\.m2\repository）的 /javax/servlet/servlet-api/2.5/目录下，例如：</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/a9335bd016fc4426edf4e06a0a53ef73-10a406ce23c147c6b76addc575e7a80c.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871021-3c8472fe57585ef281d6b15e4b6fcbe4.png" alt="a9335bd016fc4426edf4e06a0a53ef73"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/a9335bd016fc4426edf4e06a0a53ef73-10a406ce23c147c6b76addc575e7a80c.png" target="_blank" rel="noopener">a9335bd016fc4426edf4e06a0a53ef73</a></p>
<p><strong>总结：</strong></p>
<ul>
<li>在Maven中，所有的jar包全都存放在本地仓库的目录中，如果项目中需要使用某一个jar包，直接在项目的pom.xml文件中通过坐标(GroupID + ArtifactID + Version)引入指定位置的jar包即可。</li>
<li>这样可以将项目中所有使用的jar包集中在一个目录（本地仓库）中统一进行管理，需要时通过坐标直接引入即可，而不是在每个项目中都拷贝一份，减少了项目体积，也节省了磁盘空间。</li>
<li>将来如果别人需要导入你的项目，只需要将项目（当然包括pom.xml文件）代码整体传给对方，无需将jar包发送给对方，对方在配置Maven的环境后，Maven会自动根据项目中pom.xml文件里配置的坐标，引入（或下载后再引入）对应的jar包。</li>
</ul>
<p><strong>3、如果引入的jar包在本地仓库中没有呢？</strong></p>
<ul>
<li><p>如果是刚配置的Maven环境，本地仓库中还没有太多jar包，此时在pom文件中通过坐标引入jar包，而本地仓库中没有这个jar包，这时会怎么样呢？</p>
</li>
<li><p>若本地仓库没有所需要的jar包，则会到镜像仓库（也叫私服）或者到中央仓库（也叫公服）中下载。下面我们就来介绍Maven的这三种仓库。</p>
</li>
</ul>
<h3 id="Maven三种仓库"><a href="#Maven三种仓库" class="headerlink" title="Maven三种仓库"></a>Maven三种仓库</h3><p>在上面所提到的本地仓库、镜像仓库、中央仓库是用来Maven用来更好的管理jar包的所采用的一种方式。下面来了解Maven的<strong>三种仓库</strong>，以及三种仓库之间的潜在联系。</p>
<p>通过maven构建的项目，会通过项目中的pom.xml文件从远程仓库下载，并保存到本地仓库</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/6d744a6b627f8edded770b46bb5e316e-2a409d03ccbd4d64aef4c61ad2123bd4.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871021-87e18156113618bca442440937f0dedf.png" alt="6d744a6b627f8edded770b46bb5e316e"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/6d744a6b627f8edded770b46bb5e316e-2a409d03ccbd4d64aef4c61ad2123bd4.png" target="_blank" rel="noopener">6d744a6b627f8edded770b46bb5e316e</a></p>
<p><strong>本地仓库</strong>：默认的本地仓库位置在：c:/$/.m2/repository，其中$表示windows下的用户目录。本地仓库的作用是，用于保存（存储）从私服或者从中央仓库下载下来的jar包（或插件）。当项目中需要使用jar包和插件时，优先从本地仓库查找。</p>
<p>如果本地仓库中没有所需的jar包，可以到私服或者到中央仓库中下载后再保存到本地仓库。</p>
<p><strong>镜像仓库</strong>：镜像仓库也叫做私服（Nexus），私服一般由公司搭建并维护（也可以自己搭建）。比如达内有搭建自己的私服服务器（<a href="http://maven.tedu.cn/nexus/content/groups/public/%EF%BC%89%EF%BC%8C%E4%BB%A5%E5%8F%8A%E9%98%BF%E9%87%8C%E4%BA%91%E7%A7%81%E6%9C%8D%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%88http://maven.aliyun.com/nexus/content/groups/public/%EF%BC%89%E3%80%82" target="_blank" rel="noopener">http://maven.tedu.cn/nexus/content/groups/public/），以及阿里云私服服务器（http://maven.aliyun.com/nexus/content/groups/public/）。</a></p>
<p>如果项目中使用到的jar包或者插件本地仓库中没有，则可以到私服中下载，如果私服中有就直接将jar包保存到本地仓库中；而如果私服中也没有所需的jar包，就到中央仓库（公服）上下载所需要的jar包，下载之后先在私服上保存一份，最后再保存到本地仓库。</p>
<p><strong>中央仓库</strong>：中央仓库也叫做公服，在maven软件中内置了一个仓库地址（<a href="http://repo1.maven.org/maven2%EF%BC%89%E5%AE%83%E5%B0%B1%E6%98%AF%E4%B8%AD%E5%A4%AE%E4%BB%93%E5%BA%93%EF%BC%8C%E6%9C%8D%E5%8A%A1%E4%BA%8E%E6%95%B4%E4%B8%AA%E4%BA%92%E8%81%94%E7%BD%91%EF%BC%8C%E7%94%B1Maven%E5%9B%A2%E9%98%9F%E8%87%AA%E5%B7%B1%E6%90%AD%E5%BB%BA%E5%B9%B6%E7%BB%B4%E6%8A%A4%EF%BC%8C%E9%87%8C%E9%9D%A2%E5%AD%98%E5%82%A8%E4%BA%86%E9%9D%9E%E5%B8%B8%E5%85%A8%E7%9A%84jar%E5%8C%85%EF%BC%8C%E5%AE%83%E5%8C%85%E5%90%AB%E4%BA%86%E4%B8%96%E7%95%8C%E4%B8%8A%E5%A4%A7%E9%83%A8%E5%88%86%E6%B5%81%E8%A1%8C%E7%9A%84%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE%E7%9A%84jar%E5%8C%85%E3%80%82" target="_blank" rel="noopener">http://repo1.maven.org/maven2）它就是中央仓库，服务于整个互联网，由Maven团队自己搭建并维护，里面存储了非常全的jar包，它包含了世界上大部分流行的开源项目的jar包。</a></p>
<p>那么我们在使用Maven构建的Java项目，项目中所使用的jar包会来自哪里呢？例如，通过Maven先后构建项目A和项目B，在项目中都需要依赖第三方jar包：</p>
<ul>
<li><p>如果项目A中需要依赖第三方jar包，只需要在项目下的pom文件中引入jar包在<strong>本地仓库</strong>中的坐标即可使用。如果本地仓库没有所需要的jar包，则会连接私服（需要提前配置）下载所需jar包到本地仓库供项目使用。</p>
</li>
<li><p>如果私服上也没有所需的jar包，则会连接中央仓库下载所需要的jar包保存到私服，再将jar包从私服下载至本地仓库，供项目使用。</p>
</li>
<li><p>如果没有配置私服，则默认连接中央仓库下载所需要的jar包到本地仓库中供项目使用</p>
</li>
<li><p>当项目B也需要依赖第三方jar包时，先到本地仓库中查找所需jar包，如果有则直接引用而无需再次下载，如果仍有部分jar包本地仓库中没有，则同上，即连接私服下载所需jar包到本地仓库。若私服中也没有所需jar包，则连接中央仓库下载jar包到私服，再从私服下载jar包到本地仓库中，供项目使用。</p>
</li>
</ul>
<h3 id="添加依赖-方式一"><a href="#添加依赖-方式一" class="headerlink" title="添加依赖:方式一"></a>添加依赖:方式一</h3><p>使用maven插件的索引功能快速添加jar包</p>
<p>这种方式需要<strong>本地仓库中已经包含了该jar包，否则搜索不到</strong>!!!</p>
<p>1、如果本地仓库中有我们需要的jar包，可以在项目中的pom.xml文件中空白处右键–&gt; Maven –&gt; Add Dependency在弹出的窗口中添加所需要的依赖(jar包)，如图：</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/33fe1d9ff8f2d46631335a13ee2d6b51-06e1e53315ad40718fb65f172be6da36.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871021-399834f5117dd8989d17f0bb84cc5746.png" alt="33fe1d9ff8f2d46631335a13ee2d6b51"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/33fe1d9ff8f2d46631335a13ee2d6b51-06e1e53315ad40718fb65f172be6da36.png" target="_blank" rel="noopener">33fe1d9ff8f2d46631335a13ee2d6b51</a></p>
<p>**2、**添加依赖示例：添加spring的jar包的坐标到项目中</p>
<p>(1) 在项目中的pom.xml文件中右键 -&gt; Maven -&gt; Add Dependency，在弹出的窗口中输入<br>“spring”:</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/5b98e92822f738cda80091a2d4709bb8-49a2de110843419dac7636e8ae180c41.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871021-4a5fd58382b1b33dfd626c3315fb8459.png" alt="5b98e92822f738cda80091a2d4709bb8"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/5b98e92822f738cda80091a2d4709bb8-49a2de110843419dac7636e8ae180c41.png" target="_blank" rel="noopener">5b98e92822f738cda80091a2d4709bb8</a></p>
<p>选中要添加的jar包（坐标会自动填写），点击OK即可完成添加</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/172e2faf10ff88ed41dfd5fff6e05939-c091c38645514a42bdbf28fa55c5fc47.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871021-0c94ec2e15cd163da6bb7c24147cb831.png" alt="172e2faf10ff88ed41dfd5fff6e05939"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/172e2faf10ff88ed41dfd5fff6e05939-c091c38645514a42bdbf28fa55c5fc47.png" target="_blank" rel="noopener">172e2faf10ff88ed41dfd5fff6e05939</a></p>
<p>(2)如果搜索不到jar包（保证本地仓库中已经下载了该jar包），可以尝试重建索引。</p>
<p>在</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/facabede667d2edbead383cd5d725a75-e70efca1ec9c45e7be95fe9c34123029.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871021-35d02b7b691559ad0575d31615ee2f9c.png" alt="facabede667d2edbead383cd5d725a75"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/facabede667d2edbead383cd5d725a75-e70efca1ec9c45e7be95fe9c34123029.png" target="_blank" rel="noopener">facabede667d2edbead383cd5d725a75</a></p>
<p>“Maven Repositories” 视图窗口中可以看到如下内容：</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/fe8dfdbc79b3219c161e97c1f650b2a5-2bc24cf1ffc3403a9a1dd4cd383ec7fd.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871021-dd451daf923d5b15c7760668036e1d17.png" alt="fe8dfdbc79b3219c161e97c1f650b2a5"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/fe8dfdbc79b3219c161e97c1f650b2a5-2bc24cf1ffc3403a9a1dd4cd383ec7fd.png" target="_blank" rel="noopener">fe8dfdbc79b3219c161e97c1f650b2a5</a></p>
<p>在”Local Repositories”上右键选择 “Rebuild Index” 即可重建索引。</p>
<p>完成后，再尝试搜索jar包进行添加。</p>
<h3 id="添加依赖-方式二"><a href="#添加依赖-方式二" class="headerlink" title="添加依赖:方式二"></a>添加依赖:方式二</h3><p><strong>1、直接在pom.xml文件中的标签内部添加。例如：在pom.xml文件中添加如下配置，就可以将junit单元测试的jar包引入到项目中来了。</strong></p>
<p>添加依赖：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.9<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>2、手动添加依赖需要指定所依赖jar包的坐标，但是在大部分情况下，我们是不知道jar包的坐标的。可以通过访问如下网址，在互联网上搜索查询：</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;mvnrepository.com</span><br></pre></td></tr></table></figure>

<p>或者在公司镜像仓库中搜索查询:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;maven.tedu.cn&#x2F;nexus</span><br></pre></td></tr></table></figure>

<p><strong>3、示例：添加c3p0的jar包的坐标到项目中</strong></p>
<ul>
<li><p>访问上面其中的一个网址，在搜索框中搜索 “c3p0”</p>
</li>
<li><p>在搜索出来的内容中，选择所需要的版本并点击版本，查看该版本的c3p0<br>jar包所对应的坐标：</p>
</li>
<li><p>将坐标直接拷贝到项目的pom.xml文件中即可：</p>
</li>
</ul>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200225120117127-82a089391ab147d6a0a0c1079fad4c24.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871021-1ddc14cc52cec31eddfce81bc9f7c581.png" alt="image-20200225120117127"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200225120117127-82a089391ab147d6a0a0c1079fad4c24.png" target="_blank" rel="noopener">image-20200225120117127</a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200225120916520-0fd8cc2080004201ba0d1ea937acc867.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871021-a730f4e82aacafb3f163025e652add0f.png" alt="image-20200225120916520"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200225120916520-0fd8cc2080004201ba0d1ea937acc867.png" target="_blank" rel="noopener">image-20200225120916520</a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200225120728549-e8488c32aac84f708ee550434a58649f.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871021-e4129c17233fa823a8b01c8cf3b0087c.png" alt="image-20200225120728549"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200225120728549-e8488c32aac84f708ee550434a58649f.png" target="_blank" rel="noopener">image-20200225120728549</a></p>
<p><strong>4、将上图中右侧选中的坐标拷贝到pom.xml文件中:</strong></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200225121143892-e1d4a18c9853443692aa53627b9c883a.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871021-c73ec72e1e1178e5b6f096f143f515fd.png" alt="image-20200225121143892"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200225121143892-e1d4a18c9853443692aa53627b9c883a.png" target="_blank" rel="noopener">image-20200225121143892</a></p>
<h2 id="FAQ-Maven常见问题"><a href="#FAQ-Maven常见问题" class="headerlink" title="FAQ:Maven常见问题"></a>FAQ:Maven常见问题</h2><h3 id="常见Maven环境问题"><a href="#常见Maven环境问题" class="headerlink" title="常见Maven环境问题"></a>常见Maven环境问题</h3><p>问题描述：</p>
<ul>
<li>创建Maven项目时报如下错误：</li>
</ul>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200315204732042-f27f2e6669984cb6961d6c40732c2615.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871021-bbe506cd88e8f477a28043df9b8b066a.png" alt="image-20200315204732042"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200315204732042-f27f2e6669984cb6961d6c40732c2615.png" target="_blank" rel="noopener">image-20200315204732042</a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200315204802766-13a66721643246109f3a55bca0a42c97.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871021-1c24e7a838359721c3b1d105c6a529cf.png" alt="image-20200315204802766"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200315204802766-13a66721643246109f3a55bca0a42c97.png" target="_blank" rel="noopener">image-20200315204802766</a></p>
<ul>
<li>或者创建Maven项目目录结构不全（比如只有src目录），如下图：</li>
</ul>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200315205928911-80d640e31fd04a9cb837856f20d14543.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871021-572823ff54032df2252305a2cc0e9474.png" alt="image-20200315205928911"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200315205928911-80d640e31fd04a9cb837856f20d14543.png" target="_blank" rel="noopener">image-20200315205928911</a></p>
<ul>
<li>导入已有的Maven项目，项目运行不了（jar没有下载完全）</li>
</ul>
<p>此时是因为maven的环境被破坏了，导致Maven基础运行环境不全，无法创建Maven项目，或者无法下载所需要的jar包。解决方法：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">(1)在项目的pom文件中敲一个空白行,再保存文件，目的是让maven检测到pom文件发生变化，再根据pom文件中的配置到本地仓库中寻找对应的jar包，如果没有相应的jar包，maven会重新下载。</span><br><span class="line">(2)如果上面的方式不行,可以尝试在项目上,右键---&gt; Maven ---&gt; Update Project...,强制更新项目,此时maven也会检查pom文件，在本地仓库中有没有相应的jar包。</span><br><span class="line">(3)如果上面的方式仍然没有解决问题，检查当前网络环境是否能连接上所配置的镜像仓库。（比如在家里使用外网，无法连接达内的镜像仓库，或者使用手机热点网络无法连接阿里云的镜像仓库等）</span><br><span class="line">(4)如果网络能够连接上所配置的镜像仓库，到本地仓库的目录下，将本地仓库中所有的目录都删除，删除时，eclipse正在使用本地仓库中的资源文件，所以会阻止删除，此时将eclipse关闭，再将本地仓库中的所有目录删除，重启eclipse。</span><br><span class="line">(5)启动eclipse后,再将上面的第(1)步和第(2)步再做一遍!</span><br></pre></td></tr></table></figure>

<p>问题描述2：每天第一次打开Eclipse发现之前创建的Maven工程报错（比如项目上有叉号或者叹号，但项目之前是OK的），解决方法：在菜单栏中找到 Project —&gt; Clean….</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200315210421557-8cb7818efaf64e51a93f7d9ab4e8846b.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871021-a88082939839823990db90955d0030a5.png" alt="image-20200315210421557"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200315210421557-8cb7818efaf64e51a93f7d9ab4e8846b.png" target="_blank" rel="noopener">image-20200315210421557</a></p>
<h3 id="找不到jar包问题"><a href="#找不到jar包问题" class="headerlink" title="找不到jar包问题"></a>找不到jar包问题</h3><p>在项目中通过坐标引入了jar包（或者插件），并且本地仓库中也存在对应的jar包，但是项目还是报错，提示内容说找不到。</p>
<p>解决方法：如果引入的jar包，在本地仓库中存在，但是还是提示找不到，可以将本地仓库中jar包或插件的所在目录整个删除(如果删除时提示文件正在被占用，关闭eclipse再删除即可)，重新保存pom.xml文件，并更新工程，让maven再次下载上面的jar包即可！</p>
<p>未下载完全示例：<br><a href="https://www.zhangpeng.fun/upload/2020/06/71d763b5d1bea2be9037ab549f3a6033-0abd5b5b3aec4a48be8a02dd4bb0f98a.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871021-734b75dba49354a597fbc13d8b426524.png" alt="71d763b5d1bea2be9037ab549f3a6033"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/71d763b5d1bea2be9037ab549f3a6033-0abd5b5b3aec4a48be8a02dd4bb0f98a.png" target="_blank" rel="noopener">71d763b5d1bea2be9037ab549f3a6033</a></p>
<p>正常下载完全示例：</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/c4988ae458e47fe30d6fb6ab1ebf9522-56b625788c0c404f878018e198fe3db2.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871021-be594de07cdc45f22f49b6404f2a25b5.png" alt="c4988ae458e47fe30d6fb6ab1ebf9522"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/c4988ae458e47fe30d6fb6ab1ebf9522-56b625788c0c404f878018e198fe3db2.png" target="_blank" rel="noopener">c4988ae458e47fe30d6fb6ab1ebf9522</a></p>
<h3 id="拷贝Maven仓库"><a href="#拷贝Maven仓库" class="headerlink" title="拷贝Maven仓库"></a>拷贝Maven仓库</h3><p>如果因为网络环境的问题，导致jar包无法下载，也可以将别人下载好的（完整的）Maven的本地仓库拷贝过来，放在自己配置的本地仓库中。因为Maven可以支持拷贝别人的仓库。</p>
<h2 id="扩展-Maven项目结构"><a href="#扩展-Maven项目结构" class="headerlink" title="扩展:Maven项目结构"></a>扩展:Maven项目结构</h2><p>使用Maven创建的工程我们称它为Maven工程，Maven工程具有一定的目录规范，对目录结构有严格的要求，一个Maven工程要具有如下目录结构：</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/9de5e6454964c4be0b3284fd4845ce85-d3f1a419d10943858746ad32a8fc609f.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871021-5364571e1145dfa78b868b282c6f4350.png" alt="9de5e6454964c4be0b3284fd4845ce85"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/9de5e6454964c4be0b3284fd4845ce85-d3f1a419d10943858746ad32a8fc609f.png" target="_blank" rel="noopener">9de5e6454964c4be0b3284fd4845ce85</a></p>
<p>Maven项目目录介绍：</p>
<p>1）/src/main/java – 主目录下的Java目录，用于存放项目中的.java文件</p>
<p>2）/src/main/resources –- 主目下的资源目录，存放项目中的资源文件(如框架的配置文件)</p>
<p>3）/src/test/java – 测试目录下的Java目录，用于存放所有单元测试类的.java文件，如Junit测试类</p>
<p>4）/src/test/resources – 测试目录下的资源目录，用于存放测试类所需资源文件(如框架的配置文件)</p>
<p>5）/target – 项目输出目录，编译后的class文件、及项目打成的war包等会输出到此目录中</p>
<p>6）/pom.xml – maven项目的核心配置文件，文件中通过坐标来管理项目中的所有jar包和插件。</p>
<h1 id="maven-javaweb"><a href="#maven-javaweb" class="headerlink" title="maven   javaweb"></a><a href="https://www.zhangpeng.fun/tags/maven" target="_blank" rel="noopener">maven</a>   <a href="https://www.zhangpeng.fun/tags/javaweb" target="_blank" rel="noopener">javaweb</a></h1>]]></content>
      <categories>
        <category>JavaWeb</category>
      </categories>
      <tags>
        <tag>javaweb</tag>
        <tag>maven</tag>
      </tags>
  </entry>
  <entry>
    <title>11-MySQL数据库事务</title>
    <url>/2020/06/11/11-MySQL%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BA%8B%E5%8A%A1/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="11-MySQL数据库事务"><a href="#11-MySQL数据库事务" class="headerlink" title="11-MySQL数据库事务"></a>11-MySQL数据库事务</h1><h1 id="unit11-MySQL数据库事务"><a href="#unit11-MySQL数据库事务" class="headerlink" title="unit11-MySQL数据库事务"></a>unit11-MySQL数据库事务</h1><p><strong>今日目标:</strong></p>
<ul>
<li><p>了解事务的作用</p>
</li>
<li><p>掌握事务的四大特性(面试)</p>
</li>
<li><p>了解事务的三个并发读问题</p>
</li>
<li><p>掌握mysql开启和结束事务</p>
</li>
<li><p>了解事物的四个隔离级别</p>
</li>
</ul>
<h2 id="事务及四大特性"><a href="#事务及四大特性" class="headerlink" title="事务及四大特性"></a>事务及四大特性</h2><h3 id="什么是事务"><a href="#什么是事务" class="headerlink" title="什么是事务"></a>什么是事务</h3><p>数据库事务(Database Transaction)，是指作为单个逻辑工作单元执行的一系列操作，要么完全地执行，要么完全地不执行。</p>
<p>简单的说：事务就是将一堆的SQL语句(通常是增删改操作)绑定在一起执行，要么都执行成功，要么都执行失败，即都执行成功才算成功，否则就会恢复到这堆SQL执行之前的状态。</p>
<p>下面以银行转账为例，张三转100块到李四的账户，这至少需要两条SQL语句：</p>
<ul>
<li>给张三的账户减去100元；</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">update</span> 账户表 <span class="keyword">set</span> money=money<span class="number">-100</span> <span class="keyword">where</span> <span class="keyword">name</span>=<span class="string">'张三'</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>给李四的账户加上100元。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">update</span> 账户表 <span class="keyword">set</span> money=money+<span class="number">100</span> <span class="keyword">where</span> <span class="keyword">name</span>=<span class="string">'李四'</span>;</span><br></pre></td></tr></table></figure>

<p>如果在第一条SQL语句执行成功后，在执行第二条SQL语句之前，程序被中断了（可能是抛出了某个异常，也可能是其他什么原因），那么李四的账户没有加上100元，而张三却减去了100元，在现实生活中这肯定是不允许的。</p>
<p>如果在转账过程中加入事务，则整个转账过程中执行的所有SQL语句会在一个事务中，而事务中的所有操作，要么全都成功，要么全都失败，不可能存在成功一半的情况。</p>
<p>也就是说给张三的账户减去100元如果成功了，那么给李四的账户加上100元的操作也必须是成功的；否则，给张三减去100元以及给李四加上100元都是失败的。</p>
<h3 id="事务的四大特性"><a href="#事务的四大特性" class="headerlink" title="事务的四大特性"></a>事务的四大特性</h3><p>事务的四大特性(ACID)是：</p>
<p>(1)<strong>原子性</strong>（Atomicity）：事务中所有操作是不可再分割的原子单位。事务中所有操作要么全部执行成功，要么全部执行失败。</p>
<p>(2)<strong>一致性</strong>（Consistency）：事务执行后，数据库状态与其它业务规则保持一致。如转账业务，无论事务执行成功与否，参与转账的两个账户金额之和在事务前后应该是保持不变的。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">张三：1000	1000-500&#x3D;500		1000</span><br><span class="line">李四：1000	1000+500&#x3D;1500 		1000</span><br></pre></td></tr></table></figure>

<p>(3)<strong>隔离性</strong>（Isolation）：隔离性是指在并发操作中，不同事务之间应该隔离开来，使每个并发中的事务不会相互干扰。也就是说，在事中务查看数据更新时，数据所处的状态要么是另一事务修改它之前的状态，要么是另一事务修改它之后的状态，事务不会查看到中间状态的数据。例如：在A事务中，查看另一B事务(正在修改张三的账户金额)中张三的账户金额，要查看到B事务之前的张三的账户金额，要么查看到B事务之后张三的账户金额。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">事务1: 查询A、B账户金额之和（1000+1000）</span><br><span class="line">事务2: A转账给B 500元</span><br><span class="line">		A - 500 &#x3D; 500</span><br><span class="line">		B + 500 &#x3D; 1500</span><br></pre></td></tr></table></figure>

<p>(4)<strong>持久性</strong>（Durability）：一旦事务提交成功，事务中所有的数据操作都必须被持久化到数据库中，即使提交事务后，数据库马上崩溃，在数据库重启时，也必须能保证通过某种机制恢复数据。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">开启事务---A给B转账500元</span><br><span class="line">A: 1000 - 500 &#x3D; 500	(成功了)	在日志中记录,事务成功,A账户金额更新为500</span><br><span class="line">B: 1000 + 500 &#x3D; 1500 (成功了)	在日志中记录,事务成功,B账户金额更新为1500</span><br><span class="line">结束事务---回滚&#x2F;提交</span><br></pre></td></tr></table></figure>

<h2 id="MySQL中的事务"><a href="#MySQL中的事务" class="headerlink" title="MySQL中的事务"></a>MySQL中的事务</h2><p>在默认情况下，MySQL每执行一条SQL语句，都是一个单独的事务。因为底层在执行SQL语句之前会自动开启事务，在SQL语句执行完后，会立即结束事务！</p>
<p>如果需要在一个事务中包含多条SQL语句，那么需要手动开启事务和结束事务。</p>
<ul>
<li><p>开启事务：start transaction；</p>
</li>
<li><p>结束事务：commit（提交事务）或 rollback（回滚事务）。</p>
</li>
</ul>
<p>在执行SQL语句之前，先执行 strat transaction，这就开启了一个事务（事务的起点），然后可以去执行多条SQL语句，最后要结束事务，<strong>commit</strong>表示提交，即事务中的多条SQL语句所做出的影响会持久化到数据库中。或者<strong>rollback</strong>，表示回滚，即回滚到事务的起点，之前做的所有操作都被撤消了！</p>
<p>下面演示A账户给B账户转账的例子：</p>
<p><strong>准备数据：</strong></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 1、创建数据库jt_db数据库(如果不存在才创建)</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">database</span> <span class="keyword">if</span> <span class="keyword">not</span> <span class="keyword">exists</span> jt_db <span class="keyword">charset</span> utf8;</span><br><span class="line"><span class="keyword">use</span> jt_db; <span class="comment">-- 选择jt_db数据库</span></span><br><span class="line"><span class="comment">-- 2、在 jt_db 库中创建 acc 表(银行账户表),要求有id(主键),name(姓名),money(账户金额)</span></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> <span class="keyword">if</span> <span class="keyword">exists</span> <span class="keyword">acc</span>;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> <span class="keyword">acc</span>(</span><br><span class="line">    <span class="keyword">id</span> <span class="built_in">int</span> primary <span class="keyword">key</span> auto_increment,</span><br><span class="line">    <span class="keyword">name</span> <span class="built_in">varchar</span>(<span class="number">50</span>),</span><br><span class="line">    money <span class="keyword">double</span></span><br><span class="line">);</span><br><span class="line"><span class="comment">-- 3、往 acc 表中, 插入2条记录</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">acc</span> <span class="keyword">values</span>(<span class="literal">null</span>,<span class="string">'A'</span>,<span class="number">1000</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">acc</span> <span class="keyword">values</span>(<span class="literal">null</span>,<span class="string">'B'</span>,<span class="number">1000</span>);</span><br><span class="line"><span class="comment">-- 查询acc表中的所有记录</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">acc</span>;</span><br></pre></td></tr></table></figure>

<p>下面分别演示事务开启及执行一系列SQL之后，回滚事务、提交事务及中断操作的效果。</p>
<p>-- <strong>rollback（回滚事务）</strong>：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">-- 查询acc账户表中A和B的金额</span><br><span class="line">select * from acc;</span><br><span class="line">-- 开启事务</span><br><span class="line">start transaction;</span><br><span class="line">-- 开始转账，A账户减去100元</span><br><span class="line">update acc set money&#x3D;money-100 where name&#x3D;&#39;A&#39;;</span><br><span class="line">-- 查询acc账户表中A和B的金额</span><br><span class="line">select * from acc;</span><br><span class="line">-- B账户增加100元</span><br><span class="line">update acc set money&#x3D;money+100 where name&#x3D;&#39;B&#39;;</span><br><span class="line">-- 查询acc账户表中A和B的金额</span><br><span class="line">select * from acc;</span><br><span class="line">-- 回滚事务</span><br><span class="line">rollback;</span><br><span class="line">-- 再次查询acc账户表中A和B的金额</span><br><span class="line">select * from acc;</span><br></pre></td></tr></table></figure>

<p>-- <strong>commit（提交事务）</strong>：将上面的操作再做一次，最后将rollback替换为commit，即提交事务</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">commit;</span><br></pre></td></tr></table></figure>

<p>-- <strong>中断操作</strong>：将上面的操作再做一次，最后将rollback替换为quit，即中断操作</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">quit;</span><br></pre></td></tr></table></figure>

<h2 id="事务并发读问题"><a href="#事务并发读问题" class="headerlink" title="事务并发读问题"></a>事务并发读问题</h2><h3 id="事务并发读问题-1"><a href="#事务并发读问题-1" class="headerlink" title="事务并发读问题"></a>事务并发读问题</h3><p>多个事务对相同的数据同时进行操作，这叫做事务并发。</p>
<p>在事务并发时，如果没有采取必要的隔离措施，可能会导致各种并发问题，破坏数据的完整性等。这些问题中，其中有三类是读问题，分别是：脏读、不可重复读、幻读。</p>
<p>(1)<strong>脏读</strong>（dirty read）：在一个事务中，读取到另一个事务未提交更新的数据，即读取到了脏数据；</p>
<p>例如：A给B转账100元但未提交事务，在B查询后，A做了回滚操作，那么B查询到了A未提交的数据，就称之为脏读。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">提示：需要将数据库的事务隔离级别设置为最低，才能够看到脏读现象</span><br><span class="line">事务1：开启事务; A - 100 &#x3D; 900; B + 100 &#x3D; 1100; (没有提交事务)</span><br><span class="line">事务2：开启事务; 查询B账户的金额 1100, 这个过程叫做脏读, 1100就是一个脏数据</span><br></pre></td></tr></table></figure>

<p>(2)<strong>不可重复读</strong>（unrepeatable read）：对同一记录的两次读取结果不一致，因为在两次查询期间，有另一事务对该记录做了修改（是针对修改操作）</p>
<p>例如：在事务1中，前后两次查询A账户的金额，在两次查询之间，另一事物2对A账户的金额做了修改（并且也提交了事务），此种情况可能会导致事务1中，前后两次查询的结果不一致。这就是不可重复读。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">事务1：开启事务---</span><br><span class="line">	第一次读取A账户的金额：1000</span><br><span class="line">	第二次读取A账户的金额：900</span><br><span class="line">事务2：开启事务---</span><br><span class="line">	A账户 - 100 &#x3D; 900;</span><br><span class="line">	提交事务---</span><br></pre></td></tr></table></figure>

<p>(3)<strong>幻读（虚读）</strong>（phantom read）：对同一张表的两次查询结果不一致，因为在两次查询期间，有另一事务进行了插入或者是删除操作(是针对插入或删除操作)；</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">事务1：开启事务<span class="comment">---</span></span><br><span class="line">	<span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">acc</span> <span class="keyword">where</span> <span class="keyword">id</span>=<span class="number">3</span>;//不存在id为3的记录</span><br><span class="line">	<span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">acc</span> <span class="keyword">value</span>(<span class="number">3</span>,<span class="string">'C'</span>,<span class="number">2000</span>);</span><br><span class="line">	<span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">acc</span> <span class="keyword">where</span> <span class="keyword">id</span>=<span class="number">3</span>;//存在id为3的记录</span><br><span class="line">事务2：开启事务<span class="comment">---</span></span><br><span class="line">	<span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">acc</span> <span class="keyword">value</span>(<span class="number">3</span>,<span class="string">'C'</span>,<span class="number">2000</span>);</span><br><span class="line">	提交事务<span class="comment">---</span></span><br></pre></td></tr></table></figure>

<p>注意:mysql默认的是不允许出现脏读和不可重复读，所以在下面演示之前需要设置mysql允许出现脏读、不可重复读等。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">set tx_isolation&#x3D;&#39;read-uncommitted&#39;; -- 设置mysql的事务隔离级别</span><br></pre></td></tr></table></figure>

<p><strong>1、脏读示例：</strong></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 在窗口1中，开启事务，执行A给B转账100元</span></span><br><span class="line"><span class="keyword">set</span> tx_isolation=<span class="string">'read-uncommitted'</span>; <span class="comment">-- 允许脏读、不可重复读、幻读</span></span><br><span class="line"><span class="keyword">use</span> jt_db; <span class="comment">-- 选择jt_db库</span></span><br><span class="line"><span class="keyword">start</span> <span class="keyword">transaction</span>; <span class="comment">-- 开启事务</span></span><br><span class="line"><span class="keyword">update</span> <span class="keyword">acc</span> <span class="keyword">set</span> money=money<span class="number">-100</span> <span class="keyword">where</span> <span class="keyword">name</span>=<span class="string">'A'</span>;</span><br><span class="line"><span class="keyword">update</span> <span class="keyword">acc</span> <span class="keyword">set</span> money=money+<span class="number">100</span> <span class="keyword">where</span> <span class="keyword">name</span>=<span class="string">'B'</span>;</span><br><span class="line"><span class="comment">-- 在窗口2中，开启事务，查询B的账户金额</span></span><br><span class="line"><span class="keyword">set</span> tx_isolation=<span class="string">'read-uncommitted'</span>; <span class="comment">-- 允许脏读、不可重复读、幻读</span></span><br><span class="line"><span class="keyword">use</span> jt_db; <span class="comment">-- 选择jt_db库</span></span><br><span class="line"><span class="keyword">start</span> <span class="keyword">transaction</span>; <span class="comment">-- 开启事务</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">acc</span> <span class="keyword">where</span> <span class="keyword">name</span>=<span class="string">'B'</span>; <span class="comment">-- 出现脏数据</span></span><br><span class="line"><span class="comment">-- 切换到窗口1，回滚事务，撤销转账操作。</span></span><br><span class="line"><span class="keyword">rollback</span>; <span class="comment">-- 回滚事务</span></span><br><span class="line"><span class="comment">-- 切换到窗口2，查询B的账户金额</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">acc</span> <span class="keyword">where</span> <span class="keyword">name</span>=<span class="string">'B'</span>;</span><br></pre></td></tr></table></figure>

<p>在窗口2中，B看到自己的账户增加了100元（此时的数据A操作事务并未提交），此种情况称之为”脏读”。</p>
<p><strong>2、不可重复读示例：</strong></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 在窗口1中，开启事务，查询A账户的金额</span></span><br><span class="line"><span class="keyword">set</span> tx_isolation=<span class="string">'read-uncommitted'</span>; <span class="comment">-- 允许脏读、不可重复读、幻读</span></span><br><span class="line"><span class="keyword">use</span> jt_db; <span class="comment">-- 选择jt_db库</span></span><br><span class="line"><span class="keyword">start</span> <span class="keyword">transaction</span>; <span class="comment">-- 开启事务</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">acc</span> <span class="keyword">where</span> <span class="keyword">name</span>=<span class="string">'A'</span>;</span><br><span class="line"><span class="comment">-- 在窗口2中，开启事务，查询A的账户金额减100</span></span><br><span class="line"><span class="keyword">set</span> tx_isolation=<span class="string">'read-uncommitted'</span>; <span class="comment">-- 允许脏读、不可重复读、幻读</span></span><br><span class="line"><span class="keyword">use</span> jt_db; <span class="comment">-- 选择jt_db库</span></span><br><span class="line"><span class="keyword">start</span> <span class="keyword">transaction</span>; <span class="comment">-- 开启事务</span></span><br><span class="line"><span class="keyword">update</span> <span class="keyword">acc</span> <span class="keyword">set</span> money=money<span class="number">-100</span> <span class="keyword">where</span> <span class="keyword">name</span>=<span class="string">'A'</span>; <span class="comment">-- A账户减去100</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">acc</span> <span class="keyword">where</span> <span class="keyword">name</span>=<span class="string">'A'</span>;</span><br><span class="line"><span class="keyword">commit</span>; <span class="comment">-- 提交事务</span></span><br><span class="line"><span class="comment">-- 切换到窗口1，再次查询A账户的金额。</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">acc</span> <span class="keyword">where</span> <span class="keyword">name</span>=<span class="string">'A'</span>; <span class="comment">-- 前后查询结果不一致</span></span><br></pre></td></tr></table></figure>

<p>在窗口1中，前后两次对同一数据(账户A的金额)查询结果不一致，是因为在两次查询之间，另一事务对A账户的金额做了修改。此种情况就是”不可以重复读”</p>
<p><strong>3、幻读示例：</strong></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 在窗口1中，开启事务，查询账户表中是否存在id=3的账户</span></span><br><span class="line"><span class="keyword">set</span> tx_isolation=<span class="string">'read-uncommitted'</span>; <span class="comment">-- 允许脏读、不可重复读、幻读</span></span><br><span class="line"><span class="keyword">use</span> jt_db; <span class="comment">-- 选择jt_db库</span></span><br><span class="line"><span class="keyword">start</span> <span class="keyword">transaction</span>; <span class="comment">-- 开启事务</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">acc</span> <span class="keyword">where</span> <span class="keyword">id</span>=<span class="number">3</span>;</span><br><span class="line"><span class="comment">-- 在窗口2中，开启事务，往账户表中插入了一条id为3记录，并提交事务。</span></span><br><span class="line"><span class="comment">-- 设置mysql允许出现脏读、不可重复度、幻读</span></span><br><span class="line"><span class="keyword">set</span> tx_isolation=<span class="string">'read-uncommitted'</span>;</span><br><span class="line"><span class="keyword">use</span> jt_db; <span class="comment">-- 选择jt_db库</span></span><br><span class="line"><span class="keyword">start</span> <span class="keyword">transaction</span>; <span class="comment">-- 开启事务</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">acc</span> <span class="keyword">values</span>(<span class="number">3</span>, <span class="string">'C'</span>, <span class="number">1000</span>);</span><br><span class="line"><span class="keyword">commit</span>; <span class="comment">-- 提交事务</span></span><br><span class="line"><span class="comment">-- 切换到窗口1，由于上面窗口1中查询到没有id为3的记录，所以可以插入id为3的记录。</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">acc</span> <span class="keyword">values</span>(<span class="number">3</span>, <span class="string">'C'</span>, <span class="number">1000</span>); <span class="comment">-- 插入会失败!</span></span><br></pre></td></tr></table></figure>

<p>在窗口1中，查询了不存在id为3的记录，所以接下来要执行插入id为3的记录，但是还未执行插入时，另一事务中插入了id为3的记录并提交了事务，所以接下来窗口1中执行插入操作会失败。</p>
<p>探究原因，发现账户表中又有了id为3的记录（感觉像是出现了幻觉）。这种情况称之为”幻读”</p>
<p>以上就是在事务并发时常见的三种并发读问题，那么如何防止这些问题的产生？</p>
<p>可以通过设置事务隔离级别进行预防。</p>
<h3 id="事务隔离级别"><a href="#事务隔离级别" class="headerlink" title="事务隔离级别"></a>事务隔离级别</h3><p>事务隔离级别分四个等级，在相同数据环境下，对数据执行相同的操作，设置不同的隔离级别，可能导致不同的结果。不同事务隔离级别能够解决的数据并发问题的能力也是不同的。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">set</span> tx_isolation=<span class="string">'read-uncommitted'</span>;</span><br></pre></td></tr></table></figure>

<p><strong>1、READ UNCOMMITTED（读未提交数据）</strong></p>
<p>安全性最差，可能出现任何事务并发问题(比如脏读、不可以重复读、幻读等)</p>
<p>但性能最好（不使用!!）</p>
<p><strong>2、READ COMMITTED（读已提交数据）</strong>（Oracle默认）</p>
<p>安全性较差</p>
<p>性能较好</p>
<p>可以防止<strong>脏读</strong>，但不能防止不可重复读，也不能防止幻读；</p>
<p><strong>3、REPEATABLE READ（可重复读）</strong>（MySQL默认）</p>
<p>安全性较高</p>
<p>性能较差</p>
<p>可以防止<strong>脏读</strong>和<strong>不可重复读</strong>，但不能防止幻读问题；</p>
<p><strong>4、SERIALIZABLE（串行化）</strong></p>
<p>安全性最高，不会出现任何并发问题，因为它对同一数据的访问是串行的，非并发访问；</p>
<p>性能最差；(不使用!!)</p>
<p>MySQL的默认隔离级别为REPEATABLE READ，即可以防止脏读和不可重复读</p>
<h3 id="设置隔离级别-了解"><a href="#设置隔离级别-了解" class="headerlink" title="设置隔离级别(了解)"></a>设置隔离级别(了解)</h3><p>0、MySQL查询当前的事务隔离级别</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> @@tx_isolation;</span><br></pre></td></tr></table></figure>

<p><strong>1、MySQL设置事务隔离级别（了解）</strong></p>
<p>(1) set tx_isolation=’read-uncommitted’;　</p>
<p>安全性最差，容易出现<strong>脏读</strong>、<strong>不可重复读</strong>、<strong>幻读</strong>，但性能最高</p>
<p>(2) set tx_isolation=’read-committed’;</p>
<p>安全性一般，可防止<strong>脏读</strong>，不能防止<strong>不可重复读</strong>、<strong>幻读</strong></p>
<p>(3) set tx_isolation=’repeatable-read’;</p>
<p>安全性较好，可防止<strong>脏读</strong>、<strong>不可重复读</strong>，但不能防止<strong>幻读</strong></p>
<p>(4) set tx_isolation=’serialiable’;</p>
<p>安全性最好，可以防止一切事务并发问题，但是性能最差。</p>
<p><strong>2、JDBC设置事务隔离界别</strong></p>
<p>JDBC中通过Connection提供的方法设置事务隔离级别：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">Connection.setTransactionIsolation(int level)</span><br></pre></td></tr></table></figure>

<p>参数可选值如下：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">Connection.TRANSACTION_READ_UNCOMMITTED 1（读未提交数据）</span><br><span class="line">Connection.TRANSACTION_READ_COMMITTED 2（读已提交数据）</span><br><span class="line">Connection.TRANSACTION_REPEATABLE_READ 4（可重复读）</span><br><span class="line">Connection.TRANSACTION_SERIALIZABLE 8（串行化）</span><br><span class="line">Connection.TRANSACTION_NONE 0（不使用事务）</span><br></pre></td></tr></table></figure>

<p>提示：在开发中，一般情况下不需要修改事务隔离级别</p>
<p><strong>3、JDBC中实现转账例子</strong></p>
<p>提示：JDBC中默认是自动提交事务，所以需要关闭自动提交，改为手动提交事务</p>
<p>也就是说, 关闭了自动提交后, 事务就自动开启, 但是执行完后需要手动提交或者回滚!!</p>
<p>(1)执行下面的程序，程序执行没有异常，转账成功！A账户减去100元，B账户增加100元。</p>
<p>(2)将第4步、5步中间的代码放开，再次执行程序，在转账过程中抛异常，转账失败！由于事务回滚，所以A和B账户金额不变。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">public static void main(String[] args) throws SQLException &#123;</span><br><span class="line">    Connection conn = null;</span><br><span class="line">    Statement stat = null;</span><br><span class="line">    ResultSet rs = null;</span><br><span class="line">    try &#123;</span><br><span class="line">        //1.获取连接</span><br><span class="line">        conn = JdbcUtil.getConn();</span><br><span class="line">        //2.关闭JDBC自动提交事务（默认开启事务）</span><br><span class="line">        conn.setAutoCommit(false);</span><br><span class="line">        //3.获取传输器</span><br><span class="line">        stat = conn.createStatement();</span><br><span class="line">        <span class="comment">/* ***** A给B转账100元 ***** */</span></span><br><span class="line">        //4.A账户减去100元</span><br><span class="line">        String sql = "<span class="keyword">update</span> <span class="keyword">acc</span> <span class="keyword">set</span> money=money<span class="number">-100</span> <span class="keyword">where</span> <span class="keyword">name</span>=<span class="string">'A'</span><span class="string">";</span></span><br><span class="line"><span class="string">        stat.executeUpdate(sql);</span></span><br><span class="line"><span class="string">        //int i = 1/0; // 让程序抛出异常，中断转账操作</span></span><br><span class="line"><span class="string">        //5.B账户加上100元</span></span><br><span class="line"><span class="string">        sql = "</span><span class="keyword">update</span> <span class="keyword">acc</span> <span class="keyword">set</span> money=money+<span class="number">100</span> <span class="keyword">where</span> <span class="keyword">name</span>=<span class="string">'B'</span><span class="string">";</span></span><br><span class="line"><span class="string">        stat.executeUpdate(sql);</span></span><br><span class="line"><span class="string">        //6.手动提交事务</span></span><br><span class="line"><span class="string">        conn.commit();</span></span><br><span class="line"><span class="string">        System.out.println("</span>转账成功！提交事务...<span class="string">");</span></span><br><span class="line"><span class="string">    &#125; catch (Exception e) &#123;</span></span><br><span class="line"><span class="string">    	e.printStackTrace();</span></span><br><span class="line"><span class="string">    	//一旦其中一个操作出错都将回滚，使两个操作都不成功</span></span><br><span class="line"><span class="string">    	conn.rollback();</span></span><br><span class="line"><span class="string">   		System.out.println("</span>执行失败！回滚事务...<span class="string">");</span></span><br><span class="line"><span class="string">    &#125; finally&#123;</span></span><br><span class="line"><span class="string">    	JdbcUtil.close(conn, stat, rs);</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>

<h1 id="mysql-javaweb"><a href="#mysql-javaweb" class="headerlink" title="mysql   javaweb"></a><a href="https://www.zhangpeng.fun/tags/mysql" target="_blank" rel="noopener">mysql</a>   <a href="https://www.zhangpeng.fun/tags/javaweb" target="_blank" rel="noopener">javaweb</a></h1>]]></content>
      <categories>
        <category>JavaWeb</category>
      </categories>
      <tags>
        <tag>javaweb</tag>
        <tag>mysql</tag>
      </tags>
  </entry>
  <entry>
    <title>12-mybatis框架</title>
    <url>/2020/06/11/12-mybatis%E6%A1%86%E6%9E%B6/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="12-mybatis框架"><a href="#12-mybatis框架" class="headerlink" title="12-mybatis框架"></a>12-mybatis框架</h1><h1 id="unit12-mybatis框架"><a href="#unit12-mybatis框架" class="headerlink" title="unit12-mybatis框架"></a>unit12-mybatis框架</h1><p><a href="https://www.zhangpeng.fun/upload/2020/06/a0a2eb9fa872009998f7cd818925095d-6b1b0b9006c9415f9b5cd8eb016ad6fe.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871178-75c77a26cbf5168d293d6a589e465b33.png" alt="a0a2eb9fa872009998f7cd818925095d"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/a0a2eb9fa872009998f7cd818925095d-6b1b0b9006c9415f9b5cd8eb016ad6fe.png" target="_blank" rel="noopener">a0a2eb9fa872009998f7cd818925095d</a></p>
<p><strong>课程计划：</strong></p>
<p>1、MyBatis快速入门</p>
<p>2、MyBatis对数据库中数据的增删改查操作</p>
<p>3、#{}占位符的应用</p>
<p>4、动态SQL的应用</p>
<p>5、MyBatis的Mapper接口开发</p>
<h2 id="MyBatis简介-了解"><a href="#MyBatis简介-了解" class="headerlink" title="MyBatis简介(了解)"></a>MyBatis简介(了解)</h2><h3 id="什么是MyBatis"><a href="#什么是MyBatis" class="headerlink" title="什么是MyBatis"></a>什么是MyBatis</h3><p>MyBatis 本是apache的一个开源项目iBatis, 2010年这个项目由apache software foundation 迁移到了google code，并且改名为MyBatis 。2013年11月迁移到Github。</p>
<p>MyBatis是一个优秀的持久层框架，它对jdbc的操作数据库的过程进行封装，使开发者只需要关注SQL本身，而不需要花费精力去处理例如注册驱动、创建connection、创建statement、手动设置参数、结果集检索等jdbc繁杂的过程代码。</p>
<p>Mybatis通过xml或注解的方式将要执行的各种statement（statement、preparedStatemnt）配置起来，并通过java对象和statement中的sql进行映射生成最终执行的sql语句，最后由mybatis框架执行sql并将结果映射成java对象并返回。</p>
<p>总之，Mybatis对JDBC访问数据库的过程进行了封装，简化了JDBC代码，解决JDBC将结果集封装为Java对象的麻烦。</p>
<p>下图是MyBatis架构图：</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/f6d67734982f864da415a2a9cc4908a5-6f8d6ddd9a1a443493e920402464c88a.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871178-b4e28a478a564166a0712d2a2f55a35a.png" alt="f6d67734982f864da415a2a9cc4908a5"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/f6d67734982f864da415a2a9cc4908a5-6f8d6ddd9a1a443493e920402464c88a.png" target="_blank" rel="noopener">f6d67734982f864da415a2a9cc4908a5</a></p>
<p>(1)mybatis-config.xml是Mybatis的核心配置文件，通过其中的配置可以生成SqlSessionFactory,也就是SqlSession工厂</p>
<p>(2)基于SqlSessionFactory可以生成SqlSession对象</p>
<p>(3)SqlSession是一个既可以发送SQL去执行，并返回结果，类似于JDBC中的Connection对象，也是Mybatis中至关重要的一个对象。</p>
<p>(4)Executor是SqlSession底层的对象，用于执行SQL语句</p>
<p>(5)MapperStatement对象也是SqlSession底层的对象，用于接收输入映射（SQL语句中的参数），以及做输出映射（即将SQL查询的结果映射成相应的结果）</p>
<h3 id="为什么要使用MyBatis"><a href="#为什么要使用MyBatis" class="headerlink" title="为什么要使用MyBatis"></a>为什么要使用MyBatis</h3><p><em>思考：在开始之前，思考下如何通过JDBC查询Emp表中的所有记录，并封装到一个List集合中返回。（演示：准备数据、导包、导入JDBC程序）</em></p>
<p><code>1、使用传统方式JDBC访问数据库：</code></p>
<p>(1)使用JDBC访问数据库有大量重复代码（比如注册驱动、获取连接、获取传输器、释放资源等）；</p>
<p>(2)JDBC自身没有连接池，会频繁的创建连接和关闭连接，效率低；</p>
<p>(3)SQL是写死在程序中，一旦修改SQL，需要对类重新编译；</p>
<p>(4)对查询SQL执行后返回的ResultSet对象，需要手动处理，有时会特别麻烦；</p>
<p>…</p>
<p><code>2、使用mybatis框架访问数据库：</code></p>
<p>(1)Mybatis对JDBC对了封装，可以简化JDBC代码；</p>
<p>(2)Mybatis自身支持连接池（也可以配置其他的连接池），因此可以提高程序的效率；</p>
<p>(3)Mybatis是将SQL配置在mapper文件中，修改SQL只是修改配置文件，类不需要重新编译。</p>
<p>(4)对查询SQL执行后返回的ResultSet对象，Mybatis会帮我们处理，转换成Java对象。</p>
<p>…</p>
<p>总之，JDBC中所有的问题（代码繁琐、有太多重复代码、需要操作太多对象、释放资源、对结果的处理太麻烦等），在Mybatis框架中几乎都得到了解决！！</p>
<h2 id="MyBatis快速入门"><a href="#MyBatis快速入门" class="headerlink" title="MyBatis快速入门"></a>MyBatis快速入门</h2><h3 id="准备数据，创建库和表"><a href="#准备数据，创建库和表" class="headerlink" title="准备数据，创建库和表"></a>准备数据，创建库和表</h3><p>创建yonghedb库、emp表，并插入若干条记录</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 1、创建数据库 yonghedb 数据库</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">database</span> <span class="keyword">if</span> <span class="keyword">not</span> <span class="keyword">exists</span> yonghedb <span class="keyword">charset</span> utf8;</span><br><span class="line"><span class="keyword">use</span> yonghedb; <span class="comment">-- 选择yonghedb数据库</span></span><br><span class="line"><span class="comment">-- 2、删除emp表（如果存在）</span></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> <span class="keyword">if</span> <span class="keyword">exists</span> emp;</span><br><span class="line"><span class="comment">-- 3、在 yonghedb 库中创建 emp 表</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> emp(</span><br><span class="line">    <span class="keyword">id</span> <span class="built_in">int</span> primary <span class="keyword">key</span> auto_increment,</span><br><span class="line">    <span class="keyword">name</span> <span class="built_in">varchar</span>(<span class="number">50</span>),</span><br><span class="line">    job <span class="built_in">varchar</span>(<span class="number">50</span>),</span><br><span class="line">    salary <span class="keyword">double</span></span><br><span class="line">);</span><br><span class="line"><span class="comment">-- 4、往 emp 表中, 插入若干条记录</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> emp <span class="keyword">values</span>(<span class="literal">null</span>, <span class="string">'王海涛'</span>, <span class="string">'程序员'</span>, <span class="number">3300</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> emp <span class="keyword">values</span>(<span class="literal">null</span>, <span class="string">'齐雷'</span>, <span class="string">'程序员'</span>, <span class="number">2800</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> emp <span class="keyword">values</span>(<span class="literal">null</span>, <span class="string">'刘沛霞'</span>, <span class="string">'程序员鼓励师'</span>, <span class="number">2700</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> emp <span class="keyword">values</span>(<span class="literal">null</span>, <span class="string">'陈子枢'</span>, <span class="string">'部门总监'</span>, <span class="number">4200</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> emp <span class="keyword">values</span>(<span class="literal">null</span>, <span class="string">'刘昱江'</span>, <span class="string">'程序员'</span>, <span class="number">3000</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> emp <span class="keyword">values</span>(<span class="literal">null</span>, <span class="string">'董长春'</span>, <span class="string">'程序员'</span>, <span class="number">3500</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> emp <span class="keyword">values</span>(<span class="literal">null</span>, <span class="string">'苍老师'</span>, <span class="string">'程序员'</span>, <span class="number">3700</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> emp <span class="keyword">values</span>(<span class="literal">null</span>, <span class="string">'韩少云'</span>, <span class="string">'CEO'</span>, <span class="number">5000</span>);</span><br></pre></td></tr></table></figure>

<h3 id="创建工程，导入所需jar包、创建测试类"><a href="#创建工程，导入所需jar包、创建测试类" class="headerlink" title="创建工程，导入所需jar包、创建测试类"></a>创建工程，导入所需jar包、创建测试类</h3><p><code>1、创建Maven的java工程</code></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/313e2677abaf6d235c0f8603165739fc-a2a4dd4714274759bd587c4caf933829.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871178-e021e5968a64ee913dc37f498e677b68.png" alt="313e2677abaf6d235c0f8603165739fc"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/313e2677abaf6d235c0f8603165739fc-a2a4dd4714274759bd587c4caf933829.png" target="_blank" rel="noopener">313e2677abaf6d235c0f8603165739fc</a></p>
<p><code>2、导入junit、mysql、mybaits等开发包</code></p>
<p>在pom.xml文件中引入相关依赖包即可</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- junit单元测试 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.9<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- mysql驱动 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.32<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- mybatis --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.2.8<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 整合log4j --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-log4j12<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.6.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>3、创建com.tedu.mybatis.TestMybatis01测试类，并提供findAll方法（查询emp表中所有的员工信息），开发步骤如下：</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200403151610907-29d0f7809cae4a2cb753c6fdc3098603.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871178-c898767a508896489fed9f66ee8660f9.png" alt="image-20200403151610907"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200403151610907-29d0f7809cae4a2cb753c6fdc3098603.png" target="_blank" rel="noopener">image-20200403151610907</a></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/** 练习1(快速入门): 查询emp表中的所有员工, 返回一个List&lt;Emp&gt;集合</span></span><br><span class="line"><span class="comment">* <span class="doctag">@throws</span> IOException */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">findAll</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    <span class="comment">//1.读取mybatis的核心配置文件(mybatis-config.xml)</span></span><br><span class="line">    <span class="comment">//2.通过配置信息获取一个SqlSessionFactory工厂对象</span></span><br><span class="line">    <span class="comment">//3.通过工厂获取一个SqlSession对象</span></span><br><span class="line">    <span class="comment">//4.通过namespace+id找到要执行的sql语句并执行sql语句</span></span><br><span class="line">    <span class="comment">//5.输出结果</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="添加mybatis-config-xml文件"><a href="#添加mybatis-config-xml文件" class="headerlink" title="添加mybatis-config.xml文件"></a>添加mybatis-config.xml文件</h3><p><strong>1、在src/main/resources目录下，创建mybatis-config.xml文件</strong>（MyBatis的核心配置文件）</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/3e84b2af713f0ddea7c6164f57806c60-e2b8ff1d02174e1b9b583fd0ea9d172a.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871178-5f0b41001e860e228cf9ebfa17227a38.png" alt="3e84b2af713f0ddea7c6164f57806c60"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/3e84b2af713f0ddea7c6164f57806c60-e2b8ff1d02174e1b9b583fd0ea9d172a.png" target="_blank" rel="noopener">3e84b2af713f0ddea7c6164f57806c60</a></p>
<p><strong>2、mybatis-config.xml文件配置如下:</strong></p>
<p><code>mybatis-config文件头信息如下：</code></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">configuration</span></span></span><br><span class="line"><span class="meta">    <span class="meta-keyword">PUBLIC</span> <span class="meta-string">"-//mybatis.org//DTD Config 3.0//EN"</span></span></span><br><span class="line"><span class="meta">    <span class="meta-string">"http://mybatis.org/dtd/mybatis-3-config.dtd"</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">&lt;!-- MyBatis的全局配置文件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span> &gt;</span></span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>mybatis-config文件详细配置如下：</code></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">configuration</span></span></span><br><span class="line"><span class="meta">    <span class="meta-keyword">PUBLIC</span> <span class="meta-string">"-//mybatis.org//DTD Config 3.0//EN"</span></span></span><br><span class="line"><span class="meta">    <span class="meta-string">"http://mybatis.org/dtd/mybatis-3-config.dtd"</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">&lt;!-- MyBatis的全局配置文件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span> &gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 1.配置环境，可配置多个环境（比如：develop开发、test测试） --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">"develop"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">"develop"</span>&gt;</span></span><br><span class="line">			</span><br><span class="line">			<span class="comment">&lt;!-- 1.1.配置事务管理方式：JDBC/MANAGED</span></span><br><span class="line"><span class="comment">			JDBC：将事务交给JDBC管理（推荐）</span></span><br><span class="line"><span class="comment">			MANAGED：自己管理事务</span></span><br><span class="line"><span class="comment">			  --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">"JDBC"</span>&gt;</span><span class="tag">&lt;/<span class="name">transactionManager</span>&gt;</span></span><br><span class="line">			</span><br><span class="line">			<span class="comment">&lt;!-- 1.2.配置数据源，即连接池 JNDI/POOLED/UNPOOLED</span></span><br><span class="line"><span class="comment">				JNDI：已过时</span></span><br><span class="line"><span class="comment">				POOLED：使用连接池（推荐）</span></span><br><span class="line"><span class="comment">				UNPOOLED：不使用连接池</span></span><br><span class="line"><span class="comment">			 --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">"POOLED"</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driver"</span> <span class="attr">value</span>=<span class="string">"com.mysql.jdbc.Driver"</span>/&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"jdbc:mysql://localhost:3306/yonghedb?characterEncoding=utf-8"</span>/&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"root"</span>/&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"root"</span>/&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 2.导入Mapper配置文件，如果mapper文件有多个，可以通过多个mapper标签导入 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">"EmpMapper.xml"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="添加EmpMapper-xml文件"><a href="#添加EmpMapper-xml文件" class="headerlink" title="添加EmpMapper.xml文件"></a>添加EmpMapper.xml文件</h3><p><strong>1、在src/main/resources目录下，创建EmpMapper.xml文件 （实体类的映射文件）</strong></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/bf0e887dec06ea62dbad0673fe4b2730-3cc8150553244e1aa023202dc5de3db7.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871178-dd5d2ad4f5c1adb06953a23d53cbd344.png" alt="bf0e887dec06ea62dbad0673fe4b2730"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/bf0e887dec06ea62dbad0673fe4b2730-3cc8150553244e1aa023202dc5de3db7.png" target="_blank" rel="noopener">bf0e887dec06ea62dbad0673fe4b2730</a></p>
<p><strong>2、EmpMapper.xml文件配置如下:</strong></p>
<p><code>EmpMapper文件头信息如下：</code></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span></span></span><br><span class="line"><span class="meta">	<span class="meta-keyword">PUBLIC</span> <span class="meta-string">"-//mybatis.org//DTD Mapper 3.0//EN"</span></span></span><br><span class="line"><span class="meta">	<span class="meta-string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">	不同Mapper文件的namespace值应该保证唯一</span></span><br><span class="line"><span class="comment">	在程序中通过[ namespace + id ]定位到要执行哪一条SQL语句</span></span><br><span class="line"><span class="comment"> --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">""</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>EmpMapper文件详细配置如下：</code></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span></span></span><br><span class="line"><span class="meta">	<span class="meta-keyword">PUBLIC</span> <span class="meta-string">"-//mybatis.org//DTD Mapper 3.0//EN"</span></span></span><br><span class="line"><span class="meta">	<span class="meta-string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">	不同Mapper文件的namespace值应该保证唯一</span></span><br><span class="line"><span class="comment">	在程序中通过[ namespace + id ]定位到要执行哪一条SQL语句</span></span><br><span class="line"><span class="comment"> --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"EmpMapper"</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 通过select、insert、update、delete标签声明要执行的SQL --&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 练习1: 查询emp表中的所有员工信息</span></span><br><span class="line"><span class="comment">		resultType指定查询的结果将会封装到什么类型中</span></span><br><span class="line"><span class="comment">		即使最终返回的结果是集合(List&lt;Emp&gt;),resultType也只需要指定集合中的泛型即可!</span></span><br><span class="line"><span class="comment"> 	--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findAll"</span> <span class="attr">resultType</span>=<span class="string">"com.tedu.pojo.Emp"</span>&gt;</span></span><br><span class="line">		select * from emp</span><br><span class="line">	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="添加并编写Emp实体类"><a href="#添加并编写Emp实体类" class="headerlink" title="添加并编写Emp实体类"></a>添加并编写Emp实体类</h3><p>注意：在当前实例中，Emp类中的属性和数据库表的字段名称必须一致，否则将会无法将结果集封装到Java对象中。</p>
<p>在src/main/java目录下创建 com.tedu.pojo.Emp类，并编辑Emp类：提供私有属性以及对应的getter方法、setter方法，并重写toString方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.tedu.pojo;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 实体类,用于封装Emp表中的一条用户信息</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Emp</span> </span>&#123;</span><br><span class="line">	<span class="comment">//1.声明实体类中的属性</span></span><br><span class="line">	<span class="keyword">private</span> Integer id;</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="keyword">private</span> String job;</span><br><span class="line">	<span class="keyword">private</span> Double salary;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//2.提供对应的getter和setter方法</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Integer <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> id;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.id = id;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.name = name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getJob</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> job;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setJob</span><span class="params">(String job)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.job = job;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Double <span class="title">getSalary</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> salary;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSalary</span><span class="params">(Double salary)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.salary = salary;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//3.重写toString方法</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"Emp [id="</span> + id + <span class="string">", name="</span> + name + <span class="string">", job="</span> + job + <span class="string">", salary="</span> + salary + <span class="string">"]"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="实现测试类-并测试"><a href="#实现测试类-并测试" class="headerlink" title="实现测试类,并测试"></a>实现测试类,并测试</h3><p><strong>1、实现findAll方法，代码如下：</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/** 练习1(快速入门):  查询emp表中的所有员工, 返回一个List&lt;Emp&gt;集合</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> IOException */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">findAll</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">	<span class="comment">//1.读取mybatis的核心配置文件(mybatis-config.xml)</span></span><br><span class="line">	InputStream in = Resources</span><br><span class="line">			.getResourceAsStream(<span class="string">"mybatis-config.xml"</span>);</span><br><span class="line">	<span class="comment">//2.通过配置信息获取一个SqlSessionFactory工厂对象</span></span><br><span class="line">	SqlSessionFactory fac = </span><br><span class="line">			<span class="keyword">new</span> SqlSessionFactoryBuilder().build( in );</span><br><span class="line">	<span class="comment">//3.通过工厂获取一个SqlSession对象</span></span><br><span class="line">	SqlSession session = fac.openSession();</span><br><span class="line">	<span class="comment">//4.通过namespace+id找到要执行的sql语句并执行sql语句</span></span><br><span class="line">	List&lt;Emp&gt; list = session</span><br><span class="line">			.selectList(<span class="string">"EmpMapper.findAll"</span>);</span><br><span class="line">	<span class="comment">//5.输出结果</span></span><br><span class="line">	<span class="keyword">for</span>(Emp e : list) &#123;</span><br><span class="line">		System.out.println( e );</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>2、执行findAll方法，输出结果为：</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Emp [id&#x3D;1, name&#x3D;王海涛, job&#x3D;程序员, salary&#x3D;3300.0]</span><br><span class="line">Emp [id&#x3D;2, name&#x3D;齐雷, job&#x3D;程序员, salary&#x3D;2800.0]</span><br><span class="line">Emp [id&#x3D;3, name&#x3D;刘沛霞, job&#x3D;程序员鼓励师, salary&#x3D;2700.0]</span><br><span class="line">Emp [id&#x3D;4, name&#x3D;陈子枢, job&#x3D;部门总监, salary&#x3D;4200.0]</span><br><span class="line">Emp [id&#x3D;5, name&#x3D;刘昱江, job&#x3D;程序员, salary&#x3D;3000.0]</span><br><span class="line">Emp [id&#x3D;6, name&#x3D;董长春, job&#x3D;程序员, salary&#x3D;3500.0]</span><br><span class="line">Emp [id&#x3D;7, name&#x3D;苍老师, job&#x3D;程序员, salary&#x3D;3700.0]</span><br><span class="line">Emp [id&#x3D;8, name&#x3D;韩少云, job&#x3D;CEO, salary&#x3D;5000.0]</span><br></pre></td></tr></table></figure>

<h2 id="MyBatis入门细节"><a href="#MyBatis入门细节" class="headerlink" title="MyBatis入门细节"></a>MyBatis入门细节</h2><h3 id="mybatis-config-xml配置文件"><a href="#mybatis-config-xml配置文件" class="headerlink" title="mybatis-config.xml配置文件"></a>mybatis-config.xml配置文件</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">configuration</span></span></span><br><span class="line"><span class="meta">    <span class="meta-keyword">PUBLIC</span> <span class="meta-string">"-//mybatis.org//DTD Config 3.0//EN"</span></span></span><br><span class="line"><span class="meta">    <span class="meta-string">"http://mybatis.org/dtd/mybatis-3-config.dtd"</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">&lt;!-- MyBatis的全局配置文件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span> &gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 1.配置环境，可配置多个环境（比如：develop开发、test测试） --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">"develop"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">"develop"</span>&gt;</span></span><br><span class="line">			</span><br><span class="line">			<span class="comment">&lt;!-- 1.1.配置事务管理方式：JDBC/MANAGED</span></span><br><span class="line"><span class="comment">			JDBC：将事务交给JDBC管理（推荐）</span></span><br><span class="line"><span class="comment">			MANAGED：自己管理事务</span></span><br><span class="line"><span class="comment">			  --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">"JDBC"</span>&gt;</span><span class="tag">&lt;/<span class="name">transactionManager</span>&gt;</span></span><br><span class="line">			</span><br><span class="line">			<span class="comment">&lt;!-- 1.2.配置数据源，即连接池 JNDI/POOLED/UNPOOLED</span></span><br><span class="line"><span class="comment">				JNDI：已过时</span></span><br><span class="line"><span class="comment">				POOLED：使用连接池（推荐）</span></span><br><span class="line"><span class="comment">				UNPOOLED：不使用连接池</span></span><br><span class="line"><span class="comment">			 --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">"POOLED"</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driver"</span> <span class="attr">value</span>=<span class="string">"com.mysql.jdbc.Driver"</span>/&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"jdbc:mysql://localhost:3306/yonghedb?characterEncoding=utf-8"</span>/&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"root"</span>/&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"root"</span>/&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 2.导入Mapper配置文件，如果mapper文件有多个，可以通过多个mapper标签导入 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">"EmpMapper.xml"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>environments</code>标签：该标签内部可以配置多个environment，即多种环境，每种环境可以做不同配置或连接不同数据库。例如，开发、测试、生产环境可能需要不同的配置，连接的数据库可能也不相同，因此我们可以配置三个environment，分别对应上面三种不同的环境。</p>
<p>但是要记住，environment可以配置多个，但是最终要使用的只能是其中一个！</p>
<p><code>environment</code>标签：内部可以配置多种配置信息，下面介绍事务管理配置和数据源配置。</p>
<p><code>transactionManage</code>标签：事务管理配置，mybatis中有两种事务管理方式，也就是</p>
<p>type=”[JDBC|MANAGED]。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">JDBC：这个配置就是直接使用了 JDBC的提交和回滚设置，它依赖于从数据源得到的连接来管理事务范围。推荐使用。</span><br><span class="line">MANAGED：这个配置几乎没做什么。它从来不提交或回滚一个连接。需要自己手动添加并管理。不推荐使用。</span><br></pre></td></tr></table></figure>

<p><code>dataSource</code>标签：数据源，也就是连接池配置。这里type指定数据源类型，有三种内建的类型：JNDI、POOLED、UNPOOLED</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">JNDI：已过时，不推荐使用！</span><br><span class="line">POOLED：使用连接池，mybatis会创建连接池，并从连接池中获取连接访问数据库，在操作完成后，将会把连接返回连池。</span><br><span class="line">UNPOOLED：不使用连接池，该方式适用于只有小规模数量并发用户的简单应用程序上。</span><br></pre></td></tr></table></figure>

<p><code>mappers</code>标签：用于导入mapper文件的位置，其中可以配置多个mapper，即可以导入多个mapper文件。</p>
<h3 id="EmpMapper-xml配置文件"><a href="#EmpMapper-xml配置文件" class="headerlink" title="EmpMapper.xml配置文件"></a>EmpMapper.xml配置文件</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span></span></span><br><span class="line"><span class="meta">	<span class="meta-keyword">PUBLIC</span> <span class="meta-string">"-//mybatis.org//DTD Mapper 3.0//EN"</span></span></span><br><span class="line"><span class="meta">	<span class="meta-string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">	不同Mapper文件的namespace值应该保证唯一</span></span><br><span class="line"><span class="comment">	在程序中通过[ namespace + id ]定位到要执行哪一条SQL语句</span></span><br><span class="line"><span class="comment"> --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"EmpMapper"</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 通过select、insert、update、delete标签声明要执行的SQL --&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 练习1: 查询emp表中的所有员工信息</span></span><br><span class="line"><span class="comment">		resultType指定查询的结果将会封装到什么类型中</span></span><br><span class="line"><span class="comment">		即使最终返回的结果是集合(List&lt;Emp&gt;),resultType也只需要指定集合中的泛型即可!</span></span><br><span class="line"><span class="comment"> 	--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findAll"</span> <span class="attr">resultType</span>=<span class="string">"com.tedu.pojo.Emp"</span>&gt;</span></span><br><span class="line">		select * from emp</span><br><span class="line">	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>(1)第1行是xml的文档声明，用于声明xml的版本和编码</p>
<p>(2)第2、3、4行，引入了xml约束文档，当前xml文档将会按照mybatis-3-mapper.dtd文件所要求的规则进行书写。</p>
<p>(3)Mapper标签：根标签，其中namespace(名称空间，也叫命名空间)，要求不能重复。在程序中通过【namespace + id 】定位到要执行哪一条SQL语句</p>
<p>(4)select标签：用于指定将来要执行的各种SQL语句。标签上可以声明属性，下面介绍常用的属性：id、resultType、resultMap</p>
<ul>
<li><p>id属性：要求值不能重复。将来在执行SQL时，可以通过【namespace + id】找到指定SQL并执行。</p>
</li>
<li><p>resultType属性：从这条SQL语句中返回所期望类型的类的完全限定名称（包名+类名）。注意如果是集合情形，那应该是集合可以包含的类型，而不能是集合本身。</p>
<p>简而言之，resultType控制查询SQL执行后返回值的类型或集合中的泛型，例如查询emp表中的单条记录，返回值是一个Emp对象，因此，resultType=”com.tedu.pojo.Emp”；</p>
<p>如果查询emp表中的多条记录，返回值是一个List，此时resultType的值应该集合中的泛型，因此resultType=”com.tedu.pojo.Emp”；</p>
</li>
<li><p>resultMap属性：复杂对象结构（例如多表关联查询等）。 使用 resultType 或 resultMap，但不能同时使用。</p>
</li>
</ul>
<h2 id="MyBatis增删改查"><a href="#MyBatis增删改查" class="headerlink" title="MyBatis增删改查"></a>MyBatis增删改查</h2><h3 id="新增员工"><a href="#新增员工" class="headerlink" title="新增员工"></a>新增员工</h3><p><strong>1、编辑EmpMapper.xml文件, 添加新增员工对应的sql.</strong></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 练习2: 新增员工信息: 赵云 保安 6000</span></span><br><span class="line"><span class="comment">增删改的标签上不用指定resultType, 因为返回值都是int类型</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">"insert"</span> &gt;</span></span><br><span class="line">	insert into emp value(null, '赵云', '保安', 6000)</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>2、编写TestMybatis类，添加testInsert方法，实现新增员工操作。</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/** 练习2: 新增员工信息: 赵云 保安 6000 */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testInsert</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="comment">//执行sql语句, 返回执行结果</span></span><br><span class="line">  <span class="keyword">int</span> rows = session.update(<span class="string">"EmpMapper.insert"</span>);</span><br><span class="line">  <span class="comment">//提交事务</span></span><br><span class="line">  session.commit();</span><br><span class="line">  System.out.println(<span class="string">"影响的行数: "</span>+rows);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="修改员工"><a href="#修改员工" class="headerlink" title="修改员工"></a>修改员工</h3><p><strong>1、编辑EmpMapper.xml文件, 添加新增员工对应的sql。</strong></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 练习3：修改员工信息：赵云 保镖 20000 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">"update"</span>&gt;</span></span><br><span class="line">	update emp set job='保镖', salary=20000 where name='赵云'</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>2、编写TestMybatis类，添加testUpdate方法，实现修改员工信息。</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/** 练习3: 修改员工信息, 将赵云的job改为'保镖'，salary改为20000 */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testUpdate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="comment">//执行sql语句, 返回执行结果</span></span><br><span class="line">  <span class="keyword">int</span> rows = session.update(<span class="string">"EmpMapper.update"</span>);</span><br><span class="line">  <span class="comment">//提交事务</span></span><br><span class="line">  session.commit();</span><br><span class="line">  System.out.println(<span class="string">"影响行数:"</span>+rows);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="删除员工"><a href="#删除员工" class="headerlink" title="删除员工"></a>删除员工</h3><p><strong>1、编辑EmpMapper.xml文件, 添加新增员工对应的sql。</strong></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 练习4: 删除name为'赵云'的记录 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">"delete"</span>&gt;</span></span><br><span class="line">	delete from emp where name='赵云'</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>2、编写TestMybatis类，添加</strong>testDelete<strong>方法，实现删除员工。</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/** 练习4: 删除name为'赵云'的记录 */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testDelete</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="comment">//执行sql语句, 返回执行结果</span></span><br><span class="line">  <span class="keyword">int</span> rows = session.update(<span class="string">"EmpMapper.delete"</span>);</span><br><span class="line">  <span class="comment">//提交事务</span></span><br><span class="line">  session.commit();</span><br><span class="line">  System.out.println(<span class="string">"影响行数:"</span>+rows);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="mybatis中的占位符"><a href="#mybatis中的占位符" class="headerlink" title="mybatis中的占位符"></a>mybatis中的占位符</h2><h3 id="占位符"><a href="#占位符" class="headerlink" title="#{}占位符"></a>#{}占位符</h3><p>在上面的增删改查操作中，SQL语句中的值是写死在SQL语句中的，而在实际开发中，此处的值往往是用户提交过来的值，因此这里我们需要将SQL中写死的值替换为占位符。</p>
<p>在mybatis中占位符有两个，分别是 <code>#{}</code> 占位符 和 <code>${}</code> 占位符：</p>
<ul>
<li><p><code>#{}：</code>相当于JDBC中的问号（?）占位符,是为SQL语句中的参数值进行占位,大部分情况下都是使用#{}占位符; 并且当#{}占位符是为字符串或者日期类型的值进行占位时,在参数值传过来替换占位符的同时,会进行转义处理(在字符串或日期类型的值的两边加上单引号)</p>
</li>
<li><p><code>${}</code>：是为SQL片段进行占位，将传过来的SQL片段直接拼接在${}占位符所在的位置,不会进行任何的转义处理。（由于是直接将参数拼接在SQL语句中，因此可能会引发SQL注入攻击问题）</p>
</li>
</ul>
<p><strong>练习5：查询emp表中指定id的员工信息</strong></p>
<p>在mapper文件中编写SQL语句：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 练习5: 查询emp表中指定id的员工信息 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findById"</span> <span class="attr">resultType</span>=<span class="string">"com.tedu.pojo.Emp"</span>&gt;</span></span><br><span class="line">	select * from emp where id=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Java代码实现：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/** 练习5: 查询emp表中指定id的员工信息 */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindById</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="comment">//执行sql语句, 返回执行结果</span></span><br><span class="line">  Emp emp = session.selectOne( <span class="string">"EmpMapper.findById"</span>, <span class="number">1</span> );</span><br><span class="line">  System.out.println( emp );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>练习6：新增员工信息: 张飞 Java开发工程师 15000</strong></p>
<p>在mapper文件中编写SQL语句：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 练习6: 新增员工信息: 张飞 Java开发工程师 15000</span></span><br><span class="line"><span class="comment">  如果通过map集合传输参数, 需要保证占位符中的变量名</span></span><br><span class="line"><span class="comment">  和map集合中的key保持一致</span></span><br><span class="line"><span class="comment">  如果通过pojo对象传输参数, 需要保证占位符中的变量名</span></span><br><span class="line"><span class="comment">  和对象中的属性名保持一致, 或者在pojo中有对应的</span></span><br><span class="line"><span class="comment">  getXxx方法</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">"insert2"</span>&gt;</span></span><br><span class="line">	insert into emp values (null, #&#123;name&#125;, #&#123;job&#125;, #&#123;salary&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Java代码实现：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/** 练习6: 新增员工信息: 张飞 Java开发工程师 15000 */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testInsert2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="comment">//将要传输的参数封装到map集合中</span></span><br><span class="line">  <span class="comment">//Map map = new HashMap();</span></span><br><span class="line">  <span class="comment">//map.put("name", "张飞");</span></span><br><span class="line">  <span class="comment">//map.put("job", "Java开发工程师");</span></span><br><span class="line">  <span class="comment">//map.put("salary", 15000);</span></span><br><span class="line">  <span class="comment">//也可以将要传输的参数封装到Emp对象中</span></span><br><span class="line">  Emp emp = <span class="keyword">new</span> Emp();</span><br><span class="line">  emp.setName(<span class="string">"关羽123"</span>);</span><br><span class="line">  emp.setJob(<span class="string">"保安"</span>);</span><br><span class="line">  emp.setSalary(<span class="number">8000.0</span>);</span><br><span class="line">  <span class="comment">//执行sql语句</span></span><br><span class="line">  intsession rows = session.update(<span class="string">"EmpMapper.insert2"</span>, emp);</span><br><span class="line">  <span class="comment">//提交事务</span></span><br><span class="line">  session.commit();</span><br><span class="line">  System.out.println( <span class="string">"影响的行数: "</span>+rows );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>练习7：修改员工信息: 张飞 架构师 25000</strong></p>
<p>在mapper文件中编写SQL语句：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 练习7: 修改员工信息: 张飞 架构师 25000 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">"update2"</span>&gt;</span></span><br><span class="line">  update emp set job=#&#123;job&#125;, salary=#&#123;salary&#125;</span><br><span class="line">  where name=#&#123;name&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Java代码实现：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/** 练习7: 修改员工信息: 张飞 架构师 25000 */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testUpdate2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="comment">//将参数封装到Emp对象中</span></span><br><span class="line">  Emp emp = <span class="keyword">new</span> Emp();</span><br><span class="line">  emp.setName(<span class="string">"张飞"</span>);</span><br><span class="line">  emp.setJob(<span class="string">"架构师"</span>);</span><br><span class="line">  emp.setSalary(<span class="number">25000.0</span>);</span><br><span class="line">  <span class="comment">//执行sql语句</span></span><br><span class="line">  intsession rows = session.update(<span class="string">"EmpMapper.update2"</span>, emp);</span><br><span class="line">  <span class="comment">//提交事务</span></span><br><span class="line">  session.commit();</span><br><span class="line">  System.out.println(<span class="string">"影响的行数: "</span>+rows);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>练习8：删除emp表中指定id的员工信息</strong></p>
<p>mapper文件配置:</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 练习8：删除emp表中指定id的员工信息 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"delete2"</span> <span class="attr">parameterType</span>=<span class="string">"String"</span>&gt;</span></span><br><span class="line">	delete from emp where id=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>java代码示例:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*  练习8：删除emp表中指定id的员工信息 */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testDelete2</span><span class="params">()</span> <span class="keyword">throws</span> IOException</span>&#123;</span><br><span class="line">  ......</span><br><span class="line">  <span class="comment">//执行SQL语句</span></span><br><span class="line">  <span class="keyword">int</span> rows = session.delete(<span class="string">"EmpMapper.delete2"</span>, <span class="number">1</span>);</span><br><span class="line">  <span class="comment">//提交事务</span></span><br><span class="line">  session.commit();</span><br><span class="line">  System.out.println(<span class="string">"影响行数:"</span>+rows);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在上面的增删改查练习中，当SQL语句中包含的参数值是传递过来的，在SQL语句中我们会通过<code>#{}</code>占位符进行占位，在SQL语句真正执行时，再将传递过来的值替换SQL语句中的占位符。</p>
<p>其实，<code>#{}</code>就是JDBC中的问号（<strong>?</strong>）占位符，因此为了安全考虑，在执行时会对传递过来的字符串和日期类型高的值进行转译处理。</p>
<p>例如：查询指定name的员工信息，SQL语句为：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> emp <span class="keyword">where</span> <span class="keyword">name</span>=<span class="comment">#&#123;name&#125;</span></span><br></pre></td></tr></table></figure>

<p>其实就等价于JDBC中： <code>select * from emp where name=?</code>，</p>
<p>如果传过来的参数值为：王海涛，那么最终执行的SQL语句为：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 在参数替换占位符的同时进行了转义处理(在值的两边加上了单引号)</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> emp <span class="keyword">where</span> <span class="keyword">name</span>=<span class="string">'王海涛'</span></span><br></pre></td></tr></table></figure>

<h3 id="占位符-1"><a href="#占位符-1" class="headerlink" title="${}占位符"></a>${}占位符</h3><p>那么如果我们在传递的时候不是一个参数值，而是一个SQL片段呢？</p>
<p>例如：在查询时，我们想动态的传递查询的列：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="comment">#&#123;columns&#125; from emp</span></span><br></pre></td></tr></table></figure>

<p>此时传递过来的应该是一个SQL片段，不同于上面的参数值，如果此时还用<code>#{}</code>，也会像上面一样被转译处理：<code>select &#39;id,name,job&#39; from emp</code>，这不是我们希望看到的！</p>
<p>如果不想让传过来的SQL片段被转译处理，而是直接拼接在SQL语句中，那么这里可以使用<code>${}</code>，例如：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> $&#123;<span class="keyword">columns</span>&#125; <span class="keyword">from</span> emp</span><br></pre></td></tr></table></figure>

<p>拼接之后：<code>select id,name,job from emp</code></p>
<p><strong>练习9：动态指定要查询的列</strong></p>
<p>在mapper文件中编写SQL语句：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 练习9: 动态指定要查询的列 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findAll2"</span> <span class="attr">resultType</span>=<span class="string">"com.tedu.pojo.Emp"</span>&gt;</span></span><br><span class="line">	select $&#123;cols&#125; from emp</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>java代码示例:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/** 练习9: 动态指定要查询的列 */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindAll2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  Map map = <span class="keyword">new</span> HashMap();</span><br><span class="line">  <span class="comment">//map.put("cols", "id, name");</span></span><br><span class="line">  <span class="comment">//map.put("cols", "id, name, salary");</span></span><br><span class="line">  map.put(<span class="string">"cols"</span>, <span class="string">"id,name,job,salary"</span>);</span><br><span class="line">  <span class="comment">//执行sql语句, 返回结果</span></span><br><span class="line">  List&lt;Emp&gt; list = session.selectList(<span class="string">"EmpMapper.findAll2"</span>, map);</span><br><span class="line">  <span class="comment">//输出结果</span></span><br><span class="line">  <span class="keyword">for</span> ( Emp e : list ) &#123;</span><br><span class="line">  	System.out.println( e );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>示例2: 根据name模糊查询emp表</strong></p>
<p>在mapper文件中编写SQL语句：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 练习10: 根据name模糊查询emp表 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findAll3"</span> <span class="attr">resultType</span>=<span class="string">"com.tedu.pojo.Emp"</span>&gt;</span></span><br><span class="line">  select * from emp</span><br><span class="line">  where name like '%$&#123;name&#125;%'</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 练习11: 根据name模糊查询emp表 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findAll4"</span> <span class="attr">resultType</span>=<span class="string">"com.tedu.pojo.Emp"</span>&gt;</span></span><br><span class="line">  select * from emp</span><br><span class="line">  where name like #&#123;name&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Java代码实现：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 练习10: 根据name模糊查询emp表</span></span><br><span class="line"><span class="comment"> * '%王%' '%刘%'</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindAll3</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="comment">//将参数封装到map集合中</span></span><br><span class="line">  Map map = <span class="keyword">new</span> HashMap();</span><br><span class="line">  map.put(<span class="string">"name"</span>, <span class="string">"涛"</span>);</span><br><span class="line">  <span class="comment">//执行sql, 返回结果</span></span><br><span class="line">  List&lt;Emp&gt; list = session.selectList(<span class="string">"EmpMapper.findAll3"</span>, map);</span><br><span class="line">  <span class="comment">//输出结果</span></span><br><span class="line">  <span class="keyword">for</span> (Emp emp : list) &#123;</span><br><span class="line">  	System.out.println( emp );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 练习11: 根据name模糊查询emp表</span></span><br><span class="line"><span class="comment"> * '%王%' '%刘%'</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindAll4</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="comment">//将参数封装到map集合中</span></span><br><span class="line">  Map map = <span class="keyword">new</span> HashMap();</span><br><span class="line">  map.put(<span class="string">"name"</span>, <span class="string">"%刘%"</span>);</span><br><span class="line">  <span class="comment">//执行sql, 返回结果</span></span><br><span class="line">  List&lt;Emp&gt; list = session.selectList(<span class="string">"EmpMapper.findAll4"</span>, map);</span><br><span class="line">  <span class="comment">//输出结果</span></span><br><span class="line">  <span class="keyword">for</span> (Emp emp : list) &#123;</span><br><span class="line">  	System.out.println( emp );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>需要注意的是，在传递 <code>${}</code> 对应的值时，即使只有一个参数，也需要将值存入<strong>map</strong>集合中！！</p>
<p>总结：在大多数情况下还是使用#{}占位符，而${}多用于为SQL片段进行占位！</p>
<h2 id="动态SQL标签"><a href="#动态SQL标签" class="headerlink" title="动态SQL标签"></a>动态SQL标签</h2><h3 id="if、where标签"><a href="#if、where标签" class="headerlink" title="if、where标签"></a>if、where标签</h3><ul>
<li><p><code>&lt;if&gt;</code>标签：是根据<code>test属性</code>中的布尔表达式的值，从而决定是否执行包含在其中的SQL片段。如果判断结果为true，则执行其中的SQL片段；如果结果为false，则不执行其中的SQL片段</p>
</li>
<li><p><code>&lt;where&gt;</code>标签：用于对包含在其中的SQL片段进行检索，在需要时可以生成where关键字，并且在需要时会剔除多余的连接词（比如and或者or）</p>
</li>
</ul>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/f06a2a2de234a540b189b15d65943989-eb68759a231843fa9d43a07c9c7363c6.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871178-f50f6006b7c7da84f00abe26ef094214.png" alt="f06a2a2de234a540b189b15d65943989"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/f06a2a2de234a540b189b15d65943989-eb68759a231843fa9d43a07c9c7363c6.png" target="_blank" rel="noopener">f06a2a2de234a540b189b15d65943989</a></p>
<p><strong>练习12：根据薪资查询员工信息（if标签）</strong></p>
<ul>
<li><code>&lt;if&gt;</code>标签：是根据<code>test属性</code>中的布尔表达式的值，从而决定是否执行包含在其中的SQL片段。如果判断结果为true，则执行其中的SQL片段；如果结果为false，则不执行其中的SQL片段</li>
</ul>
<p>在mapper文件中编写SQL语句：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 练习12: 根据薪资查询员工信息</span></span><br><span class="line"><span class="comment">* 如果没有参数, 则不执行where子句, 默认查询所有员工：</span></span><br><span class="line"><span class="comment">* 	select * from emp</span></span><br><span class="line"><span class="comment">* 如果参数中只有minSal(即minSal不为null), 则：</span></span><br><span class="line"><span class="comment">* 	... where salary &gt; minSal</span></span><br><span class="line"><span class="comment">* 如果参数中只有maxSal(即maxSal不为null), 则：</span></span><br><span class="line"><span class="comment">* 	... where salary &lt; maxSal</span></span><br><span class="line"><span class="comment">* 如果参数有 minSal、maxSal(即minSal、maxSal不为null), 则：</span></span><br><span class="line"><span class="comment">*		... where salary &gt; minSal and salary &lt; maxSal  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findAllBySal"</span> <span class="attr">resultType</span>=<span class="string">"com.tedu.pojo.Emp"</span>&gt;</span></span><br><span class="line">  select * from emp</span><br><span class="line">  where 1=1</span><br><span class="line">  <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"minSal != null"</span>&gt;</span></span><br><span class="line">  	and salary&gt;#&#123;minSal&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"maxSal != null"</span>&gt;</span></span><br><span class="line">  	and salary &lt;![CDATA[ &lt; ]]&gt; #&#123;maxSal&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Java代码实现：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* 练习12: 根据薪资查询员工信息</span></span><br><span class="line"><span class="comment">* 如果没有参数, 则不执行where子句, 默认查询所有员工：</span></span><br><span class="line"><span class="comment">* 	select * from emp</span></span><br><span class="line"><span class="comment">* 如果参数中只有minSal(即minSal不为null), 则：</span></span><br><span class="line"><span class="comment">* 	... where salary &gt; minSal</span></span><br><span class="line"><span class="comment">* 如果参数中只有maxSal(即maxSal不为null), 则：</span></span><br><span class="line"><span class="comment">* 	... where salary &lt; maxSal</span></span><br><span class="line"><span class="comment">* 如果参数有 minSal、maxSal(即minSal、maxSal不为null), 则：</span></span><br><span class="line"><span class="comment">*	... where salary &gt; minSal and salary &lt; maxSal  */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindBySal</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	Map&lt;String, Object&gt; map = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</span><br><span class="line">	<span class="comment">//map.put( "minSal" , 3000 );</span></span><br><span class="line">	<span class="comment">//map.put( "maxSal", 4000 );</span></span><br><span class="line">	List&lt;Emp&gt; list = session.selectList( <span class="string">"EmpMapper.findBySal"</span>, map );</span><br><span class="line">	<span class="keyword">for</span> (Emp emp : list) &#123;</span><br><span class="line">		System.out.println( emp );</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>练习13：根据薪资查询员工信息(where标签)</strong></p>
<ul>
<li><code>&lt;where&gt;</code>标签：用于对包含在其中的SQL片段进行检索，在需要时可以生成where关键字，并且在需要时会剔除多余的连接词（比如and或者or）</li>
</ul>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 练习13: 根据薪资查询员工信息</span></span><br><span class="line"><span class="comment">* 如果没有参数, 则不执行where子句, 默认查询所有员工：</span></span><br><span class="line"><span class="comment">* 	select * from emp</span></span><br><span class="line"><span class="comment">* 如果参数中只有minSal(即minSal不为null), 则：</span></span><br><span class="line"><span class="comment">* 	... where salary &gt; minSal</span></span><br><span class="line"><span class="comment">* 如果参数中只有maxSal(即maxSal不为null), 则：</span></span><br><span class="line"><span class="comment">* 	... where salary &lt; maxSal</span></span><br><span class="line"><span class="comment">* 如果参数有 minSal、maxSal(即minSal、maxSal不为null), 则：</span></span><br><span class="line"><span class="comment">*		... where salary &gt; minSal and salary &lt; maxSal  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findAllBySal2"</span> <span class="attr">resultType</span>=<span class="string">"com.tedu.pojo.Emp"</span>&gt;</span></span><br><span class="line">  select * from emp</span><br><span class="line">  <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"minSal != null"</span>&gt;</span></span><br><span class="line">    	and salary&gt;#&#123;minSal&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"maxSal != null"</span>&gt;</span></span><br><span class="line">    	and salary &lt;![CDATA[ &lt; ]]&gt; #&#123;maxSal&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Java代码实现：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 练习13: 根据薪资查询员工信息</span></span><br><span class="line"><span class="comment">* 如果没有参数, 则不执行where子句, 默认查询所有员工：</span></span><br><span class="line"><span class="comment">* 	select * from emp</span></span><br><span class="line"><span class="comment">* 如果参数中只有minSal(即minSal不为null), 则：</span></span><br><span class="line"><span class="comment">* 	... where salary &gt; minSal</span></span><br><span class="line"><span class="comment">* 如果参数中只有maxSal(即maxSal不为null), 则：</span></span><br><span class="line"><span class="comment">* 	... where salary &lt; maxSal</span></span><br><span class="line"><span class="comment">* 如果参数有 minSal、maxSal(即minSal、maxSal不为null), 则：</span></span><br><span class="line"><span class="comment">*	... where salary &gt; minSal and salary &lt; maxSal  */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindAllBySal</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="comment">//封装参数到map集合中</span></span><br><span class="line">  Map map = <span class="keyword">new</span> HashMap();</span><br><span class="line">  map.put(<span class="string">"minSal"</span>, <span class="number">3000</span>);</span><br><span class="line">  map.put(<span class="string">"maxSal"</span>, <span class="number">4000.0</span>);</span><br><span class="line">  List&lt;Emp&gt; list = session.selectList(<span class="string">"EmpMapper.findAllBySal2"</span>, map);</span><br><span class="line">  <span class="keyword">for</span> (Emp emp : list) &#123;</span><br><span class="line">  	System.out.println( emp );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="foreach元素"><a href="#foreach元素" class="headerlink" title="foreach元素"></a>foreach元素</h3><p>foreach标签：可以对传过来的参数数组或集合进行遍历，以下是foreach标签上的各个属性介绍：</p>
<table>
<thead>
<tr>
<th>属性</th>
<th>属性描述</th>
</tr>
</thead>
<tbody><tr>
<td>collection</td>
<td>必需，值为遍历的集合类型，例如：如果参数只是一个数组或List集合，则collection的值为array或list；如果传的是多个参数，用map封装，collection则指定为map中的key。</td>
</tr>
<tr>
<td>item</td>
<td>必需，若collection为数组或List集合时，item表示其中的元素，若collection为map中的key，item表示map中value（集合或数组）中的元素</td>
</tr>
<tr>
<td>open</td>
<td>可选，表示遍历生成的SQL片段以什么开始，最常用的是左括号’(‘</td>
</tr>
<tr>
<td>close</td>
<td>可选，表示遍历生成的SQL片段以什么结束，最常用的是右括号’)’</td>
</tr>
<tr>
<td>separator</td>
<td>可选，每次遍历后给生成的SQL片段后面指定间隔符</td>
</tr>
</tbody></table>
<p><strong>练习14: 根据员工的id批量删除员工信息</strong></p>
<p>在mapper文件中编写SQL语句：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 练习14: 根据员工的id批量删除员工信息</span></span><br><span class="line"><span class="comment">	delete from emp where id in (1,3,5,7)</span></span><br><span class="line"><span class="comment">	collection: 如果传的参数仅仅是一个数组或者List集合, collection可以指定为</span></span><br><span class="line"><span class="comment">		array或list; 如果传的是多个参数，用map封装，collection则指定为map中的key</span></span><br><span class="line"><span class="comment">	open: 指定生成的SQL片段以什么符号开始</span></span><br><span class="line"><span class="comment">	close: 指定生成的SQL片段以什么符号结束</span></span><br><span class="line"><span class="comment">	item: 指定变量接收数组或集合中的元素</span></span><br><span class="line"><span class="comment">	separator: 指定一个间隔符, 在将数组或集合中的每个元素拼接到SQL片段之后, </span></span><br><span class="line"><span class="comment">		在后面拼接一个间隔符</span></span><br><span class="line"><span class="comment"> --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">"deleteByIds"</span>&gt;</span></span><br><span class="line">	delete from emp where id in</span><br><span class="line">	<span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">"array"</span> <span class="attr">open</span>=<span class="string">"("</span> <span class="attr">item</span>=<span class="string">"id"</span> <span class="attr">separator</span>=<span class="string">","</span> <span class="attr">close</span>=<span class="string">")"</span>&gt;</span></span><br><span class="line">		#&#123;id&#125;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Java代码实现：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* 练习14: 根据员工的id批量删除员工信息 */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testDeleteByIds</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="comment">//获取所要删除的员工的id数组</span></span><br><span class="line">	Integer[] ids = &#123;<span class="number">1</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">7</span>&#125;;</span><br><span class="line">	<span class="keyword">int</span> rows = session.delete( <span class="string">"EmpMapper.deleteByIds"</span>, ids );</span><br><span class="line">	System.out.println( <span class="string">"影响行数: "</span>+rows );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>练习15：根据员工的id批量更新员工信息</strong></p>
<p>在mapper文件中编写SQL语句：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 练习15: 根据员工的id批量更新员工信息</span></span><br><span class="line"><span class="comment"> 	将id为 2、4、6、8的员工的薪资在原有基础上增加1000</span></span><br><span class="line"><span class="comment"> 	update emp set salary=salary + 1000</span></span><br><span class="line"><span class="comment">	where id in(2,4,6,8);</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">"updateByIds"</span>&gt;</span></span><br><span class="line">	update emp set salary=salary + #&#123;sal&#125;</span><br><span class="line">	where id in</span><br><span class="line">	<span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">"arrIds"</span> <span class="attr">open</span>=<span class="string">"("</span> <span class="attr">item</span>=<span class="string">"id"</span> <span class="attr">separator</span>=<span class="string">","</span> <span class="attr">close</span>=<span class="string">")"</span>&gt;</span></span><br><span class="line">		#&#123;id&#125;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Java代码实现：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* 练习15: 根据员工的id批量更新员工信息</span></span><br><span class="line"><span class="comment"> * 将id为 2、4、6、8的员工的薪资在原有基础上增加1000</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testUpdateByIds</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	Integer[] ids = &#123;<span class="number">2</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">8</span>&#125;; <span class="comment">//获取所要更新的员工的id数组</span></span><br><span class="line">	Double sal = <span class="number">1000.0</span>; <span class="comment">//要涨的薪资</span></span><br><span class="line">	<span class="comment">//传递的参数超过1个, 将参数封装到map集合中再传递</span></span><br><span class="line">	Map&lt;String, Object&gt; map = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</span><br><span class="line">	map.put( <span class="string">"arrIds"</span> , ids );</span><br><span class="line">	map.put( <span class="string">"sal"</span>, sal );</span><br><span class="line">	<span class="keyword">int</span> rows = session.update( <span class="string">"EmpMapper.updateByIds"</span>, map );</span><br><span class="line">	System.out.println( <span class="string">"影响行数: "</span>+rows );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>下面练习自己完成：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* 练习16：根据员工的id批量查询指定id的员工信息</span></span><br><span class="line"><span class="comment"> * 查询id为 2、4、6、8的员工的信息</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindByIds</span><span class="params">()</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Mapper接口开发"><a href="#Mapper接口开发" class="headerlink" title="Mapper接口开发"></a>Mapper接口开发</h2><h3 id="Mapper接口开发介绍"><a href="#Mapper接口开发介绍" class="headerlink" title="Mapper接口开发介绍"></a>Mapper接口开发介绍</h3><p>在上面的Mybatis案例中, 通过SqlSession对象调用方法进行增删改查操作时，方法中需要传入的第一个参数是一个字符串值，该值对应的内容为: (Mapper文件中的)namespace + id, 通过这种方式，找到Mapper文件中映射的SQL语句并执行!!</p>
<p>这种方式由于传入的是字符串值, 很容易发生字符串拼写错误且编译时期不会提示。</p>
<p>这里我们将会讲解比上面更加简单的方式，也是我们企业开发中最常用的方式，即使用mapper接口开发。使用mapper接口开发需要注意以下几点：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1、创建一个接口，接口的全路径名和mapper文件的namespace值要相同</span><br><span class="line">2、mapper文件中每条要执行的SQL语句，在接口中要添加一个对应的方法，并且接口中的方法名和SQL标签上的id值相同</span><br><span class="line">3、Mapper接口中方法接收的参数类型，和mapper.xml中定义的sql的接收的参数类型要相同</span><br><span class="line">4、接口中方法的返回值类型和SQL标签上的resultType即返回值类型相同(如果方法返回值是集合,resultType只需要指定集合中的泛型)</span><br></pre></td></tr></table></figure>

<h3 id="Mapper接口开发实现"><a href="#Mapper接口开发实现" class="headerlink" title="Mapper接口开发实现"></a>Mapper接口开发实现</h3><p>下面将使用mapper接口开发的方式，实现根据id查询指定的员工信息</p>
<p><strong>1、创建com.tedu.dao.EmpMapper接口</strong></p>
<p>由于接口的全路径名(com.tedu.dao.EmpMapper)要和EmpMapper.xml的namespace值保持一致，因此, 这里将namespace的值改为com.tedu.dao.EmpMapper：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span></span></span><br><span class="line"><span class="meta">  <span class="meta-keyword">PUBLIC</span> <span class="meta-string">"-//mybatis.org//DTD Mapper 3.0//EN"</span></span></span><br><span class="line"><span class="meta">  <span class="meta-string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"com.tedu.dao.EmpMapper"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>2、在接口中提供findById方法</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 根据id查询员工信息</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span> Emp</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Emp <span class="title">findById</span><span class="params">(Integer id)</span></span>;</span><br></pre></td></tr></table></figure>

<p>注意:方法的名字要和映射的sql标签的id值保持一致</p>
<p>方法的返回值类型和resultType的类型要一致</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 1.查询：查询Emp表中指定id的员工信息 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findById"</span> <span class="attr">resultType</span>=<span class="string">"com.tedu.pojo.Emp"</span>&gt;</span></span><br><span class="line">	select * from emp where id=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>3、提供实现类，测试Emp接口中的根据id查询员工的方法</strong></p>
<p>(1)创建com.tedu.test.TestMybatisInf类, 并提供testFindById方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestMybatisInf</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindById</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>4、实现testFindById方法并测试</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindById</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">  ......</span><br><span class="line">  <span class="comment">//3.获取Mapper接口对象</span></span><br><span class="line">  EmpMapper map = session.getMapper(EmpMapper<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">  <span class="comment">//4.调用接口对象的方法进行查询</span></span><br><span class="line">  Emp e = map.findById(<span class="number">2</span>);</span><br><span class="line">  <span class="comment">//5.输出结果</span></span><br><span class="line">  System.out.println(e);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>5、在接口中提供findAll方法</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 查询所有的员工信息</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span> List&lt;Emp&gt;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;Emp&gt; <span class="title">findAll</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>

<p>注意:方法的名字要和映射的sql标签的id值保持一致</p>
<p>方法的返回值类型和resultType的类型要一致, 例如:</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 2.查询Emp表中所有员工的信息 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findAll"</span> <span class="attr">resultType</span>=<span class="string">"com.tedu.pojo.Emp"</span>&gt;</span></span><br><span class="line">	select * from emp</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>6、提供实现类，测试Emp接口中的查询所有员工的方法</strong></p>
<p>(1)创建com.tedu.test.TestMybatisInf类, 并提供testFindAll方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestMybatisInf</span> </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindAll</span> <span class="params">()</span> <span class="keyword">throws</span> Exception</span>&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>实现testFindAll方法并测试</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindAll</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="comment">//3.获取Mapper接口对象</span></span><br><span class="line">  EmpMapper map = session.getMapper(EmpMapper<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">  <span class="comment">//4.调用接口对象的方法进行查询</span></span><br><span class="line">  List&lt;Emp&gt; list = map.findAll();</span><br><span class="line">  <span class="comment">//5.输出结果</span></span><br><span class="line">  <span class="keyword">for</span> (Emp e : list) &#123;</span><br><span class="line">  	System.out.println(e);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="几个可以优化的地方"><a href="#几个可以优化的地方" class="headerlink" title="几个可以优化的地方"></a>几个可以优化的地方</h2><h3 id="加入log4j日志框架"><a href="#加入log4j日志框架" class="headerlink" title="加入log4j日志框架"></a>加入log4j日志框架</h3><p>在项目中加入log4j的配置文件，用于打印日志信息，便于开发调试。</p>
<p>在src（或相似的目录）下创建log4j.properties如下：</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Global logging configuration</span></span><br><span class="line"><span class="meta">log4j.rootLogger</span>=<span class="string">DEBUG, stdout</span></span><br><span class="line"><span class="comment"># Console output...</span></span><br><span class="line"><span class="meta">log4j.appender.stdout</span>=<span class="string">org.apache.log4j.ConsoleAppender</span></span><br><span class="line"><span class="meta">log4j.appender.stdout.layout</span>=<span class="string">org.apache.log4j.PatternLayout</span></span><br><span class="line"><span class="meta">log4j.appender.stdout.layout.ConversionPattern</span>=<span class="string">%5p [%t] - %m%n</span></span><br></pre></td></tr></table></figure>

<p>mybatis默认使用log4j作为输出日志信息。</p>
<p>只要将该文件放在指定的位置，log4j工具会自动到指定位置加载上述文件，读取文件中的配置信息并使用！</p>
<h3 id="SQL语句中的特殊符号"><a href="#SQL语句中的特殊符号" class="headerlink" title="SQL语句中的特殊符号"></a>SQL语句中的特殊符号</h3><p><strong>示例：添加一个查询功能：查询薪资小于3500的所有员工。</strong></p>
<p>1、编辑EmpMapper.xml文件, 添加查询对应的sql.</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 练习12: 根据薪资查询员工信息 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findBySal"</span> <span class="attr">resultType</span>=<span class="string">"com.tedu.pojo.Emp"</span>&gt;</span></span><br><span class="line">	select * from emp</span><br><span class="line">	where 2=2 </span><br><span class="line">	<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"minSal != null"</span>&gt;</span></span><br><span class="line">		and salary &gt;= #&#123;minSal&#125;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"maxSal != null"</span>&gt;</span></span><br><span class="line">		and salary <span class="tag">&lt;<span class="name">=</span> #&#123;<span class="attr">maxSal</span>&#125;</span></span><br><span class="line">	&lt;/if&gt;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>2、但在书写完后，xml文件提示有错误：</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200407172154514-eb86f89feeb547af8a44ee3e6c438920.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871178-584a65a0940df9728034f7df216dc7dc.png" alt="image-20200407172154514"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200407172154514-eb86f89feeb547af8a44ee3e6c438920.png" target="_blank" rel="noopener">image-20200407172154514</a></p>
<p>原来，小于号（&lt;）在xml文件中是特殊字符，被xml文件当成了标签的开始符号。</p>
<p>3、解决方法：可以使用 <code>&amp;lt;</code>代替 <code>&lt;</code>，例如：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findBySal"</span> <span class="attr">resultType</span>=<span class="string">"com.tedu.pojo.Emp"</span>&gt;</span></span><br><span class="line">	select * from emp</span><br><span class="line">	where 2=2 </span><br><span class="line">	<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"minSal != null"</span>&gt;</span></span><br><span class="line">		and salary &gt;= #&#123;minSal&#125;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"maxSal != null"</span>&gt;</span></span><br><span class="line">		and salary <span class="symbol">&amp;lt;</span>= #&#123;maxSal&#125;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>或者是将特殊符号包含在CDATA区（ ）中，这是因为放在CDATA区中的内容，只会被xml解析器当作普通文本来处理。而不是被当成标签的一部分处理。</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 查询薪资小于3500的所有员工 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findBySal"</span> <span class="attr">resultType</span>=<span class="string">"com.tedu.pojo.Emp"</span>&gt;</span></span><br><span class="line">	select * from emp</span><br><span class="line">	where 2=2 </span><br><span class="line">	<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"minSal != null"</span>&gt;</span></span><br><span class="line">		and salary &gt;= #&#123;minSal&#125;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"maxSal != null"</span>&gt;</span></span><br><span class="line">		and salary &lt;![CDATA[ &lt;= ]]&gt; #&#123;maxSal&#125;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="jdbc-properties文件"><a href="#jdbc-properties文件" class="headerlink" title="jdbc.properties文件"></a>jdbc.properties文件</h3><p>在开发中，通常我们会将连接数据库的配置信息单独放在一个properties文件中（方便管理和维护），<br>然后在MyBatis的mapper文件中引入properties文件的配置信息即可！</p>
<p><strong>1、在src目录下创建一个名称为jdbc.properties的文件</strong></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/c689eb39f8139c834ce014974d446229-bb4a05eb99f54138b3f31e9c58e3cf87.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871178-f27ee584566f3d30a1881384cb23508a.png" alt="c689eb39f8139c834ce014974d446229"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/c689eb39f8139c834ce014974d446229-bb4a05eb99f54138b3f31e9c58e3cf87.png" target="_blank" rel="noopener">c689eb39f8139c834ce014974d446229</a></p>
<p><strong>2、jdbc.properties文件内容如下:</strong></p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="meta">jdbc.driver</span>=<span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="meta">jdbc.url</span>=<span class="string">jdbc:mysql://localhost:3306/yonghedb?characterEncoding=utf-8</span></span><br><span class="line"><span class="meta">jdbc.username</span>=<span class="string">root</span></span><br><span class="line"><span class="meta">jdbc.password</span>=<span class="string">root</span></span><br></pre></td></tr></table></figure>

<p><strong>3、在mybatis-config.xml文件中引入jdbc.properties文件</strong></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/7f967dea070cc2df6038dc0a11fcfc7e-e103b441cfcf4b59a6e96c16b8505607.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871178-7d734ed869da75c5c76629886495ab53.png" alt="7f967dea070cc2df6038dc0a11fcfc7e"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/7f967dea070cc2df6038dc0a11fcfc7e-e103b441cfcf4b59a6e96c16b8505607.png" target="_blank" rel="noopener">7f967dea070cc2df6038dc0a11fcfc7e</a></p>
<p>1、其中 <code>&lt;properties resource=&quot;jdbc.properties&quot;/&gt;</code>标签用于引入jdbc.properties文件，默认到classpath即类目录下寻找指定的文件；</p>
<p>2、properties标签上value属性中配置的 $：</p>
<p><code>${jdbc.driver}</code>：其实就是jdbc.properties文件中的 jdbc.driver的值，即：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">com.mysql.jdbc.Driver</span><br></pre></td></tr></table></figure>

<p><code>${jdbc.url}</code>：其实就是jdbc.properties文件中的 jdbc.url的值，即：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">jdbc:mysql:&#x2F;&#x2F;localhost:3306&#x2F;mybatisdb?characterEncoding&#x3D;utf-8</span><br></pre></td></tr></table></figure>

<p><code>${jdbc.username}</code>：其实就是jdbc.properties文件中的 jdbc.username的值，即：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">root</span><br></pre></td></tr></table></figure>

<p><code>${jdbc.password}</code>：其实就是jdbc.properties文件中的 jdbc.password的值，即：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">root</span><br></pre></td></tr></table></figure>

<h2 id="扩展内容"><a href="#扩展内容" class="headerlink" title="扩展内容"></a>扩展内容</h2><h3 id="Jdbc回顾"><a href="#Jdbc回顾" class="headerlink" title="Jdbc回顾"></a>Jdbc回顾</h3><p><em>通过JDBC查询Emp表中的所有记录，并封装到一个List集合中返回</em></p>
<p><strong>1、创建TestJdbc类，完成查询所有员工：</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.tedu.jdbc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.DriverManager;</span><br><span class="line"><span class="keyword">import</span> java.sql.ResultSet;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"><span class="keyword">import</span> java.sql.Statement;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> com.tedu.pojo.Emp;</span><br><span class="line"><span class="comment">/** Jdbc回顾 */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestJdbc</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="comment">/* 查询emp表中的所有员工信息，将每个员工信息的封装到一个</span></span><br><span class="line"><span class="comment">		 * Emp对象中，再将封装了员工信息所有Emp对象存入List集合</span></span><br><span class="line"><span class="comment">		 * 中，并遍历输出所有的员工信息 </span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		List&lt;Emp&gt; empList = findAll();</span><br><span class="line">		<span class="keyword">for</span>(Emp emp : empList)&#123;</span><br><span class="line">			System.out.println(emp);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 查询emp表中的所有员工信息,封装到List集合并返回</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">static</span> List&lt;Emp&gt; <span class="title">findAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		Connection conn = <span class="keyword">null</span>;</span><br><span class="line">		Statement stat = <span class="keyword">null</span>;</span><br><span class="line">		ResultSet rs = <span class="keyword">null</span>;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="comment">//1.注册数据库驱动</span></span><br><span class="line">			Class.forName(<span class="string">"com.mysql.jdbc.Driver"</span>);</span><br><span class="line">			<span class="comment">//2.获取数据库连接(Connection)</span></span><br><span class="line">			conn = DriverManager.getConnection(</span><br><span class="line">					<span class="string">"jdbc:mysql:///yonghedb"</span>, </span><br><span class="line">					<span class="string">"root"</span>, <span class="string">"root"</span>);</span><br><span class="line">			<span class="comment">//3.获取传输器</span></span><br><span class="line">			stat = conn.createStatement();</span><br><span class="line">			<span class="comment">//4.利用传输器发送sql到数据库执行,并返回执行结果</span></span><br><span class="line">			String sql = <span class="string">"select * from emp"</span>;</span><br><span class="line">			rs = stat.executeQuery(sql);</span><br><span class="line">			<span class="comment">//5.处理结果</span></span><br><span class="line">			<span class="comment">//5.1.声明List集合,用于封装所有的员工信息</span></span><br><span class="line">			List&lt;Emp&gt; empList = <span class="keyword">new</span> ArrayList();</span><br><span class="line">			<span class="comment">//5.2.遍历ResultSet结果集</span></span><br><span class="line">			<span class="keyword">while</span>(rs.next()) &#123;</span><br><span class="line">				<span class="comment">//5.3.获取结果集中的每一条员工信息</span></span><br><span class="line">				<span class="keyword">int</span> id = rs.getInt(<span class="string">"id"</span>);</span><br><span class="line">				String name = rs.getString(<span class="string">"name"</span>);</span><br><span class="line">				String job = rs.getString(<span class="string">"job"</span>);</span><br><span class="line">				<span class="keyword">double</span> salary = rs.getDouble(<span class="string">"salary"</span>);</span><br><span class="line">				<span class="comment">//5.4.将每一条员工信息封装到一个Emp对象中</span></span><br><span class="line">				Emp emp = <span class="keyword">new</span> Emp();</span><br><span class="line">				emp.setId(id);</span><br><span class="line">				emp.setName(name);</span><br><span class="line">				emp.setJob(job);</span><br><span class="line">				emp.setSalary(salary);</span><br><span class="line">				<span class="comment">//5.5.将Emp对象存入List集合中</span></span><br><span class="line">				empList.add(emp);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">return</span> empList;</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">			System.out.println(<span class="string">"查询失败!"</span>);</span><br><span class="line">		&#125; <span class="keyword">finally</span>&#123;</span><br><span class="line">			<span class="comment">//6.释放资源</span></span><br><span class="line">			<span class="keyword">if</span>(rs != <span class="keyword">null</span>)&#123;</span><br><span class="line">				<span class="keyword">try</span> &#123;</span><br><span class="line">					rs.close();</span><br><span class="line">				&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">					e.printStackTrace();</span><br><span class="line">				&#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">					rs = <span class="keyword">null</span>;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span>(stat != <span class="keyword">null</span>)&#123;</span><br><span class="line">				<span class="keyword">try</span> &#123;</span><br><span class="line">					stat.close();</span><br><span class="line">				&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">					e.printStackTrace();</span><br><span class="line">				&#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">					stat = <span class="keyword">null</span>;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span>(conn != <span class="keyword">null</span>)&#123;</span><br><span class="line">				<span class="keyword">try</span> &#123;</span><br><span class="line">					conn.close();</span><br><span class="line">				&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">					e.printStackTrace();</span><br><span class="line">				&#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">					conn = <span class="keyword">null</span>;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>2、声明Emp实体类，用于封装员工信息：</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.tedu.pojo;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 实体类,用于封装Emp表中的一条用户信息</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Emp</span> </span>&#123;</span><br><span class="line">	<span class="comment">//1.声明实体类中的属性</span></span><br><span class="line">	<span class="keyword">private</span> Integer id;</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="keyword">private</span> String job;</span><br><span class="line">	<span class="keyword">private</span> Double salary;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//2.提供对应的getter和setter方法</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Integer <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> id;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.id = id;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.name = name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getJob</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> job;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setJob</span><span class="params">(String job)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.job = job;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Double <span class="title">getSalary</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> salary;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSalary</span><span class="params">(Double salary)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.salary = salary;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//3.重写toString方法</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"Emp [id="</span> + id + <span class="string">", name="</span> + name + <span class="string">", job="</span> + job + <span class="string">", salary="</span> + salary + <span class="string">"]"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="mybatis-config文件没有提示的解决办法"><a href="#mybatis-config文件没有提示的解决办法" class="headerlink" title="mybatis-config文件没有提示的解决办法"></a>mybatis-config文件没有提示的解决办法</h3><p>如果在没有网络(外网)的情况下，编写mybatis-config.xml文件没有提示，可以按照下面的步骤进行配置：</p>
<p>(1)找到mybatis-3-config.dtd的文件的位置，例如：</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/065e6b731aa74d5650821fdc63cbd4b9-a916b8fe6d80434da075b2c70213be5f.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871178-370d55e6e8b991ac89040032a7b32833.png" alt="065e6b731aa74d5650821fdc63cbd4b9"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/065e6b731aa74d5650821fdc63cbd4b9-a916b8fe6d80434da075b2c70213be5f.png" target="_blank" rel="noopener">065e6b731aa74d5650821fdc63cbd4b9</a></p>
<p>(2)复制下面的url地址：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;mybatis.org&#x2F;dtd&#x2F;mybatis-3-config.dtd</span><br></pre></td></tr></table></figure>

<p>(3)在eclipse菜单栏中: window –&gt; Preferences –&gt; 在搜索框中搜索 [ xml ] XML –&gt; XML Catalog –&gt; User Specified Entries –&gt; Add…</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/eef68594c0d7b072e09702b3d6289831-da6604b74ae942c9a0e27565879c55a6.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871178-c630c3dad6bade32ffb34594d1e1934b.png" alt="eef68594c0d7b072e09702b3d6289831"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/eef68594c0d7b072e09702b3d6289831-da6604b74ae942c9a0e27565879c55a6.png" target="_blank" rel="noopener">eef68594c0d7b072e09702b3d6289831</a></p>
<p>(4)在弹出的窗口中:</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/364a97a96fcb74e6ca14d4a9c8b89e6b-671989c3b2f2458db7b49fe32a23d85d.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871178-1c33bab8ff1f359f0bea91f65ced15b8.png" alt="364a97a96fcb74e6ca14d4a9c8b89e6b"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/364a97a96fcb74e6ca14d4a9c8b89e6b-671989c3b2f2458db7b49fe32a23d85d.png" target="_blank" rel="noopener">364a97a96fcb74e6ca14d4a9c8b89e6b</a></p>
<h3 id="Mapper文件没有提示的解决办法"><a href="#Mapper文件没有提示的解决办法" class="headerlink" title="Mapper文件没有提示的解决办法"></a>Mapper文件没有提示的解决办法</h3><p>如果在没有网络(外网)的情况下，编写XxxMapper.xml文件没有提示，可以按照下面的步骤进行配置：</p>
<p>(1)找到mybatis-3-mapper.dtd的文件的位置，例如：</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/50f2e9357bd4d42791f85098a75795c0-2a02d2ee0058408fbcef5d7c75df4838.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871178-85577d9508e29c05364cccc92fa1c6ac.png" alt="50f2e9357bd4d42791f85098a75795c0"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/50f2e9357bd4d42791f85098a75795c0-2a02d2ee0058408fbcef5d7c75df4838.png" target="_blank" rel="noopener">50f2e9357bd4d42791f85098a75795c0</a></p>
<p>(2)复制上面的url地址，即：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;mybatis.org&#x2F;dtd&#x2F;mybatis-3-mapper.dtd</span><br></pre></td></tr></table></figure>

<p>(3)在eclipse菜单栏中: window –&gt; Preferences –&gt; 在搜索框中搜索 [ xml ] XML –&gt; XML Catalog –&gt; User Specified Entries –&gt; Add…</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/eef68594c0d7b072e09702b3d6289831-da6604b74ae942c9a0e27565879c55a6.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871178-c630c3dad6bade32ffb34594d1e1934b.png" alt="eef68594c0d7b072e09702b3d6289831"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/eef68594c0d7b072e09702b3d6289831-da6604b74ae942c9a0e27565879c55a6.png" target="_blank" rel="noopener">eef68594c0d7b072e09702b3d6289831</a></p>
<p>(4)在弹出的窗口中:</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/e907b64d04d56389acba7c7e2f6bd74c-cba9037ad45f4a5ba191d984473736ed.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871178-68eadb9243ff12811b56bea1348cf8f5.png" alt="e907b64d04d56389acba7c7e2f6bd74c"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/e907b64d04d56389acba7c7e2f6bd74c-cba9037ad45f4a5ba191d984473736ed.png" target="_blank" rel="noopener">e907b64d04d56389acba7c7e2f6bd74c</a></p>
<h3 id="配置达内XML-Schema代理服务器"><a href="#配置达内XML-Schema代理服务器" class="headerlink" title="配置达内XML Schema代理服务器"></a>配置达内XML Schema代理服务器</h3><p>1、打开Eclipse的配置首选项</p>
<p>![<a href="http://doc.tedu.cn/img/1.png\](JAVAWEB-[![eb81455caf93624c289a4e60105b6aca](assets/1591871178-5431f18504a02a423ca84e597dd95e5a.png)](https://www.zhangpeng.fun/upload/2020/06/eb81455caf93624c289a4e60105b6aca-67e645a62bde49b28fcc2e35a2589c87.png)" target="_blank" rel="noopener">http://doc.tedu.cn/img/1.png\](JAVAWEB-[![eb81455caf93624c289a4e60105b6aca](assets/1591871178-5431f18504a02a423ca84e597dd95e5a.png)](https://www.zhangpeng.fun/upload/2020/06/eb81455caf93624c289a4e60105b6aca-67e645a62bde49b28fcc2e35a2589c87.png)</a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/eb81455caf93624c289a4e60105b6aca-67e645a62bde49b28fcc2e35a2589c87.png" target="_blank" rel="noopener">eb81455caf93624c289a4e60105b6aca</a></p>
<p>2、找到 XML -&gt; XML Catalog, 添加配置项目：</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/bf2d8978925006db94220c283a695f57-94054f0992804ea8bb0fddc0c21d042d.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871178-e26bbce57f51c702b09be41d0ef58ad3.png" alt="bf2d8978925006db94220c283a695f57"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/bf2d8978925006db94220c283a695f57-94054f0992804ea8bb0fddc0c21d042d.png" target="_blank" rel="noopener">bf2d8978925006db94220c283a695f57</a></p>
<p>3、添加URI代理配置, 比如：配置Spring Schema</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/7e5343736b72ca605ac7e577025ccd9e-65db6fe953154f3b9146fc5993c4fa9f.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871178-5f4d7d839dee52a92eef391b9adbfcb0.png" alt="7e5343736b72ca605ac7e577025ccd9e"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/7e5343736b72ca605ac7e577025ccd9e-65db6fe953154f3b9146fc5993c4fa9f.png" target="_blank" rel="noopener">7e5343736b72ca605ac7e577025ccd9e</a></p>
<p><strong>4、可以配置的代理有</strong></p>
<table>
<thead>
<tr>
<th></th>
<th><a href="http://ibatis.apache.org/" target="_blank" rel="noopener">http://ibatis.apache.org</a></th>
<th><a href="http://doc.tedu.cn/" target="_blank" rel="noopener">http://doc.tedu.cn</a></th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td><a href="http://www.springframework.org/" target="_blank" rel="noopener">http://www.springframework.org</a></td>
<td><a href="http://doc.tedu.cn/" target="_blank" rel="noopener">http://doc.tedu.cn</a></td>
</tr>
<tr>
<td></td>
<td><a href="http://mybatis.org/" target="_blank" rel="noopener">http://mybatis.org</a></td>
<td><a href="http://doc.tedu.cn/" target="_blank" rel="noopener">http://doc.tedu.cn</a></td>
</tr>
<tr>
<td></td>
<td><a href="http://hibernate.sourceforge.net/" target="_blank" rel="noopener">http://hibernate.sourceforge.net</a>, <a href="http://www.hibernate.org/" target="_blank" rel="noopener">http://www.hibernate.org</a></td>
<td><a href="http://doc.tedu.cn/" target="_blank" rel="noopener">http://doc.tedu.cn</a></td>
</tr>
<tr>
<td></td>
<td><a href="http://struts.apache.org/" target="_blank" rel="noopener">http://struts.apache.org</a></td>
<td><a href="http://doc.tedu.cn/" target="_blank" rel="noopener">http://doc.tedu.cn</a></td>
</tr>
</tbody></table>
<h1 id="mybatis-javaweb"><a href="#mybatis-javaweb" class="headerlink" title="mybatis   javaweb"></a><a href="https://www.zhangpeng.fun/tags/mybatis" target="_blank" rel="noopener">mybatis</a>   <a href="https://www.zhangpeng.fun/tags/javaweb" target="_blank" rel="noopener">javaweb</a></h1>]]></content>
      <categories>
        <category>JavaWeb</category>
      </categories>
      <tags>
        <tag>javaweb</tag>
        <tag>mybatis</tag>
      </tags>
  </entry>
  <entry>
    <title>13-spring框架</title>
    <url>/2020/06/11/13-spring%E6%A1%86%E6%9E%B6/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="13-spring框架"><a href="#13-spring框架" class="headerlink" title="13-spring框架"></a>13-spring框架</h1><h1 id="unit13-spring框架"><a href="#unit13-spring框架" class="headerlink" title="unit13-spring框架"></a>unit13-spring框架</h1><h2 id="spring简介"><a href="#spring简介" class="headerlink" title="spring简介"></a>spring简介</h2><h3 id="什么是Spring？"><a href="#什么是Spring？" class="headerlink" title="什么是Spring？"></a>什么是Spring？</h3><p>spring是分层的JavaSE及JavaEE应用于全栈的轻量级开源框架，以IoC（Inverse Of Control：控制反转/反转控制）和AOP（Aspact Oriented Programming：面向切面编程）为核心，提供了表现层SpringMVC和持久层Spring<br>JDBC以及业务层事务管理等众多模块的企业级应用技术，还能整合开源世界中众多著名的第三方框架和类库，逐渐成为使用最多的JavaEE企业应用开源框架。</p>
<p>SSH(struts2 spring hibernate)</p>
<p>SSM(springmvc spring mybatis)</p>
<p>Spring的本质是管理软件中的对象，即<strong>创建对象</strong>和<strong>维护对象之间的关系</strong></p>
<h3 id="Spring的发展历程"><a href="#Spring的发展历程" class="headerlink" title="Spring的发展历程"></a>Spring的发展历程</h3><p>1997 年 IBM提出了EJB 的思想</p>
<p>1998 年，SUN制定开发标准规范 EJB1.0</p>
<p>1999 年，EJB1.1 发布</p>
<p>2001 年，EJB2.0 发布</p>
<p>2003 年，EJB2.1 发布</p>
<p>2006 年，EJB3.0 发布</p>
<p><strong>Rod Johnson</strong> （罗德·约翰逊，spring 之父）</p>
<blockquote>
<p>Expert One-to-One J2EE Development without EJB(2004)</p>
<p>阐述了 J2EE 开发不使用 EJB的解决方式（Spring 雏形）</p>
</blockquote>
<p>2017年9月份发布了spring的最新版本<strong>spring 5.0</strong>通用版</p>
<h3 id="Spring的优势"><a href="#Spring的优势" class="headerlink" title="Spring的优势"></a>Spring的优势</h3><p><strong>1).方便解耦，简化开发</strong></p>
<p>通过 Spring提供的 IoC容器，可以将对象间的依赖关系交由Spring进行控制，避免硬编码所造成的过度程序耦合。用户也不必再为较为底层的需求编写代码，可以更专注于上层的应用。</p>
<p><strong>2).AOP 编程的支持</strong></p>
<p>通过 Spring的 AOP 功能，方便进行面向切面的编程，许多不容易用传统OOP（Object Oriented Programming：面向对象编程） 实现的功能可以通过 AOP 轻松应付。</p>
<p><strong>3).声明式事务的支持</strong></p>
<p>可以将我们从单调烦闷的事务管理代码中解脱出来，通过声明式方式灵活的进行事务的管理，提高开发效率和质量。</p>
<p><strong>4).方便程序的测试</strong></p>
<p>可以用非容器依赖的编程方式进行几乎所有的测试工作，测试不再是昂贵的操作，而是随手可做的事情。</p>
<p><strong>5).方便集成各种优秀框架</strong></p>
<p>Spring可以降低各种框架的使用难度，提供了对各种优秀框架（Struts、Hibernate、Hessian、Quartz等）的直接支持。</p>
<p><strong>6).降低 JavaEE API 的使用难度。</strong></p>
<p>Spring对 JavaEE API（如 JDBC、JavaMail、远程调用等）进行了薄薄的封装层，使这些API 的使用难度大为降低。</p>
<p><strong>7).Spring框架源码是经典学习范例</strong></p>
<p>Spring的源代码设计精妙、结构清晰、匠心独用，处处体现着大师对Java设计模式灵活运用以及对 Java技术的高深造诣。它的源代码无疑是Java技术的最佳实践的范例。</p>
<h3 id="spring的架构"><a href="#spring的架构" class="headerlink" title="spring的架构"></a>spring的架构</h3><p>Spring 最初的目标就是要整合一切优秀资源,然后对外提供一个统一的服务。Spring 模块构建在核心容器之上，核心容器定义了创建、配置和管理 bean 的方式，如下图所示：</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/bf0676465991176183ba7d0765728e57-d3f19206246c4d1aae6ee97834a1e32b.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871240-7066b832305efaa261bdc94d58e0c7b1.png" alt="bf0676465991176183ba7d0765728e57"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/bf0676465991176183ba7d0765728e57-d3f19206246c4d1aae6ee97834a1e32b.png" target="_blank" rel="noopener">bf0676465991176183ba7d0765728e57</a></p>
<p>组成 Spring 框架的每个模块（或组件）都可以单独存在，或者与其他一个或多个模块联合实现。每个模块的功能如下：</p>
<table>
<thead>
<tr>
<th></th>
<th>模块</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td>核心容器Spring Core</td>
<td>核心容器，提供Spring框架的基本功能。核心容器的主要组件是BeanFactory，它是工厂模式的实现。BeanFactory 使用控制反转（IOC）模式，将应用程序的配置和依赖性规范与实际的应用程序代码分开。</td>
</tr>
<tr>
<td></td>
<td>Spring Context</td>
<td>Spring上下文，是一个配置文件，向 Spring 框架提供上下文信息。Spring 上下文包括企业服务，例如 JNDI、EJB、电子邮件、国际化、校验和调度功能。</td>
</tr>
<tr>
<td></td>
<td>Spring AOP</td>
<td>通过配置管理特性，Spring AOP 模块直接将面向切面的编程功能集成到了 Spring 框架中。可以很容易地使 Spring框架管理的任何对象支持AOP。Spring AOP模块为基于 Spring 的应用程序中的对象提供了事务管理服务。通过使用 Spring AOP，就可以将声明性事务管理集成到应用程序中。</td>
</tr>
<tr>
<td></td>
<td>Spring DAO</td>
<td>JDBC DAO 抽象层提供了有意义的异常层次结构，可用该结构来管理异常处理和不同数据库供应商抛出的错误消息。异常层次结构简化了错误处理，并且极大地降低了需要编写的异常代码数量（例如打开和关闭连接）。Spring DAO 的面向 JDBC 的异常遵从通用的 DAO 异常层次结构。</td>
</tr>
<tr>
<td></td>
<td>Spring ORM</td>
<td>Spring 框架插入了若干个 ORM 框架，从而提供了 ORM 的对象关系工具，其中包括JDO、Hibernate和iBatis SQL Map。所有这些都遵从 Spring 的通用事务和 DAO 异常层次结构。</td>
</tr>
<tr>
<td></td>
<td>Spring Web</td>
<td>Web上下文模块建立在应用程序上下文模块之上，为基于 Web 的应用程序提供了上下文。所以Spring 框架支持与 Jakarta Struts的集成。Web模块还简化了处理多部分请求以及将请求参数绑定到域对象的工作。</td>
</tr>
<tr>
<td></td>
<td>Spring MVC框架</td>
<td>MVC 框架是一个全功能的构建 Web 应用程序的 MVC 实现。通过策略接口，MVC 框架变成为高度可配置的，MVC 容纳了大量视图技术，其中包括 JSP、Velocity、Tiles、iText 和 POI。</td>
</tr>
</tbody></table>
<h2 id="程序中的耦合和解耦"><a href="#程序中的耦合和解耦" class="headerlink" title="程序中的耦合和解耦"></a>程序中的耦合和解耦</h2><h3 id="什么是程序的耦合"><a href="#什么是程序的耦合" class="headerlink" title="什么是程序的耦合"></a>什么是程序的耦合</h3><p>耦合性(Coupling)，也叫耦合度，是对模块间关联程度的度量。耦合的强弱取决于模块间接口的复杂性、调用模块的方式以及通过界面传送数据的多少。模块间的耦合度是指模块之间的依赖关系，包括控制关系、调用关系、数据传递关系。<strong>模块间联系越多，其耦合性越强</strong>，同时表明其独立性越差（降低耦合性，可以提高其独立性）。耦合性存在于各个领域，而非软件设计中独有的，但是我们只讨论软件工程中的耦合。</p>
<p>总结：在软件工程中，<strong>耦合指的就是指对象之间的依赖关系。对象之间的依赖程度越高，耦合度就越高。对象之间的耦合越高，维护成本越高</strong>。因此对象的设计应使类和构件之间的耦合最小。</p>
<p>降低程序之间的依赖程度，即降低程序之间的耦合度的过程就叫做解耦。</p>
<p>例如：早期的Jdbc操作中，在注册数据库驱动时，为什么采用的是Class.forName的方式，而不是采用DriverManager.registerDriver的方式?</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestJdbc</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="comment">//1.注册数据库驱动</span></span><br><span class="line">    <span class="comment">// DriverManager.registerDriver( new Driver() );</span></span><br><span class="line">    Class.forName(<span class="string">"com.mysql.jdbc.Driver"</span>);</span><br><span class="line">    <span class="comment">//2.获取数据库连接</span></span><br><span class="line">    <span class="comment">//3.获取传输器</span></span><br><span class="line">    <span class="comment">//4.发送sql到服务器执行并返回执行结果</span></span><br><span class="line">    <span class="comment">//5.处理结果</span></span><br><span class="line">    <span class="comment">//6.释放资源</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>除了<code>DriverManager.registerDriver</code>会导致驱动注册两次外，更重要的是，如果使用这种方式，JDBC程序就会依赖于数据库的驱动类（MySQL的Driver类），如果后期程序因数据量和性能原因升级到Oracle数据库，就需要修改程序源代码——重新导入新的驱动类，这会增加很多不必要的麻烦！</p>
<p>而是用<code>Class.forName</code>方式注册驱动，这样的好处是Jdbc程序不再依赖具体的驱动类，即使删除（或不导入）mysql驱动包，程序依然可以编译（当然不可能运行，因为运行时肯定需要依赖驱动）。</p>
<p>此时类中仅仅是将mysql驱动类的全限定类名写死在程序中（只是一个字符串），可以将这个字符串提取到配置文件中，后期可以通过修改配置文件（而不用修改程序代码）轻松的替换数据库产品。</p>
<h3 id="工厂模式解耦介绍"><a href="#工厂模式解耦介绍" class="headerlink" title="工厂模式解耦介绍"></a>工厂模式解耦介绍</h3><p>在实际开发中可以将三层（表现层、业务层、持久层）的对象都使用配置文件配置起来，当启动服务器加载应用时，可以通过工厂读取配置文件，根据配置文件中的配置将这些对象创建出来，在接下来使用的时候，直接拿过来使用即可。</p>
<p>那么，这个负责读取配置文件，根据配置文件创建并返回这些对象的类就是工厂。</p>
<p>可以通过【工厂+接口+配置文件】的方式解除程序中的耦合。</p>
<h3 id="工厂模式解耦示例"><a href="#工厂模式解耦示例" class="headerlink" title="工厂模式解耦示例"></a>工厂模式解耦示例</h3><hr>
<p>解耦程序编写步骤：</p>
<hr>
<p>1、创建一个Maven的Java工程（day16-spring）</p>
<p>2、创建持久层接口和接口实现类</p>
<blockquote>
<p>com.tedu.dao.EmpDao （接口）</p>
</blockquote>
<blockquote>
<p>com.tedu.dao.EmpDaoImpl （实现类）</p>
</blockquote>
<p>3、创建业务层接口和接口实现类</p>
<blockquote>
<p>com.tedu.service.EmpService （接口）</p>
</blockquote>
<blockquote>
<p>com.tedu.service.EmpServiceImpl （实现类）</p>
</blockquote>
<p>4、创建表现层测试程序（com.tedu.controller.EmpController）并运行测试程序</p>
<p>5、通过工程+配置文件+接口（已有）方式解耦</p>
<blockquote>
<p>(1)创建工厂类（com.tedu.factory.BeanFactory）并实现</p>
</blockquote>
<blockquote>
<p>(2)提供配置文件，将service接口和dao接口的实现类的全限定类名编写到配置文件中。</p>
</blockquote>
<p>6、使用工厂获取service接口和dao接口的实例，替换使用new的方式获取接口的实例。</p>
<hr>
<p>详细代码如下：</p>
<hr>
<p><strong>1、创建持久层接口（com.tedu.dao.EmpDao）</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.tedu.dao;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 员工模块的Dao(持久层)接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">EmpDao</span> </span>&#123;</span><br><span class="line">	<span class="comment">/** 添加员工信息 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addEmp</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>2、创建持久层接口实现类（com.tedu.dao.EmpDaoImpl）</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.tedu.dao;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 员工模块的Dao(持久层)接口实现类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EmpDaoImpl</span> <span class="keyword">implements</span> <span class="title">EmpDao</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addEmp</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(</span><br><span class="line">			<span class="string">"Dao层的addEmp()方法执行了..成功保存了一条员工信息.."</span></span><br><span class="line">		);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>3、创建业务层接口（com.tedu.service.EmpService）</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.tedu.service;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 员工模块的service(业务层)接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">EmpService</span> </span>&#123;</span><br><span class="line">	<span class="comment">/** 添加员工信息 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addEmp</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>4、创建业务层接口实现类（com.tedu.service.EmpServiceImpl）</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.tedu.service;</span><br><span class="line"><span class="keyword">import</span> com.tedu.dao.EmpDao;</span><br><span class="line"><span class="keyword">import</span> com.tedu.dao.EmpDaoImpl;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 员工模块的service(业务层)接口实现类</span></span><br><span class="line"><span class="comment"> * service层 ---&gt; dao层</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EmpServiceImpl</span> <span class="keyword">implements</span> <span class="title">EmpService</span> </span>&#123;</span><br><span class="line">	<span class="comment">/* 获取Dao接口的子类实例</span></span><br><span class="line"><span class="comment">	 * ——这里使用new对象的方式造成了程序之间的耦合性提升 */</span></span><br><span class="line">	<span class="keyword">private</span> EmpDao dao = <span class="keyword">new</span> EmpDaoImpl();</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addEmp</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"调用dao层的方法添加员工信息..."</span>);</span><br><span class="line">		dao.addEmp();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>5、创建表现层测试类（com.tedu.controller.EmpController）</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.tedu.controller;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> com.tedu.service.EmpService;</span><br><span class="line"><span class="keyword">import</span> com.tedu.service.EmpServiceImpl;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 模拟表现层 </span></span><br><span class="line"><span class="comment"> * controller --&gt; service --&gt; dao</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EmpController</span> </span>&#123;</span><br><span class="line">	<span class="comment">/* 获取Service接口的子类实例</span></span><br><span class="line"><span class="comment">	 * ——这里使用new对象的方式造成了程序之间的耦合性提升 */</span></span><br><span class="line">	<span class="keyword">private</span> EmpService service = <span class="keyword">new</span> EmpServiceImpl();</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAddEmp</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"调用service层的方法添加员工信息..."</span>);</span><br><span class="line">		service.addEmp();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在上面的程序中，EmpController中要调用Service层的方法，所以通过new对象的形式获取了EmpService接口子类的实例，代码如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> EmpService service = <span class="keyword">new</span> EmpServiceImpl();</span><br></pre></td></tr></table></figure>

<p>在EmpService的实现类中要调用Dao层的方法，所以通过new对象的形式获取了EmpDao接口子类的实例，代码如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> EmpDao dao = <span class="keyword">new</span> EmpDaoImpl();</span><br></pre></td></tr></table></figure>

<p>如果在上面的程序中将EmpDaoImpl或者EmpServiceImpl移除，会导致其他类中的代码编译错误。此时表现层和业务层，及业务层和持久层之间的依赖程度过高，如果将来替换某一层，很可能会造成其他层无法运行，只能通过修改程序代码保证程序运行，这样依赖就会提高维护成本以及造成不必要的麻烦。</p>
<p>而在程序中new对象的方式造成了这种程序之间的依赖程度提升，即提升了程序之间的耦合性。</p>
<p>使用工厂+配置文件+接口解耦代码如下：</p>
<hr>
<p>6、创建com.tedu.factory.BeanFactory类，用于创建各个层所需要的对象。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.tedu.factory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ---------------------------------------------------------</span></span><br><span class="line"><span class="comment"> * Bean: 可重用组件(计算机英语)</span></span><br><span class="line"><span class="comment"> * JavaBean：使用Java语言编写的可重用组件，例如：service层、dao层等</span></span><br><span class="line"><span class="comment"> * JavaBean：通常分为业务Bean和实体Bean</span></span><br><span class="line"><span class="comment"> * 		业务Bean：处理业务逻辑，service层、dao层</span></span><br><span class="line"><span class="comment"> * 		实体Bean：封装数据，例如，为了封装员工信息而编写的Emp实体类.</span></span><br><span class="line"><span class="comment"> * ---------------------------------------------------------</span></span><br><span class="line"><span class="comment"> * 解除耦合:</span></span><br><span class="line"><span class="comment"> * (1)需要提供配置文件，在配置文件中配置service和dao的实现类</span></span><br><span class="line"><span class="comment"> * 		配置内容为：唯一标识=实现类的全限定类名（key=value结构）</span></span><br><span class="line"><span class="comment"> * (2)通过工厂读取配置文件中配置的全限定类名，利用反射创建对象。</span></span><br><span class="line"><span class="comment"> * 		xml配置文件、properties配置文件</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BeanFactory</span> </span>&#123;</span><br><span class="line">	<span class="comment">//声明一个Properties对象，在静态代码块中对其进行初始化</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> Properties prop;</span><br><span class="line">	<span class="keyword">static</span> &#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="comment">//为prop进行实例化</span></span><br><span class="line">			prop = <span class="keyword">new</span> Properties();</span><br><span class="line">			<span class="comment">//获取配置文件的流对象</span></span><br><span class="line">			InputStream in = BeanFactory<span class="class">.<span class="keyword">class</span>.<span class="title">getClassLoader</span>()</span></span><br><span class="line">					.getResourceAsStream("config.properties");</span><br><span class="line">			<span class="comment">//将配置文件中的内容读取到Properties对象中</span></span><br><span class="line">			prop.load( in );</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"初始化Properties对象失败!"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 根据config.xml文件中的key获取对应class类的实例</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> key </span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title">getBean</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">		Object bean = <span class="keyword">null</span>;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			String className = prop.getProperty( key );</span><br><span class="line">			bean = Class.forName(className).newInstance();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> bean;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>7、在源码目录下创建一个config.properties文件，文件内容配置如下：</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="attr">EmpService</span>=<span class="string">com.tedu.service.EmpServiceImpl</span></span><br><span class="line"><span class="attr">EmpDao</span>=<span class="string">com.tedu.dao.EmpDaoImpl</span></span><br></pre></td></tr></table></figure>

<p><strong>8、将EmpController类中通过 “new对象的形式获取了EmpService接口子类的实例” 以及在EmpServiceImpl类中通过 “new对象的形式获取了EmpDao接口子类的实例” 改为使用BeanFactory工厂获取Service和Dao层的实例。如下：</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* 获取Service接口的子类实例</span></span><br><span class="line"><span class="comment"> * ——这里使用new对象的方式造成了程序之间的耦合性提升 */</span></span><br><span class="line"><span class="comment">//private EmpService service = new EmpServiceImpl();</span></span><br><span class="line"><span class="keyword">private</span> EmpService service = (EmpService)BeanFactory.getBean(<span class="string">"EmpService"</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* 获取Dao接口的子类实例</span></span><br><span class="line"><span class="comment"> * ——这里使用new对象的方式造成了程序之间的耦合性提升 */</span></span><br><span class="line"><span class="comment">//private EmpDao dao = new EmpDaoImpl();</span></span><br><span class="line"><span class="keyword">private</span> EmpDao dao = (EmpDao)BeanFactory.getBean( <span class="string">"EmpDao"</span> );</span><br></pre></td></tr></table></figure>

<h2 id="Spring-IOC控制反转"><a href="#Spring-IOC控制反转" class="headerlink" title="Spring IOC控制反转"></a>Spring IOC控制反转</h2><h3 id="什么是控制反转"><a href="#什么是控制反转" class="headerlink" title="什么是控制反转"></a>什么是控制反转</h3><p><strong>IOC</strong>（Inverse Of Control）<strong>控制反转</strong>，即，把创建对象的权利交给框架。</p>
<p>也就是指将对象的创建、对象的存储、对象的管理交给了spring容器。</p>
<p>（spring容器是spring中的一个核心模块，用于管理对象，底层可以理解为是一个map集合）</p>
<hr>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/0a11c44a30f5a7328589e4031d624ffd-221f83a278544a97a475c1d85cbf89cb.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871240-60a3fc57832fc7d150a9a5655df6da9f.png" alt="0a11c44a30f5a7328589e4031d624ffd"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/0a11c44a30f5a7328589e4031d624ffd-221f83a278544a97a475c1d85cbf89cb.png" target="_blank" rel="noopener">0a11c44a30f5a7328589e4031d624ffd</a></p>
<hr>
<p>在此之前，当需要对象时，通常是利用new关键字创建一个对象：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* 获取Service接口的子类实例</span></span><br><span class="line"><span class="comment"> * ——这里使用new对象的方式造成了程序之间的耦合性提升 */</span></span><br><span class="line"><span class="keyword">private</span> EmpService service = <span class="keyword">new</span> EmpServiceImpl();</span><br><span class="line"><span class="comment">//private EmpService service = (EmpService)BeanFactory.getBean("EmpService");</span></span><br></pre></td></tr></table></figure>

<p>但由于new对象，会提高类和类之间的依赖关系，即代码之间的耦合性。</p>
<p>而现在我们可以将对象的创建交给框架来做：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* 获取Service接口的子类实例</span></span><br><span class="line"><span class="comment"> * ——这里使用new对象的方式造成了程序之间的耦合性提升 */</span></span><br><span class="line"><span class="comment">//private EmpService service = new EmpServiceImpl();</span></span><br><span class="line"><span class="keyword">private</span> EmpService service = (EmpService)BeanFactory.getBean(<span class="string">"EmpService"</span>);</span><br></pre></td></tr></table></figure>

<p>只需要将类提前配置在配置文件中，就可以将对象的创建交给框架来做。当需要对象时，不需要自己创建，而是通过框架直接获取即可，省去了new对象的过程，自然就降低类和类之间的依赖关系，也就是耦合性。</p>
<h2 id="IOC入门案例"><a href="#IOC入门案例" class="headerlink" title="IOC入门案例"></a>IOC入门案例</h2><p>下面将使用spring的IOC解决程序间的耦合</p>
<h3 id="创建工程，引入jar包"><a href="#创建工程，引入jar包" class="headerlink" title="创建工程，引入jar包"></a>创建工程，引入jar包</h3><p>创建Maven工程，引入spring相关依赖包</p>
<p>1、创建Maven—Java工程</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/e38fbdb8819178517de105a52e112a84-7c55b08b4c93490b8d3da570d8a8071b.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871240-169992d43c0087ef00bf01f5dec15959.png" alt="e38fbdb8819178517de105a52e112a84"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/e38fbdb8819178517de105a52e112a84-7c55b08b4c93490b8d3da570d8a8071b.png" target="_blank" rel="noopener">e38fbdb8819178517de105a52e112a84</a></p>
<p>2、引入junit、spring的jar包：在maven工程的pom.xml文件的根标签（project）内添加如下配置：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 添加junit的jar包 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">version</span>&gt;</span>4.10<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 添加spring的jar包 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">version</span>&gt;</span>4.1.3.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>导入后保存pom文件，项目如图所示：</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/ffe9287f31af4c4bf68f5d098b1d2039-60055999e39b4a1085039cf1e1e7a67d.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871240-6f4d339a5f47619e71c7dc0eb2a221c8.png" alt="ffe9287f31af4c4bf68f5d098b1d2039"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/ffe9287f31af4c4bf68f5d098b1d2039-60055999e39b4a1085039cf1e1e7a67d.png" target="_blank" rel="noopener">ffe9287f31af4c4bf68f5d098b1d2039</a></p>
<h3 id="创建spring配置文件"><a href="#创建spring配置文件" class="headerlink" title="创建spring配置文件"></a>创建spring配置文件</h3><p>创建spring核心配置文件—applicationContext.xml</p>
<p>1、在工程的src/main/resources源码目录下，创建applicationContext.xml文件:</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/3b521e8ba5d563ec21a2e142fa6cf623-6c3c460ed840496d826b08f14a49ba40.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871240-c2deb9bd3fc9dd01cc50678bd6420a89.png" alt="3b521e8ba5d563ec21a2e142fa6cf623"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/3b521e8ba5d563ec21a2e142fa6cf623-6c3c460ed840496d826b08f14a49ba40.png" target="_blank" rel="noopener">3b521e8ba5d563ec21a2e142fa6cf623</a></p>
<p>2、在applicationContext.xml中添加文件头信息：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans/spring-beans.xsd"</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>3、将EmpService接口的实现类的实例<br>以及EmpDao接口的实现类的实例交给Spring容器创建，在核心配置文件中添加如下配置：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans/spring-beans.xsd"</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 将EmpService接口的实现类的实例交给spring创建 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"empService"</span> <span class="attr">class</span>=<span class="string">"com.tedu.service.EmpServiceImpl"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 将EmpDao接口的实现类的实例交给spring创建 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"empDao"</span> <span class="attr">class</span>=<span class="string">"com.tedu.dao.EmpDaoImpl"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="创建测试类进行解耦"><a href="#创建测试类进行解耦" class="headerlink" title="创建测试类进行解耦"></a>创建测试类进行解耦</h3><p>创建测试类—TestSpring，通过spring的IOC解决程序中的耦合问题</p>
<p>1、创建测试类</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/30070bf2108c5dcd69ad97c00021d08b-d9c3b11f9a294efb901b3c31f13a6e8c.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871240-464256493fe46c4b4a9c58df93c0ebba.png" alt="30070bf2108c5dcd69ad97c00021d08b"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/30070bf2108c5dcd69ad97c00021d08b-d9c3b11f9a294efb901b3c31f13a6e8c.png" target="_blank" rel="noopener">30070bf2108c5dcd69ad97c00021d08b</a></p>
<p>2、测试步骤及代码如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestSpring</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 使用spring的IOC解决程序中的耦合问题</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testIOC</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">//获取spring的核心容器对象</span></span><br><span class="line">		ApplicationContext ac = </span><br><span class="line">				<span class="keyword">new</span> ClassPathXmlApplicationContext(</span><br><span class="line">						<span class="string">"applicationContext.xml"</span>);</span><br><span class="line">		<span class="comment">//通过spring的核心容器获取EmpService接口的子类实例</span></span><br><span class="line">		EmpService service = (EmpService) ac.getBean(<span class="string">"empService"</span>);</span><br><span class="line">		EmpDao dao = (EmpDao) ac.getBean(<span class="string">"empDao"</span>);</span><br><span class="line">		System.out.println( service );</span><br><span class="line">		System.out.println( dao );</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>3、运行结果：</strong></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/96cee091183ae525af0bf5314bf057c1-a8b7a70e13c040339333820a636b0734.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871240-f362f2684cec3acc9f8150bf61b45ca2.png" alt="96cee091183ae525af0bf5314bf057c1"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/96cee091183ae525af0bf5314bf057c1-a8b7a70e13c040339333820a636b0734.png" target="_blank" rel="noopener">96cee091183ae525af0bf5314bf057c1</a></p>
<p><strong>4、入门案例总结：</strong></p>
<p>这就是spring框架的IOC——控制反转。之前我们自己new对象，例如：</p>
<blockquote>
<p>User u = new User();</p>
</blockquote>
<p>而现在，变成由一个初始化的xml配置文件来创建，也就是由spring容器来创建。</p>
<blockquote>
<p>User user = (User) ac.getBean(“user”);</p>
</blockquote>
<p>当程序运行，spring开始工作后，会加载整个xml核心配置文件，读取到，获取到class属性中类的全路径，利用反射创建该类的对象。</p>
<h2 id="Bean对象的单例和多例"><a href="#Bean对象的单例和多例" class="headerlink" title="Bean对象的单例和多例"></a>Bean对象的单例和多例</h2><h3 id="Bean对象的单例和多例概述"><a href="#Bean对象的单例和多例概述" class="headerlink" title="Bean对象的单例和多例概述"></a>Bean对象的单例和多例概述</h3><p>在Spring容器中管理的Bean对象的作用域，可以通过<strong>scope属性</strong>或用相关注解指定其作用域。</p>
<p>最常用是singleton（单例）或prototype（多例）。其含义如下：</p>
<p><strong>1) singleton</strong>：单实例，是默认值。这个作用域标识的对象具备全局唯一性。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">当把一个 bean 定义设置scope为singleton作用域时，那么Spring IOC容器只会创建该bean定义的唯一实例。也就是说，整个Spring IOC容器中只会创建当前类的唯一一个对象。</span><br><span class="line">这个单一实例会被存储到单例缓存（singleton cache）中，并且所有针对该bean的后续请求和引用都 将返回被缓存的、唯一的这个对象实例。</span><br><span class="line">singleton负责对象的创建、初始化、销毁。</span><br></pre></td></tr></table></figure>

<p><strong>2) prototype</strong>：多实例。这个作用域标识的对象每次获取都会创建新的对象。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">当把一个 bean 定义设置scope为singleton作用域时，Spring IOC容器会在每一次获取当前Bean时，都会产生一个新的Bean实例（相当于new的操作）</span><br><span class="line">prototype只负责对象的创建和初始化，不负责销毁。</span><br></pre></td></tr></table></figure>

<h3 id="为什么用单实例或多实例？"><a href="#为什么用单实例或多实例？" class="headerlink" title="为什么用单实例或多实例？"></a>为什么用单实例或多实例？</h3><p>之所以用单实例，在没有线程安全问题的前提下，没必要每个请求都创建一个对象，这样子既浪费CPU又浪费内存；</p>
<p>之所以用多例，是为了防止并发问题；即一个请求改变了对象的状态(例如，可改变的成员变量)，此时对象又处理另一个请求，而之前请求对对象状态的改变导致了对象对另一个请求做了错误的处理；</p>
<p>用单例和多例的标准只有一个：当对象含有可改变的状态时（更精确的说就是在实际应用中该状态会改变），使用多实例，否则单实例；</p>
<p>在Spring中配置Bean实例是单例还是多例方法是：</p>
<p><strong>单例：</strong></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"user"</span> <span class="attr">scope</span>=<span class="string">"singleton"</span> <span class="attr">class</span>=<span class="string">"com.tedu.spring.User"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>多例：</strong></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"user"</span> <span class="attr">scope</span>=<span class="string">"prototype"</span> <span class="attr">class</span>=<span class="string">"com.tedu.spring.User"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="测试spring的单实例和多实例"><a href="#测试spring的单实例和多实例" class="headerlink" title="测试spring的单实例和多实例"></a>测试spring的单实例和多实例</h3><p>1、创建TestIOC2类，测试代码如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.tedu.spring;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestIOC2</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="comment">/* 通过spring容器创建创建User对象,</span></span><br><span class="line"><span class="comment">		 * 并调用User中的sayHi方法  */</span></span><br><span class="line">		<span class="comment">//1.加载spring的核心配置文件</span></span><br><span class="line">		ClassPathXmlApplicationContext ac = </span><br><span class="line">				<span class="keyword">new</span> ClassPathXmlApplicationContext(</span><br><span class="line">					<span class="string">"applicationContext.xml"</span></span><br><span class="line">				);</span><br><span class="line">		<span class="comment">//2.从spring容器中获取bean对象(而不是自己new)</span></span><br><span class="line">		User user1 = (User) ac.getBean(<span class="string">"user"</span>);</span><br><span class="line">		User user2 = (User) ac.getBean(<span class="string">"user"</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//3.测试</span></span><br><span class="line">		<span class="keyword">if</span>(user1 == user2)&#123;</span><br><span class="line">			System.out.println(<span class="string">"当前实例为单实例..."</span>);</span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			System.out.println(<span class="string">"当前实例为多实例..."</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3、将applicationContext.xml中，User类bean标签的scope值设置为singleton：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"user"</span> <span class="attr">scope</span>=<span class="string">"singleton"</span> <span class="attr">class</span>=<span class="string">"com.tedu.spring.User"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>运行TestIOC2，运行结果为：</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/4f79acd66228d70451ef21a27911d21b-d2f259825365438ebc7767a8b730f075.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871240-b46216bebe738c38171b3b04d40f45c4.png" alt="4f79acd66228d70451ef21a27911d21b"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/4f79acd66228d70451ef21a27911d21b-d2f259825365438ebc7767a8b730f075.png" target="_blank" rel="noopener">4f79acd66228d70451ef21a27911d21b</a></p>
<p>4、将applicationContext.xml中，User类bean标签的scope值修改为prototype</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"user"</span> <span class="attr">scope</span>=<span class="string">"prototype"</span> <span class="attr">class</span>=<span class="string">"com.tedu.spring.User"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>再次运行TestIOC2，运行结果为：</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/805f9db5f3eed078dc77876db32298ac-d73d5cb8b5fe4b68af3b56cebb6baab9.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871240-1c5e1f1a34f8ec215c5c1e6689422ab2.png" alt="805f9db5f3eed078dc77876db32298ac"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/805f9db5f3eed078dc77876db32298ac-d73d5cb8b5fe4b68af3b56cebb6baab9.png" target="_blank" rel="noopener">805f9db5f3eed078dc77876db32298ac</a></p>
<h2 id="Spring-DI依赖注入"><a href="#Spring-DI依赖注入" class="headerlink" title="Spring DI依赖注入"></a>Spring DI依赖注入</h2><h3 id="两种注入方式介绍"><a href="#两种注入方式介绍" class="headerlink" title="两种注入方式介绍"></a>两种注入方式介绍</h3><p>DI（Dependency Injection）依赖注入 。</p>
<p>依赖注入，即组件之间的依赖关系由容器在应用系统运行期来决定，也就是由容器动态地将某种依赖关系的目标对象实例注入到应用系统中的各个关联的组件之中。</p>
<hr>
<p>简单来说，所谓的依赖注入其实就是，在创建对象的同时或之后，如何给对象的属性赋值。</p>
<p>如果对象由我们自己创建，这一切都变得很简单，例如：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">User user = <span class="keyword">new</span> User();</span><br><span class="line">user.setName(<span class="string">"韩少云"</span>);</span><br><span class="line">user.setAge(<span class="number">18</span>);</span><br></pre></td></tr></table></figure>

<p>或者：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">User user = <span class="keyword">new</span> User(<span class="string">"韩少云"</span>, <span class="number">18</span>);</span><br></pre></td></tr></table></figure>

<p>如果对象由spring创建，那么spring是怎么给属性赋值的？spring提供两种方式为属性赋值：</p>
<p><strong>(1).Set方式注入</strong></p>
<p><strong>(2).构造方法注入</strong></p>
<h2 id="set方式注入"><a href="#set方式注入" class="headerlink" title="set方式注入"></a>set方式注入</h2><h3 id="普通属性注入"><a href="#普通属性注入" class="headerlink" title="普通属性注入"></a>普通属性注入</h3><p><strong>需求：通过Spring创建User实例，并为User实例的name和age属性（普通属性）赋值</strong></p>
<p><strong>1、创建User类，声明name和age属性，并添加对应的setter和getter方法，以及toString方法</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.tedu.spring;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="keyword">private</span> Integer age;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.name = name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Integer <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> age;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(Integer age)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.age = age;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"User [name="</span> + name + <span class="string">", age="</span> + age + <span class="string">"]"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>2、在applicationContext.xml中声明User类的bean实例</strong></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 声明User类的bean实例 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"user"</span> <span class="attr">class</span>=<span class="string">"com.tedu.spring.User"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>3、创建测试类—TestDI</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.tedu.spring;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestDI</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//1.加载applicationContext.xml核心配置文件</span></span><br><span class="line">		ClassPathXmlApplicationContext ac = </span><br><span class="line">				<span class="keyword">new</span> ClassPathXmlApplicationContext(</span><br><span class="line">					<span class="string">"applicationContext.xml"</span></span><br><span class="line">				);</span><br><span class="line">		<span class="comment">//2.获取User类的实例</span></span><br><span class="line">		User user = (User) ac.getBean(<span class="string">"user"</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//3.输出User实例</span></span><br><span class="line">		System.out.println( user );</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>由于这里没有为User对象的属性赋值，所以此时运行测试，结果为：</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/1175a00c572e203e5413862754583a75-16ec07d867134c9681bebc389d3e1cc6.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871240-67d749786e544695c59635d2286d614d.png" alt="1175a00c572e203e5413862754583a75"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/1175a00c572e203e5413862754583a75-16ec07d867134c9681bebc389d3e1cc6.png" target="_blank" rel="noopener">1175a00c572e203e5413862754583a75</a></p>
<p><strong>4、修改applicationContext.xml中User实例的声明，为User实例注入属性</strong></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 声明User类的bean实例 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"user"</span> <span class="attr">class</span>=<span class="string">"com.tedu.spring.User"</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 通过set方式为普通属性赋值 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">value</span>=<span class="string">"韩少云"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"age"</span> <span class="attr">value</span>=<span class="string">"20"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>其中name属性的值，必须要和User类中所注入属性对应的get方法的名字去掉get后首字母变为小写的名字相同。</p>
<p>例如：为 User类中的age属性赋值，由于name属性对应的get方法名字为getAge，当去调用get和首字母变为小写后的名称为age，因此为age属性注入的配置内容为：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"age"</span> <span class="attr">value</span>=<span class="string">"20"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>普通属性直接通过value注入即可。</p>
<p><strong>5、运行测试类TestDI，结果为：</strong></p>
<p>上面通过spring提供的set方式对User对象的属性进行了赋值赋值，所以此时运行测试，结果为：</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/abda0664c744fdef3e8ece4ea2db2a45-bb9ed6cbb939426988a9eb6c7452f755.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871240-e1d92925ce23e0b0f08de81de129414a.png" alt="abda0664c744fdef3e8ece4ea2db2a45"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/abda0664c744fdef3e8ece4ea2db2a45-bb9ed6cbb939426988a9eb6c7452f755.png" target="_blank" rel="noopener">abda0664c744fdef3e8ece4ea2db2a45</a></p>
<h3 id="对象属性注入"><a href="#对象属性注入" class="headerlink" title="对象属性注入"></a>对象属性注入</h3><p><strong>需求：通过Spring创建User实例，并为User对象的userInfo属性(对象属性)赋值</strong></p>
<p>1、创建UserInfo类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.tedu.spring;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserInfo</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2、在applicationContext.xml中，声明UserInfo类的bean实例</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 声明UserInfo类的bean实例 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"userInfo"</span> <span class="attr">class</span>=<span class="string">"com.tedu.spring.UserInfo"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>3、修改User类，声明userInfo属性，添加对应的setter和getter方法，并重新生成toString方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">	...</span><br><span class="line">	<span class="keyword">private</span> UserInfo userInfo;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> UserInfo <span class="title">getUserInfo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> userInfo;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUserInfo</span><span class="params">(UserInfo userInfo)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.userInfo = userInfo;</span><br><span class="line">	&#125;</span><br><span class="line">	...</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"User [name="</span> + name + <span class="string">", age="</span> + age + <span class="string">", userInfo="</span> + userInfo + <span class="string">"]"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>4、在applicationContext.xml中，将UserInfo对象作为值，赋值给User对象的userInfo属性</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 声明User类的bean实例 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"user"</span> <span class="attr">class</span>=<span class="string">"com.tedu.spring.User"</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 通过set方式为普通属性赋值 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">value</span>=<span class="string">"韩少云"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"age"</span> <span class="attr">value</span>=<span class="string">"20"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 通过set方式为对象属性赋值 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"userInfo"</span> <span class="attr">ref</span>=<span class="string">"userInfo"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>由于此处是将UserInfo对象作为值赋值给另一个对象的属性，因此ref属性的值，为UserInfo对象bean标签的id值。</p>
<p>对象属性通过ref属性注入。</p>
<p>5、运行测试类TestDI，结果为：</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/62c1243d1a13010db1a3c3cd8b116759-e72f4ccc2eff49359fbf0b715707f5c1.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871240-bf0ee0494328f791d153cb246546e1c1.png" alt="62c1243d1a13010db1a3c3cd8b116759"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/62c1243d1a13010db1a3c3cd8b116759-e72f4ccc2eff49359fbf0b715707f5c1.png" target="_blank" rel="noopener">62c1243d1a13010db1a3c3cd8b116759</a></p>
<h2 id="构造方法注入"><a href="#构造方法注入" class="headerlink" title="构造方法注入"></a>构造方法注入</h2><p><strong>需求：通过Spring创建User对象，并为User对象的属性（name、age、UserInfo属性）赋值</strong></p>
<p><strong>1、为User类声明构造函数</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//声明无参构造函数</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">()</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//声明有参构造函数</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">(String name, Integer age, UserInfo userInfo)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">super</span>();</span><br><span class="line">	<span class="keyword">this</span>.name = name;</span><br><span class="line">	<span class="keyword">this</span>.age = age;</span><br><span class="line">	<span class="keyword">this</span>.userInfo = userInfo;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>2、修改applicationContext.xml文件，将set方式修改为构造方法注入。</strong></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"user"</span> <span class="attr">class</span>=<span class="string">"com.tedu.spring.User"</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 通过set方式为普通属性赋值</span></span><br><span class="line"><span class="comment">	&lt;property name="name" value="韩少云"&gt;&lt;/property&gt;</span></span><br><span class="line"><span class="comment">	&lt;property name="age" value="20"&gt;&lt;/property&gt;</span></span><br><span class="line"><span class="comment">	&lt;property name="userInfo" ref="userInfo"&gt;&lt;/property&gt;</span></span><br><span class="line"><span class="comment">	 --&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 通过构造器中参数为属性赋值 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">value</span>=<span class="string">"马云"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"age"</span> <span class="attr">value</span>=<span class="string">"35"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"userInfo"</span> <span class="attr">ref</span>=<span class="string">"userInfo"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 声明UserInfo类的bean实例 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"userInfo"</span> <span class="attr">class</span>=<span class="string">"com.tedu.spring.UserInfo"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>其中，constructor-arg标签name属性的值必须和构造函数中参数的名字相同!</p>
<p>同样的，普通属性直接通过value注入即可；</p>
<p>对象属性通过ref属性注入。</p>
<p><strong>3、运行测试类TestDI，结果为：</strong></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/4b1ba956af8e1244bd1a30553f4fe6bf-a480c822140941cf8af5ca0ec3e70087.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871240-16edd43d95d677e71a90f665dffa50b4.png" alt="4b1ba956af8e1244bd1a30553f4fe6bf"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/4b1ba956af8e1244bd1a30553f4fe6bf-a480c822140941cf8af5ca0ec3e70087.png" target="_blank" rel="noopener">4b1ba956af8e1244bd1a30553f4fe6bf</a></p>
<h2 id="扩展内容"><a href="#扩展内容" class="headerlink" title="扩展内容"></a>扩展内容</h2><h3 id="applicationContext-xml没有提示的解决办法"><a href="#applicationContext-xml没有提示的解决办法" class="headerlink" title="applicationContext.xml没有提示的解决办法"></a>applicationContext.xml没有提示的解决办法</h3><p><strong>1、配置spring-beans-4.1.xsd文件</strong></p>
<p>(1)找到spring-beans-4.1.xsd的文件的位置，例如：</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/3526b8f7cb18db7def8c59c6b8f5a8c6-c1e23c7540a54f4b93593f86d5de0598.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871240-ac03239e9b4a83ff65dec7ddb794ffe6.png" alt="3526b8f7cb18db7def8c59c6b8f5a8c6"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/3526b8f7cb18db7def8c59c6b8f5a8c6-c1e23c7540a54f4b93593f86d5de0598.png" target="_blank" rel="noopener">3526b8f7cb18db7def8c59c6b8f5a8c6</a></p>
<p>(2)复制下面的url地址：</p>
<p><a href="http://www.springframework.org/schema/beans/spring-beans-4.0.xsd" target="_blank" rel="noopener">http://www.springframework.org/schema/beans/spring-beans-4.0.xsd</a></p>
<p>(3)在eclipse菜单栏中: window –&gt; Preferences –&gt; 在搜索框中搜索 [ xml ]</p>
<p>XML –&gt; XML Catalog –&gt; User Specified Entries –&gt; Add…</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/eef68594c0d7b072e09702b3d6289831-2abb2831056a467ea0e402114919ae7b.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871240-9da2d74788244d266b058b39bcf25b51.png" alt="eef68594c0d7b072e09702b3d6289831"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/eef68594c0d7b072e09702b3d6289831-2abb2831056a467ea0e402114919ae7b.png" target="_blank" rel="noopener">eef68594c0d7b072e09702b3d6289831</a></p>
<p>(4)在弹出的窗口中:</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/10a6f5e3901af4d2fd9cba0d644e00bd-567300686a1e4b2b8abb54e00c14927b.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871240-8a57d339be1440cfd3ac2a258e062648.png" alt="10a6f5e3901af4d2fd9cba0d644e00bd"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/10a6f5e3901af4d2fd9cba0d644e00bd-567300686a1e4b2b8abb54e00c14927b.png" target="_blank" rel="noopener">10a6f5e3901af4d2fd9cba0d644e00bd</a></p>
<p><strong>2、配置spring-context-4.1.xsd文件</strong></p>
<p>(1)找到spring-context-4.1.xsd的文件的位置，例如：</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/f88878c81816bfccdaf534b48ecbf37d-6e1f88beb10d460f93f2f8c7cb530fae.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871240-db52729fe354acd3f1f710c9b05158ce.png" alt="f88878c81816bfccdaf534b48ecbf37d"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/f88878c81816bfccdaf534b48ecbf37d-6e1f88beb10d460f93f2f8c7cb530fae.png" target="_blank" rel="noopener">f88878c81816bfccdaf534b48ecbf37d</a></p>
<p>(2)复制下面的url地址：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;www.springframework.org&#x2F;schema&#x2F;context&#x2F;spring-context-4.0.xsd</span><br></pre></td></tr></table></figure>

<p>(3)在eclipse菜单栏中: window –&gt; Preferences –&gt; 在搜索框中搜索 [ xml ] XML –&gt; XML Catalog –&gt; User Specified Entries –&gt; Add…</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/eef68594c0d7b072e09702b3d6289831-2abb2831056a467ea0e402114919ae7b.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871240-9da2d74788244d266b058b39bcf25b51.png" alt="eef68594c0d7b072e09702b3d6289831"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/eef68594c0d7b072e09702b3d6289831-2abb2831056a467ea0e402114919ae7b.png" target="_blank" rel="noopener">eef68594c0d7b072e09702b3d6289831</a></p>
<p>(4)在弹出的窗口中:</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/bab1eb1bf264e64de4a3672c96f23e8b-87ddf7fa6d4f4c9b89aaf2384ba1bfe2.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871240-61a9ed1c87f109e75bb05a89a2f73c12.png" alt="bab1eb1bf264e64de4a3672c96f23e8b"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/bab1eb1bf264e64de4a3672c96f23e8b-87ddf7fa6d4f4c9b89aaf2384ba1bfe2.png" target="_blank" rel="noopener">bab1eb1bf264e64de4a3672c96f23e8b</a></p>
<h1 id="spring-javaweb"><a href="#spring-javaweb" class="headerlink" title="spring    javaweb"></a><a href="https://www.zhangpeng.fun/tags/spring-" target="_blank" rel="noopener">spring</a>    <a href="https://www.zhangpeng.fun/tags/javaweb" target="_blank" rel="noopener">javaweb</a></h1>]]></content>
      <categories>
        <category>JavaWeb</category>
      </categories>
      <tags>
        <tag>javaweb</tag>
        <tag>spring</tag>
      </tags>
  </entry>
  <entry>
    <title>14-springmvc框架</title>
    <url>/2020/06/11/14-springmvc%E6%A1%86%E6%9E%B6/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="14-springmvc框架"><a href="#14-springmvc框架" class="headerlink" title="14-springmvc框架"></a>14-springmvc框架</h1><h1 id="unit14-springmvc框架"><a href="#unit14-springmvc框架" class="headerlink" title="unit14-springmvc框架"></a>unit14-springmvc框架</h1><h2 id="MVC设计模式"><a href="#MVC设计模式" class="headerlink" title="MVC设计模式"></a>MVC设计模式</h2><h3 id="什么是设计模式"><a href="#什么是设计模式" class="headerlink" title="什么是设计模式"></a>什么是设计模式</h3><p>设计模式（Design Pattern）是一套被反复使用、多数人知晓的、经过分类的、代码设计经验的总结。</p>
<p>使用设计模式的目的：为了代码可重用性、让代码更容易被他人理解、保证代码可靠性。</p>
<p>设计模式使代码编写真正工程化；</p>
<p>设计模式是软件工程的基石脉络，如同大厦的结构一样。</p>
<p>设计模式就是一种模子，经过多年实践锤炼形成一套行之有效的完成某个特定任务的步骤和方式。</p>
<p>例如：西凤酒的酿造过程，酿造工序，前后不能变，温差不能变，这样做就是好喝，稍微改动就变味道了。</p>
<p>再如，北京烤鸭，就是那样做，就是那些调料腌制，变量配比，味道口感就是不如人家。</p>
<h3 id="MVC设计模式-1"><a href="#MVC设计模式-1" class="headerlink" title="MVC设计模式"></a>MVC设计模式</h3><p>MVC设计模式是一种通用的软件编程思想</p>
<p>在MVC设计模式中认为, 任何软件都可以分为三部分组成：</p>
<p>(1)控制程序流转的控制器（<strong>Controller</strong>）</p>
<p>(2)封装数据处理数据的模型（<strong>Model</strong>）</p>
<p>(3)负责展示数据的视图（<strong>view</strong>）</p>
<p>并且在MVC设计思想中要求一个符合MVC设计思想的软件应该保证上面这三部分相互独立，互不干扰，每一个部分只负责自己擅长的部分。</p>
<p>如果某一个模块发生变化，应该尽量做到不影响其他两个模块。这样做的好处是，软件的结构会变得更加的清晰，可读性强。有利于后期的扩展和维护，并且代码可以实现复用。</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/20e60e831a34d3a4a68805e386aa1779-8fa3ff93261c49cb9f4a0c0e2c6a9c89.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871282-f2a1029f89277d189d598d1a3351a6e0.png" alt="20e60e831a34d3a4a68805e386aa1779"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/20e60e831a34d3a4a68805e386aa1779-8fa3ff93261c49cb9f4a0c0e2c6a9c89.png" target="_blank" rel="noopener">20e60e831a34d3a4a68805e386aa1779</a></p>
<h2 id="初识SpringMVC"><a href="#初识SpringMVC" class="headerlink" title="初识SpringMVC"></a>初识SpringMVC</h2><h3 id="Servlet的缺点"><a href="#Servlet的缺点" class="headerlink" title="Servlet的缺点"></a>Servlet的缺点</h3><p>1、通常情况下，一个Servlet类只负责处理一个请求，若项目中有成百上千个请求需要处理，就需要有成百上千个Servlet类，这样会使得项目中Servlet类的个数暴增；</p>
<p>2、在Servlet3.0版本之前，每一个Servlet都需要在web.xml文件中至少做八行配置信息，配置内容多且繁琐。当Servlet特别多时，web.xml配置量太多，不利于团队开发；</p>
<p>3、当通过客户端提交参数到服务器，通过Servlet进行接收时，无论数据本身是什么格式，在Servlet中一律按照字符串进行接收，后期需要进行类型转换，复杂类型还需要特殊处理，特别麻烦！</p>
<p><code>String value = request.getParameter(String name);</code></p>
<p>4、servlet具有容器依赖性，必须放在服务器中运行，不利于单元测试；</p>
<p>…</p>
<h3 id="SpringMVC简介"><a href="#SpringMVC简介" class="headerlink" title="SpringMVC简介"></a>SpringMVC简介</h3><p>Springmvc是spring框架的一个模块，spring和springmvc无需中间整合层整合</p>
<p>Springmvc是一个基于mvc的web框架</p>
<h3 id="spring执行原理"><a href="#spring执行原理" class="headerlink" title="spring执行原理"></a>spring执行原理</h3><p><a href="https://www.zhangpeng.fun/upload/2020/06/14c0c2f53620fb0e29c11170729226f0-538d782aedbf4211884c882e14452a89.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871282-30637a43c8bd13b1a4158087ee462ebe.png" alt="14c0c2f53620fb0e29c11170729226f0"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/14c0c2f53620fb0e29c11170729226f0-538d782aedbf4211884c882e14452a89.png" target="_blank" rel="noopener">14c0c2f53620fb0e29c11170729226f0</a></p>
<p><code>(1)</code>.用户发送请求 至 前端控制器(DispatcherServlet)；</p>
<p>提示：DispatcherServlet的作用：接收请求，调用其它组件处理请求，响应结果，相当于转发器、中央处理器，是整个流程控制的中心</p>
<p><code>(2)</code>.前端控制器(DispatcherServlet)收到请求后调用处理器映射器(HandlerMapping)</p>
<p>处理器映射器(HandlerMapping)找到具体的Controller(可以根据xml配置、注解进行查找)，并将Controller返回给DispatcherServlet；</p>
<p><code>(3)</code>.前端控制器(DispatcherServlet)调用处理器适配器(HandlerAdapter)。处理器适配器经过适配调用具体的Controller；(Controller–&gt; service –&gt; Dao –&gt; 数据库)</p>
<p>Controller执行完成后返回ModelAndView，</p>
<p>提示：Model(模型数据，即Controller处理的结果，Map) View(逻辑视图名，即负责展示结果的JSP页面的名字)</p>
<p>处理器适配器(HandlerAdapter)将controller执行的结果(ModelAndView)返回给前端控制器(DispatcherServlet)；</p>
<p><code>(4)</code>.前端控制器(DispatcherServlet)将执行的结果(ModelAndView)传给视图解析器(ViewReslover)</p>
<p>视图解析器(ViewReslover)根据View(逻辑视图名)解析后返回具体JSP页面</p>
<p><code>(5)</code>.前端控制器(DispatcherServlet)根据Model对View进行渲染（即将模型数据填充至视图中）；</p>
<p>前端控制器(DispatcherServlet)将填充了数据的网页响应给用户。</p>
<p>其中整个过程中需要开发人员编写的部分有<strong>Controller</strong>、<strong>Service</strong>、<strong>Dao</strong>、<strong>View；</strong></p>
<h2 id="springmvc入门案例"><a href="#springmvc入门案例" class="headerlink" title="springmvc入门案例"></a>springmvc入门案例</h2><p><strong>需求：</strong></p>
<p>(1)通过浏览器访问 <code>http://localhost/项目名称/hello</code> 地址，在控制台输出 “hello springmvc”</p>
<p>(2)将请求转向（跳转到） <code>/WEB-INF/pages/home.jsp</code> 页面</p>
<h3 id="创建Maven—web工程"><a href="#创建Maven—web工程" class="headerlink" title="创建Maven—web工程"></a>创建Maven—web工程</h3><p><strong>1、通过Maven创建web工程</strong></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200410140300719-6e66072b3b254abd9a1fd24645f05b73.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871282-e70576f4af6be4def179a56ff597d2dd.png" alt="image-20200410140300719"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200410140300719-6e66072b3b254abd9a1fd24645f05b73.png" target="_blank" rel="noopener">image-20200410140300719</a></p>
<p><strong>2、在pom.xml中引入springmvc所需jar包</strong>：将下面的配置直接拷贝到pom.xml中的根标签内</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 单元测试 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">version</span>&gt;</span>4.10<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- SpringMVC的jar包 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-webmvc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">version</span>&gt;</span>4.1.3.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- servlet 和 jsp的jar包 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jsp-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- java对象转换json的工具类 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-databind<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">version</span>&gt;</span>2.5.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="在web-xml中配置前端控制器"><a href="#在web-xml中配置前端控制器" class="headerlink" title="在web.xml中配置前端控制器"></a>在web.xml中配置前端控制器</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns</span>=<span class="string">"http://java.sun.com/xml/ns/javaee"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">"http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">id</span>=<span class="string">"WebApp_ID"</span> <span class="attr">version</span>=<span class="string">"2.5"</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 配置springmvc前端控制器, 将所有请求交给springmvc来处理 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>springmvc<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">		</span><br><span class="line">		<span class="comment">&lt;!-- 配置springmvc核心配置文件的位置，默认Springmvc的配置文件是在WEB-INF目录下，默认的名字为springmvc-servlet.xml，如果要放在其他目录，则需要指定如下配置：</span></span><br><span class="line"><span class="comment">		--&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:springmvc-config.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">init-param</span>&gt;</span>		</span><br><span class="line">	<span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 其中的斜杠（/）表示拦截所有请求（除JSP以外）, 所有请求都要经过springmvc前端控制器 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>springmvc<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="创建并配置springmvc-config-xml"><a href="#创建并配置springmvc-config-xml" class="headerlink" title="创建并配置springmvc-config.xml"></a>创建并配置springmvc-config.xml</h3><p>直接复制下面配置文件的内容即可！</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xmlns:mvc</span>=<span class="string">"http://www.springframework.org/schema/mvc"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/mvc</span></span></span><br><span class="line"><span class="tag"><span class="string">						http://www.springframework.org/schema/mvc/spring-mvc-4.0.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">						http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">						http://www.springframework.org/schema/beans/spring-beans-4.0.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">						http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">          				http://www.springframework.org/schema/context/spring-context-4.0.xsd"</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 1.配置前端控制器放行静态资源(html/css/js等，否则静态资源将无法访问) --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">mvc:default-servlet-handler</span>/&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 2.配置注解驱动，用于识别注解（比如@Controller） --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">mvc:annotation-driven</span>&gt;</span><span class="tag">&lt;/<span class="name">mvc:annotation-driven</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 3.配置需要扫描的包：spring自动去扫描 base-package 下的类，</span></span><br><span class="line"><span class="comment">		如果扫描到的类上有 @Controller、@Service、@Component等注解，</span></span><br><span class="line"><span class="comment">		将会自动将类注册为bean </span></span><br><span class="line"><span class="comment">	 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.tedu.controller"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 4.配置内部资源视图解析器</span></span><br><span class="line"><span class="comment">		prefix:配置路径前缀</span></span><br><span class="line"><span class="comment">		suffix:配置文件后缀</span></span><br><span class="line"><span class="comment">	 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.view.InternalResourceViewResolver"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"prefix"</span> <span class="attr">value</span>=<span class="string">"/WEB-INF/pages/"</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"suffix"</span> <span class="attr">value</span>=<span class="string">".jsp"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="创建并实现HelloController类"><a href="#创建并实现HelloController类" class="headerlink" title="创建并实现HelloController类"></a>创建并实现HelloController类</h3><p>1、创建com.tedu.controller.HelloController类</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200411120818696-f7d9e3c7def24f588bfbc480e66c789a.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871282-e45fe176815c39e440df078922ef67a2.png" alt="image-20200411120818696"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200411120818696-f7d9e3c7def24f588bfbc480e66c789a.png" target="_blank" rel="noopener">image-20200411120818696</a></p>
<p>2、实现HelloController类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.tedu.controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* @Controller作用: 表示当前类属于controller层</span></span><br><span class="line"><span class="comment"> * 	同时标识将当前类的对象的创建交给spring容器负责</span></span><br><span class="line"><span class="comment"> * 	http://localhost/day16-springmvc/hello</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloController</span> </span>&#123;</span><br><span class="line">	<span class="comment">/* @RequestMapping("/hello") 用于配置当前方法的访问路径，不能省略，且不能重复！</span></span><br><span class="line"><span class="comment">	 * @RequestMapping注解在当前方法上声明的访问路径, 在当前controller类中不能重复！</span></span><br><span class="line"><span class="comment">	 * 如果controller类上没有访问路径，当前方法上的访问路径在所有controller类中都不能重复！</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@RequestMapping</span>(<span class="string">"/hello"</span>) </span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">testHello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println( <span class="string">"hello springmvc...."</span> );</span><br><span class="line">		<span class="comment">//跳转到哪一个路径	/WEB-INF/pages/home.jsp</span></span><br><span class="line">		<span class="keyword">return</span> <span class="string">"home"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="创建并实现home-jsp"><a href="#创建并实现home-jsp" class="headerlink" title="创建并实现home.jsp"></a>创建并实现home.jsp</h3><p>在WEB-INF/pages/目录下，创建home.jsp页面。</p>
<p><strong>WEB-INF/pages/home.jsp</strong></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">page</span> <span class="attr">pageEncoding</span>=<span class="string">"UTF-8"</span>%&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">h1</span>&gt;</span>day16-springmvc...home.jsp....<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="访问测试"><a href="#访问测试" class="headerlink" title="访问测试"></a>访问测试</h3><p>打开浏览器，输入url地址：<a href="http://localhost/day16-springmv/hello" target="_blank" rel="noopener">http://localhost/day16-springmv/hello</a> 地址，访问结果如下：</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200411120516046-6d83f83ba59c4d99b06214d826d2c94a.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871282-56f65bacc7467b41fa4824a7bcd73d61.png" alt="image-20200411120516046"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200411120516046-6d83f83ba59c4d99b06214d826d2c94a.png" target="_blank" rel="noopener">image-20200411120516046</a></p>
<h2 id="springmvc参数绑定"><a href="#springmvc参数绑定" class="headerlink" title="springmvc参数绑定"></a>springmvc参数绑定</h2><p>当项目中引入springmvc框架后，所有的请求流转将由springmvc进行控制，当客户端发送的请求中包含数据（也就是请求参数）时，那么该如何在controller层获取这些参数呢？</p>
<p>springmvc会自动的将请求中包含的参数和方法的参数进行匹配，也就是说只要保证，请求中的参数名称和方法中的参数名称相对应（另，参数的格式也要正确），在方法中就可以使用这些参数—即请求中的参数。</p>
<h3 id="基本类型参数绑定"><a href="#基本类型参数绑定" class="headerlink" title="基本类型参数绑定"></a>基本类型参数绑定</h3><p>当需要获取客户端发送过来的少量数据时，可以在Controller中声明的方法上，通过声明方法参数对这些参数一个一个进行接收，具体示例如下：</p>
<p><strong>需求：通过浏览器发请求访问Controller，并在请求中携带name、age数据访问服务器，在服务器端的<br>Controller中获取这些数据。</strong></p>
<p>1、在HelloController类中添加testParam1方法，用于接收基本类型的参数，代码实现如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.tedu.controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span> <span class="comment">/* 这个注解表示当前类是属于控制层 */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloController</span> </span>&#123;</span><br><span class="line">	<span class="comment">/* 1、测试springmvc的简单类型参数绑定</span></span><br><span class="line"><span class="comment">	 * ../testParam1?name=张飞&amp;age=20&amp;addr=河北</span></span><br><span class="line"><span class="comment">	 * 如何获取请求中name、age、addr的参数值？</span></span><br><span class="line"><span class="comment">	 * 	request.getParameter("name") -- 张飞</span></span><br><span class="line"><span class="comment">	 * 在方法上添加三个同类型、同名的形参分别为 name、age、addr</span></span><br><span class="line"><span class="comment">	 * 用于接收请求中name、age、addr参数的值  */</span></span><br><span class="line">	<span class="meta">@RequestMapping</span>(<span class="string">"/testParam1"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">testParam1</span><span class="params">(String name, Integer age, String addr)</span> </span>&#123;</span><br><span class="line">		System.out.println( <span class="string">"name="</span>+name );</span><br><span class="line">		System.out.println( <span class="string">"age="</span>+age );</span><br><span class="line">		System.out.println( <span class="string">"addr="</span>+addr );</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"home"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2、访问HelloController中的testParam1方法，在访问时，注意将name、age、addr参数一起发送给服务器:</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200411121233000-10d240d6c7e24a9f93e357baeaa7c7f3.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871282-1658f5db1f0b6b250d841b77f5c59518.png" alt="image-20200411121233000"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200411121233000-10d240d6c7e24a9f93e357baeaa7c7f3.png" target="_blank" rel="noopener">image-20200411121233000</a></p>
<p>控制台输出结果为：</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200411121322974-1193a05b4f86423c86d823208e206495.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871282-aa251f0d93dc2dc20f0881f7f1d05dc5.png" alt="image-20200411121322974"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200411121322974-1193a05b4f86423c86d823208e206495.png" target="_blank" rel="noopener">image-20200411121322974</a></p>
<h3 id="包装类型参数绑定"><a href="#包装类型参数绑定" class="headerlink" title="包装类型参数绑定"></a>包装类型参数绑定</h3><p>当需要获取客户端发送过来的多个数据时，可以在Controller中声明的方法上，通过声明方法参数对这些数据一个一个进行接收较麻烦，可以在方法上声明对象类型的参数，通过对这些数据统一进行接受，springmvc会自动将接收过来的参数封装在对象中，具体示例如下：</p>
<p>1、在HelloController类中添加param2方法，用于接收对象类型的参数，代码实现如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.tedu.controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span> <span class="comment">/* 这个注解表示当前类是属于控制层 */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloController</span> </span>&#123;</span><br><span class="line">	<span class="comment">/* 2、测试springmvc的包装类型参数绑定</span></span><br><span class="line"><span class="comment">	 * ../testParam2?name=关羽&amp;age=30&amp;addr=北京</span></span><br><span class="line"><span class="comment">	 * 如何获取请求中name、age、addr的参数值？</span></span><br><span class="line"><span class="comment">	 * 提供一个User类,在类中添加和请求参数同名的属性</span></span><br><span class="line"><span class="comment">	 * 底层通过调用setName、setAge、setAddr方法将参数值封装到User对象中 */</span></span><br><span class="line">	<span class="meta">@RequestMapping</span>(<span class="string">"/testParam2"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">testParam2</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">		System.out.println( <span class="string">"user.name="</span>+user.getName() );</span><br><span class="line">		System.out.println( <span class="string">"user.age="</span>+user.getAge() );</span><br><span class="line">		System.out.println( <span class="string">"user.addr="</span>+user.getAddr() );</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"home"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3、创建User类，声明name、age、addr属性，提供对应的set和get方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.tedu.pojo;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 封装用户信息</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="keyword">private</span> Integer age;</span><br><span class="line">	<span class="keyword">private</span> String addr;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">()</span> </span>&#123;&#125; <span class="comment">//无参构造函数</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">(String name, Integer age, String addr)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>();</span><br><span class="line">		<span class="keyword">this</span>.name = name;</span><br><span class="line">		<span class="keyword">this</span>.age = age;</span><br><span class="line">		<span class="keyword">this</span>.addr = addr;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//get、set方法</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.name = name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Integer <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> age;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(Integer age)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.age = age;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getAddr</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> addr;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAddr</span><span class="params">(String addr)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.addr = addr;</span><br><span class="line">	&#125;	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>4、访问HelloController中的param2方法，在访问时，注意将name和age参数一起发送给服务器:</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200411125305873-4802569ff4bd496ca4c640a1f03b80d6.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871282-cea84568f2cbba98f9e8527b62eb9da4.png" alt="image-20200411125305873"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200411125305873-4802569ff4bd496ca4c640a1f03b80d6.png" target="_blank" rel="noopener">image-20200411125305873</a></p>
<p>控制台输出结果为：</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200411125340557-3985177bee224b439cefcb867f34f4c0.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871282-c52609126e62d45a11ce2811bf196387.png" alt="image-20200411125340557"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200411125340557-3985177bee224b439cefcb867f34f4c0.png" target="_blank" rel="noopener">image-20200411125340557</a></p>
<h3 id="日期类型参数绑定"><a href="#日期类型参数绑定" class="headerlink" title="日期类型参数绑定"></a>日期类型参数绑定</h3><p>1、在HelloController类中添加testParam3方法，代码实现如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Controller</span> <span class="comment">/* 这个注解表示当前类是属于控制层 */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloController</span> </span>&#123;	</span><br><span class="line">	<span class="comment">/* 3、测试springmvc的日期类型参数绑定</span></span><br><span class="line"><span class="comment">	 * ../testParam3?date=2020-4-10 16:40:39	报400错误,表示参数类型不匹配</span></span><br><span class="line"><span class="comment">	 * ../testParam3?date=2020/4/10 16:40:39</span></span><br><span class="line"><span class="comment">	 * 	如何获取请求中date参数的值？</span></span><br><span class="line"><span class="comment">	 * 	springmvc默认是以斜杠接收日期类型的参数, 如果提交的日期就是以斜杠</span></span><br><span class="line"><span class="comment">	 * 	分隔的, springmvc就可以接收这个日期类型的参数, 否则将无法接收</span></span><br><span class="line"><span class="comment">	 * 	如果提交的日期参数就是以横杠分隔, 也可以修改springmvc默认的接收格式</span></span><br><span class="line"><span class="comment">	 * 	改为以横杠分隔!!</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@RequestMapping</span>(<span class="string">"/testParam3"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">testParam3</span><span class="params">(Date date)</span> </span>&#123;</span><br><span class="line">		System.out.println( <span class="string">"date="</span>+date );</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"home"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2、访问HelloController中的testParam3方法，在访问时，注意将date参数一起发送给服务器:</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200410165200699-49c00d44e2d244a2bd6f45b233860360.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871282-d8d1b93df478014439abf4448acd6d80.png" alt="image-20200410165200699"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200410165200699-49c00d44e2d244a2bd6f45b233860360.png" target="_blank" rel="noopener">image-20200410165200699</a></p>
<p>控制台输出结果为：</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200410165311287-8bb4e105ea42415f84aeaaf4cfae1f80.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871282-84fac5addd6f626d994b3841b297dc45.png" alt="image-20200410165311287"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200410165311287-8bb4e105ea42415f84aeaaf4cfae1f80.png" target="_blank" rel="noopener">image-20200410165311287</a></p>
<p><strong>常见问题：</strong></p>
<p>1、当访问HelloController中的testParam3方法，如果传递给服务器的日期数据是如下格式：</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200410165410638-dfa2a240c82947c4a6bbbbbe4af4b168.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871282-0ae0ab066ee57186c59d1adb1cb5ba9a.png" alt="image-20200410165410638"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200410165410638-dfa2a240c82947c4a6bbbbbe4af4b168.png" target="_blank" rel="noopener">image-20200410165410638</a></p>
<p>从图中可以看出，如果日期参数是 yyyy-MM-dd格式（以横杠分隔）就会出现400错误，其实是因为参数格式匹配错误，由于springmvc默认的日期格式是yyyy/MM/dd（以斜杠分隔），因此如果日期参数不是yyyy/MM/dd 格式，就会出现400错误！！</p>
<p><strong>2、解决方案：</strong></p>
<p>在springmvc中，提供了@InitBinder注解，用于指定自定义的日期转换格式，因此，我们只需要在Controller类中添加下面的代码即可，在接受日期类型的参数时，会自动按照自定义的日期格式进行转换。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* 自定义日期格式转换器</span></span><br><span class="line"><span class="comment"> * 将springmvc默认以斜杠(/)分隔日期改为以横杠分隔(-)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@InitBinder</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">InitBinder</span> <span class="params">(ServletRequestDataBinder binder)</span></span>&#123;</span><br><span class="line">	binder.registerCustomEditor(java.util.Date<span class="class">.<span class="keyword">class</span>, </span></span><br><span class="line">		new CustomDateEditor(new SimpleDateFormat("yyyy-MM-dd HH:mm:ss"), true)</span><br><span class="line">	);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3、再次测试：</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200411125752937-1a79d343c639415e9545ffd4f4e91e78.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871282-f82616e37dd8cf2885b82edcce9d8172.png" alt="image-20200411125752937"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200411125752937-1a79d343c639415e9545ffd4f4e91e78.png" target="_blank" rel="noopener">image-20200411125752937</a></p>
<p>控制台输出结果为：</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200411125827915-60033b5caefe4bcfa949c121ca7b817a.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871282-44d0fe587abb9e26661bace1f076dc4e.png" alt="image-20200411125827915"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200411125827915-60033b5caefe4bcfa949c121ca7b817a.png" target="_blank" rel="noopener">image-20200411125827915</a></p>
<h2 id="跳转和乱码处理"><a href="#跳转和乱码处理" class="headerlink" title="跳转和乱码处理"></a>跳转和乱码处理</h2><h3 id="实现转发-forward"><a href="#实现转发-forward" class="headerlink" title="实现转发(forward)"></a>实现转发(forward)</h3><p>在前面request对象的学习中，通过request对象可以实现请求转发（即资源的跳转）。同样的，springmvc也提供了请求转发的方式，具体实现如下：</p>
<p>需求：通过浏览器访问 testForward方法，执行testForward方法后，将请求转发到（HelloController）hello， 也就是home.jsp页面。</p>
<p>1、在HelloController中，提供testForward方法，代码实现如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* 测试请求转发(forward) */</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"testForward"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">testForward</span><span class="params">()</span></span>&#123;</span><br><span class="line">	System.out.println(<span class="string">"测试请求转发(forward)..."</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="string">"forward:hello"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2、打开浏览器，在浏览器中输入：<a href="http://localhost/day16-springmvc/testForward" target="_blank" rel="noopener">http://localhost/day16-springmvc/testForward</a>地址，访问效果如下:</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200411125952494-b6801772df9749cba6ac298f1d77483a.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871282-1380b418ac5c1f329f77e6578a5f6174.png" alt="image-20200411125952494"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200411125952494-b6801772df9749cba6ac298f1d77483a.png" target="_blank" rel="noopener">image-20200411125952494</a></p>
<p>forward方式相当于:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">request.getRequestDispatcher(<span class="string">"url"</span>).forward(request,response);</span><br></pre></td></tr></table></figure>

<p>转发是一次请求，一次响应；</p>
<p>转发后地址栏地址没有发生变化（还是访问testForward的地址）；</p>
<p>转发前后的request和response对象也是同一个。</p>
<h3 id="实现重定向-redirect"><a href="#实现重定向-redirect" class="headerlink" title="实现重定向(redirect)"></a>实现重定向(redirect)</h3><p>在前面response对象的学习中，通过response对象可以实现请求重定向（即资源的跳转）。</p>
<p>同样的，springmvc也提供了请求重定向的方式，具体实现如下：</p>
<p>需求：通过浏览器访问 testRedirect方法，执行testRedirect方法后，将请求重定向到<br>（HelloController）hello， 也就是home.jsp页面。</p>
<p>1、在HelloController中，提供testRedirect方法，代码实现如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* 测试请求重定向(redirect) */</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"testRedirect"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">testRedirect</span><span class="params">()</span></span>&#123;</span><br><span class="line">	System.out.println(<span class="string">"测试请求重定向(redirect)..."</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="string">"redirect:hello"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2、打开浏览器，在浏览器中输入：<a href="http://localhost/day16-springmvc/testRedirect" target="_blank" rel="noopener">http://localhost/day16-springmvc/testRedirect</a>地址，访问效果如下:</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200411130114886-65e5e03a1f254560b16b8f6ba52aea88.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871282-5907e799f51f6f3af14098486e0a99cb.png" alt="image-20200411130114886"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/image-20200411130114886-65e5e03a1f254560b16b8f6ba52aea88.png" target="_blank" rel="noopener">image-20200411130114886</a></p>
<p>redirect方式相当于：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">response.sendRedirect(url);</span><br></pre></td></tr></table></figure>

<p>重定向是两次请求，两次响应；</p>
<p>重定向后地址栏地址发生了变化(变为转发后的地址)；</p>
<p>并且在重定向前后，request和response对象不是同一个。</p>
<h3 id="乱码处理"><a href="#乱码处理" class="headerlink" title="乱码处理"></a>乱码处理</h3><p>在前面的Servlet学习中，我们学习了GET和POST请求参数乱码如何解决。</p>
<p>springmvc也提供了解决请求参数乱码的方案，就是在web.xml中加入如下代码（配置请求参数乱码过滤器），可以解决POST提交的中文参数乱码问题！</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置过滤器,解决POST提交的中文参数乱码问题 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>encodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">param-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">param-value</span>&gt;</span>UTF8<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>encodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Servlet中，两种请求方式乱码解决方案回顾：</p>
<p>(1)如果请求方式为<strong>POST</strong>提交，必然会出现乱码，解决方式是在任何获取参数的代码之前，添加如下代码：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">request.setCharacterEncoding(<span class="string">"utf-8"</span>);</span><br></pre></td></tr></table></figure>

<p>(2)如果请求方式为<strong>GET</strong>提交，tomcat8及之后的版本已经解决了GET提交的中文参数乱码问题，因此不需要处理；在 tomcat7 及之前的版本中，获取GET提交的中文参数仍有乱码，解决方法是：只需要在[tomcat]/conf/server.xml中添加如下配置也可以解决乱码问题。</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/31a1d635302b07dcec001a8cb8a27a4f-f8f8aa790a02496d876fc80adc1f87b8.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871282-80af1d45db50e1f6aca07e4f7685f0c1.png" alt="31a1d635302b07dcec001a8cb8a27a4f"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/31a1d635302b07dcec001a8cb8a27a4f-f8f8aa790a02496d876fc80adc1f87b8.png" target="_blank" rel="noopener">31a1d635302b07dcec001a8cb8a27a4f</a></p>
<h2 id="springmvc响应数据"><a href="#springmvc响应数据" class="headerlink" title="springmvc响应数据"></a>springmvc响应数据</h2><h3 id="Model的使用"><a href="#Model的使用" class="headerlink" title="Model的使用"></a>Model的使用</h3><p>当请求发起访问Controller中的方法时，可以通过参数声明，在方法内使用Model。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/doorList"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">doorList</span><span class="params">(Model model)</span></span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<p>Model对象实际上是一个Map集合，例如：往model中添加一个属性</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">model.addAttribute(String name, Object value);</span><br></pre></td></tr></table></figure>

<p>其中，addAttribute方法会将属性保存到request域中，再通过转发将属性数据带到相应的JSP中，通过${}取出并显示。</p>
<p>示例，往Model中添加属性：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/testModel"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">testModel</span><span class="params">(Model model)</span></span>&#123;</span><br><span class="line">	<span class="comment">/* 往Model添加属性 */</span></span><br><span class="line">	model.addAttribute(<span class="string">"name"</span>, <span class="string">"马云"</span>);</span><br><span class="line">	model.addAttribute(<span class="string">"age"</span>, <span class="number">20</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="string">"home"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在home.jsp中取出属性并显示：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">h1</span>&gt;</span>hello springmvc~~~<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">	$&#123; name &#125; <span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">	$&#123; age &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="扩展内容"><a href="#扩展内容" class="headerlink" title="扩展内容"></a>扩展内容</h2><h3 id="springmvc前端控制器放行静态资源的解决办法"><a href="#springmvc前端控制器放行静态资源的解决办法" class="headerlink" title="springmvc前端控制器放行静态资源的解决办法"></a>springmvc前端控制器放行静态资源的解决办法</h3><p>在配置SpringMVC开发环境时，会在web.xml文件中配置SpringMVC的前端控制器，将所有请求交给前端控制器处理，因此在url-pattern中配置了斜杠（/）:</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 1.配置springmvc前端控制器, 并将所有请求交给springmvc处理 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>springmvc<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 配置springmvc核心配置文件的位置，默认Springmvc的配置文件是在WEB-INF目录下，默认的名字为springmvc-servlet.xml，如果要放在其他目录，则需要指定如下配置：</span></span><br><span class="line"><span class="comment">	--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:springmvc-config.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>springmvc<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 斜杠表示拦截所有请求（除JSP以外） --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>url-pattern中配置的斜杠（/）表示将除了JSP以外的其他请求都拦截下来，交给spring的前端控制器来处理。</p>
<p>但是这样配置，会将对静态资源的访问也拦截下来，导致访问静态资源时，出现404（资源找不到），因为spring的前端控制器将对静态资源的访问也当成了一个controller请求，去配置对应的映射路径，这当然找不到。</p>
<p>比如访问：<a href="http://localhost/day15-springmvc/home.html" target="_blank" rel="noopener">http://localhost/day15-springmvc/home.html</a>，由于配置的是斜杠（/），所以此时会拦截静态资源，到controller中匹配路径为/home.html的方法，此时自然是匹配不到的。</p>
<p>如果需要访问到静态资源，让前端控制器对静态资源的请求放行。此时可以在springmvc-config.xml文件中添加放行静态资源的配置:</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 1.配置前端控制器放行静态资源(html/css/js等，否则静态资源将无法访问) --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:default-servlet-handler</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="applicationContext-xml没有提示的解决方法"><a href="#applicationContext-xml没有提示的解决方法" class="headerlink" title="applicationContext.xml没有提示的解决方法"></a>applicationContext.xml没有提示的解决方法</h3><p>1、配置spring-beans-4.1.xsd文件</p>
<p>(1)找到spring-beans-4.1.xsd的文件的位置，例如：</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/3526b8f7cb18db7def8c59c6b8f5a8c6-ffa1a72b2f064feaa2f6827a9baa26db.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871282-749b06b8e357308ef7d085b0e25e9e86.png" alt="3526b8f7cb18db7def8c59c6b8f5a8c6"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/3526b8f7cb18db7def8c59c6b8f5a8c6-ffa1a72b2f064feaa2f6827a9baa26db.png" target="_blank" rel="noopener">3526b8f7cb18db7def8c59c6b8f5a8c6</a></p>
<p>(2)复制下面的url地址：</p>
<p><a href="http://www.springframework.org/schema/beans/spring-beans-4.0.xsd" target="_blank" rel="noopener">http://www.springframework.org/schema/beans/spring-beans-4.0.xsd</a></p>
<p>(3)在eclipse菜单栏中: window –&gt; Preferences –&gt; 在搜索框中搜索 [ xml ]</p>
<p>XML –&gt; XML Catalog –&gt; User Specified Entries –&gt; Add…</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/eef68594c0d7b072e09702b3d6289831-9e686056fb2642589f8dca20b73e4efc.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871282-b49a7e7646df9cc3d447c014e24a61b3.png" alt="eef68594c0d7b072e09702b3d6289831"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/eef68594c0d7b072e09702b3d6289831-9e686056fb2642589f8dca20b73e4efc.png" target="_blank" rel="noopener">eef68594c0d7b072e09702b3d6289831</a></p>
<p>(4)在弹出的窗口中:</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/10a6f5e3901af4d2fd9cba0d644e00bd-113bea79f0ec4812b46dd20dd3031b2e.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871282-92e920b98046ad4c27e44a1be155bac7.png" alt="10a6f5e3901af4d2fd9cba0d644e00bd"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/10a6f5e3901af4d2fd9cba0d644e00bd-113bea79f0ec4812b46dd20dd3031b2e.png" target="_blank" rel="noopener">10a6f5e3901af4d2fd9cba0d644e00bd</a></p>
<p>2、配置spring-context-4.0.xsd文件</p>
<p>(1)找到spring-context-4.0.xsd的文件的位置，例如：</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/f88878c81816bfccdaf534b48ecbf37d-e69940eaa4574e7ca19eca368e72be02.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871282-a6b69131e4100b7bdb04ba56af579c0f.png" alt="f88878c81816bfccdaf534b48ecbf37d"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/f88878c81816bfccdaf534b48ecbf37d-e69940eaa4574e7ca19eca368e72be02.png" target="_blank" rel="noopener">f88878c81816bfccdaf534b48ecbf37d</a></p>
<p>(2)复制下面的url地址：</p>
<p><a href="http://www.springframework.org/schema/context/spring-context-4.0.xsd" target="_blank" rel="noopener">http://www.springframework.org/schema/context/spring-context-4.0.xsd</a></p>
<p>(3)在eclipse菜单栏中: window –&gt; Preferences –&gt; 在搜索框中搜索 [ xml ]</p>
<p>XML –&gt; XML Catalog –&gt; User Specified Entries –&gt; Add…</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/eef68594c0d7b072e09702b3d6289831-9e686056fb2642589f8dca20b73e4efc.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871282-b49a7e7646df9cc3d447c014e24a61b3.png" alt="eef68594c0d7b072e09702b3d6289831"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/eef68594c0d7b072e09702b3d6289831-9e686056fb2642589f8dca20b73e4efc.png" target="_blank" rel="noopener">eef68594c0d7b072e09702b3d6289831</a></p>
<p>(4)在弹出的窗口中:</p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/bab1eb1bf264e64de4a3672c96f23e8b-d98e8d94be54439ea263bd207d76a0ff.png" target="_blank" rel="noopener"><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591871282-0149e70d411f76ba3fce4c8f33f9e4ac.png" alt="bab1eb1bf264e64de4a3672c96f23e8b"></a></p>
<p><a href="https://www.zhangpeng.fun/upload/2020/06/bab1eb1bf264e64de4a3672c96f23e8b-d98e8d94be54439ea263bd207d76a0ff.png" target="_blank" rel="noopener">bab1eb1bf264e64de4a3672c96f23e8b</a></p>
<h1 id="springmvc-javaweb"><a href="#springmvc-javaweb" class="headerlink" title="springmvc   javaweb"></a><a href="https://www.zhangpeng.fun/tags/springmvc" target="_blank" rel="noopener">springmvc</a>   <a href="https://www.zhangpeng.fun/tags/javaweb" target="_blank" rel="noopener">javaweb</a></h1>]]></content>
      <categories>
        <category>JavaWeb</category>
      </categories>
      <tags>
        <tag>javaweb</tag>
        <tag>springmvc</tag>
      </tags>
  </entry>
  <entry>
    <title>Chrome 插件推荐</title>
    <url>/2020/04/15/Chrome%E6%8F%92%E4%BB%B6%E6%8E%A8%E8%8D%90/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="Chrome-插件推荐"><a href="#Chrome-插件推荐" class="headerlink" title="Chrome 插件推荐"></a>Chrome 插件推荐</h2><p>&emsp;&emsp;不知不觉我的chrome浏览器装了如此之多的插件，以前都没注意过，现在就简单介绍几个给大家，说明，不建议大家安装太多插件，因为会占用太多内存。&emsp;<br>&emsp;&emsp;作为一名开发人员，浏览器是我们平时用到的最多的工具之一，信很多人都在使用 Chrome 浏览器，其流畅的浏览体验得到了不少用户的偏爱，但流畅只是一方面， Chrome 最大的优势还是其支持众多强大好用的扩展程序,以下都是我正在使用或用过的，个人认为比较实用的，排名不分先后。</p>
<p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://www.zhangpeng.fun/upload/2020/04/image-0922fde27aba486bbd9960f656ef2862.png" alt="image"></p>
<h3 id="1-IDM"><a href="#1-IDM" class="headerlink" title="1.IDM"></a>1.IDM</h3><p>&emsp;&emsp;已经记不清多久没用浏览器下载了，这是我用过的最好用的下载器，简直是神器。软件安装过时会自动安装浏览器插件。<br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://www.zhangpeng.fun/upload/2020/04/image-84889e2c53f64c089a4a47f1595382a8.png" alt="image.png"><br>简单功能介绍：<br>1、批量下载<br>InternetDownloadManager支持批量下载功能，如果下载链接是有规律可循，可以用通配符*来代替变化的部分，举例如图（下载网页中的所有有图片）。</p>
<p>2、站点抓取<br>这个功能可以代替离线浏览器的功能，它可以将网站内容全部存储在你的硬盘上，以便你在离线、连接慢、链接不稳定等情况下顺利访问网站。</p>
<p>3、搭配网盘使用<br>绝大多数BT资源和磁力链接可以利用【百度网盘+IDM】来进行离线下载，离线成功，就可以像网盘资源一样高速下载了。</p>
<p>4、视频抓取<br>打开任意一个网页视频，在视频的右上解会出现IDM的嗅探按钮，点击即可一键下载。如果你嫌图标碍眼，可以在【选项】——【常规】——【自定义浏览器中的IDM浮动条】中选择迷你模式。</p>
<p>5、直播源录制<br>打开要录制的直播，可以看到视频右上角出现了IDM下载按钮，点击按钮，开始下载，还支持同时下载多个直接源！<br>这个功能非常强大，直接抓取直接播源数据，保证视频画质音质无损！该功能支持所有直接平台，斗鱼直播需要安装一个叫“斗鱼HTML5播放器”的拓展。</p>
<p>6、代理下载<br>想下载Y2B等需要代理才能访问的网站视频，在IDM【选项】——【代理服务器】中设置一下端口即可，如果在Y2B等网站无法显示浮动条，需要在【高级/socks】中勾选Socks选项，此方法支持Y2B4K视频下载。</p>
<h3 id="2-剪藏"><a href="#2-剪藏" class="headerlink" title="2.剪藏"></a>2.剪藏</h3><p>&emsp;&emsp;经常使用印象笔记来写东西，这个插件一键保存各类网页图文到印象笔记，并能随时随地查看和编辑。告别复制粘贴，高效收集信息。<br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://www.zhangpeng.fun/upload/2020/04/image-2094f975130a46f2baa8af7dac95425e.png" alt="image.png"></p>
<h3 id="3-Google-Helper谷歌上网助手"><a href="#3-Google-Helper谷歌上网助手" class="headerlink" title="3. Google Helper谷歌上网助手"></a>3. Google Helper谷歌上网助手</h3><p>可以让你访问 Google、Gmail 等，装了它你就可以自由的使用 Chrome 应用商店了。下面的插件都是依靠他了。<br>插件地址：<a href="http://googlehelper.net/" target="_blank" rel="noopener">http://googlehelper.net/</a><br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://www.zhangpeng.fun/upload/2020/04/image-aa5e4a92747040f49df8fe0ffc25f288.png" alt="image.png"><br>注册登录就可以使用了。<br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://www.zhangpeng.fun/upload/2020/04/image-b65b6daf002944b6991b04d3c12fd032.png" alt="image.png"></p>
<h3 id="4-WEB前端助手-FeHelper"><a href="#4-WEB前端助手-FeHelper" class="headerlink" title="4.WEB前端助手(FeHelper)"></a>4.WEB前端助手(FeHelper)</h3><p><a href="https://chrome.google.com/webstore/detail/fehelper%E5%89%8D%E7%AB%AF%E5%8A%A9%E6%89%8B/pkgccpejnmalmdinmhkkfafefagiiiad/related" target="_blank" rel="noopener">FeHelper(前端助手)</a><br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://www.zhangpeng.fun/upload/2020/04/image-e949ec92dd0547ceae0875bbf940631d.png" alt="image.png"><br>扩展功能：</p>
<p>JSON自动美化（页面自动检测并格式化）<br>JSON手动美化（粘贴文本、手动格式化）<br>JSON比对工具（支持左右两个JSON片段进行键值对比较）<br>字符串编解码（Unicode/UTF8/Base64/MD5/HEX）<br>代码美化工具（HTML/CSS/JS/XML/SQL）<br>代码压缩工具（HTML/CSS/JS）<br>简易Postman（Api接口测试，模拟HEAD/GET/POST方式）<br>二维码生成器（支持当前页面、图片、链接、选中的文字生成QrCode）<br>二维码解码器（支持网页二维码右键解码）<br>网页转为图片（将当前整个网页转为图片并保存）<br>Markdown转换（支持Html到Markdown的互转）<br>页面取色工具（滑动鼠标随意取色）<br>Js正则表达式（正则测试、常用正则列表）<br>时间(戳)转换（Unix戳与本地时间的互转）<br>图片Base64（任意图片转DataURI格式）<br>随机密码生成（任意长度、任意字符、随机）<br>编码规范检测（HTML/CSS/JS规范检测）<br>页面性能检测（页面响应时间、Header监测）<br>页面栅格标尺（页面栅格化、屏幕标尺）<br>Ajax调试功能（需在控制台中使用）<br>网页油猴工具（网页特效、网页定制、脚本注入、自动刷新等）<br>网页编码设置（UTF-8、GBK、日文、韩文等）<br>我的便签笔记（便签笔记，支持导出）<br>下载/分享插件（在商店下载任意扩展文件）<br>人像背景移除（将人物照片中的背景移除：抠图工具）<br>多维小工具集（进制转换、颜色转换、还款计算器、Crontab等）</p>
<h3 id="5-OneTab"><a href="#5-OneTab" class="headerlink" title="5.OneTab"></a>5.OneTab</h3><p>节省高达95％的内存，并减轻标签页混乱现象<br>当您发现自己有太多的标签页时，单击OneTab图标，将所有标签页转换成一个列表。当您需要再次访问这些标签页时，可以单独或全部恢复它们。</p>
<p>当您的标签页位于OneTab列表时，您将节省高达95％的内存，因为你将减少Google Chrome浏览器中打开的标签页的数量。<br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://www.zhangpeng.fun/upload/2020/04/image-61a29bc513d144ceb70f561a77307162.png" alt="image.png"></p>
<h3 id="6-Tampermonkey"><a href="#6-Tampermonkey" class="headerlink" title="6.Tampermonkey"></a>6.Tampermonkey</h3><p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://www.zhangpeng.fun/upload/2020/04/image-e297b02825fd47f9829efe99e0b70b6b.png" alt="image.png"><br>&emsp;&emsp;神器，哈哈。　Tampermonkey 是最受欢迎的用户脚本管理器。<br>用户脚本集合：<a href="https://greasyfork.org/zh-CN/scripts" target="_blank" rel="noopener">https://greasyfork.org/zh-CN/scripts</a><br>啥也不说，先放截图：<br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://www.zhangpeng.fun/upload/2020/04/image-d63cda1fd884493d925ad092a1caf380.png" alt="image.png"></p>
<h3 id="7-Infinity-新标签页"><a href="#7-Infinity-新标签页" class="headerlink" title="7.Infinity 新标签页"></a>7.Infinity 新标签页</h3><p><a href="https://chrome.google.com/webstore/detail/infinity-new-tab-producti/dbfmnekepjoapopniengjbcpnbljalfg" target="_blank" rel="noopener">Infinity 新标签页</a><br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://www.zhangpeng.fun/upload/2020/04/image-45e70089ddca41c3a25951144d9bb5bd.png" alt="image.png"><br>&emsp;&emsp;百万用户选择的新标签页，自由添加网站图标，云端高清壁纸，快速访问书签、天气、笔记、待办事项、扩展管理与历史记录。</p>
<h3 id="8-Fatkun图片批量下载"><a href="#8-Fatkun图片批量下载" class="headerlink" title="8.Fatkun图片批量下载"></a>8.Fatkun图片批量下载</h3><p><a href="https://chrome.google.com/webstore/detail/fatkun-batch-download-ima/nnjjahlikiabnchcpehcpkdeckfgnohf/related" target="_blank" rel="noopener">Fatkun图片批量下载</a></p>
<p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://www.zhangpeng.fun/upload/2020/04/image-1cc6d2647782455ca801ecd30219911a.png" alt="image.png"><br>&emsp;&emsp;可能大多数人用不上，我喜欢收集图片哈哈<br>找出当前页面的所有图片，提供按分辨率、链接等筛选图片，做一个简单好用的下载图片扩展！<br>只需点击一下，即可下载页面上选择的所有图像。</p>
<p>可以使用你自己的规则下载图像列表。</p>
<p>可以批量重命名下载的图像</p>
<h3 id="9-AdGuard-广告拦截器"><a href="#9-AdGuard-广告拦截器" class="headerlink" title="9.AdGuard 广告拦截器"></a>9.AdGuard 广告拦截器</h3><p><a href="https://chrome.google.com/webstore/detail/adguard-adblocker/bgnkhhnnamicmpeenaelnjfhikgbkllg/related" target="_blank" rel="noopener">AdGuard 广告拦截器</a><br>&emsp;&emsp;一款无与伦比的广告拦截扩展，用以对抗各式广告与弹窗。可以拦截 Facebook、YouTube 和其它所有网站的广告。<br>AdGuard 广告拦截器可有效的拦截所有网页上的所有类型的广告，甚至是在 Facebook、Youtube 以及其他万千网站上的广告！</p>
<p>AdGuard AdBlocker 可以：</p>
<ol>
<li>拦截所有广告，包括：</li>
</ol>
<ul>
<li>视频广告（包括 Youtube 视频广告）</li>
<li>各种媒体广告，例如视频广告，插播广告和浮动广告</li>
<li>令人讨厌的弹窗</li>
<li>横幅广告和文字广告（包括 Facebook 广告）</li>
</ul>
<ol start="2">
<li>加速页面载入，节省带宽，屏蔽广告和弹窗</li>
<li>拦截各种间谍软件，广告软件和拨号安装程序（可选）</li>
<li>通过拦截常见第三方跟踪系统保护您的隐私（可选）</li>
<li>保护您对抗恶意和钓鱼攻击（可选）</li>
</ol>
<p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://www.zhangpeng.fun/upload/2020/04/image-3573ad76c93c4e78a4bac9a2c6918342.png" alt="image.png"></p>
<h3 id="10-扩展管理器（Extension-Manager）"><a href="#10-扩展管理器（Extension-Manager）" class="headerlink" title="10.扩展管理器（Extension Manager）"></a>10.扩展管理器（Extension Manager）</h3><p>插件太多啦！那就需要一个插件来管理插件啦！<br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://www.zhangpeng.fun/upload/2020/04/image-6f19798c05404caa81ef1a33264e7ac0.png" alt="image.png"><br>一键管理所有扩展，快速开启/禁用、批量闪电管理，智能排序，右键卸载、锁定、选项配置，角标提醒，大小布局随心配。快捷、简单、安全。<br>一键开启/禁用扩展</p>
<ol>
<li>闪电分组：根据场景快速开启/禁用扩展组（被锁定或主题类扩展除外）</li>
<li>智能排序：可根据您的使用频率智能排序（默认根据名称排序）</li>
<li>右键菜单：提供锁定、卸载、选项配置、主页、APP运行等快捷功能</li>
<li>智能搜索：通过关键字或词组快速找到需要的扩展</li>
<li>角标提醒：实时显示扩展状态，用完后提醒重置，减少资源占用（被锁定或主题类扩展除外）</li>
<li>视图选择：提供列表视图和网格视图，符合用户习惯</li>
<li>分组管理：普通分组和固定分组，灵活管理</li>
<li>扩展命名：给扩展起一个你喜欢的别名</li>
<li>自动匹配：可以根据不同的网站开启和关闭扩展<h3 id="11-其他"><a href="#11-其他" class="headerlink" title="11.其他"></a>11.其他</h3><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://www.zhangpeng.fun/upload/2020/04/image-a68938571b3647b8b2cf7e6b2b333d6d.png" alt="image.png"></li>
</ol>
<p>chrome浏览器的插件也是相当的多，非常的方便，不经常用的可以暂时不启用。有兴趣的可以自己找找哟</p>
]]></content>
      <categories>
        <category>前端</category>
      </categories>
      <tags>
        <tag>Chrome</tag>
        <tag>插件</tag>
      </tags>
  </entry>
  <entry>
    <title>Dubbo</title>
    <url>/2020/03/28/Dubbo/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="Dubbo"><a href="#Dubbo" class="headerlink" title="Dubbo"></a>Dubbo</h1><h2 id="1-1-SOA思想"><a href="#1-1-SOA思想" class="headerlink" title="1.1 SOA思想"></a>1.1 SOA思想</h2><h3 id="1-1-1-SOA介绍"><a href="#1-1-1-SOA介绍" class="headerlink" title="1.1.1 SOA介绍"></a>1.1.1 SOA介绍</h3><p><strong>SOA</strong> （面向服务的架构）<br/><br>  面向服务的架构（SOA）是一个组件模型，它将应用程序的不同功能单元（称为服务）进行拆分，并通过这些服务之间定义良好的接口和协议联系起来。接口是采用中立的方式进行定义的，它应该独立于实现服务的硬件平台、操作系统和编程语言。这使得构件在各种各样的系统中的服务可以以一种统一和通用的方式进行交互。</p>
<hr>
<p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://www.zhangpeng.fun/upload/2019/12/image-ae856a7313ea47bd8f74c64d9fa6222a.png" alt="image.png"></p>
<h2 id="1-2-RPC协议"><a href="#1-2-RPC协议" class="headerlink" title="1.2 RPC协议"></a>1.2 RPC协议</h2><h3 id="1-2-1-RPC介绍"><a href="#1-2-1-RPC介绍" class="headerlink" title="1.2.1 RPC介绍"></a>1.2.1 RPC介绍</h3><p>  RPC是远程过程调用（Remote Procedure Call）的缩写形式。SAP系统RPC调用的原理其实很简单，有一些类似于三层构架的C/S系统，第三方的客户程序通过接口调用SAP内部的标准或自定义函数，获得函数返回的数据进行处理后显示或打印。<br/><br>  RPC:实现系统之间的通信,用户不需要了解底层原理.</p>
<h3 id="1-1-2-RPC与HTTP区别"><a href="#1-1-2-RPC与HTTP区别" class="headerlink" title="1.1.2 RPC与HTTP区别"></a>1.1.2 RPC与HTTP区别</h3><p>网络7层协议如图所示.</p>
<hr>
<p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://www.zhangpeng.fun/upload/2019/12/image-f5538a7b128f47afba3045baa6e87bf5.png" alt="image.png"></p>
<p>层级关系与对应的协议.</p>
<hr>
<p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://www.zhangpeng.fun/upload/2019/12/image-c655388dc2494930aa4790fbba69eee7.png" alt="image.png"></p>
<p>区别:<br/><br>  1.RPC是传输层协议(4层).而HTTP协议是应用层协议(7层).<br/><br>  2.RPC协议可以直接调用中立接口,HTTP协议不可以.<br/><br>  3.RPC通信协议是长链接,HTTP协议一般采用短连接需要3次握手(可以配置长链接添加请求头Keep-Alive: timeout=20).(长连接，指在一个连接上可以连续发送多个数据包，在连接保持期间，如果没有数据包发送，需要双方发链路检测包。)<br/><br>  4.RPC协议传递数据是加密压缩传输.HTTP协议需要传递大量的请求头信息.<br/><br>  5.RPC协议一般都有注册中心.有丰富的监控机制.<br/></p>
<h2 id="1-3-Dubbo"><a href="#1-3-Dubbo" class="headerlink" title="1.3 Dubbo"></a>1.3 Dubbo</h2><h3 id="1-3-1-Dubbo介绍"><a href="#1-3-1-Dubbo介绍" class="headerlink" title="1.3.1 Dubbo介绍"></a>1.3.1 Dubbo介绍</h3><p>   Apache Dubbo |ˈdʌbəʊ| 是一款高性能、轻量级的开源Java RPC框架，它提供了三大核心能力：面向接口的远程方法调用，智能容错和负载均衡，以及服务自动注册和发现。<br>   Dubbo(读音[ˈdʌbəʊ])是阿里巴巴公司开源的一个高性能优秀的服务框架，使得应用可通过高性能的 RPC 实现服务的输出和输入功能，可以和 [1]  Spring框架无缝集成。<br><a href="http://dubbo.apache.org/en-us/" target="_blank" rel="noopener" title="http://dubbo.apache.org/en-us/">http://dubbo.apache.org/en-us/</a></p>
<h3 id="1-3-2-Dubbo调用原理"><a href="#1-3-2-Dubbo调用原理" class="headerlink" title="1.3.2 Dubbo调用原理"></a>1.3.2 Dubbo调用原理</h3><hr>
<p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://www.zhangpeng.fun/upload/2019/12/image-6c7a6b6179be4349b18d174583961183.png" alt="image.png"></p>
<hr>
<p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://www.zhangpeng.fun/upload/2019/12/image-88b29022ac3148cf8390805f527708e0.png" alt="image.png"></p>
<h2 id="1-4-Dubbo负载均衡算法"><a href="#1-4-Dubbo负载均衡算法" class="headerlink" title="1.4 Dubbo负载均衡算法"></a>1.4 Dubbo负载均衡算法</h2><h3 id="1-4-1-Nginx负载均衡机制"><a href="#1-4-1-Nginx负载均衡机制" class="headerlink" title="1.4.1 Nginx负载均衡机制"></a>1.4.1 Nginx负载均衡机制</h3><p>说明:nginx是服务端负载均衡,所有的请求都会由nginx实现负载.</p>
<hr>
<p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://www.zhangpeng.fun/upload/2019/12/image-925dac6ef8b3409db365d2480b0cb6a6.png" alt="image.png"></p>
<h3 id="1-4-2-Dubbo的负载均衡模式"><a href="#1-4-2-Dubbo的负载均衡模式" class="headerlink" title="1.4.2 Dubbo的负载均衡模式"></a>1.4.2 Dubbo的负载均衡模式</h3><p>dubbo采用客户端负载均衡机制,并且是正向代理.</p>
<hr>
<p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://www.zhangpeng.fun/upload/2019/12/image-0573b98f88c2453f8ece46a0e497d2f0.png" alt="image.png"></p>
<p>1.6.3    随机机制<br>说明:dubbo默认采用的负载均衡算法为随机.</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Reference</span>(timeout=<span class="number">3000</span>,check=<span class="keyword">false</span>,</span><br><span class="line">		loadbalance = <span class="string">"random"</span>)</span><br><span class="line"><span class="keyword">private</span> UserService userService;</span><br></pre></td></tr></table></figure>

<p>1.6.4    轮循算法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Reference</span>(timeout=<span class="number">3000</span>,check=<span class="keyword">false</span>,</span><br><span class="line">			loadbalance = <span class="string">"roundrobin"</span>)</span><br><span class="line">	<span class="keyword">private</span> UserService userService;</span><br></pre></td></tr></table></figure>
<p>1.6.5    IPHASH算法<br>说明:根据IP绑定服务器.</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Reference</span>(timeout=<span class="number">3000</span>,check=<span class="keyword">false</span>,</span><br><span class="line">		loadbalance = <span class="string">"consistenthash"</span>)</span><br><span class="line"><span class="keyword">private</span> UserService userService;</span><br></pre></td></tr></table></figure>
<p>1.6.6    最小访问量机制<br>说明:根据当前服务器的最小访问量实现负载均衡.(压力小先访问)</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Reference</span>(timeout=<span class="number">3000</span>,check=<span class="keyword">false</span>,</span><br><span class="line">		loadbalance = <span class="string">"leastactive"</span>)</span><br><span class="line"><span class="keyword">private</span> UserService userService;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>后端</category>
      </categories>
      <tags>
        <tag>Dubbo</tag>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>Github上那些Java面试、学习相关仓库</title>
    <url>/2020/04/13/Github%E4%B8%8A%E9%82%A3%E4%BA%9BJava%E9%9D%A2%E8%AF%95%E3%80%81%E5%AD%A6%E4%B9%A0%E7%9B%B8%E5%85%B3%E4%BB%93%E5%BA%93/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h3 id="1-JavaGuide"><a href="#1-JavaGuide" class="headerlink" title="1.JavaGuide"></a>1.JavaGuide</h3><p>•Github地址： <a href="https://github.com/Snailclimb/JavaGuide" target="_blank" rel="noopener">https://github.com/Snailclimb/JavaGuide</a> 64.0k• 介绍: 【Java学习+面试指南】 一份涵盖大部分Java程序员所需要掌握的核心知识。</p>
<h3 id="2-CS-Notes"><a href="#2-CS-Notes" class="headerlink" title="2.CS-Notes"></a>2.CS-Notes</h3><p>•Github 地址：<a href="https://github.com/CyC2018/CS-Notes" target="_blank" rel="noopener">https://github.com/CyC2018/CS-Notes</a> [2]•Star: 68.3k•介绍: 技术面试必备基础知识、Leetcode 题解、后端面试、Java 面试、春招、秋招、操作系统、计算机网络、系统设计。</p>
<h3 id="3-advanced-java"><a href="#3-advanced-java" class="headerlink" title="3.advanced-java"></a>3.advanced-java</h3><p>•Github地址：<a href="https://github.com/doocs/advanced-java" target="_blank" rel="noopener">https://github.com/doocs/advanced-java</a> [3]•star: 23.4k•介绍: 互联网 Java 工程师进阶知识完全扫盲：涵盖高并发、分布式、高可用、微服务等领域知识，后端同学必看，前端同学也可学习。</p>
<h3 id="4-JCSprout"><a href="#4-JCSprout" class="headerlink" title="4.JCSprout"></a>4.JCSprout</h3><p>•Github地址：<a href="https://github.com/crossoverJie/JCSprout" target="_blank" rel="noopener">https://github.com/crossoverJie/JCSprout</a> [4]•star: 21.2k•介绍: Java Core Sprout：处于萌芽阶段的 Java 核心知识库。</p>
<h3 id="5-technology-talk"><a href="#5-technology-talk" class="headerlink" title="5.technology-talk"></a>5.technology-talk</h3><p>•Github地址： <a href="https://github.com/aalansehaiyang/technology-talk[5]•star" target="_blank" rel="noopener">https://github.com/aalansehaiyang/technology-talk[5]•star</a>: 6.1k•介绍: 汇总java生态圈常用技术框架、开源中间件，系统架构、项目管理、经典架构案例、数据库、常用三方库、线上运维等知识。</p>
<h3 id="6-Linux-Tutorial"><a href="#6-Linux-Tutorial" class="headerlink" title="6.Linux-Tutorial"></a>6.Linux-Tutorial</h3><p>后端（尤其是Java）程序员的 Linux 学习仓库-Linux-Tutorial：<a href="https://github.com/judasn/Linux-Tutorial" target="_blank" rel="noopener">https://github.com/judasn/Linux-Tutorial</a> ( Star:4.6k)</p>
]]></content>
      <categories>
        <category>面试题</category>
      </categories>
      <tags>
        <tag>github</tag>
      </tags>
  </entry>
  <entry>
    <title>Mybatis 原理分析</title>
    <url>/2020/03/20/Mybatis%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="Mybatis-原理分析"><a href="#Mybatis-原理分析" class="headerlink" title="Mybatis 原理分析"></a>Mybatis 原理分析</h1><h2 id="1-MYBATIS-框架核心基础"><a href="#1-MYBATIS-框架核心基础" class="headerlink" title="1.MYBATIS 框架核心基础"></a>1.MYBATIS 框架核心基础</h2><h3 id="1-1-MYBATIS-架构分析"><a href="#1-1-MYBATIS-架构分析" class="headerlink" title="1.1.MYBATIS 架构分析"></a>1.1.MYBATIS 架构分析</h3><h4 id="1-1-1-Mybatis-应用架构-重点"><a href="#1-1-1-Mybatis-应用架构-重点" class="headerlink" title="1.1.1.Mybatis 应用架构(重点)"></a>1.1.1.Mybatis 应用架构(重点)</h4><p>  MyBatis 本是apache的一个开源项目iBatis, 2010年这个项目由apache software foundation 迁移到了google code，并且改名为MyBatis 。2013年11月迁移到Github。<br/><br>  iBATIS一词来源于“internet”和“abatis”的组合，是一个基于Java的持久层框架。iBATIS提供的持久层框架包括SQL Maps和Data Access Objects（DAOs）<br/><br>  当前，最新版本是MyBatis 3.5.3 ，其发布时间是2019年10月20日。<br/><br>  谈谈对mybatis的应用架构的理解？<br/><br>  MyBatis 是一个优秀的持久层框架，实现了对JDBC操作（标准API）的封装，主要用于传统简化JDBC操作中的一些相对繁琐的步骤，例如参数的映射，结果集的映射（数据库中记录存储到内存中的对象中）等。</p>
<hr>
<p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://www.zhangpeng.fun/upload/2019/12/image-560a50a7839f4872849ab1ccbfad6469.png" alt="image.png"></p>
<p>为何使用mybatis实现数据持久层应用？<br/><br>  1)第一稳定，灵活（动态SQL），功能强大(池，日志，缓存)<br/><br>  2)学习以及使用成本低<br/><br>  3)解耦，SQL的可维护性，可复用性比较高。<br/><br>说明:mybatis官网参考<br/><br>  1)mybatis.org/mybatis-3<br/><br>  2)github.com/mybatis<br/><br>  <a href="http://www.mybatis.org/spring/" target="_blank" rel="noopener">http://www.mybatis.org/spring/</a><br/></p>
<h4 id="1-1-2-Mybatis-产品架构"><a href="#1-1-2-Mybatis-产品架构" class="headerlink" title="1.1.2.Mybatis 产品架构"></a>1.1.2.Mybatis 产品架构</h4><p>  所有框架都要解决一些共性问题（持久化），都是一种半成品，mybatis也不例外，它作为一种框架，它要解决相关问题，如何解决问题？采用怎样的架构解决问题，这是我们要学习的一个点。<br/></p>
<hr>
<p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://www.zhangpeng.fun/upload/2019/12/image-ce73a35989d24609bea1e690e4fefbe8.png" alt="image.png">)<img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://182.92.171.224/upload/20191123_11104417.png" alt=""><br>思考:mybatis作为一个持久层框架,应该解决哪些功能性问题?<br/><br>  1)会话功能 (SqlSession)<br/><br>  2)会话语言 (SQL,动态SQL)<br/><br>  3)会话协议 (TCP)<br/><br>  4)用户体验 (连接池,缓存,日志)<br/></p>
<h4 id="1-1-3-MyBatis-技术架构"><a href="#1-1-3-MyBatis-技术架构" class="headerlink" title="1.1.3.MyBatis 技术架构"></a>1.1.3.MyBatis 技术架构</h4><hr>
<p>Mybatis 框架”构成”分析,如下图所示:</p>
<hr>
<p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://www.zhangpeng.fun/upload/2019/12/image-a20f8c95d3b9434ebc3b31b227e67ad1.png" alt="image.png"></p>
<p>资源配置技术架构,如下图所示:</p>
<hr>
<p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://www.zhangpeng.fun/upload/2019/12/image-06be9ff35c7c4e91b120bcd7037e6724.png" alt="image.png"></p>
<p>会话工厂对象创建(说说SqlSessionFactory对象的创建过程),如下图所示:</p>
<hr>
<p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://www.zhangpeng.fun/upload/2019/12/image-bcc803a719c34a9ba811d459227e8a5b.png" alt="image.png"></p>
<p>会话对象创建？(说说sqlsession对象创建过程),如下图所示:</p>
<hr>
<p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://www.zhangpeng.fun/upload/2019/12/image-b694dc22593a49fba51c7e8e797825fc.png" alt="image.png"></p>
<p>会话对象应用方式,如下图所示:</p>
<hr>
<p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://www.zhangpeng.fun/upload/2019/12/image-a42b6b7b51a644f5b2e4d05d2ab4e37d.png" alt="image.png"></p>
<h3 id="1-2-MYBATIS-环境配置实践"><a href="#1-2-MYBATIS-环境配置实践" class="headerlink" title="1.2.MYBATIS 环境配置实践"></a>1.2.MYBATIS 环境配置实践</h3><h4 id="1-2-1-初始化数据环境"><a href="#1-2-1-初始化数据环境" class="headerlink" title="1.2.1.初始化数据环境"></a>1.2.1.初始化数据环境</h4><p>本次数据初始化直接在mysql的命令行执行:<br/><br>1.启动系统命令行控制台<br/><br>2.登陆数据库:mysql -u root -p<br/><br>3.设置客户端编码：set names utf8<br/><br>4.导入数据：source d:/xxx.sql<br/><br>说明：查询时，假如有中文要显示，可先执行set names gbk.<br/></p>
<h4 id="1-2-2-创建并配置项目"><a href="#1-2-2-创建并配置项目" class="headerlink" title="1.2.2.创建并配置项目"></a>1.2.2.创建并配置项目</h4><p>1.打开IDE并进行配置(新的工作区)<br/><br>1)配置工作区编码(utf-8)<br/><br/><br>2)配置maven环境(本地库,私服配置)<br/></p>
<p>2.创建maven项目并添加依赖<br/><br/><br>项目名称:CGB-MYBATIS-01<br/><br>打包方式:jar包<br/><br>组id:com.cy<br/></p>
<p>MySQL驱动依赖(假如驱动版本与当前数据库不一致可能会有问题)</p>
<pre><code>&lt;dependency&gt;
     &lt;groupId&gt;mysql&lt;/groupId&gt;
   &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;
     &lt;version&gt;8.0.17&lt;/version&gt;
 &lt;/dependency&gt;</code></pre><p>Mybatis 框架依赖（参考官方 mybatis.org/mybatis-3）</p>
<pre><code>&lt;dependency&gt;
    &lt;groupId&gt;org.mybatis&lt;/groupId&gt;
    &lt;artifactId&gt;mybatis&lt;/artifactId&gt;
    &lt;version&gt;3.5.2&lt;/version&gt;
&lt;/dependency&gt;</code></pre><p>Junit单元测试依赖</p>
<pre><code>&lt;dependency&gt;
          &lt;groupId&gt;junit&lt;/groupId&gt;
          &lt;artifactId&gt;junit&lt;/artifactId&gt;
          &lt;version&gt;4.12&lt;/version&gt;
      &lt;/dependency&gt;</code></pre><p>说明:学了spring boot以后还有一种测试方式<br/><br>3.配置项目<br/><br>在src/main/resources目录下创建mybatis-configs.xml配置文件如下：</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;!DOCTYPE configuration
  PUBLIC &quot;-//mybatis.org//DTD Config 3.0//EN&quot;
  &quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;&gt;
&lt;!-- mybatis 核心配置 --&gt;
&lt;configuration&gt;
  &lt;!-- 配置初始化环境(连接) --&gt;
  &lt;environments default=&quot;development&quot;&gt;
    &lt;environment id=&quot;development&quot;&gt;
      &lt;transactionManager type=&quot;JDBC&quot;/&gt;
      &lt;!-- 使用mybatis自带连接池 --&gt;
      &lt;dataSource type=&quot;POOLED&quot;&gt;
        &lt;property name=&quot;driver&quot; value=&quot;com.mysql.jdbc.Driver&quot;/&gt;
        &lt;property name=&quot;url&quot;  value=&quot;jdbc:mysql:///dbgoods?serverTimezone=GMT&quot;/&gt;
        &lt;property name=&quot;username&quot; value=&quot;root&quot;/&gt;
        &lt;property name=&quot;password&quot; value=&quot;root&quot;/&gt;
      &lt;/dataSource&gt;
    &lt;/environment&gt;
  &lt;/environments&gt;
&lt;/configuration&gt;</code></pre><p>其模板：参考官方配置实现（Getting start ）</p>
<h4 id="1-2-3-项目环境单元测试"><a href="#1-2-3-项目环境单元测试" class="headerlink" title="1.2.3.项目环境单元测试"></a>1.2.3.项目环境单元测试</h4><p>在测试包中，创建测试类，测试是否可以获取与数据库的连接<br/></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestBase</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 借助此对象创建SqlSession(通过此对象</span></span><br><span class="line"><span class="comment">	 * 实现与数据库之间的会话)</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">protected</span> SqlSessionFactory factory;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 此方会在<span class="doctag">@Test</span>注解修饰的方法之前执行,</span></span><br><span class="line"><span class="comment">     * 通常用于做一些初始化操作(方法名自己定义)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">	<span class="meta">@Before</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span><span class="keyword">throws</span> IOException</span>&#123;</span><br><span class="line">		InputStream in=</span><br><span class="line">Resources.getResourceAsStream(<span class="string">"mybatis-configs.xml"</span>);</span><br><span class="line">		factory=<span class="keyword">new</span> SqlSessionFactoryBuilder().build(in);</span><br><span class="line">		<span class="comment">//系统底层建造者模式构建工厂对象(此对象构建过程相对复杂)</span></span><br><span class="line">		System.out.println(factory);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSqlSessionConnection</span><span class="params">()</span></span>&#123;</span><br><span class="line">		SqlSession session=factory.openSession();</span><br><span class="line">		Connection conn=session.getConnection();</span><br><span class="line">		System.out.println(conn);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>API 创建过程分析:</p>
<hr>
<p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://www.zhangpeng.fun/upload/2019/12/image-dc8bb262568b4dea95913f0c517f4486.png" alt="image.png"></p>
<h3 id="1-3-MYBATIS业务应用快速实践"><a href="#1-3-MYBATIS业务应用快速实践" class="headerlink" title="1.3.MYBATIS业务应用快速实践"></a>1.3.MYBATIS业务应用快速实践</h3><p>参考官网：<a href="http://www.mybatis.org/mybatis-3" target="_blank" rel="noopener">www.mybatis.org/mybatis-3</a> 实现对商品模块数据的CRUD操作。</p>
<h4 id="1-3-1-基于业务实现"><a href="#1-3-1-基于业务实现" class="headerlink" title="1.3.1.基于业务实现"></a>1.3.1.基于业务实现</h4><p>添加业务实现(以添加商品信息为例进行实现)<br/><br>第一步：编写pojo对象(com.cy.pj.goods.pojo.Goods),<br/><br>借助此对象存储内存中的数据,最后将内存中的数据持久化到数据库.<br/></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cy.pj.goods.pojo;</span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * POJO:借助此对象在内存中封装商品信息</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Goods</span> <span class="keyword">implements</span> <span class="title">Serializable</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">6239917530570596544L</span>;</span><br><span class="line">	<span class="keyword">private</span> Long id;</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="keyword">private</span> String remark;</span><br><span class="line">	<span class="keyword">private</span> Date createdTime;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Long <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> id;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Long id)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.id = id;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.name = name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getRemark</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> remark;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRemark</span><span class="params">(String remark)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.remark = remark;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Date <span class="title">getCreatedTime</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> createdTime;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCreatedTime</span><span class="params">(Date createdTime)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.createdTime = createdTime;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>第二步:编写映射文件(mapper/GoodsMapper.xml),实现内存中对象(一般是pojo对象)与数据库表的映射(例如属性与字段进行映射)</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;!DOCTYPE mapper
  PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;
  &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;
&lt;mapper namespace=&quot;com.cy.pj.goods.dao.GoodsDao&quot;&gt;
    &lt;insert id=&quot;insertObject&quot;
            parameterType=&quot;com.cy.pj.goods.pojo.Goods&quot;&gt;
        insert into tb_goods
        (id,name,remark,createdTime)
        values
        (#{id},#{name},#{remark},now())
    &lt;/insert&gt;
&lt;/mapper&gt;</code></pre><p>第三步:注册映射文件(mybatis-configs.xml)，在配置文件中添加如下语句：</p>
<pre><code>&lt;mappers&gt;
     &lt;mapper resource=&quot;mapper/GoodsMapper.xml&quot;/&gt;
  &lt;/mappers&gt;\</code></pre><p>第四步:定义单元测试类(TestGoodsDao)及方法进行单元测试</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.test;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> com.cy.pj.goods.pojo.Goods;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestGoodsDao01</span> <span class="keyword">extends</span> <span class="title">TestBaseWithXml</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testInsertObject</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">//1.创建Goods对象</span></span><br><span class="line">		Goods g=<span class="keyword">new</span> Goods();</span><br><span class="line">		g.setId(<span class="number">14L</span>);</span><br><span class="line">		g.setName(<span class="string">"IO"</span>);</span><br><span class="line">		g.setRemark(<span class="string">"IO..."</span>);</span><br><span class="line">		<span class="comment">//2.将Goods对象写入到数据库</span></span><br><span class="line">		<span class="comment">//2.1获取SqlSession对象</span></span><br><span class="line">		SqlSession session=</span><br><span class="line">		sqlSessionFactory.openSession();</span><br><span class="line">		<span class="comment">//2.2将对象持久化</span></span><br><span class="line">		String statement=<span class="string">"com.cy.pj.goods.dao.GoodsDao.insertObject"</span>;</span><br><span class="line">		<span class="keyword">int</span> rows=session.insert(statement, g);</span><br><span class="line">		System.out.println(<span class="string">"insert.rows=+"</span>+rows);</span><br><span class="line">		<span class="comment">//2.3提交事务</span></span><br><span class="line">		session.commit();</span><br><span class="line">		<span class="comment">//2.4释放资源</span></span><br><span class="line">		session.close();</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p>修改业务实现(以修改商品信息为例进行实现)<br/><br>第一步：修改映射文件(mapper/GoodsMapper.xml),添加update元素实现信息修改操作语句的定义.</p>
<pre><code>&lt;update id=&quot;updateObject&quot;&gt;
    update tb_goods
    set name=#{name},
        remark=#{remark}
    where id=#{id}
&lt;/update&gt;</code></pre><p>第二步:修改单元测试类(TestGoodsDao01),添加修改测试方法.</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testUpdateObject</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">//1.创建Goods对象</span></span><br><span class="line">		Goods g=<span class="keyword">new</span> Goods();</span><br><span class="line">		g.setId(<span class="number">14L</span>);</span><br><span class="line">		g.setName(<span class="string">"Thread"</span>);</span><br><span class="line">		g.setRemark(<span class="string">"Thread..."</span>);</span><br><span class="line">		<span class="comment">//2.将Goods对象写入到数据库</span></span><br><span class="line">		<span class="comment">//2.1获取SqlSession对象</span></span><br><span class="line">		SqlSession session=</span><br><span class="line">				sqlSessionFactory.openSession();</span><br><span class="line">		<span class="comment">//2.2将对象持久化</span></span><br><span class="line">		String statement=<span class="string">"com.cy.pj.goods.dao.GoodsDao.updateObject"</span>;</span><br><span class="line">		<span class="keyword">int</span> rows=session.update(statement, g);</span><br><span class="line">		System.out.println(<span class="string">"update.rows=+"</span>+rows);</span><br><span class="line">		<span class="comment">//2.3提交事务</span></span><br><span class="line">		session.commit();</span><br><span class="line">		<span class="comment">//2.4释放资源</span></span><br><span class="line">		session.close();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>1)删除业务实现(以删除作者信息为例进行实现)<br/><br>step01:修改映射文件(mapper/GoodsMapper.xml),添加delete元素,实现基于id进行删除操作语句的定义.</p>
<pre><code>&lt;delete id=&quot;deleteById&quot;&gt;
      delete from tb_goods
      where id=#{id}
 &lt;/delete&gt;</code></pre><p>step02:修改单元测试类(TestGoodsDao01),添加删除测试方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testDeleteById</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">//1.获取session对象</span></span><br><span class="line">		SqlSession session = </span><br><span class="line">		sqlSessionFactory.openSession();</span><br><span class="line">		<span class="comment">//2.执行删除操作</span></span><br><span class="line">		String statement=</span><br><span class="line">		<span class="string">"com.cy.pj.goods.dao.GoodsDao.deleteById"</span>;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">		<span class="keyword">int</span> rows=session.delete(statement, <span class="number">10</span>);</span><br><span class="line">		System.out.println(<span class="string">"delete.rows="</span>+rows);</span><br><span class="line">		<span class="comment">//3.提交事务</span></span><br><span class="line">		session.commit();</span><br><span class="line">		<span class="comment">//4.释放资源</span></span><br><span class="line">		&#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">		session.close();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<p>2)查询业务实现(以查询某个商品信息为例进行实现)<br/><br>step01:修改映射文件(mapper/GoodsMapper.xml),添加select元素,实现基于id查询作者信息语句的定义.</p>
<pre><code>&lt;select id=&quot;selectById&quot;
         resultType=&quot;com.cy.pj.goods.pojo.Goods&quot;&gt;
    select id,name,remark,createdTime
    from tb_goods
    where id=#{id}
 &lt;/select&gt;</code></pre><p>step02:修改单元测试类(TestGoodsDao01),添加基于id执行查询的操作</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSelectById</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">//1.获取session对象</span></span><br><span class="line">		SqlSession session = </span><br><span class="line">				sqlSessionFactory.openSession();</span><br><span class="line">		<span class="comment">//2.执行删除操作</span></span><br><span class="line">		String statement=</span><br><span class="line">				<span class="string">"com.cy.pj.goods.dao.GoodsDao.selectById"</span>;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			Goods g=session.selectOne(statement,<span class="number">11</span>);</span><br><span class="line">			System.out.println(g);</span><br><span class="line">			<span class="comment">//3.提交事务</span></span><br><span class="line">			session.commit();</span><br><span class="line">			<span class="comment">//4.释放资源</span></span><br><span class="line">		&#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">			session.close();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p>3)分页查询实现(以查询多个商品信息为例进行实现)<br/><br>step01:修改映射文件(mapper/GoodsMapper.xml),添加select元素,实现基于分页条件查询作者信息语句的定义.</p>
<pre><code>&lt;select id=&quot;findPageObjects&quot;
            resultType=&quot;com.cy.pj.goods.pojo.Goods&quot;&gt;
         select *
         from tb_goods
         limit #{startIndex},#{pageSize}
    &lt;/select&gt;</code></pre><p>step02:修改单元测试类(TestGoodsDao01),添加基于分页条件执行查询.</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindPageObjects</span><span class="params">()</span> </span>&#123; </span><br><span class="line">		<span class="comment">//1.获取session对象</span></span><br><span class="line">		SqlSession session = </span><br><span class="line">		sqlSessionFactory.openSession();</span><br><span class="line">		<span class="comment">//2.执行删除操作</span></span><br><span class="line">		String statement=</span><br><span class="line">		<span class="string">"com.cy.pj.goods.dao.GoodsDao.findPageObjects"</span>;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">		Map&lt;String,Object&gt; map=<span class="keyword">new</span> HashMap&lt;String,Object&gt;();</span><br><span class="line">		map.put(<span class="string">"startIndex"</span>, <span class="number">0</span>);</span><br><span class="line">		map.put(<span class="string">"pageSize"</span>, <span class="number">3</span>);</span><br><span class="line">		List&lt;Goods&gt; list=</span><br><span class="line">		session.selectList(statement,map); </span><br><span class="line">		System.out.println(list);</span><br><span class="line">		<span class="comment">//3.提交事务</span></span><br><span class="line">		session.commit();<span class="comment">//connection.commint</span></span><br><span class="line">		<span class="comment">//4.释放资源</span></span><br><span class="line">		&#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">		session.close();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p>4)删除多条数据(以删除商品信息为例进行删除,借助动态sql)<br/><br>step01:修改映射文件(mapper/GoodsMapper.xml),添加delete元素,实现基于多个ID删除作者信息的语句的定义.</p>
<pre><code>&lt;delete id=&quot;deleteObjects&quot;&gt;
    delete from tb_goods
    &lt;where&gt; 
      &lt;!-- foreach元素用于迭代一个数组或集合 --&gt;
      &lt;foreach collection=&quot;array&quot;
             item=&quot;id&quot;&gt;
           or id=#{id}
      &lt;/foreach&gt;
    &lt;/where&gt;
 &lt;/delete&gt;</code></pre><p>step02:修改单元测试类(TestGoodsDao01),添加基于多个ID执行删除的操作.</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testDeleteObjects</span><span class="params">()</span> </span>&#123; </span><br><span class="line">		<span class="comment">//1.获取session对象</span></span><br><span class="line">		SqlSession session = </span><br><span class="line">		sqlSessionFactory.openSession();</span><br><span class="line">		<span class="comment">//2.执行删除操作</span></span><br><span class="line">		String statement=</span><br><span class="line">		<span class="string">"com.cy.pj.goods.dao.GoodsDao.deleteObjects"</span>;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">		<span class="keyword">int</span> rows=session.delete(statement, <span class="keyword">new</span> Object[] &#123;<span class="number">13</span>,<span class="number">3</span>&#125;);</span><br><span class="line">		System.out.println(<span class="string">"delete.rows="</span>+rows);</span><br><span class="line">		<span class="comment">//3.提交事务</span></span><br><span class="line">		session.commit();<span class="comment">//connection.commint</span></span><br><span class="line">		<span class="comment">//4.释放资源</span></span><br><span class="line">		&#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">		session.close();</span><br><span class="line">		&#125;&#125;</span><br></pre></td></tr></table></figure>

<h4 id="1-3-2-基本业务进阶实现"><a href="#1-3-2-基本业务进阶实现" class="headerlink" title="1.3.2.基本业务进阶实现"></a>1.3.2.基本业务进阶实现</h4><p>基于接口方式实现数据访问操作<br/><br>1)分页查询实现(以查询多个作者信息为例进行实现)<br/><br>第一步: 创建一个接口GoodsDao 定一个分页查询方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cy.pj.goods.dao;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Param;</span><br><span class="line"><span class="keyword">import</span> com.cy.pj.goods.pojo.Goods;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">GoodsDao</span> </span>&#123;</span><br><span class="line">	 <span class="comment">/**</span></span><br><span class="line"><span class="comment">	    * 执行数据的删除操作</span></span><br><span class="line"><span class="comment">	  * <span class="doctag">@param</span> ids</span></span><br><span class="line"><span class="comment">	  * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	  */</span></span><br><span class="line">	 <span class="function"><span class="keyword">int</span> <span class="title">deleteObjects</span><span class="params">(<span class="keyword">int</span>... ids)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>第二步: 创建一个单元测试类TestGoodsDao02对分页查询进行单元测试</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestGoodsDao02</span> <span class="keyword">extends</span> <span class="title">TestBaseWithXml</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testDeleteObjects</span><span class="params">()</span> </span>&#123; </span><br><span class="line">		<span class="comment">//1.获取session对象</span></span><br><span class="line">		SqlSession session = </span><br><span class="line">		sqlSessionFactory.openSession();</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">		<span class="comment">//2.执行删除操作</span></span><br><span class="line">		GoodsDao gDao=</span><br><span class="line">		session.getMapper(GoodsDao<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">		<span class="keyword">int</span> rows=gDao.deleteObjects(<span class="number">11</span>,<span class="number">12</span>);</span><br><span class="line">		System.out.println(<span class="string">"delete.rows="</span>+rows);</span><br><span class="line">		<span class="comment">//3.提交事务</span></span><br><span class="line">		<span class="comment">//session.commit();//connection.commint</span></span><br><span class="line">		<span class="comment">//4.释放资源</span></span><br><span class="line">		&#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">		session.close();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2)基于多个id进行删除 (以删除作者信息为例进行实现)<br/><br>第一步：修改GoodsDao接口,添加deleteObjects方法</p>
<pre><code>int deleteObjects(int... ids);</code></pre><p>第二步: 修改单元测试类,添加testDeleteObjects方法实现单元测试.</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testDeleteObjects</span><span class="params">()</span> </span>&#123; </span><br><span class="line">		<span class="comment">//1.获取session对象</span></span><br><span class="line">		SqlSession session = </span><br><span class="line">		sqlSessionFactory.openSession();</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">		<span class="comment">//2.执行删除操作</span></span><br><span class="line">		GoodsDao gDao=</span><br><span class="line">		session.getMapper(GoodsDao<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">		<span class="keyword">int</span> rows=gDao.deleteObjects(<span class="number">11</span>,<span class="number">12</span>);</span><br><span class="line">		System.out.println(<span class="string">"delete.rows="</span>+rows);</span><br><span class="line">		<span class="comment">//3.提交事务</span></span><br><span class="line">		<span class="comment">//session.commit();//connection.commint</span></span><br><span class="line">		<span class="comment">//4.释放资源</span></span><br><span class="line">		&#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">		session.close();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p>基于注解(Annotation)方式做业务实现?<br/><br>第一步：在GoodsDao接口中添加统计记录行数的方法：getRowCount()<br/></p>
<pre><code>int getRowCount();&lt;br/&gt;</code></pre><p>第二步：在GoodsDao接口的统计记录方法上添加@Select注解，定义查询语句。<br/></p>
<pre><code>@Select(&quot;select count(*) from tb_goods&quot;)
int getRowCount();</code></pre><p>第三步：在TestGoodsDao02测试类中添加测试方法。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testGetRowCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		SqlSession session=</span><br><span class="line">		sqlSessionFactory.openSession();</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">		GoodsDao dao=</span><br><span class="line">		session.getMapper(GoodsDao<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">		<span class="keyword">int</span> rowCount=dao.getRowCount();</span><br><span class="line">		System.out.println(rowCount);</span><br><span class="line">		session.commit();</span><br><span class="line">		&#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">		session.close();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<h4 id="1-3-3-会话工厂对象创建增强-了解"><a href="#1-3-3-会话工厂对象创建增强-了解" class="headerlink" title="1.3.3.会话工厂对象创建增强(了解)"></a>1.3.3.会话工厂对象创建增强(了解)</h4><hr>
<p>基于非XMl方式构建SqlSessionFactory对象?</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.test;</span><br><span class="line"><span class="keyword">import</span> com.cy.pj.goods.dao.GoodsDao;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Building SqlSessionFactory without XML</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestBaseWithJava</span> </span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> SqlSessionFactory sqlSessionFactory;</span><br><span class="line">	<span class="meta">@Before</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">//1.构建数据源对象</span></span><br><span class="line">		PooledDataSource dataSource=<span class="keyword">new</span> PooledDataSource();</span><br><span class="line">		dataSource.setDriver(<span class="string">"com.mysql.cj.jdbc.Driver"</span>);</span><br><span class="line">	dataSource.setUrl(<span class="string">"jdbc:mysql:///dbgoods?serverTimezone=GMT&amp;characterEncoding=utf8"</span>);</span><br><span class="line">		dataSource.setUsername(<span class="string">"root"</span>);</span><br><span class="line">		dataSource.setPassword(<span class="string">"root"</span>);</span><br><span class="line">		<span class="comment">//2.创建事务管理工厂</span></span><br><span class="line">		JdbcTransactionFactory transactionFactory=</span><br><span class="line">		<span class="keyword">new</span> JdbcTransactionFactory();</span><br><span class="line">		<span class="comment">//3.创建一个环境对象</span></span><br><span class="line">		Environment env= <span class="keyword">new</span> Environment(<span class="string">"development"</span>,</span><br><span class="line">		transactionFactory, dataSource);</span><br><span class="line">		<span class="comment">//4.创建配置对象</span></span><br><span class="line">		Configuration config=</span><br><span class="line">		<span class="keyword">new</span> Configuration(env);</span><br><span class="line">		config.addMapper(GoodsDao<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">		<span class="comment">//5.创建sqlSessionFactory对象</span></span><br><span class="line">		sqlSessionFactory=</span><br><span class="line">        <span class="keyword">new</span> SqlSessionFactoryBuilder()</span><br><span class="line">		.build(config);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testConnection</span><span class="params">()</span></span>&#123;</span><br><span class="line">		Connection conn=</span><br><span class="line">		sqlSessionFactory.openSession()</span><br><span class="line">		.getConnection();</span><br><span class="line">		System.out.println(conn);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试实现</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.test;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> com.cy.pj.goods.dao.GoodsDao;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 	基于接口方式进行测试实现</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestGoodsDao03</span> </span></span><br><span class="line"><span class="class">     <span class="keyword">extends</span> <span class="title">TestBaseWithJava</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testGetRowCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		SqlSession session=</span><br><span class="line">		sqlSessionFactory.openSession();</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">		GoodsDao dao=</span><br><span class="line">		session.getMapper(GoodsDao<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">		<span class="keyword">int</span> rowCount=dao.getRowCount();</span><br><span class="line">		System.out.println(rowCount);</span><br><span class="line">		session.commit();</span><br><span class="line">		&#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">		session.close();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-4-MYBATIS-应用原理进阶分析"><a href="#1-4-MYBATIS-应用原理进阶分析" class="headerlink" title="1.4.MYBATIS 应用原理进阶分析"></a>1.4.MYBATIS 应用原理进阶分析</h3><h4 id="1-4-1-会话工厂创建分析-了解"><a href="#1-4-1-会话工厂创建分析-了解" class="headerlink" title="1.4.1.会话工厂创建分析(了解)"></a>1.4.1.会话工厂创建分析(了解)</h4><hr>
<p>会话工厂(SqlSessionFactory)创建过程分析:基于xml方式</p>
<hr>
<p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://www.zhangpeng.fun/upload/2019/12/image-454b49d31ee043ceb7e67d1cc5848800.png" alt="image.png"><br>1.通过IO读取配置文件<br/><br>2.解析IO数据并进行封装(所有信息都会存储到Configuration对象)<br/><br>3.基于配置对象创建SqlSessionFactory对象<br/></p>
<p>会话工厂(SqlSessionFactory)创建过程分析:不基基于xml方式</p>
<hr>
<p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://www.zhangpeng.fun/upload/2019/12/image-b3af8a61276444e7a1313cb634862e86.png" alt="image.png"></p>
<h3 id="1-4-2-会话对象应用分析-了解"><a href="#1-4-2-会话对象应用分析-了解" class="headerlink" title="1.4.2.会话对象应用分析 (了解)"></a>1.4.2.会话对象应用分析 (了解)</h3><hr>
<p>说说mybatis对jdbc的封装过程（了解）？（SqlSession应用增强分析）</p>
<hr>
<p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://www.zhangpeng.fun/upload/2019/12/image-9eeb8dbe5a1e42fea794fcc251a9b054.png" alt="image.png"><br>封装了连接获取过程？（Executor-&gt;JDBCTransactionConnection）<br/><br>2)封装了Statement对象创建过程？(connection)<br/><br>3)封装了sql的发送过程，参数的处理过程，结果的映射过程。<br/></p>
<h3 id="1-4-3-基于Mapper接口会话-了解"><a href="#1-4-3-基于Mapper接口会话-了解" class="headerlink" title="1.4.3.基于Mapper接口会话(了解)"></a>1.4.3.基于Mapper接口会话(了解)</h3><p>例如：XxxMapper xm=session.getMapper(XxxDao.class);<br/><br>当获取到mapper接口对应的实现类对象以后可以基于实现类底层执行sql操作。<br/></p>
<hr>
<p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://www.zhangpeng.fun/upload/2019/12/image-2bf3be2cf81f4e3b9866452880e67a14.png" alt="image.png"><br>FAQ?<br/><br>1)不同通过getMapper方式获取指定接口实现类是否可以基于mybatis实现数据访问操作?(可以)<br/><br>2)基于Mapper接口访问数据库库的优势,劣势?(解耦,可读性好但是性能相对较差,相对于直接通过sqlsession的selectList,update方法而言).<br/></p>
<h4 id="1-4-4-缓存应用实现过程分析-掌握"><a href="#1-4-4-缓存应用实现过程分析-掌握" class="headerlink" title="1.4.4.缓存应用实现过程分析(掌握)"></a>1.4.4.缓存应用实现过程分析(掌握)</h4><p>Mybatis 框架提供一种缓存机制，通过缓存的应用来提高查询性能,但可能会有一定的不一致(脏读)问题。Mybatis中的缓存提供一级缓存和二级缓存的实现,默认都是开启状态（可参考官网）。<br/><br>1.Mybatis 一级缓存<br/><br>Mybatis中的一级缓存有时又称为SqlSession级缓存，SqlSession关闭时一级缓存失效。在同一个SqlSession内部多次执行同一个查询，后续的查询会从此缓存取数据.一级缓存结构分析如下:<br/><br>一级缓存基本架构应用分析:<br/></p>
<hr>
<p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://www.zhangpeng.fun/upload/2019/12/image-994fdc20ec8f406b90944ffe8583ca93.png" alt="image.png"><br>一级缓存代码架构分析:</p>
<hr>
<p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://www.zhangpeng.fun/upload/2019/12/image-6e8c3b268e9b4227948e747aa9e19071.png" alt="image.png"><br>说明：一级缓存的实现可查看BaseExecutor类中的localCache属性。</p>
<p>2.MyBatis二级缓存<br/></p>
<p>Mybatis中的二级缓存有时又称跨session缓存，可在多个SqlSession间共享数据,假如要使用二级缓存，可在对应的mapper文件中借助cache元素进行配置(可参考官方映射文件配置),二级缓存架构分析如下:<br/></p>
<p>二级缓存基本应用架构:<br/></p>
<hr>
<p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://www.zhangpeng.fun/upload/2019/12/image-320d1aa0f9a14514867317e697c88ae1.png" alt="image.png"><br>二级缓存代码结构分析:<br/></p>
<hr>
<p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://www.zhangpeng.fun/upload/2019/12/image-15ee6b13b3c24b4e8fbb1b42b07b7651.png" alt="image.png"><br>说明：<br/><br>1)二级缓存的实现可查看CachingExecutor类中的query方法.<br/><br>2)二级缓存底层采用装饰模式进行设计,例如:<br/><br>new SynchronizedCache (new LoggingCache(…));<br/><br>3)二级缓存中可以存储序列化对象(readWrite属性值为false时)<br/><br>4)使用二级缓存可在映射文件中借助<Cache/>标签进行声明,也可在接口中借助注解@CacheNamespace对接口进行描述.<br/><br>5)当映射配置有注解方式,也有xml方式时可通过缓存引用进行配置,例如.<br>@CacheNamespaceRef(name=”com.cy.pj.googs.dao.GoodsDao “)<br/></p>
]]></content>
      <categories>
        <category>后端</category>
      </categories>
      <tags>
        <tag>mybatis</tag>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>Nginx相关知识</title>
    <url>/2020/04/16/Nginx%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="1-nginx-介绍"><a href="#1-nginx-介绍" class="headerlink" title="1.nginx 介绍"></a>1.nginx 介绍</h2><p>Nginx (engine x) 是一个高性能的HTTP和反向代理web服务器，同时也提供了IMAP/POP3/SMTP服务。Nginx是由伊戈尔·赛索耶夫为俄罗斯访问量第二的Rambler.ru站点（俄文：Рамблер）开发的，第一个公开版本0.1.0发布于2004年10月4日。<br>其将源代码以类BSD许可证的形式发布，因它的稳定性、丰富的功能集、示例配置文件和低系统资源的消耗而闻名。2011年6月1日，nginx 1.0.4发布。<br>Nginx是一款轻量级的Web 服务器/反向代理服务器及电子邮件（IMAP/POP3）代理服务器，在BSD-like 协议下发行。其特点是占有内存少，并发能力强，事实上nginx的并发能力在同类型的网页服务器中表现较好，中国大陆使用nginx网站用户有：百度、京东、新浪、网易、腾讯、淘宝等。</p>
<h2 id="2-安装nginx"><a href="#2-安装nginx" class="headerlink" title="2.安装nginx"></a>2.安装nginx</h2><p>安装nginx</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo yum install epel-release</span><br><span class="line">sudo yum install nginx</span><br></pre></td></tr></table></figure>

<p>让nginx随系统启动而启动</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo systemctl enable nginx</span><br></pre></td></tr></table></figure>
<p>/etc/nginx</p>
<h2 id="3-nginx-负载均衡"><a href="#3-nginx-负载均衡" class="headerlink" title="3.nginx 负载均衡"></a>3.nginx 负载均衡</h2><p>Nginx通过反向代理可以实现服务的负载均衡，避免了服务器单节点故障，把请求按照一定的策略转发到不同的服务器上，达到负载的效果。<br>1、轮询<br>将请求按顺序轮流地分配到后端服务器上，它均衡地对待后端的每一台服务器，而不关心服务器实际的连接数和当前的系统负载。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http &#123;</span><br><span class="line"></span><br><span class="line">    upstream myapp1 &#123;</span><br><span class="line"></span><br><span class="line">        server 192.168.1.103:8080;</span><br><span class="line"></span><br><span class="line">        server 192.168.1.104:8080;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ……略</span><br><span class="line"></span><br><span class="line">   server &#123;</span><br><span class="line"></span><br><span class="line">        listen 80;</span><br><span class="line"></span><br><span class="line">        server_name  localhost;</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">        ……略</span><br><span class="line"></span><br><span class="line">        location &#x2F;webautotest&#x2F; &#123;</span><br><span class="line"></span><br><span class="line">            proxy_buffering off;</span><br><span class="line"></span><br><span class="line">            proxy_pass http:&#x2F;&#x2F;myapp1;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2、加权轮询<br>不同的后端服务器可能机器的配置和当前系统的负载并不相同，因此它们的抗压能力也不相同。</p>
<p>给配置高、负载低的机器配置更高的权重，让其处理更多的请；而配置低、负载高的机器，给其分配较低的权重，降低其系统负载，加权轮询能很好地处理这一问题，并将请求顺序且按照权重分配到后端。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">upstream myapp1 &#123;</span><br><span class="line"></span><br><span class="line">       server srv1.example.com weight&#x3D;3;</span><br><span class="line"></span><br><span class="line">       server srv2.example.com;</span><br><span class="line"></span><br><span class="line">       server srv3.example.com;</span><br><span class="line"></span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>3、ip_hash（源地址哈希法）<br>根据获取客户端的IP地址，通过哈希函数计算得到一个数值，用该数值对服务器列表的大小进行取模运算，得到的结果便是客户端要访问服务器的序号。</p>
<p>采用源地址哈希法进行负载均衡，同一IP地址的客户端，当后端服务器列表不变时，它每次都会映射到同一台后端服务器进行访问。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">upstream myapp1 &#123;</span><br><span class="line"></span><br><span class="line">    ip_hash;</span><br><span class="line"></span><br><span class="line">    server srv1.example.com;</span><br><span class="line"></span><br><span class="line">    server srv2.example.com;</span><br><span class="line"></span><br><span class="line">    server srv3.example.com;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>4、least_conn（最小连接数法）<br>由于后端服务器的配置不尽相同，对于请求的处理有快有慢，最小连接数法根据后端服务器当前的连接情况，动态地选取其中当前积压连接数最少的一台服务器来处理当前的请求，尽可能地提高后端服务的利用效率，将负责合理地分流到每一台服务器。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">upstream myapp1 &#123;</span><br><span class="line"></span><br><span class="line">        least_conn;</span><br><span class="line"></span><br><span class="line">        server srv1.example.com;</span><br><span class="line"></span><br><span class="line">        server srv2.example.com;</span><br><span class="line"></span><br><span class="line">        server srv3.example.com;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>5、随机</p>
<h2 id="4-nginx-反向代理"><a href="#4-nginx-反向代理" class="headerlink" title="4.nginx 反向代理"></a>4.nginx 反向代理</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">vim Nginx.conf</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">	# 监听80端口，一般不用改</span><br><span class="line">    listen 80;</span><br><span class="line">	# 将这里的example换成自己的域名</span><br><span class="line">    server_name example.com www.example.com;</span><br><span class="line"></span><br><span class="line">    location &#x2F; &#123;</span><br><span class="line">        proxy_set_header HOST $host;</span><br><span class="line">        proxy_set_header X-Forwarded-Proto $scheme;</span><br><span class="line">        proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">		# 这里的http后面的url就是你访问你上方的域名代理的地址</span><br><span class="line">        proxy_pass http:&#x2F;&#x2F;127.0.0.1:8090&#x2F;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>重启</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">nginx -s reload</span><br></pre></td></tr></table></figure>
<h2 id="5-配置SSL证书"><a href="#5-配置SSL证书" class="headerlink" title="5.配置SSL证书"></a>5.配置SSL证书</h2><p>1.下载证书上传<br>在阿里云购买免费版本的SSL证书后，下载SSL证书到本地，选择Nginx版本。<br>下载的证书共有两个文件，分别是：</p>
<p>xxxxxxxx.pem<br>xxxxxxxx.key</p>
<p>在服务上/root路径下新建ssl文件夹，并将下载到本地的证书文件上传至该文件夹。</p>
<p>可使用rz命令或者Xftp来上传,也可以使用filezilla上传。<br>2.配置<br>在/etc/nginx/conf.d/路径下新建文件nginx.conf</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">vim &#x2F;etc&#x2F;nginx&#x2F;conf.d&#x2F;nginx.conf</span><br></pre></td></tr></table></figure>
<p>输入</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">server</span><br><span class="line">&#123;</span><br><span class="line">listen 443 ssl;</span><br><span class="line">server_name yuzho.cn www.yuzho.cn;</span><br><span class="line">ssl_certificate &#x2F;root&#x2F;ssl&#x2F;xxxxxxxx.pem;</span><br><span class="line">ssl_certificate_key &#x2F;root&#x2F;ssl&#x2F;xxxxxxxx.key;</span><br><span class="line">ssl_session_timeout 5m;</span><br><span class="line">ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;</span><br><span class="line">ssl_protocols TLSv1 TLSv1.1 TLSv1.2;</span><br><span class="line">ssl_prefer_server_ciphers on;</span><br><span class="line">location &#x2F; &#123;</span><br><span class="line">proxy_buffer_size 128k;</span><br><span class="line">proxy_buffers 32 32k;</span><br><span class="line">proxy_busy_buffers_size 128k;</span><br><span class="line">proxy_pass http:&#x2F;&#x2F;127.0.0.1:8090;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">server</span><br><span class="line">&#123;</span><br><span class="line">listen 80;</span><br><span class="line">server_name yuzho.cn www.yuzho.cn;</span><br><span class="line">rewrite ^(.*)$ https:&#x2F;&#x2F;host1 permanent;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>将其中的 yuzho.cn, <a href="http://www.yuzho.cn换成你自己的域名；/root/ssl/xxxxxxxx.pem，/root/ssl/xxxxxxxx.key换成你自己在上一步中所上传的证书的绝对路径；将8090换成你所需要代理的端口。" target="_blank" rel="noopener">www.yuzho.cn换成你自己的域名；/root/ssl/xxxxxxxx.pem，/root/ssl/xxxxxxxx.key换成你自己在上一步中所上传的证书的绝对路径；将8090换成你所需要代理的端口。</a><br>3.重新加载nginx<br>使用nginx -t命令来检查语法错误，使用nginx -s reload命令来重新加载nginx。<br>如nginx -t正确，而nginx -s reload命令出现错误提示：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">nginx: [error] invalid PID number &quot;&quot; in &quot;&#x2F;run&#x2F;nginx.pid&quot;</span><br></pre></td></tr></table></figure>
<p>执行</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">nginx -c &#x2F;etc&#x2F;nginx&#x2F;nginx.conf</span><br><span class="line">sudo nginx -s reload</span><br></pre></td></tr></table></figure>
<p>引用 <a href="https://www.cnblogs.com/liulun/p/11518252.html" target="_blank" rel="noopener">https://www.cnblogs.com/liulun/p/11518252.html</a></p>
<h2 id="6"><a href="#6" class="headerlink" title="6."></a>6.</h2><p>Nginx中文文档 ：      <a href="https://www.nginx.cn/doc/" target="_blank" rel="noopener">https://www.nginx.cn/doc/</a><br>官网 ： <a href="https://www.nginx.com/" target="_blank" rel="noopener">https://www.nginx.com/</a></p>
]]></content>
      <categories>
        <category>工具</category>
      </categories>
      <tags>
        <tag>nginx</tag>
      </tags>
  </entry>
  <entry>
    <title>Redis 命令</title>
    <url>/2020/03/25/Redis%E5%91%BD%E4%BB%A4/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="1-1Redis-命令"><a href="#1-1Redis-命令" class="headerlink" title="1.1Redis 命令"></a>1.1Redis 命令</h1><h3 id="1-1-1String类型"><a href="#1-1-1String类型" class="headerlink" title="1.1.1String类型"></a>1.1.1String类型</h3><table>
<thead>
<tr>
<th>命令</th>
<th>说明</th>
<th>案例</th>
</tr>
</thead>
<tbody><tr>
<td>set</td>
<td>添加key-value</td>
<td>set username admin</td>
</tr>
<tr>
<td>get</td>
<td>根据key获取数据</td>
<td>get username</td>
</tr>
<tr>
<td>strlen</td>
<td>获取key的长度</td>
<td>strlen key</td>
</tr>
<tr>
<td>exists</td>
<td>判断key是否存在</td>
<td>exists name 返回1存在  0不存在</td>
</tr>
<tr>
<td>del</td>
<td>删除redis中的key</td>
<td>del key</td>
</tr>
<tr>
<td>Keys</td>
<td>用于查询符合条件的key</td>
<td>keys * 查询redis中全部的keykeys n?me 使用占位符获取数据keys nam* 获取nam开头的数据</td>
</tr>
<tr>
<td>mset</td>
<td>赋值多个key-value</td>
<td>mset key1 value1 key2 value2 key3 value3</td>
</tr>
<tr>
<td>mget</td>
<td>获取多个key的值</td>
<td>mget key1 key2</td>
</tr>
<tr>
<td>append</td>
<td>对某个key的值进行追加</td>
<td>append key value</td>
</tr>
<tr>
<td>type</td>
<td>检查某个key的类型</td>
<td>type key</td>
</tr>
<tr>
<td>select</td>
<td>切换redis数据库</td>
<td>select 0-15 redis中共有16个数据库</td>
</tr>
<tr>
<td>flushdb</td>
<td>清空单个数据库</td>
<td>flushdb</td>
</tr>
<tr>
<td>flushall</td>
<td>清空全部数据库</td>
<td>flushall</td>
</tr>
<tr>
<td>incr</td>
<td>自动加1</td>
<td>incr key</td>
</tr>
<tr>
<td>decr</td>
<td>自动减1</td>
<td>decr key</td>
</tr>
<tr>
<td>incrby</td>
<td>指定数值添加</td>
<td>incrby 10</td>
</tr>
<tr>
<td>decrby</td>
<td>指定数值减</td>
<td>decrby 10</td>
</tr>
<tr>
<td>expire</td>
<td>指定key的生效时间 单位秒</td>
<td>expire key 20 key20秒后失效</td>
</tr>
<tr>
<td>pexpire</td>
<td>指定key的失效时间 单位毫秒</td>
<td>pexpire key 2000key 2000毫秒后失效</td>
</tr>
<tr>
<td>ttl</td>
<td>检查key的剩余存活时间</td>
<td>ttl key</td>
</tr>
<tr>
<td>persist</td>
<td>撤销key的失效时间</td>
<td>persist key</td>
</tr>
</tbody></table>
<h3 id="1-1-1-2Hash类型"><a href="#1-1-1-2Hash类型" class="headerlink" title="1. 1.1.2Hash类型"></a>1. 1.1.2Hash类型</h3><p>说明:可以用散列类型保存对象和属性值</p>
<p>例子:User对象{id:2,name:小明,age:19}</p>
<table>
<thead>
<tr>
<th>命令</th>
<th>说明</th>
<th>案例</th>
</tr>
</thead>
<tbody><tr>
<td>hset</td>
<td>为对象添加数据</td>
<td>hset key field value</td>
</tr>
<tr>
<td>hget</td>
<td>获取对象的属性值</td>
<td>hget key field</td>
</tr>
<tr>
<td>hexists</td>
<td>判断对象的属性是否存在</td>
<td>HEXISTS key field1表示存在  0表示不存在</td>
</tr>
<tr>
<td>hdel</td>
<td>删除hash中的属性</td>
<td>hdel user field [field …]</td>
</tr>
<tr>
<td>hgetall</td>
<td>获取hash全部元素和值</td>
<td>HGETALL key</td>
</tr>
<tr>
<td>hkyes</td>
<td>获取hash中的所有字段</td>
<td>HKEYS key</td>
</tr>
<tr>
<td>hlen</td>
<td>获取hash中所有属性的数量</td>
<td>hlen key</td>
</tr>
<tr>
<td>hmget</td>
<td>获取hash里面指定字段的值</td>
<td>hmget key field [field …]</td>
</tr>
<tr>
<td>hmset</td>
<td>为hash的多个字段设定值</td>
<td>hmset key field value [field value …]</td>
</tr>
<tr>
<td>hsetnx</td>
<td>设置hash的一个字段,只有当这个字段不存在时有效</td>
<td>HSETNX key field value</td>
</tr>
<tr>
<td>hstrlen</td>
<td>获取hash中指定key的长度</td>
<td>HSTRLEN key field</td>
</tr>
<tr>
<td>hvals</td>
<td>获取hash的所有值</td>
<td>HVALS user</td>
</tr>
</tbody></table>
<h3 id="1-1-1-3List类型"><a href="#1-1-1-3List类型" class="headerlink" title="1. 1.1.3List类型"></a>1. 1.1.3List类型</h3><p>说明:Redis中的List集合是双端循环列表,分别可以从左右两个方向插入数据.</p>
<p>List集合可以当做队列使用,也可以当做栈使用</p>
<p>队列:存入数据的方向和获取数据的方向相反</p>
<p>栈:存入数据的方向和获取数据的方向相同</p>
<table>
<thead>
<tr>
<th>命令</th>
<th>说明</th>
<th>案例</th>
</tr>
</thead>
<tbody><tr>
<td>lpush</td>
<td>从队列的左边入队一个或多个元素</td>
<td>LPUSH key value [value …]</td>
</tr>
<tr>
<td>rpush</td>
<td>从队列的右边入队一个或多个元素</td>
<td>RPUSH key value [value …]</td>
</tr>
<tr>
<td>lpop</td>
<td>从队列的左端出队一个元素</td>
<td>LPOP key</td>
</tr>
<tr>
<td>rpop</td>
<td>从队列的右端出队一个元素</td>
<td>RPOP key</td>
</tr>
<tr>
<td>lpushx</td>
<td>当队列存在时从队列的左侧入队一个元素</td>
<td>LPUSHX key value</td>
</tr>
<tr>
<td>rpushx</td>
<td>当队列存在时从队列的右侧入队一个元素</td>
<td>RPUSHx key value</td>
</tr>
<tr>
<td>lrange</td>
<td>从列表中获取指定返回的元素</td>
<td>LRANGE key start stop  Lrange key 0 -1 获取全部队列的数据</td>
</tr>
<tr>
<td>lrem</td>
<td>从存于 key 的列表里移除前 count 次出现的值为 value 的元素。 这个 count 参数通过下面几种方式影响这个操作：</td>
<td></td>
</tr>
<tr>
<td>- count &gt; 0: 从头往尾移除值为 value 的元素。</td>
<td></td>
<td></td>
</tr>
<tr>
<td>- count &lt; 0: 从尾往头移除值为 value 的元素。</td>
<td></td>
<td></td>
</tr>
<tr>
<td>- count = 0: 移除所有值为 value 的元素。</td>
<td></td>
<td></td>
</tr>
<tr>
<td>LREM list -2 “hello” 会从存于 list 的列表里移除最后两个出现的 “hello”。需要注意的是，如果list里没有存在key就会被当作空list处理，所以当 key 不存在的时候，这个命令会返回 0。</td>
<td></td>
<td></td>
</tr>
<tr>
<td>Lset</td>
<td>设置 index 位置的list元素的值为 value</td>
<td>LSET key index value</td>
</tr>
</tbody></table>
<h3 id="1-1-1-4Redis事务命令"><a href="#1-1-1-4Redis事务命令" class="headerlink" title="1.1.1.4Redis事务命令"></a>1.1.1.4Redis事务命令</h3><p>说明:redis中操作可以添加事务的支持.一项任务可以由多个redis命令完成,如果有一个命令失败导致入库失败时.需要实现事务回滚.</p>
<table>
<thead>
<tr>
<th>命令</th>
<th>说明</th>
<th>案例</th>
</tr>
</thead>
<tbody><tr>
<td>multi</td>
<td>标记一个事务开始</td>
<td>127.0.0.1:6379&gt; MULTIOK</td>
</tr>
<tr>
<td>exec</td>
<td>执行所有multi之后发的命令</td>
<td>127.0.0.1:6379&gt; EXEC OK</td>
</tr>
<tr>
<td>discard</td>
<td>丢弃所有multi之后发的命令</td>
<td></td>
</tr>
</tbody></table>
<h1 id="2Redis高级应用"><a href="#2Redis高级应用" class="headerlink" title="2Redis高级应用"></a>2Redis高级应用</h1><h2 id="2-1-Redis入门案例"><a href="#2-1-Redis入门案例" class="headerlink" title="2.1 Redis入门案例"></a>2.1 Redis入门案例</h2><h3 id="2-1-1添加jar包文件"><a href="#2-1-1添加jar包文件" class="headerlink" title="2.1.1添加jar包文件"></a>2.1.1添加jar包文件</h3><p>说明:在JT-PARENT项目中添加jar包文件</p>
<pre><code>&lt;!-- jedis --&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;redis.clients&lt;/groupId&gt;
        &lt;artifactId&gt;jedis&lt;/artifactId&gt;
        &lt;version&gt;${jedis.version}&lt;/version&gt;
    &lt;/dependency&gt;

    &lt;!--添加spring-datajar包  --&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.data&lt;/groupId&gt;
        &lt;artifactId&gt;spring-data-redis&lt;/artifactId&gt;
        &lt;version&gt;1.4.1.RELEASE&lt;/version&gt;
    &lt;/dependency&gt;</code></pre><p>2.1.2入门案例-String</p>
<pre><code>/**
 * 连接单台redis  
 * 参数介绍:
 *     redisIP地址.
 *  redis:6379
 */
@Test
public void test01(){
    Jedis jedis = new Jedis(&quot;192.168.126.166&quot;,6379);
    jedis.set(&quot;redis&quot;, &quot;redis入门案例&quot;);
    System.out.println
    (&quot;获取redis中的数据:&quot;+jedis.get(&quot;redis&quot;));
    //为数据设定超时时间  单位秒
    jedis.setex(&quot;1804&quot;, 100, &quot;1804班&quot;);
}</code></pre><p>2.1.3入门案例-hash</p>
<pre><code>@Test
public void test01(){
    Jedis jedis = new Jedis(&quot;192.168.126.148&quot;, 6379);
    jedis.hset(&quot;user&quot;, &quot;id&quot;, &quot;1&quot;);
    jedis.hset(&quot;user&quot;, &quot;name&quot;, &quot;tomcat&quot;);
    jedis.hset(&quot;user&quot;, &quot;age&quot;, &quot;18&quot;);
    System.out.println(&quot;操作完成!!!&quot;+jedis.hget(&quot;user&quot;, &quot;id&quot;));
    Map&lt;String,String&gt; map = jedis.hgetAll(&quot;user&quot;);
    System.out.println(map);
}</code></pre><p>结果展现:<br>操作完成!!!1<br>{name=tomcat, age=18, id=1}<br>2.1.4入门案例-List</p>
<pre><code>@Test
public void test02(){
    Jedis jedis = new Jedis(&quot;192.168.126.148&quot;, 6379);
    Long number = jedis.lpush(&quot;list&quot;, &quot;a&quot;,&quot;b&quot;,&quot;c&quot;,&quot;d&quot;,&quot;e&quot;);
    System.out.println(&quot;获取数据&quot;+number);
    List&lt;String&gt; list= jedis.lrange(&quot;list&quot;, 0, -1);
    System.out.println(&quot;获取参数:&quot;+list);
}</code></pre><p>结果展现:<br>获取数据5<br>获取参数:[e, d, c, b, a]</p>
]]></content>
      <categories>
        <category>后端</category>
      </categories>
      <tags>
        <tag>java</tag>
        <tag>redis</tag>
      </tags>
  </entry>
  <entry>
    <title>Redis</title>
    <url>/2020/03/24/Redis/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h1><h2 id="1、什么是Redis？"><a href="#1、什么是Redis？" class="headerlink" title="1、什么是Redis？"></a>1、什么是Redis？</h2><p>Redis本质上是一个Key-Value类型的内存数据库，很像memcached，整个数据库统统加载在内存当中进行操作，定期通过异步操作把数据库数据flush到硬盘上进行保存。因为是纯内存操作，Redis的性能非常出色，每秒可以处理超过 10万次读写操作，是已知性能最快的Key-Value DB。 Redis的出色之处不仅仅是性能，Redis最大的魅力是支持保存多种数据结构，此外单个value的最大限制是1GB，不像 memcached只能保存1MB的数据，因此Redis可以用来实现很多有用的功能，比方说用他的List来做FIFO双向链表，实现一个轻量级的高性 能消息队列服务，用他的Set可以做高性能的tag系统等等。另外Redis也可以对存入的Key-Value设置expire时间，因此也可以被当作一 个功能加强版的memcached来用。 Redis的主要缺点是数据库容量受到物理内存的限制，不能用作海量数据的高性能读写，因此Redis适合的场景主要局限在较小数据量的高性能操作和运算上。</p>
<h2 id="2、Redis相比memcached有哪些优势？"><a href="#2、Redis相比memcached有哪些优势？" class="headerlink" title="2、Redis相比memcached有哪些优势？"></a>2、Redis相比memcached有哪些优势？</h2><p>(1) memcached所有的值均是简单的字符串，redis作为其替代者，支持更为丰富的数据类型</p>
<p>(2) redis的速度比memcached快很多</p>
<p>(3) redis可以持久化其数据</p>
<h2 id="3、Redis支持哪几种数据类型？"><a href="#3、Redis支持哪几种数据类型？" class="headerlink" title="3、Redis支持哪几种数据类型？"></a>3、Redis支持哪几种数据类型？</h2><p>String、List、Set、Sorted Set、hashes</p>
<h2 id="4、Redis主要消耗什么物理资源？"><a href="#4、Redis主要消耗什么物理资源？" class="headerlink" title="4、Redis主要消耗什么物理资源？"></a>4、Redis主要消耗什么物理资源？</h2><p>内存。</p>
<h2 id="5、Redis的全称是什么？"><a href="#5、Redis的全称是什么？" class="headerlink" title="5、Redis的全称是什么？"></a>5、Redis的全称是什么？</h2><p>Remote Dictionary Server。</p>
<h2 id="6、Redis有哪几种数据淘汰策略？"><a href="#6、Redis有哪几种数据淘汰策略？" class="headerlink" title="6、Redis有哪几种数据淘汰策略？"></a>6、Redis有哪几种数据淘汰策略？</h2><p>noeviction:返回错误当内存限制达到并且客户端尝试执行会让更多内存被使用的命令（大部分的写入指令，但DEL和几个例外）</p>
<p>allkeys-lru: 尝试回收最少使用的键（LRU），使得新添加的数据有空间存放。</p>
<p>volatile-lru: 尝试回收最少使用的键（LRU），但仅限于在过期集合的键,使得新添加的数据有空间存放。</p>
<p>allkeys-random: 回收随机的键使得新添加的数据有空间存放。</p>
<p>volatile-random: 回收随机的键使得新添加的数据有空间存放，但仅限于在过期集合的键。</p>
<p>volatile-ttl: 回收在过期集合的键，并且优先回收存活时间（TTL）较短的键,使得新添加的数据有空间存放。</p>
<h2 id="7、Redis官方为什么不提供Windows版本？"><a href="#7、Redis官方为什么不提供Windows版本？" class="headerlink" title="7、Redis官方为什么不提供Windows版本？"></a>7、Redis官方为什么不提供Windows版本？</h2><p>因为目前Linux版本已经相当稳定，而且用户量很大，无需开发windows版本，反而会带来兼容性等问题。</p>
<h2 id="8、一个字符串类型的值能存储最大容量是多少？"><a href="#8、一个字符串类型的值能存储最大容量是多少？" class="headerlink" title="8、一个字符串类型的值能存储最大容量是多少？"></a>8、一个字符串类型的值能存储最大容量是多少？</h2><p>512M</p>
<h2 id="9、为什么Redis需要把所有数据放到内存中？"><a href="#9、为什么Redis需要把所有数据放到内存中？" class="headerlink" title="9、为什么Redis需要把所有数据放到内存中？"></a>9、为什么Redis需要把所有数据放到内存中？</h2><p>Redis为了达到最快的读写速度将数据都读到内存中，并通过异步的方式将数据写入磁盘。所以redis具有快速和数据持久化的特征。如果不将数据放在内存中，磁盘I/O速度为严重影响redis的性能。在内存越来越便宜的今天，redis将会越来越受欢迎。 如果设置了最大使用的内存，则数据已有记录数达到内存限值后不能继续插入新值。</p>
<h2 id="10、Redis集群方案应该怎么做？都有哪些方案？"><a href="#10、Redis集群方案应该怎么做？都有哪些方案？" class="headerlink" title="10、Redis集群方案应该怎么做？都有哪些方案？"></a>10、Redis集群方案应该怎么做？都有哪些方案？</h2><p>1.twemproxy，大概概念是，它类似于一个代理方式，使用方法和普通redis无任何区别，设置好它下属的多个redis实例后，使用时在本需要连接redis的地方改为连接twemproxy，它会以一个代理的身份接收请求并使用一致性hash算法，将请求转接到具体redis，将结果再返回twemproxy。使用方式简便(相对redis只需修改连接端口)，对旧项目扩展的首选。 问题：twemproxy自身单端口实例的压力，使用一致性hash后，对redis节点数量改变时候的计算值的改变，数据无法自动移动到新的节点。</p>
<p>2.codis，目前用的最多的集群方案，基本和twemproxy一致的效果，但它支持在 节点数量改变情况下，旧节点数据可恢复到新hash节点。</p>
<p>3.redis cluster3.0自带的集群，特点在于他的分布式算法不是一致性hash，而是hash槽的概念，以及自身支持节点设置从节点。具体看官方文档介绍。</p>
<p>4.在业务代码层实现，起几个毫无关联的redis实例，在代码层，对key 进行hash计算，然后去对应的redis实例操作数据。 这种方式对hash层代码要求比较高，考虑部分包括，节点失效后的替代算法方案，数据震荡后的自动脚本恢复，实例的监控，等等。</p>
<h2 id="11、Redis集群方案什么情况下会导致整个集群不可用？"><a href="#11、Redis集群方案什么情况下会导致整个集群不可用？" class="headerlink" title="11、Redis集群方案什么情况下会导致整个集群不可用？"></a>11、Redis集群方案什么情况下会导致整个集群不可用？</h2><p>有A，B，C三个节点的集群,在没有复制模型的情况下,如果节点B失败了，那么整个集群就会以为缺少5501-11000这个范围的槽而不可用。</p>
<h2 id="12、MySQL里有2000w数据，redis中只存20w的数据，如何保证redis中的数据都是热点数据？"><a href="#12、MySQL里有2000w数据，redis中只存20w的数据，如何保证redis中的数据都是热点数据？" class="headerlink" title="12、MySQL里有2000w数据，redis中只存20w的数据，如何保证redis中的数据都是热点数据？"></a>12、MySQL里有2000w数据，redis中只存20w的数据，如何保证redis中的数据都是热点数据？</h2><p>redis内存数据集大小上升到一定大小的时候，就会施行数据淘汰策略。</p>
<h2 id="13、Redis有哪些适合的场景？"><a href="#13、Redis有哪些适合的场景？" class="headerlink" title="13、Redis有哪些适合的场景？"></a>13、Redis有哪些适合的场景？</h2><p>（1）、会话缓存（Session Cache）</p>
<p>最常用的一种使用Redis的情景是会话缓存（session cache）。用Redis缓存会话比其他存储（如Memcached）的优势在于：Redis提供持久化。当维护一个不是严格要求一致性的缓存时，如果用户的购物车信息全部丢失，大部分人都会不高兴的，现在，他们还会这样吗？</p>
<p>幸运的是，随着 Redis 这些年的改进，很容易找到怎么恰当的使用Redis来缓存会话的文档。甚至广为人知的商业平台Magento也提供Redis的插件。</p>
<p>（2）、全页缓存（FPC）</p>
<p>除基本的会话token之外，Redis还提供很简便的FPC平台。回到一致性问题，即使重启了Redis实例，因为有磁盘的持久化，用户也不会看到页面加载速度的下降，这是一个极大改进，类似PHP本地FPC。</p>
<p>再次以Magento为例，Magento提供一个插件来使用Redis作为全页缓存后端。</p>
<p>此外，对WordPress的用户来说，Pantheon有一个非常好的插件 wp-redis，这个插件能帮助你以最快速度加载你曾浏览过的页面。</p>
<p>（3）、队列</p>
<p>Reids在内存存储引擎领域的一大优点是提供 list 和 set 操作，这使得Redis能作为一个很好的消息队列平台来使用。Redis作为队列使用的操作，就类似于本地程序语言（如Python）对 list 的 push/pop 操作。</p>
<p>如果你快速的在Google中搜索“Redis queues”，你马上就能找到大量的开源项目，这些项目的目的就是利用Redis创建非常好的后端工具，以满足各种队列需求。例如，Celery有一个后台就是使用Redis作为broker，你可以从这里去查看。</p>
<p>（4），排行榜/计数器</p>
<p>Redis在内存中对数字进行递增或递减的操作实现的非常好。集合（Set）和有序集合（Sorted Set）也使得我们在执行这些操作的时候变的非常简单，Redis只是正好提供了这两种数据结构。所以，我们要从排序集合中获取到排名最靠前的10个用户–我们称之为“user_scores”，我们只需要像下面一样执行即可：</p>
<p>当然，这是假定你是根据你用户的分数做递增的排序。如果你想返回用户及用户的分数，你需要这样执行：</p>
<p>ZRANGE user_scores 0 10 WITHSCORES</p>
<p>Agora Games就是一个很好的例子，用Ruby实现的，它的排行榜就是使用Redis来存储数据的，你可以在这里看到。</p>
<p>（5）、发布/订阅</p>
<p>最后（但肯定不是最不重要的）是Redis的发布/订阅功能。发布/订阅的使用场景确实非常多。我已看见人们在社交网络连接中使用，还可作为基于发布/订阅的脚本触发器，甚至用Redis的发布/订阅功能来建立聊天系统！（不，这是真的，你可以去核实）。</p>
<h2 id="14、Redis支持的Java客户端都有哪些？官方推荐用哪个？"><a href="#14、Redis支持的Java客户端都有哪些？官方推荐用哪个？" class="headerlink" title="14、Redis支持的Java客户端都有哪些？官方推荐用哪个？"></a>14、Redis支持的Java客户端都有哪些？官方推荐用哪个？</h2><p>Redisson、Jedis、lettuce等等，官方推荐使用Redisson。</p>
<h2 id="15、Redis和Redisson有什么关系？"><a href="#15、Redis和Redisson有什么关系？" class="headerlink" title="15、Redis和Redisson有什么关系？"></a>15、Redis和Redisson有什么关系？</h2><p>Redisson是一个高级的分布式协调Redis客服端，能帮助用户在分布式环境中轻松实现一些Java的对象 (Bloom filter, BitSet, Set, SetMultimap, ScoredSortedSet, SortedSet, Map, ConcurrentMap, List, ListMultimap, Queue, BlockingQueue, Deque, BlockingDeque, Semaphore, Lock, ReadWriteLock, AtomicLong, CountDownLatch, Publish / Subscribe, HyperLogLog)。</p>
<h2 id="16、Jedis与Redisson对比有什么优缺点？"><a href="#16、Jedis与Redisson对比有什么优缺点？" class="headerlink" title="16、Jedis与Redisson对比有什么优缺点？"></a>16、Jedis与Redisson对比有什么优缺点？</h2><p>Jedis是Redis的Java实现的客户端，其API提供了比较全面的Redis命令的支持；Redisson实现了分布式和可扩展的Java数据结构，和Jedis相比，功能较为简单，不支持字符串操作，不支持排序、事务、管道、分区等Redis特性。Redisson的宗旨是促进使用者对Redis的关注分离，从而让使用者能够将精力更集中地放在处理业务逻辑上。</p>
<h2 id="17、Redis如何设置密码及验证密码？"><a href="#17、Redis如何设置密码及验证密码？" class="headerlink" title="17、Redis如何设置密码及验证密码？"></a>17、Redis如何设置密码及验证密码？</h2><p>设置密码：config set requirepass 123456</p>
<p>授权密码：auth 123456</p>
<h2 id="18、说说Redis哈希槽的概念？"><a href="#18、说说Redis哈希槽的概念？" class="headerlink" title="18、说说Redis哈希槽的概念？"></a>18、说说Redis哈希槽的概念？</h2><p>Redis集群没有使用一致性hash,而是引入了哈希槽的概念，Redis集群有16384个哈希槽，每个key通过CRC16校验后对16384取模来决定放置哪个槽，集群的每个节点负责一部分hash槽。</p>
<h2 id="19、Redis集群的主从复制模型是怎样的？"><a href="#19、Redis集群的主从复制模型是怎样的？" class="headerlink" title="19、Redis集群的主从复制模型是怎样的？"></a>19、Redis集群的主从复制模型是怎样的？</h2><p>为了使在部分节点失败或者大部分节点无法通信的情况下集群仍然可用，所以集群使用了主从复制模型,每个节点都会有N-1个复制品.</p>
<h2 id="20、Redis集群会有写操作丢失吗？为什么？"><a href="#20、Redis集群会有写操作丢失吗？为什么？" class="headerlink" title="20、Redis集群会有写操作丢失吗？为什么？"></a>20、Redis集群会有写操作丢失吗？为什么？</h2><p>Redis并不能保证数据的强一致性，这意味这在实际中集群在特定的条件下可能会丢失写操作。</p>
<h2 id="21、Redis集群之间是如何复制的？"><a href="#21、Redis集群之间是如何复制的？" class="headerlink" title="21、Redis集群之间是如何复制的？"></a>21、Redis集群之间是如何复制的？</h2><p>异步复制</p>
<h2 id="22、Redis集群最大节点个数是多少？"><a href="#22、Redis集群最大节点个数是多少？" class="headerlink" title="22、Redis集群最大节点个数是多少？"></a>22、Redis集群最大节点个数是多少？</h2><p>16384个。</p>
<h2 id="23、Redis集群如何选择数据库？"><a href="#23、Redis集群如何选择数据库？" class="headerlink" title="23、Redis集群如何选择数据库？"></a>23、Redis集群如何选择数据库？</h2><p>Redis集群目前无法做数据库选择，默认在0数据库。</p>
<h2 id="24、怎么测试Redis的连通性？"><a href="#24、怎么测试Redis的连通性？" class="headerlink" title="24、怎么测试Redis的连通性？"></a>24、怎么测试Redis的连通性？</h2><p>ping</p>
<h2 id="25、Redis中的管道有什么用？"><a href="#25、Redis中的管道有什么用？" class="headerlink" title="25、Redis中的管道有什么用？"></a>25、Redis中的管道有什么用？</h2><p>一次请求/响应服务器能实现处理新的请求即使旧的请求还未被响应。这样就可以将多个命令发送到服务器，而不用等待回复，最后在一个步骤中读取该答复。</p>
<p>这就是管道（pipelining），是一种几十年来广泛使用的技术。例如许多POP3协议已经实现支持这个功能，大大加快了从服务器下载新邮件的过程。</p>
<h2 id="26、怎么理解Redis事务？"><a href="#26、怎么理解Redis事务？" class="headerlink" title="26、怎么理解Redis事务？"></a>26、怎么理解Redis事务？</h2><p>事务是一个单独的隔离操作：事务中的所有命令都会序列化、按顺序地执行。事务在执行的过程中，不会被其他客户端发送来的命令请求所打断。</p>
<p>事务是一个原子操作：事务中的命令要么全部被执行，要么全部都不执行。</p>
<h2 id="27、Redis事务相关的命令有哪几个？"><a href="#27、Redis事务相关的命令有哪几个？" class="headerlink" title="27、Redis事务相关的命令有哪几个？"></a>27、Redis事务相关的命令有哪几个？</h2><p>MULTI、EXEC、DISCARD、WATCH</p>
<h2 id="28、Redis-key的过期时间和永久有效分别怎么设置？"><a href="#28、Redis-key的过期时间和永久有效分别怎么设置？" class="headerlink" title="28、Redis key的过期时间和永久有效分别怎么设置？"></a>28、Redis key的过期时间和永久有效分别怎么设置？</h2><p>EXPIRE和PERSIST命令。</p>
<h2 id="29、Redis如何做内存优化？"><a href="#29、Redis如何做内存优化？" class="headerlink" title="29、Redis如何做内存优化？"></a>29、Redis如何做内存优化？</h2><p>尽可能使用散列表（hashes），散列表（是说散列表里面存储的数少）使用的内存非常小，所以你应该尽可能的将你的数据模型抽象到一个散列表里面。比如你的web系统中有一个用户对象，不要为这个用户的名称，姓氏，邮箱，密码设置单独的key,而是应该把这个用户的所有信息存储到一张散列表里面.</p>
<h2 id="30、Redis回收进程如何工作的？"><a href="#30、Redis回收进程如何工作的？" class="headerlink" title="30、Redis回收进程如何工作的？"></a>30、Redis回收进程如何工作的？</h2><p>一个客户端运行了新的命令，添加了新的数据。<br>Redi检查内存使用情况，如果大于maxmemory的限制, 则根据设定好的策略进行回收。<br>一个新的命令被执行，等等。<br>所以我们不断地穿越内存限制的边界，通过不断达到边界然后不断地回收回到边界以下。<br>如果一个命令的结果导致大量内存被使用（例如很大的集合的交集保存到一个新的键），不用多久内存限制就会被这个内存使用量超越。</p>
<h2 id="31、Redis回收使用的是什么算法？"><a href="#31、Redis回收使用的是什么算法？" class="headerlink" title="31、Redis回收使用的是什么算法？"></a>31、Redis回收使用的是什么算法？</h2><p>LRU算法</p>
<h2 id="32、Redis如何做大量数据插入？"><a href="#32、Redis如何做大量数据插入？" class="headerlink" title="32、Redis如何做大量数据插入？"></a>32、Redis如何做大量数据插入？</h2><p>Redis2.6开始redis-cli支持一种新的被称之为pipe mode的新模式用于执行大量数据插入工作。</p>
<h2 id="33、为什么要做Redis分区？"><a href="#33、为什么要做Redis分区？" class="headerlink" title="33、为什么要做Redis分区？"></a>33、为什么要做Redis分区？</h2><p>分区可以让Redis管理更大的内存，Redis将可以使用所有机器的内存。如果没有分区，你最多只能使用一台机器的内存。分区使Redis的计算能力通过简单地增加计算机得到成倍提升,Redis的网络带宽也会随着计算机和网卡的增加而成倍增长。</p>
<h2 id="34、你知道有哪些Redis分区实现方案？"><a href="#34、你知道有哪些Redis分区实现方案？" class="headerlink" title="34、你知道有哪些Redis分区实现方案？"></a>34、你知道有哪些Redis分区实现方案？</h2><p>客户端分区就是在客户端就已经决定数据会被存储到哪个redis节点或者从哪个redis节点读取。大多数客户端已经实现了客户端分区。</p>
<p>代理分区 意味着客户端将请求发送给代理，然后代理决定去哪个节点写数据或者读数据。代理根据分区规则决定请求哪些Redis实例，然后根据Redis的响应结果返回给客户端。redis和memcached的一种代理实现就是Twemproxy</p>
<p>查询路由(Query routing) 的意思是客户端随机地请求任意一个redis实例，然后由Redis将请求转发给正确的Redis节点。Redis Cluster实现了一种混合形式的查询路由，但并不是直接将请求从一个redis节点转发到另一个redis节点，而是在客户端的帮助下直接redirected到正确的redis节点。</p>
<h2 id="35、Redis分区有什么缺点？"><a href="#35、Redis分区有什么缺点？" class="headerlink" title="35、Redis分区有什么缺点？"></a>35、Redis分区有什么缺点？</h2><p>涉及多个key的操作通常不会被支持。例如你不能对两个集合求交集，因为他们可能被存储到不同的Redis实例（实际上这种情况也有办法，但是不能直接使用交集指令）。<br>同时操作多个key,则不能使用Redis事务.<br>分区使用的粒度是key，不能使用一个非常长的排序key存储一个数据集（The partitioning granularity is the key, so it is not possible to shard a dataset with a single huge key like a very big sorted set）.<br>当使用分区的时候，数据处理会非常复杂，例如为了备份你必须从不同的Redis实例和主机同时收集RDB / AOF文件。<br>分区时动态扩容或缩容可能非常复杂。Redis集群在运行时增加或者删除Redis节点，能做到最大程度对用户透明地数据再平衡，但其他一些客户端分区或者代理分区方法则不支持这种特性。然而，有一种预分片的技术也可以较好的解决这个问题。</p>
<h2 id="36、Redis持久化数据和缓存怎么做扩容？"><a href="#36、Redis持久化数据和缓存怎么做扩容？" class="headerlink" title="36、Redis持久化数据和缓存怎么做扩容？"></a>36、Redis持久化数据和缓存怎么做扩容？</h2><p>如果Redis被当做缓存使用，使用一致性哈希实现动态扩容缩容。<br>如果Redis被当做一个持久化存储使用，必须使用固定的keys-to-nodes映射关系，节点的数量一旦确定不能变化。否则的话(即Redis节点需要动态变化的情况），必须使用可以在运行时进行数据再平衡的一套系统，而当前只有Redis集群可以做到这样。</p>
<h2 id="37、分布式Redis是前期做还是后期规模上来了再做好？为什么？"><a href="#37、分布式Redis是前期做还是后期规模上来了再做好？为什么？" class="headerlink" title="37、分布式Redis是前期做还是后期规模上来了再做好？为什么？"></a>37、分布式Redis是前期做还是后期规模上来了再做好？为什么？</h2><p>既然Redis是如此的轻量（单实例只使用1M内存）,为防止以后的扩容，最好的办法就是一开始就启动较多实例。即便你只有一台服务器，你也可以一开始就让Redis以分布式的方式运行，使用分区，在同一台服务器上启动多个实例。</p>
<p>一开始就多设置几个Redis实例，例如32或者64个实例，对大多数用户来说这操作起来可能比较麻烦，但是从长久来看做这点牺牲是值得的。</p>
<p>这样的话，当你的数据不断增长，需要更多的Redis服务器时，你需要做的就是仅仅将Redis实例从一台服务迁移到另外一台服务器而已（而不用考虑重新分区的问题）。一旦你添加了另一台服务器，你需要将你一半的Redis实例从第一台机器迁移到第二台机器。</p>
<h2 id="38、Twemproxy是什么？"><a href="#38、Twemproxy是什么？" class="headerlink" title="38、Twemproxy是什么？"></a>38、Twemproxy是什么？</h2><p>Twemproxy是Twitter维护的（缓存）代理系统，代理Memcached的ASCII协议和Redis协议。它是单线程程序，使用c语言编写，运行起来非常快。它是采用Apache 2.0 license的开源软件。 Twemproxy支持自动分区，如果其代理的其中一个Redis节点不可用时，会自动将该节点排除（这将改变原来的keys-instances的映射关系，所以你应该仅在把Redis当缓存时使用Twemproxy)。 Twemproxy本身不存在单点问题，因为你可以启动多个Twemproxy实例，然后让你的客户端去连接任意一个Twemproxy实例。 Twemproxy是Redis客户端和服务器端的一个中间层，由它来处理分区功能应该不算复杂，并且应该算比较可靠的。</p>
<h2 id="39、支持一致性哈希的客户端有哪些？"><a href="#39、支持一致性哈希的客户端有哪些？" class="headerlink" title="39、支持一致性哈希的客户端有哪些？"></a>39、支持一致性哈希的客户端有哪些？</h2><p>Redis-rb、Predis等。</p>
<h2 id="40、Redis与其他key-value存储有什么不同？"><a href="#40、Redis与其他key-value存储有什么不同？" class="headerlink" title="40、Redis与其他key-value存储有什么不同？"></a>40、Redis与其他key-value存储有什么不同？</h2><p>Redis有着更为复杂的数据结构并且提供对他们的原子性操作，这是一个不同于其他数据库的进化路径。Redis的数据类型都是基于基本数据结构的同时对程序员透明，无需进行额外的抽象。<br>Redis运行在内存中但是可以持久化到磁盘，所以在对不同数据集进行高速读写时需要权衡内存，应为数据量不能大于硬件内存。在内存数据库方面的另一个优点是， 相比在磁盘上相同的复杂的数据结构，在内存中操作起来非常简单，这样Redis可以做很多内部复杂性很强的事情。 同时，在磁盘格式方面他们是紧凑的以追加的方式产生的，因为他们并不需要进行随机访问。</p>
<h2 id="41、Redis的内存占用情况怎么样？"><a href="#41、Redis的内存占用情况怎么样？" class="headerlink" title="41、Redis的内存占用情况怎么样？"></a>41、Redis的内存占用情况怎么样？</h2><p>给你举个例子： 100万个键值对（键是0到999999值是字符串“hello world”）在我的32位的Mac笔记本上 用了100MB。同样的数据放到一个key里只需要16MB， 这是因为键值有一个很大的开销。 在Memcached上执行也是类似的结果，但是相对Redis的开销要小一点点，因为Redis会记录类型信息引用计数等等。</p>
<p>当然，大键值对时两者的比例要好很多。</p>
<p>64位的系统比32位的需要更多的内存开销，尤其是键值对都较小时，这是因为64位的系统里指针占用了8个字节。 但是，当然，64位系统支持更大的内存，所以为了运行大型的Redis服务器或多或少的需要使用64位的系统。</p>
<h2 id="42、都有哪些办法可以降低Redis的内存使用情况呢？"><a href="#42、都有哪些办法可以降低Redis的内存使用情况呢？" class="headerlink" title="42、都有哪些办法可以降低Redis的内存使用情况呢？"></a>42、都有哪些办法可以降低Redis的内存使用情况呢？</h2><p>如果你使用的是32位的Redis实例，可以好好利用Hash,list,sorted set,set等集合类型数据，因为通常情况下很多小的Key-Value可以用更紧凑的方式存放到一起。</p>
<h2 id="43、查看Redis使用情况及状态信息用什么命令？"><a href="#43、查看Redis使用情况及状态信息用什么命令？" class="headerlink" title="43、查看Redis使用情况及状态信息用什么命令？"></a>43、查看Redis使用情况及状态信息用什么命令？</h2><p>info</p>
<h2 id="44、Redis的内存用完了会发生什么？"><a href="#44、Redis的内存用完了会发生什么？" class="headerlink" title="44、Redis的内存用完了会发生什么？"></a>44、Redis的内存用完了会发生什么？</h2><p>如果达到设置的上限，Redis的写命令会返回错误信息（但是读命令还可以正常返回。）或者你可以将Redis当缓存来使用配置淘汰机制，当Redis达到内存上限时会冲刷掉旧的内容。</p>
<h2 id="45、Redis是单线程的，如何提高多核CPU的利用率？"><a href="#45、Redis是单线程的，如何提高多核CPU的利用率？" class="headerlink" title="45、Redis是单线程的，如何提高多核CPU的利用率？"></a>45、Redis是单线程的，如何提高多核CPU的利用率？</h2><p>可以在同一个服务器部署多个Redis的实例，并把他们当作不同的服务器来使用，在某些时候，无论如何一个服务器是不够的， 所以，如果你想使用多个CPU，你可以考虑一下分片（shard）。</p>
<h2 id="46、一个Redis实例最多能存放多少的keys？List、Set、Sorted-Set他们最多能存放多少元素？"><a href="#46、一个Redis实例最多能存放多少的keys？List、Set、Sorted-Set他们最多能存放多少元素？" class="headerlink" title="46、一个Redis实例最多能存放多少的keys？List、Set、Sorted Set他们最多能存放多少元素？"></a>46、一个Redis实例最多能存放多少的keys？List、Set、Sorted Set他们最多能存放多少元素？</h2><p>理论上Redis可以处理多达232的keys，并且在实际中进行了测试，每个实例至少存放了2亿5千万的keys。我们正在测试一些较大的值。</p>
<p>任何list、set、和sorted set都可以放232个元素。</p>
<p>换句话说，Redis的存储极限是系统中的可用内存值。</p>
<h2 id="47、Redis常见性能问题和解决方案？"><a href="#47、Redis常见性能问题和解决方案？" class="headerlink" title="47、Redis常见性能问题和解决方案？"></a>47、Redis常见性能问题和解决方案？</h2><p>(1) Master最好不要做任何持久化工作，如RDB内存快照和AOF日志文件</p>
<p>(2) 如果数据比较重要，某个Slave开启AOF备份数据，策略设置为每秒同步一次</p>
<p>(3) 为了主从复制的速度和连接的稳定性，Master和Slave最好在同一个局域网内</p>
<p>(4) 尽量避免在压力很大的主库上增加从库</p>
<p>(5) 主从复制不要用图状结构，用单向链表结构更为稳定，即：Master &lt;- Slave1 &lt;- Slave2 &lt;- Slave3…</p>
<p>这样的结构方便解决单点故障问题，实现Slave对Master的替换。如果Master挂了，可以立刻启用Slave1做Master，其他不变。</p>
<h2 id="48、Redis提供了哪几种持久化方式？"><a href="#48、Redis提供了哪几种持久化方式？" class="headerlink" title="48、Redis提供了哪几种持久化方式？"></a>48、Redis提供了哪几种持久化方式？</h2><p>RDB持久化方式能够在指定的时间间隔能对你的数据进行快照存储.<br>AOF持久化方式记录每次对服务器写的操作,当服务器重启的时候会重新执行这些命令来恢复原始的数据,AOF命令以redis协议追加保存每次写的操作到文件末尾.Redis还能对AOF文件进行后台重写,使得AOF文件的体积不至于过大.<br>如果你只希望你的数据在服务器运行的时候存在,你也可以不使用任何持久化方式.<br>你也可以同时开启两种持久化方式, 在这种情况下, 当redis重启的时候会优先载入AOF文件来恢复原始的数据,因为在通常情况下AOF文件保存的数据集要比RDB文件保存的数据集要完整.<br>最重要的事情是了解RDB和AOF持久化方式的不同,让我们以RDB持久化方式开始。</p>
<h2 id="49、如何选择合适的持久化方式？"><a href="#49、如何选择合适的持久化方式？" class="headerlink" title="49、如何选择合适的持久化方式？"></a>49、如何选择合适的持久化方式？</h2><p>一般来说， 如果想达到足以媲美PostgreSQL的数据安全性， 你应该同时使用两种持久化功能。如果你非常关心你的数据， 但仍然可以承受数分钟以内的数据丢失，那么你可以只使用RDB持久化。</p>
<p>有很多用户都只使用AOF持久化，但并不推荐这种方式：因为定时生成RDB快照（snapshot）非常便于进行数据库备份， 并且 RDB 恢复数据集的速度也要比AOF恢复的速度要快，除此之外， 使用RDB还可以避免之前提到的AOF程序的bug。</p>
<h2 id="50、修改配置不重启Redis会实时生效吗？"><a href="#50、修改配置不重启Redis会实时生效吗？" class="headerlink" title="50、修改配置不重启Redis会实时生效吗？"></a>50、修改配置不重启Redis会实时生效吗？</h2><p>针对运行实例，有许多配置选项可以通过 CONFIG SET 命令进行修改，而无需执行任何形式的重启。 从 Redis 2.2 开始，可以从 AOF 切换到 RDB 的快照持久性或其他方式而不需要重启 Redis。检索 ‘CONFIG GET *’ 命令获取更多信息。</p>
<p>但偶尔重新启动是必须的，如为升级 Redis 程序到新的版本，或者当你需要修改某些目前 CONFIG 命令还不支持的配置参数的时候。</p>
]]></content>
      <categories>
        <category>后端</category>
      </categories>
      <tags>
        <tag>java</tag>
        <tag>redis</tag>
      </tags>
  </entry>
  <entry>
    <title>Redis集群实现</title>
    <url>/2020/03/26/Redis%E9%9B%86%E7%BE%A4%E5%AE%9E%E7%8E%B0/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="1Redis集群实现"><a href="#1Redis集群实现" class="headerlink" title="1Redis集群实现"></a>1Redis集群实现</h1><h2 id="1-1Redis集群"><a href="#1-1Redis集群" class="headerlink" title="1.1Redis集群"></a>1.1Redis集群</h2><h3 id="1-1-1为什么要搭建集群"><a href="#1-1-1为什么要搭建集群" class="headerlink" title="1.1.1为什么要搭建集群"></a>1.1.1为什么要搭建集群</h3><p>通常，为了提高网站响应速度，总是把热点数据保存在内存中而不是直接从后端数据库中读取。<br>Redis是一个很好的Cache工具。大型网站应用，热点数据量往往巨大，几十G上百G是很正常的事儿。<br>由于内存大小的限制，使用一台 Redis 实例显然无法满足需求，这时就需要使用多台 Redis作为缓存数据库。但是如何保证数据存储的一致性呢,这时就需要搭建redis集群.采用合理的机制,保证用户的正常的访问需求.<br>采用redis集群,可以保证数据分散存储,同时保证数据存储的一致性.并且在内部实现高可用的机制.实现了服务故障的自动迁移.</p>
<h3 id="1-1-2集群搭建计划"><a href="#1-1-2集群搭建计划" class="headerlink" title="1.1.2集群搭建计划"></a>1.1.2集群搭建计划</h3><p>主从划分:<br>3台主机 3台从机共6台  端口划分7000-7005</p>
<h2 id="1-2集群搭建"><a href="#1-2集群搭建" class="headerlink" title="1.2集群搭建"></a>1.2集群搭建</h2><h3 id="1-2-1准备集群文件夹"><a href="#1-2-1准备集群文件夹" class="headerlink" title="1.2.1准备集群文件夹"></a>1.2.1准备集群文件夹</h3><p>1.准备集群文件夹<br>Mkdir cluster<br>2.在cluster文件夹中分别创建7000-7005文件夹</p>
<hr>
<h2 id=""><a href="#" class="headerlink" title=""></a><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://www.zhangpeng.fun/upload/2019/12/image-834d3a15932b4aa5b957be3c7fa90c74.png" alt="image.png"></h2><h3 id="1-2-2复制配置文件"><a href="#1-2-2复制配置文件" class="headerlink" title="1.2.2复制配置文件"></a>1.2.2复制配置文件</h3><p>说明:<br>将redis根目录中的redis.conf文件复制到cluster/7000/ 并以原名保存<br>cp redis.conf cluster/7000/</p>
<h3 id="1-2-3编辑配置文件"><a href="#1-2-3编辑配置文件" class="headerlink" title="1.2.3编辑配置文件"></a>1.2.3编辑配置文件</h3><p>1.注释本地绑定IP地址</p>
<hr>
<h2 id="-1"><a href="#-1" class="headerlink" title=""></a><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://www.zhangpeng.fun/upload/2019/12/image-7b1b777c1e06475da5a6741fdb816604.png" alt="image.png"></h2><p>2.关闭保护模式</p>
<hr>
<h2 id="-2"><a href="#-2" class="headerlink" title=""></a><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://www.zhangpeng.fun/upload/2019/12/image-4a784a85961c4a0186bc3b4192a731f9.png" alt="image.png"></h2><p>3.修改端口号</p>
<hr>
<h2 id="-3"><a href="#-3" class="headerlink" title=""></a><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://www.zhangpeng.fun/upload/2019/12/image-3fda490b94bc4d34b03a2a214944513d.png" alt="image.png"></h2><p>4.启动后台启动</p>
<hr>
<h2 id="-4"><a href="#-4" class="headerlink" title=""></a><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://www.zhangpeng.fun/upload/2019/12/image-d1d236f080d640788e199ce2131b79e8.png" alt="image.png"></h2><p>5.修改pid文件</p>
<hr>
<h2 id="-5"><a href="#-5" class="headerlink" title=""></a><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://www.zhangpeng.fun/upload/2019/12/image-c1e1ab0bbc1e4216b4c5d7a173c3dbb6.png" alt="image.png"></h2><p>6.修改持久化文件路径</p>
<hr>
<h2 id="-6"><a href="#-6" class="headerlink" title=""></a><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://www.zhangpeng.fun/upload/2019/12/image-59bb9452f2d14b559d9a2b6c089f27a4.png" alt="image.png"></h2><p>7.设定内存优化策略</p>
<hr>
<h2 id="-7"><a href="#-7" class="headerlink" title=""></a><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://www.zhangpeng.fun/upload/2019/12/image-05a18d27f9b04f2391a6e742bd14847c.png" alt="image.png"></h2><p>8.关闭AOF模式</p>
<hr>
<h2 id="-8"><a href="#-8" class="headerlink" title=""></a><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://www.zhangpeng.fun/upload/2019/12/image-461db8171ae445f794977741b89ec090.png" alt="image.png"></h2><p>9.开启集群配置</p>
<hr>
<h2 id="-9"><a href="#-9" class="headerlink" title=""></a><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://www.zhangpeng.fun/upload/2019/12/image-17ac0c2902c04c4184d49be6f315809c.png" alt="image.png"></h2><p>10.开启集群配置文件</p>
<hr>
<h2 id="-10"><a href="#-10" class="headerlink" title=""></a><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://www.zhangpeng.fun/upload/2019/12/image-db4a3c20823f4d5daeedb313218988ad.png" alt="image.png"></h2><p>11.修改集群超时时间</p>
<hr>
<h2 id="-11"><a href="#-11" class="headerlink" title=""></a><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://www.zhangpeng.fun/upload/2019/12/image-ae735b01dbc44e3b931d947629e4b7ae.png" alt="image.png"></h2><h3 id="1-2-4复制修改后的配置文件"><a href="#1-2-4复制修改后的配置文件" class="headerlink" title="1.2.4复制修改后的配置文件"></a>1.2.4复制修改后的配置文件</h3><p>说明:将7000文件夹下的redis.conf文件分别复制到7001-7005中</p>
<pre><code>[root@localhost cluster]# cp 7000/redis.conf  7001/
[root@localhost cluster]# cp 7000/redis.conf  7002/
[root@localhost cluster]# cp 7000/redis.conf  7003/
[root@localhost cluster]# cp 7000/redis.conf  7004/
[root@localhost cluster]# cp 7000/redis.conf  7005/</code></pre><h3 id="1-2-5批量修改"><a href="#1-2-5批量修改" class="headerlink" title="1.2.5批量修改"></a>1.2.5批量修改</h3><p>说明:分别将7001-7005文件中的7000改为对应的端口号的名称,<br>修改时注意方向键的使用</p>
<hr>
<h2 id="-12"><a href="#-12" class="headerlink" title=""></a><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://www.zhangpeng.fun/upload/2019/12/image-07dbc580650e4250b0b5992e0456a178.png" alt="image.png"></h2><h3 id="1-2-6通过脚本编辑启动-关闭指令"><a href="#1-2-6通过脚本编辑启动-关闭指令" class="headerlink" title="1.2.6通过脚本编辑启动/关闭指令"></a>1.2.6通过脚本编辑启动/关闭指令</h3><p>1.创建启动脚本  vim start.sh</p>
<hr>
<h2 id="-13"><a href="#-13" class="headerlink" title=""></a><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://www.zhangpeng.fun/upload/2019/12/image-6378e9a704f04028a8c1664eb0228790.png" alt="image.png"></h2><p>2.编辑关闭的脚本    vim  shutdown.sh</p>
<hr>
<h2 id="-14"><a href="#-14" class="headerlink" title=""></a><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://www.zhangpeng.fun/upload/2019/12/image-cbea1e4f601a4063b57924a19cfad16f.png" alt="image.png"></h2><p>3.启动redis节点<br>sh start.sh<br>4.检查redis节点启动是否正常</p>
<hr>
<h2 id="-15"><a href="#-15" class="headerlink" title=""></a><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://www.zhangpeng.fun/upload/2019/12/image-0453014e3d0a47319482723cce0c4b0f.png" alt="image.png"></h2><h3 id="1-2-7创建redis集群"><a href="#1-2-7创建redis集群" class="headerlink" title="1.2.7创建redis集群"></a>1.2.7创建redis集群</h3><p>#5.0版本执行 使用C语言内部管理集群<br>    redis-cli –cluster create –cluster-replicas 1 192.168.35.130:7000 192.168.35.130:7001 192.168.35.130:7002 192.168.35.130:7003 192.168.35.130:7004 192.168.35.130:7005</p>
<hr>
<p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://www.zhangpeng.fun/upload/2019/12/image-5cd699f4926e4fb1b4e982c410bfd4dd.png" alt="image.png"></p>
<hr>
<h2 id="-16"><a href="#-16" class="headerlink" title=""></a><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://www.zhangpeng.fun/upload/2019/12/image-66518edf874c42d9af403b2108112c72.png" alt="image.png"></h2><h3 id="1-2-8Redis集群高可用测试"><a href="#1-2-8Redis集群高可用测试" class="headerlink" title="1.2.8Redis集群高可用测试"></a>1.2.8Redis集群高可用测试</h3><p>1.关闭redis主机.检查是否自动实现故障迁移.<br>2.再次启动关闭的主机.检查是否能够实现自动的挂载.<br>一般情况下 能够实现主从挂载<br>个别情况: 宕机后的节点重启,可能挂载到其他主节点中(7001-7002) 正确的</p>
<hr>
<h2 id="-17"><a href="#-17" class="headerlink" title=""></a><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://www.zhangpeng.fun/upload/2019/12/image-79b6603ee64a4e238a6d6b6027dd7e28.png" alt="image.png"></h2><h2 id="1-3Redis集群原理"><a href="#1-3Redis集群原理" class="headerlink" title="1.3Redis集群原理"></a>1.3Redis集群原理</h2><h3 id="1-3-1Redis集群高可用推选原理"><a href="#1-3-1Redis集群高可用推选原理" class="headerlink" title="1.3.1Redis集群高可用推选原理"></a>1.3.1Redis集群高可用推选原理</h3><p>如图-24所示</p>
<hr>
<h2 id="-18"><a href="#-18" class="headerlink" title=""></a><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://www.zhangpeng.fun/upload/2019/12/image-242074965c474745a343c3ec40c73620.png" alt="image.png"></h2><p>图- 24<br>原理说明:<br>Redis的所有节点都会保存当前redis集群中的全部主从状态信息.并且每个节点都能够相互通信.当一个节点发生宕机现象.则集群中的其他节点通过PING-PONG检测机制检查Redis节点是否宕机.当有半数以上的节点认为宕机.则认为主节点宕机.同时由Redis剩余的主节点进入选举机制.投票选举链接宕机的主节点的从机.实现故障迁移.</p>
<h3 id="1-3-2Redis集群宕机条件"><a href="#1-3-2Redis集群宕机条件" class="headerlink" title="1.3.2Redis集群宕机条件"></a>1.3.2Redis集群宕机条件</h3><p>特点:集群中如果主机宕机,那么从机可以继续提供服务,<br>当主机中没有从机时,则向其它主机借用多余的从机.继续提供服务.如果主机宕机时没有从机可用,则集群崩溃.<br>答案:9个redis节点,节点宕机5-7次时集群才崩溃.<br>如图-25所示:</p>
<hr>
<h2 id="-19"><a href="#-19" class="headerlink" title=""></a><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://www.zhangpeng.fun/upload/2019/12/image-1b78823638cc4399958e31d00b0b0878.png" alt="image.png"></h2><p>图- 25</p>
<h3 id="1-3-3Redis-hash槽存储数据原理"><a href="#1-3-3Redis-hash槽存储数据原理" class="headerlink" title="1.3.3Redis hash槽存储数据原理"></a>1.3.3Redis hash槽存储数据原理</h3><p>说明: RedisCluster采用此分区，所有的键根据哈希函数(CRC16[key]&amp;16383)映射到0－16384槽内，共16384个槽位，每个节点维护部分槽及槽所映射的键值数据.根据主节点的个数,均衡划分区间.<br> 算法:哈希函数: Hash()=CRC16[key]&amp;16384按位与<br>如图-26所示</p>
<hr>
<h2 id="-20"><a href="#-20" class="headerlink" title=""></a><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://www.zhangpeng.fun/upload/2019/12/image-72a8ed71a5fe4cf5a16091adbd480192.png" alt="image.png"></h2><p>图- 26</p>
<p>当向redis集群中插入数据时,首先将key进行计算.之后将计算结果匹配到具体的某一个槽的区间内,之后再将数据set到管理该槽的节点中.<br>如图-27所示</p>
<hr>
<p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://www.zhangpeng.fun/upload/2019/12/image-c21369e67623451ab967a2ff79eb4a9b.png" alt="image.png"><br>图- 27</p>
<p>效率高:<br>            分片效率高:  发生在服务器中   redis只负责存取<br>            Redis集群:  发生在redis内部 效率低</p>
]]></content>
      <categories>
        <category>后端</category>
      </categories>
      <tags>
        <tag>redis</tag>
      </tags>
  </entry>
  <entry>
    <title>SPRING 框架MVC模块进阶</title>
    <url>/2020/03/22/SPRING%E6%A1%86%E6%9E%B6MVC%E6%A8%A1%E5%9D%97%E8%BF%9B%E9%98%B6/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="2-SPRING-框架MVC模块进阶"><a href="#2-SPRING-框架MVC模块进阶" class="headerlink" title="2.SPRING 框架MVC模块进阶"></a>2.SPRING 框架MVC模块进阶</h1><h2 id="2-1-Spring-MVC-设计思想"><a href="#2-1-Spring-MVC-设计思想" class="headerlink" title="2.1.Spring MVC 设计思想"></a>2.1.Spring MVC 设计思想</h2><h3 id="2-1-1-Spring-MVC-设计思想分析"><a href="#2-1-1-Spring-MVC-设计思想分析" class="headerlink" title="2.1.1.Spring MVC 设计思想分析"></a>2.1.1.Spring MVC 设计思想分析</h3><p>MVC是一种分层架构设计思想，目的是基于对象职责上的不同，进行分层设计，实现各司其职，各尽所能，以提高代码的可维护性，可扩展性。<br>1)生活中的MVC:正规饭店(菜单,服务员,厨师)<br>2)程序中的MVC:(html,jsp)/servlet/(service,dao))</p>
<hr>
<h2 id=""><a href="#" class="headerlink" title=""></a><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://www.zhangpeng.fun/upload/2019/12/image-7a786784d3ca41f4946261f296b671bd.png" alt="image.png"></h2><p>SPRING MVC是Spring 框架中的一个WEB模块, 是基于MVC设思想的一种完美实现。</p>
<h3 id="2-1-2-Spring-MVC-核心对象及流程分析"><a href="#2-1-2-Spring-MVC-核心对象及流程分析" class="headerlink" title="2.1.2.Spring MVC 核心对象及流程分析"></a>2.1.2.Spring MVC 核心对象及流程分析</h3><p>Spring MVC 处理流程及其核心组件对象构成，如下图所示：</p>
<hr>
<h2 id="-1"><a href="#-1" class="headerlink" title=""></a><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://www.zhangpeng.fun/upload/2019/12/image-349c5b35210b4a4b9bb0991a02d335bc.png" alt="image.png"></h2><p>FAQ：说说spring MVC中的核心组件？<br>1)DipatcherServlet:前端控制器(web服务器启动时加载)<br>2)HandlerMapping:注册中心(负责存储url到后端控制器的映射)<br>3)HandlerInterceptor:拦截器(请求到handler之间的拦截)<br>4)Handler:后端处理器(又称之为Controller)<br>5)ViewResolver:视图解析器(负责是视图页面进行解析)</p>
<h2 id="2-2-Spring-MVC-快速实践"><a href="#2-2-Spring-MVC-快速实践" class="headerlink" title="2.2.Spring MVC 快速实践"></a>2.2.Spring MVC 快速实践</h2><h3 id="2-2-1-xml方式配置实现-脱离文档"><a href="#2-2-1-xml方式配置实现-脱离文档" class="headerlink" title="2.2.1.xml方式配置实现(脱离文档)"></a>2.2.1.xml方式配置实现(脱离文档)</h3><p>1.创建maven项目</p>
<p>1)项目名称: CGB-SPRINGMVC-01<br>2)组id: com.cy<br>3)打包方式: war包方式</p>
<p>2.配置并初始化项目环境</p>
<p>1)生成web.xml(配置spring mvc 前端控制器)<br>2)设置项目的运行时环境(选择tomcat,提供servlet支持)<br>3)设置项目编码方式 utf-8<br>4)设置统一编译环境 JDK8<br>5)添加项目依赖:spring-webmvc<br>6)添加spring mvc配置文件并进行配置:spring-configs.xml<br>7)web.xml中配置spring mvc前端控制器(DispatcherServlet)<br>8)部署项目,启动tomcat测试 (假如tomcat正常启动,则没问题)</p>
<p>说明:如上配置可参考后面内容中的关键代码分享.</p>
<p>3.Spring MVC基础业务实现 </p>
<p>1)定义Controller类<br>a)包名:com.cy.pj.search.controller<br>b)类名:SearchController</p>
<p>代码如下:</p>
<pre><code>@Controller
@RequestMapping(&quot;/search/&quot;)
public class SearchController {
}</code></pre><p>其中:@RequestMapping修饰类时用于定义请求路径</p>
<p>2)添加Controller方法<br>方法1:此方法用于向客户端返回一个页面</p>
<pre><code>@RequestMapping(&quot;doSearchUI&quot;)
public String doSearchUI() {
return &quot;search&quot;;
}</code></pre><p>其中:对于返回值search需要在/WEB-INF/pages/目录下有对应的<br>search.html页面.</p>
<p>方法2:此方法用于向客户端返回一个json格式的字符串</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"doSearch"</span>)</span><br><span class="line">	<span class="meta">@ResponseBody</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Object <span class="title">doSearch</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">		Map&lt;String,Object&gt; map=<span class="keyword">new</span> HashMap&lt;String,Object&gt;();</span><br><span class="line">		map.put(<span class="string">"state"</span>, <span class="number">1</span>);</span><br><span class="line">		map.put(<span class="string">"message"</span>,<span class="string">"hello everyone"</span>);</span><br><span class="line">		<span class="keyword">return</span> map;<span class="comment">//&#123;"state":1,"message":"hello everyone"&#125;</span></span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<p>其中:<br>a)@ResponseBody修饰方法时,Spring MVC可以将方法的返回值以指定格式进行进行输出,例如JSON格式字符串.<br>b)doSearch方法进行测试时,需要在项目中添加如下依赖:</p>
<pre><code>&lt;dependency&gt;
    &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt;
    &lt;artifactId&gt;jackson-databind&lt;/artifactId&gt;
    &lt;version&gt;2.9.9.3&lt;/version&gt;
&lt;/dependency&gt;</code></pre><p>3)部署并启动服务测试.</p>
<p>4.关键代码分享:</p>
<p>spring-configs.xml</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
    xmlns:mvc=&quot;http://www.springframework.org/schema/mvc&quot;
    xmlns:context=&quot;http://www.springframework.org/schema/context&quot;
    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
    xsi:schemaLocation=&quot;
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/context
        http://www.springframework.org/schema/context/spring-context.xsd
        http://www.springframework.org/schema/mvc
        http://www.springframework.org/schema/mvc/spring-mvc.xsd&quot;&gt;

    &lt;context:component-scan base-package=&quot;com.cy.controller&quot;/&gt;
    &lt;!-- Enable MVC Configuration:启用默认bean对象(注解驱动)  --&gt;
    &lt;mvc:annotation-driven/&gt;
    &lt;!-- 启用 DefaultServletHttpRequestHandler对静态进行处理 --&gt;
    &lt;mvc:default-servlet-handler/&gt;
    &lt;!-- 配置视图解析器(ViewResolver)对象 --&gt;
    &lt;bean id=&quot;viewResolver&quot;  class=&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;&gt;
       &lt;!-- Set DI (默认找对象中的set方法)--&gt;
       &lt;property name=&quot;Prefix&quot; value=&quot;/WEB-INF/pages/&quot;/&gt;
       &lt;property name=&quot;Suffix&quot; value=&quot;.html&quot;/&gt;
    &lt;/bean&gt;
&lt;/beans&gt;</code></pre><p>Web.xml</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;web-app xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xmlns=&quot;http://java.sun.com/xml/ns/javaee&quot; xsi:schemaLocation=&quot;http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd&quot; version=&quot;2.5&quot;&gt;
  &lt;display-name&gt;CGB-SPRINGMVC-01&lt;/display-name&gt;
  &lt;!-- 配置前端控制器 --&gt;
  &lt;servlet&gt;
    &lt;servlet-name&gt;frontController&lt;/servlet-name&gt;
    &lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class&gt;
    &lt;init-param&gt;
        &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;
        &lt;param-value&gt;classpath:spring-configs.xml&lt;/param-value&gt;
    &lt;/init-param&gt;
    &lt;!-- tomcat 启动时则初始化servlet,数字越小优先级越高 --&gt;
    &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;
  &lt;/servlet&gt;
  &lt;servlet-mapping&gt;
     &lt;servlet-name&gt;frontController&lt;/servlet-name&gt;
     &lt;url-pattern&gt;/&lt;/url-pattern&gt;
  &lt;/servlet-mapping&gt;
&lt;/web-app&gt;</code></pre><p>SearchController</p>
<pre><code>package com.cy.pj.search.controller;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.ResponseBody;
@Controller 
@RequestMapping(&quot;/search/&quot;) 
public class SearchController {
    @RequestMapping(&quot;doSearchUI&quot;)
    public String doSearchUI() {
        return &quot;search&quot;;
    }///WEB-INF/pages/search.html

    @RequestMapping(&quot;doSearch&quot;)
    @ResponseBody
    public Object doSearch(String key) {
        Map&lt;String,Object&gt; map=new HashMap&lt;String,Object&gt;();
        map.put(&quot;state&quot;, 1);
        map.put(&quot;message&quot;,&quot;hello everyone&quot;);
        return map;//{&quot;state&quot;:1,&quot;message&quot;:&quot;hello everyone&quot;}
    }
}</code></pre><h3 id="2-2-2-注解方式配置实现（脱离文档）"><a href="#2-2-2-注解方式配置实现（脱离文档）" class="headerlink" title="2.2.2.注解方式配置实现（脱离文档）"></a>2.2.2.注解方式配置实现（脱离文档）</h3><p>Tomcat 启动加载方式:</p>
<hr>
<h2 id="-2"><a href="#-2" class="headerlink" title=""></a><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://www.zhangpeng.fun/upload/2019/12/image-20db542cf104453c8a8451787821bda0.png" alt="image.png"></h2><p>1.创建maven项目</p>
<p>1)项目名称: CGB-SPRINGMVC-02<br>2)组id: com.cy<br>3)打包方式: war包方式</p>
<p>2.配置并初始化项目环境(重点对xml方式进行重构)</p>
<p>1)配置maven war包插件(忽略web.xml)<br>2)设置项目的运行时环境(选择tomcat)<br>3)设置项目编码方式 utf-8<br>4)设置统一编译环境 JDK8<br>5)添加项目依赖:spring-webmvc<br>6)添加spring mvc配置类:SpringWebConfig类<br>7)创建WebInitializer类配置spring mvc(例如前端控制器)。<br>8)部署项目,启动tomcat测试 (假如tomcat正常启动,则没问题)</p>
<p>3.Spring MVC基础业务实现 (参考xml方式业务代码实现)</p>
<p>4.Spring mvc 注解方式应用分析:</p>
<hr>
<h2 id="-3"><a href="#-3" class="headerlink" title=""></a><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://www.zhangpeng.fun/upload/2019/12/image-de958697c6d948dda4e45ae287c18496.png" alt="image.png"></h2><p>其中META-INF目录可在sping-web.jar中进行查看.</p>
<p>关键代码分析:</p>
<p>SpringWebConfig类</p>
<pre><code>@Configuration 
@ComponentScan(&quot;com.cy.pj.search.controller&quot;)
@EnableWebMvc //&lt;mvc:annotation-driven/&gt;
public class SpringWebConfig implements WebMvcConfigurer{
    //&lt;mvc:default-servlet-handler/&gt;
    @Override
    public void configureDefaultServletHandling(
            DefaultServletHandlerConfigurer configurer) {
        configurer.enable();
    }
    @Override
    public void configureViewResolvers(
        ViewResolverRegistry registry) {
        registry.jsp(&quot;/WEB-INF/pages/&quot;,&quot;.html&quot;);
    }
}</code></pre><p>WebInitializer类</p>
<pre><code>public class WebInitializer extends 
AbstractAnnotationConfigDispatcherServletInitializer {

    //Service,Repository
    @Override
    protected Class&lt;?&gt;[] getRootConfigClasses() {
        System.out.println(&quot;getRootConfigClasses()&quot;);
        return null;
    }
    //View,Controller
    @Override
    protected Class&lt;?&gt;[] getServletConfigClasses() {
        System.out.println(&quot;getServletConfigClasses()&quot;);
        return new Class[] {SpringWebConfig.class};
    }
    @Override
    protected String[] getServletMappings() {
        System.out.println(&quot;getServletMappings()&quot;);
        return new String[] {&quot;/&quot;};
    }
}</code></pre><h2 id="2-3-Spring-MVC-请求响应处理增强分析"><a href="#2-3-Spring-MVC-请求响应处理增强分析" class="headerlink" title="2.3.Spring MVC 请求响应处理增强分析"></a>2.3.Spring MVC 请求响应处理增强分析</h2><p>所有MVC框架的重点都在请求和响应数据的处理上。</p>
<h3 id="2-3-1-请求处理增强分析及实现-重点"><a href="#2-3-1-请求处理增强分析及实现-重点" class="headerlink" title="2.3.1.请求处理增强分析及实现(重点)"></a>2.3.1.请求处理增强分析及实现(重点)</h3><p>Spring MVC请求处理主要从如下几个方面进行考虑：<br>1)请求路径(普通方式，rest方式) ：404<br>2)请求方式(Get请求，Post请求,…):405<br>3)请求参数(直接量，POJO对象，MAP对象):400</p>
<p>代码分析如下：</p>
<pre><code>@Controller
@RequestMapping(&quot;/request/&quot;)
public class RequestHandleController {
     //===请求url定义 
      //普通URL定义实现(多个url可以对应同一个资源)
      @RequestMapping(value={&quot;doHandleUrl&quot;,&quot;doWelcomeUI&quot;})
      public String doHandleUrl() {
         return &quot;welcome&quot;; 
      }
      //REST风格的URL，其url格式为{a}/{b}/{c}
      //假如希望方法参数获取url中{}表达式内部的值
      //可以使用@PathVariable对参数进行修饰
      @RequestMapping(&quot;{module}/{page}&quot;)
      public String doMoudleUrl(
              @PathVariable String module,
              @PathVariable String page) {
         return module+&quot;/&quot;+page;
      }
      //===请求方式定义
      //@RequestMapping(value=&quot;type&quot;,method=RequestMethod.GET)
      @GetMapping(&quot;type&quot;)
      //@PostMapping(&quot;type&quot;)
      @ResponseBody
      public String doRequestType() {
          return &quot;request type&quot;;
      }
      //=====请求参数处理======
      @GetMapping(&quot;param&quot;)
      @ResponseBody
      public String doRequestParam(
             RequestWrapper rw,//pojo
             @RequestParam(required=false) String msg,
             @DateTimeFormat(pattern=&quot;yyyy/MM/dd&quot;)Date begin) {
          return &quot;request parameter handle msg=&quot;+msg+&quot;,begin=&quot;+begin+&quot;,rw=&quot;+rw.toString();
      }
}</code></pre><h3 id="2-3-2-响应处理增强分析实现（重点）"><a href="#2-3-2-响应处理增强分析实现（重点）" class="headerlink" title="2.3.2.响应处理增强分析实现（重点）"></a>2.3.2.响应处理增强分析实现（重点）</h3><p>Spring MVC响应处理主要从如下几个方面进行考虑：<br>1）响应方式(转发forward，重定向redirect)<br>2）响应数据封装(ModelAndView,Model,Map,Pojo)<br>3）响应数据转换（将对象序列化为JSON格式字符串）</p>
<p>代码分析如下：</p>
<pre><code>@Controller
@RequestMapping(&quot;/resp/&quot;)
public class ResponseHandleController {
     @RequestMapping(&quot;doResponseUI&quot;)
     public String doResponseUI() {
         return &quot;response&quot;;
     }
     @RequestMapping(&quot;type&quot;)
     public String doResponseType() {
         //转发(客户端请求一次)
         return &quot;forward:doResponseUI&quot;;//address
         //重定向(客户端两次请求)
         //return &quot;redirect:doResponseUI&quot;;//address
     }

     @RequestMapping(&quot;doDataConvert&quot;)
     @ResponseBody
     public String doDataConvert()throws Exception {
         Map&lt;String,Object&gt; map=new HashMap&lt;String,Object&gt;();
         map.put(&quot;id&quot;, 100);
         map.put(&quot;msg&quot;, &quot;hello jackson&quot;);
         //借助jackson中的API将对象转换json格式的字符串
         ObjectMapper om=new ObjectMapper();
         return om.writeValueAsString(map);
     }
}</code></pre><h1 id="少年易老学难成，一寸光阴不可轻。"><a href="#少年易老学难成，一寸光阴不可轻。" class="headerlink" title="少年易老学难成，一寸光阴不可轻。"></a>少年易老学难成，一寸光阴不可轻。</h1>]]></content>
      <categories>
        <category>后端</category>
      </categories>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>SPRING 框架核心进阶</title>
    <url>/2020/03/21/SPRING%E6%A1%86%E6%9E%B6%E6%A0%B8%E5%BF%83%E8%BF%9B%E9%98%B6/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="1-SPRING-框架核心进阶"><a href="#1-SPRING-框架核心进阶" class="headerlink" title="1.SPRING 框架核心进阶"></a>1.SPRING 框架核心进阶</h1><h2 id="1-1-SPRING-框架架构分析"><a href="#1-1-SPRING-框架架构分析" class="headerlink" title="1.1.SPRING 框架架构分析"></a>1.1.SPRING 框架架构分析</h2><h3 id="1-1-1-Spring-框架应用架构"><a href="#1-1-1-Spring-框架应用架构" class="headerlink" title="1.1.1.Spring 框架应用架构"></a>1.1.1.Spring 框架应用架构</h3><hr>
<p>Spring 官网资源:spring.io/projects<br>Spring 是一个”资源整合”框架,通过spring可将很多资源(例如连接池,<br>mybatis,…)等整合在一起,对外提供相关服务(例如,秒杀服务,支付服务,…)。</p>
<hr>
<h2 id=""><a href="#" class="headerlink" title=""></a><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://www.zhangpeng.fun/upload/2019/12/image-d92bfc62abae4b1abbc7a002da599370.png" alt="image.png"></h2><p>说明:spring 框架中一切资源的整合都源于IOC模块，IOC要实现对象生命周期的管理，对象依赖关系的管理。</p>
<h3 id="1-1-2-Spring-框架产品架构"><a href="#1-1-2-Spring-框架产品架构" class="headerlink" title="1.1.2. Spring 框架产品架构"></a>1.1.2. Spring 框架产品架构</h3><hr>
<p>产品架构主要从这个框架对外提供的服务（功能）进行理解.</p>
<hr>
<h2 id="-1"><a href="#-1" class="headerlink" title=""></a><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://www.zhangpeng.fun/upload/2019/12/image-9dbc108b167f467ca8b895cd29288f64.png" alt="image.png"></h2><h3 id="1-1-3-Spring-框架技术架构"><a href="#1-1-3-Spring-框架技术架构" class="headerlink" title="1.1.3.Spring 框架技术架构"></a>1.1.3.Spring 框架技术架构</h3><p>IOC API基础架构(Spring 工厂对象分析)</p>
<hr>
<p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://www.zhangpeng.fun/upload/2019/12/image-96662d4783ed4306993deb401bac9c8b.png" alt="image.png"><br>IOC(控制反转) 容器初始化过程分析.</p>
<hr>
<p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://www.zhangpeng.fun/upload/2019/12/image-92dc43a7d1364ae694bd834ebf80e959.png" alt="image.png"></p>
<h2 id="1-2-SPRING框架快速实践-注解方式-脱离文档"><a href="#1-2-SPRING框架快速实践-注解方式-脱离文档" class="headerlink" title="1.2.SPRING框架快速实践 (注解方式-脱离文档)"></a>1.2.SPRING框架快速实践 (注解方式-脱离文档)</h2><h3 id="1-2-1-Spring项目创建及配置"><a href="#1-2-1-Spring项目创建及配置" class="headerlink" title="1.2.1.Spring项目创建及配置"></a>1.2.1.Spring项目创建及配置</h3><p>1.创建maven项目(jar包项目)<br>1)项目名称 CGB-SPRING-01<br>2)组id:com.cy<br>3)打包方式:jar</p>
<p>2.添加项目依赖(spring-context)</p>
<p>添加spring依赖</p>
<pre><code>&lt;dependency&gt;
 &lt;groupId&gt;org.springframework&lt;/groupId&gt;
 &lt;artifactId&gt;spring-context&lt;/artifactId&gt;
 &lt;version&gt;5.1.9.RELEASE&lt;/version&gt;
&lt;/dependency&gt;</code></pre><p>添加junit依赖</p>
<pre><code>&lt;dependency&gt;
  &lt;groupId&gt;junit&lt;/groupId&gt;
  &lt;artifactId&gt;junit&lt;/artifactId&gt;
  &lt;version&gt;4.12&lt;/version&gt;
&lt;/dependency&gt;</code></pre><h3 id="1-2-2-Spring基本测试环境创建"><a href="#1-2-2-Spring基本测试环境创建" class="headerlink" title="1.2.2.Spring基本测试环境创建"></a>1.2.2.Spring基本测试环境创建</h3><p>添加spring配置类(SpringConfig)</p>
<pre><code>package com.cy.spring.config;
import org.springframework.context.annotation.ComponentScan;
/**
 * @ComponentScan 用于告诉spring容器从
   * 从指定包进行bean的扫描
 */
@ComponentScan(&quot;com.cy.spring.beans&quot;)
public class SpringConfig {//spring-configs.xml

}</code></pre><p>定义测试基类 </p>
<pre><code>package com.spring;
import org.junit.After;
import org.junit.Before;
import org.junit.Test;
import org.springframework.context.annotation.AnnotationConfigApplicationContext;
public class TestBase {
     protected AnnotationConfigApplicationContext ctx;
     @Before
     public void init() {
      ctx=new AnnotationConfigApplicationContext(
                 SpringConfig.class);
     }
     @After
     public void close() {
         ctx.close();
     }
     @Test
     public void testCtx() {
         System.out.println(ctx);
     }
}</code></pre><h3 id="1-2-3-Spring项目基本业务实现"><a href="#1-2-3-Spring项目基本业务实现" class="headerlink" title="1.2.3.Spring项目基本业务实现"></a>1.2.3.Spring项目基本业务实现</h3><p>业务描述,创建一个DefaultCache对象然后将此对象交给Spring容器管理.<br>创建DefaultCache类,并明确此类交给spring管理.</p>
<pre><code>package com.cy.spring.beans;
import javax.annotation.PostConstruct;
import javax.annotation.PreDestroy;
import org.springframework.context.annotation.Lazy;
import org.springframework.context.annotation.Scope;
import org.springframework.stereotype.Component;
/**
@Component 注解用于告诉spring容器
请将这个类交给spring管理.
@Lazy 用于告诉spring容器此对象要延迟加载
@Scope 用于告诉spring容器此bean的作用域
1)singleton (单例作用域-默认,会存储到池中)
2)prototype (多例作用域,每次获取都创建新对象)
 */
@Lazy
@Scope(&quot;singleton&quot;) 
@Component //@Controller,@Service,...
public class DefaultCache {
     public DefaultCache() {
         System.out.println(&quot;DefaultCache()&quot;);
     }
     @PostConstruct //告诉spring 此对象初始化时执行init方法
     public void init() {
         System.out.println(&quot;init()&quot;);
     }
     @PreDestroy//告诉spring 此对象销毁时执行close方法
     public void close() {
         System.out.println(&quot;close()&quot;);
     }
}</code></pre><p>定义测试类,从spring容器中获取bean对象</p>
<pre><code>package com.cy.test;
import org.junit.Assert;
import org.junit.Test;
import com.cy.spring.beans.DefaultCache;
public class TestCache extends TestBase {
    @Test
    public void testDefaultCahce() {
        DefaultCache cache01=
        ctx.getBean(&quot;defaultCache&quot;,DefaultCache.class);
        Assert.assertNotEquals(null, cache01);
        DefaultCache cache02=
        ctx.getBean(&quot;defaultCache&quot;,DefaultCache.class);
        Assert.assertNotEquals(null, cache02);
        System.out.println(cache01==cache02);
    }
}</code></pre><h3 id="1-2-4-Spring项目课堂练习分析及实现"><a href="#1-2-4-Spring项目课堂练习分析及实现" class="headerlink" title="1.2.4.Spring项目课堂练习分析及实现"></a>1.2.4.Spring项目课堂练习分析及实现</h3><p>1.整合第三方连接池DRUID.<br>1)步骤分析:<br>step01:添加依赖(数据库驱动依赖,连接池依赖)<br>step02:对druid连接池进行配置<br>step03:对连接池进行单元测试.<br>2)关键代码实现</p>
<p>添加mysql依赖</p>
<pre><code>&lt;dependency&gt;
    &lt;groupId&gt;mysql&lt;/groupId&gt;
    &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;
    &lt;version&gt;8.0.17&lt;/version&gt;
 &lt;/dependency&gt;</code></pre><p>添加Druid依赖</p>
<pre><code>&lt;dependency&gt;
  &lt;groupId&gt;com.alibaba&lt;/groupId&gt;
  &lt;artifactId&gt;druid&lt;/artifactId&gt;
  &lt;version&gt;1.1.19&lt;/version&gt;
&lt;/dependency&gt;</code></pre><p>定义数据源配置类</p>
<pre><code>package com.cy.spring.beans;
import javax.sql.DataSource;
@Configuration
public class DataSourceConfig {
      @Bean(value=&quot;druid&quot;,initMethod=&quot;init&quot;,destroyMethod=&quot;close&quot;)
      public DataSource newDruid() {
         // System.out.println(&quot;newDruid()&quot;);
          DruidDataSource ds=new DruidDataSource();
          //ds.setDriverClassName(&quot;com.mysql.cj.jdbc.Driver&quot;);
          ds.setUrl(&quot;jdbc:mysql:///test?serverTimezone=GMT&quot;);
          ds.setUsername(&quot;root&quot;);
          ds.setPassword(&quot;root&quot;);
          ds.setMaxWait(10000);
          //....
          return ds;
      }      
}</code></pre><p>创建单元测试类</p>
<pre><code>package com.cy.test;
import javax.sql.DataSource;
import org.junit.Assert;
import org.junit.Test;
import com.zaxxer.hikari.HikariDataSource;
public class TestDataSource extends TestBase{
    @Test
    public void testDruidDataSource()throws Exception {
        DataSource ds=
        ctx.getBean(&quot;druid&quot;,DataSource.class);
        Assert.assertNotEquals(null, ds);
        System.out.println(ds.getConnection());
    }
}</code></pre><h1 id="2-整合第三方连接池HiKariCP连接池-扩展"><a href="#2-整合第三方连接池HiKariCP连接池-扩展" class="headerlink" title="2.整合第三方连接池HiKariCP连接池(扩展)."></a>2.整合第三方连接池HiKariCP连接池(扩展).</h1><h2 id="1-3-SPRING-IOC-应用原理进阶分析"><a href="#1-3-SPRING-IOC-应用原理进阶分析" class="headerlink" title="1.3.SPRING IOC 应用原理进阶分析"></a>1.3.SPRING IOC 应用原理进阶分析</h2><h3 id="1-3-1-Spring-IOC设计思想分析"><a href="#1-3-1-Spring-IOC设计思想分析" class="headerlink" title="1.3.1.Spring IOC设计思想分析"></a>1.3.1.Spring IOC设计思想分析</h3><p>IOC 是一种设计思想，称之为控制反转。基于这种思想实现对象创建，对象的科学管理以及应用时的解耦(借助DI机制实现)。Spring框架核心就是基于这种机制进行了完美实现。<br>说明：<br>1)控制反转探讨的是什么？谁控制谁的问题（spring控制对象的创建管理）<br>2)生活中的IOC的实现？(例如股票操盘手,父母包办婚姻）</p>
<h3 id="1-3-2-Spring-Bean-工厂的初始化"><a href="#1-3-2-Spring-Bean-工厂的初始化" class="headerlink" title="1.3.2.Spring Bean 工厂的初始化"></a>1.3.2.Spring Bean 工厂的初始化</h3><p>基于xml方式实现Spring中Bean工厂的初始化.</p>
<hr>
<p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://www.zhangpeng.fun/upload/2019/12/image-630cb3fbad434155b03166a0ec10b184.png" alt="image.png"><br>说明:Spring 中的Bean工厂会基于Bean对象描述,创建bean的实例,并可以有选择性的对实例对象进行管理(例如单例作用域的对象).</p>
<h3 id="1-3-3-Spring-中的两大map对象分析"><a href="#1-3-3-Spring-中的两大map对象分析" class="headerlink" title="1.3.3.Spring 中的两大map对象分析"></a>1.3.3.Spring 中的两大map对象分析</h3><p>1.如何理解Spring中的两大map对象(存储对象的两个容器)？<br>1）一个map用于存储bean的配置信息(工厂的原材料)<br>2）一个map用于存储bean的实例信息(工厂中的成品对象)</p>
<p>基于xml配置文件实现:</p>
<hr>
<h2 id="-2"><a href="#-2" class="headerlink" title=""></a><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://www.zhangpeng.fun/upload/2019/12/image-c49b3bb717964a3189411cc5c0387a3f.png" alt="image.png"></h2><p>基于注解配置实现:</p>
<hr>
<h2 id="-3"><a href="#-3" class="headerlink" title=""></a><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://www.zhangpeng.fun/upload/2019/12/image-1e18b43a520043d681eea9e4a79a5f7e.png" alt="image.png"></h2><h3 id="1-3-4-Spring-中两大bean对象分析-了解"><a href="#1-3-4-Spring-中两大bean对象分析-了解" class="headerlink" title="1.3.4.Spring 中两大bean对象分析(了解)"></a>1.3.4.Spring 中两大bean对象分析(了解)</h3><p>Bean对象创建<br>1)未实现FactoryBean接口(直接构造方法);<br>2)实现FactoryBean接口（调用FactoryBean对象的getObject方法）</p>
<hr>
<h2 id="-4"><a href="#-4" class="headerlink" title=""></a><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://www.zhangpeng.fun/upload/2019/12/image-5bdbf2e837434d1eabb4a2ddc7c838e2.png" alt="image.png"></h2><p>说明：一般在创建一些相对复杂的工厂对象时，通常会写一个工厂bean对象，<br>然后基于工厂bean对象创建具体的工厂对象，例如SqlSessionFactoryBean,<br>ShiroFilterFactoryBean，ProxyFactoryBean等。</p>
<h3 id="1-3-5-Spring-中两大bean对象描述方式"><a href="#1-3-5-Spring-中两大bean对象描述方式" class="headerlink" title="1.3.5.Spring 中两大bean对象描述方式"></a>1.3.5.Spring 中两大bean对象描述方式</h3><p>Bean 对象的描述<br>1)xml方式 (例如<bean id=”factory” class=”com.beans.Factory”>)<br>2)annotation方式（@Service,@Controller，@Configuration，@Bean，..）</p>
<p>Spring 中用于描述这是一个Bean对象的相关注解如下:</p>
<hr>
<p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://www.zhangpeng.fun/upload/2019/12/image-ec7bdf52e7324e209438f176a87a0527.png" alt="image.png"><br>说明:无论使用如上图中的哪个注解对Bean进行描述,对Spring而言都认为是一样的Bean.</p>
<h2 id="1-1-Spring-依赖注入实践增强"><a href="#1-1-Spring-依赖注入实践增强" class="headerlink" title="1.1.Spring 依赖注入实践增强"></a>1.1.Spring 依赖注入实践增强</h2><h3 id="1-1-1-Spring-中Bean对象依赖注入分析-重点"><a href="#1-1-1-Spring-中Bean对象依赖注入分析-重点" class="headerlink" title="1.1.1.Spring 中Bean对象依赖注入分析(重点)"></a>1.1.1.Spring 中Bean对象依赖注入分析(重点)</h3><p>依赖注入(DI)是一种设计思想,简单点就是对象通过set或构造方法直接为对象属性赋值,在Spring框架中为这种注入基于反射技术提供一种自动实现方式.例如:</p>
<p>IOC 依赖注入在项目中的应用实现：</p>
<hr>
<h2 id="-5"><a href="#-5" class="headerlink" title=""></a><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://www.zhangpeng.fun/upload/2019/12/image-8effc442fbba466fbdf7b27016a7bab9.png" alt="image.png"></h2><p>实际项目中为了解耦和,对象之间通常会通过接口进行通讯,也就是<br>说对象要耦合与接口,例如2</p>
<hr>
<p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://www.zhangpeng.fun/upload/2019/12/image-aa073ba90cc446a3ab1018da3c585284.png" alt="image.png"></p>
<p>个人认为：IOC的核心是对象生命周期管理(资源管理)以及<br>依赖注入（资源协同）；</p>
<h3 id="1-1-2-Spring-中Bean对象依赖注入实践"><a href="#1-1-2-Spring-中Bean对象依赖注入实践" class="headerlink" title="1.1.2.Spring 中Bean对象依赖注入实践"></a>1.1.2.Spring 中Bean对象依赖注入实践</h3><p>在1.2小节基础上,基于如下设计,进行代码实践分析及实现。</p>
<hr>
<p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://www.zhangpeng.fun/upload/2019/12/image-31a98667ce2d4cd89c0896f59d297459.png" alt="image.png"></p>
<p>核心步骤分析：<br>Step01:创建Cache接口以及对应的实现DefaultCache<br>Step02:创建SearchService接口以及对应的实现类。<br>Step03:将DefaultCache对象注入给DefaultSearchService。<br>Step03:创建SynchronizedCache测试@Autowired注解。</p>
<p>关键代码分析及实现：</p>
<p>Cache接口定义</p>
<pre><code>public interface Cache {

}</code></pre><p>DefaultCache类定义</p>
<pre><code>@Lazy
@Component
public class DefaultCache implements Cache{
    public DefaultCache() {
        System.out.println(&quot;DefaultCache()&quot;);
    }
}</code></pre><p>SynchronizedCache定义</p>
<pre><code>@Component
public class SynchronizedCache implements Cache {

}</code></pre><p>SearchService接口定义</p>
<pre><code>public interface SearchService {

}</code></pre><p>SearchService实现类定义</p>
<pre><code>@Service
public class DefaultSearchService implements SearchService {
    /**@Autowired 可以修饰属性，set方法，构造方法等
     * 默认按照属性类型，方法参数类型为对象属性注入值,
     * 假如相同类型的对象有多个，还会按属性名或方法参
     * 数名等进行查找。
     * @Qualifier 配合@Autowired，用于指定要注入的对
     * 象的名字。
     */
    @Autowired
    @Qualifier(&quot;defaultCache&quot;)
    private Cache cache;
    @Override
    public  String toString() {
        return &quot;DefaultSearchService [cache=&quot; + cache + &quot;]&quot;;
    }
}</code></pre><p>测试实现</p>
<pre><code>public class TestSearchService extends TestBase {
    @Test
    public void testSearchService() {
        DefaultSearchService ds=
        ctx.getBean(&quot;defaultSearchService&quot;,
                DefaultSearchService.class);
        System.out.println(ds);
    }
}</code></pre><h1 id="少年易老学难成，一寸光阴不可轻。"><a href="#少年易老学难成，一寸光阴不可轻。" class="headerlink" title="少年易老学难成，一寸光阴不可轻。"></a>少年易老学难成，一寸光阴不可轻。</h1>]]></content>
      <categories>
        <category>后端</category>
      </categories>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>SSM框架综合案例实现</title>
    <url>/2020/03/23/SSM%E6%A1%86%E6%9E%B6%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B%E5%AE%9E%E7%8E%B0/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="2-SSM框架综合案例实现-注解方式"><a href="#2-SSM框架综合案例实现-注解方式" class="headerlink" title="2.SSM框架综合案例实现(注解方式)"></a>2.SSM框架综合案例实现(注解方式)</h1><h2 id="2-1-业务描述"><a href="#2-1-业务描述" class="headerlink" title="2.1.业务描述"></a>2.1.业务描述</h2><p>通过spring整合mybatis完成商品数据库中数据的查询,并在客户端以json格式对数据进行输出?<br>思路:<br>1)创建maven web项目(打包方式war):CGB-SSM-01<br>2)配置项目?(运行时环境,编码,编译版本)<br>3)添加依赖?(mysql,druid,mybatis,junit,spring-webmvc,..)<br>4)整合资源?(连接池,mybatis,spring mvc..)</p>
<h2 id="2-2-初始化化数据环境"><a href="#2-2-初始化化数据环境" class="headerlink" title="2.2.初始化化数据环境"></a>2.2.初始化化数据环境</h2><p>数据库脚本分析:</p>
<pre><code>drop database if exists dbgoods;
create database dbgoods default character set utf8;
use dbgoods;
create table tb_goods(
   id bigint auto_increment,
   name varchar(200) not null,
   remark text,
   createdTime datetime,
   primary key (id)
)engine=InnoDB;

insert into tb_goods values (null,&apos;A&apos;,&apos;A...&apos;,now());
insert into tb_goods values (null,&apos;B&apos;,&apos;B...&apos;,now());
insert into tb_goods values (null,&apos;C&apos;,&apos;C...&apos;,now());</code></pre><p>说明:可以将如上脚本写到db-goods.sql文件中,然后去执行完成完成初始化.</p>
<h2 id="2-3-项目创建及配置"><a href="#2-3-项目创建及配置" class="headerlink" title="2.3.项目创建及配置"></a>2.3.项目创建及配置</h2><p>1.创建maven web项目:CGB-SSM-01<br>2.在pom.xml添加war包插件,修改其配置(这样项目可以不写web.xml)</p>
<pre><code>&lt;build&gt;
   &lt;plugins&gt;
       &lt;plugin&gt;
           &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
           &lt;artifactId&gt;maven-war-plugin&lt;/artifactId&gt;
           &lt;version&gt;2.6&lt;/version&gt;
           &lt;configuration&gt;
             &lt;failOnMissingWebXml&gt;false&lt;/failOnMissingWebXml&gt;
           &lt;/configuration&gt;
       &lt;/plugin&gt;
   &lt;/plugins&gt;
 &lt;/build&gt;</code></pre><p>3.配置项目(设置运行时环境-tomcat,编译版本JDK1.8)<br>4.添加项目依赖(参考如下图中的依赖)<br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://www.zhangpeng.fun/upload/2019/12/image-e0e83512c916471aaa3961fc4299d37b.png" alt="image.png"></p>
<h2 id="2-4-项目资源整合实现"><a href="#2-4-项目资源整合实现" class="headerlink" title="2.4.项目资源整合实现"></a>2.4.项目资源整合实现</h2><h3 id="2-4-1-配置架构分析及实现"><a href="#2-4-1-配置架构分析及实现" class="headerlink" title="2.4.1.配置架构分析及实现"></a>2.4.1.配置架构分析及实现</h3><p>配置架构分析:</p>
<p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://www.zhangpeng.fun/upload/2019/12/image-b79885d125f24239b23067babe1e3333.png" alt="image.png"></p>
<p>其中:<br>1)SpringRepositoryConfig 负责数据层配置<br>2)SpringServiceConfig负责业务层配置<br>3)SpringWebConfig负责请求处理层配置(Spring MVC中的V,C)<br>4)WebInitializer 负责启动初始化.</p>
<p>基于配置架构,创建配置类:</p>
<p>数据层配置类</p>
<pre><code>package com.cy.pj.common.config;
@Configuration
@MapperScan(&quot;com.cy.pj.goods.dao&quot;)//扫描dao
public class SpringRepositoryConfig {
}</code></pre><p>业务层配置类:<br>package com.cy.pj.common.config;<br>@Configuration<br>@ComponentScan(“com.cy.pj.goods.service”)<br>public class SpringServiceConfig {<br>    //…..<br>}</p>
<p>控制层配置类</p>
<pre><code>package com.cy.pj.common.config;
@ComponentScan(&quot;com.cy.pj.goods.controller&quot;)
@EnableWebMvc
@Configuration 
public class SpringWebConfig implements WebMvcConfigurer{

}</code></pre><p>WebInitializer 启动类配置:</p>
<pre><code>package com.cy.pj.common.config;
//--&gt;web.xml
public class WebInitializer extends 
AbstractAnnotationConfigDispatcherServletInitializer {
    //Service,Repository
    @Override
    protected Class&lt;?&gt;[] getRootConfigClasses() {
        System.out.println(&quot;getRootConfigClasses()&quot;);
        return new Class[] {SpringRepositoryConfig.class,
SpringServiceConfig.class};
    }
    //View,Controller
    @Override
    protected Class&lt;?&gt;[] getServletConfigClasses() {
        System.out.println(&quot;getServletConfigClasses()&quot;);
        return new Class[] {SpringWebConfig.class};
    }
    @Override
    protected String[] getServletMappings() {
        System.out.println(&quot;getServletMappings()&quot;);
        return new String[] {&quot;/&quot;};
    }

}</code></pre><p>整合过程分析:(顺序从右到左)<br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://www.zhangpeng.fun/upload/2019/12/image-2c8c25e8740f4e56b2b9d96c7e01008a.png" alt="image.png"></p>
<h3 id="2-4-2-整合连接池对象"><a href="#2-4-2-整合连接池对象" class="headerlink" title="2.4.2.整合连接池对象"></a>2.4.2.整合连接池对象</h3><p>在SpringRepositoryConfig 类中添加dataSource()方法,在方法中创建<br>DruidDataSource对象.并将此对象交给spring管理.</p>
<pre><code>@Bean(value=&quot;druid&quot;,initMethod=&quot;init&quot;,destroyMethod=&quot;close&quot;)
public DruidDataSource dataSource() {
    DruidDataSource ds=new DruidDataSource();
    ds.setUrl(&quot;jdbc:mysql:///dbgoods?serverTimezone=GMT%2B8&quot;);
    ds.setUsername(&quot;root&quot;);
    ds.setPassword(&quot;root&quot;);
    return ds;
}</code></pre><p>说明:@Bean注解要配合@Configuration注解使用,@Configuration用于描述类.</p>
<h3 id="2-4-3-整合mybatis框架"><a href="#2-4-3-整合mybatis框架" class="headerlink" title="2.4.3.整合mybatis框架"></a>2.4.3.整合mybatis框架</h3><p>在SpringRepositoryConfig类中添加创建SqlSessionFactory对象创建<br>的方法:</p>
<pre><code>@Bean(&quot;sqlSessionFactory&quot;)
public SqlSessionFactory newSqlSessionFactory(
        DataSource dataSource) 
        throws Exception {
  //构建SqlSessionFactoryBean对象
  SqlSessionFactoryBean factoryBean =
  new SqlSessionFactoryBean();
  factoryBean.setDataSource(dataSource);
  //调用FactoryBean的getObject方法创建SqlSessionFactory
  //底层会使用SqlSessionFactoryBuilder创建
  return factoryBean.getObject();
}</code></pre><p>参考:<a href="http://www.mybatis.org/spring" target="_blank" rel="noopener">www.mybatis.org/spring</a></p>
<h3 id="2-4-4-整合Spring-MVC-模块"><a href="#2-4-4-整合Spring-MVC-模块" class="headerlink" title="2.4.4.整合Spring MVC 模块"></a>2.4.4.整合Spring MVC 模块</h3><p>在Spring MVC配置类中添加视图解析配置,默认servlet处理等配置.</p>
<pre><code>package com.cy.pj.common.config;

@Configuration 
@ComponentScan(&quot;com.cy.pj.goods.controller&quot;)
@EnableWebMvc //&lt;mvc:annotation-driven/&gt;
public class SpringWebConfig implements WebMvcConfigurer{
    //&lt;mvc:default-servlet-handler/&gt;
    @Override
    public void configureDefaultServletHandling(
            DefaultServletHandlerConfigurer configurer) {
        configurer.enable();
    }
    @Override
    public void configureViewResolvers(
        ViewResolverRegistry registry) {
        registry.jsp(&quot;/WEB-INF/pages/&quot;,&quot;.html&quot;);
    }
}</code></pre><h2 id="2-5-业务设计分析及实现"><a href="#2-5-业务设计分析及实现" class="headerlink" title="2.5.业务设计分析及实现"></a>2.5.业务设计分析及实现</h2><h3 id="2-5-1-业务架构"><a href="#2-5-1-业务架构" class="headerlink" title="2.5.1.业务架构"></a>2.5.1.业务架构</h3><p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://www.zhangpeng.fun/upload/2019/12/image-672453807116433ca5a8bab6a294760f.png" alt="image.png"></p>
<h3 id="2-5-2-POJO实现"><a href="#2-5-2-POJO实现" class="headerlink" title="2.5.2.POJO实现"></a>2.5.2.POJO实现</h3><p>定义pojo对象Goods用于封装数据:</p>
<pre><code>package com.cy.pj.goods.pojo;
import java.io.Serializable;
import java.util.Date;
public class Goods implements Serializable{
    private static final long serialVersionUID = 690138036951052829L;
    private Long id;
    private String name;
    private String remark;
    private Date createdTime;
    public Long getId() {
        return id;
    }
    public void setId(Long id) {
        this.id = id;
    }
    public String getName() {
        return name;
    }
    public void setName(String name) {
        this.name = name;
    }

    public String getRemark() {
        return remark;
    }

    public void setRemark(String remark) {
        this.remark = remark;
    }

    public Date getCreatedTime() {
        return createdTime;
    }

    public void setCreatedTime(Date createdTime) {
        this.createdTime = createdTime;
    }

    @Override
    public String toString() {
        return &quot;Goods [id=&quot; + id + &quot;, name=&quot; + name + &quot;, remark=&quot; + remark + &quot;, createdTime=&quot; + createdTime + &quot;]&quot;;
    }
}</code></pre><h3 id="2-5-3-Dao实现"><a href="#2-5-3-Dao实现" class="headerlink" title="2.5.3.Dao实现"></a>2.5.3.Dao实现</h3><p>定义GoodsDao接口,代码如下:</p>
<pre><code>package com.cy.pj.goods.dao;
import org.apache.ibatis.annotations.Select;
public interface GoodsDao {

@Select(&quot;select * from tb_goods&quot;)
    List&lt;Goods&gt; findGoods();
}</code></pre><p>在SpringRepositoryConfig类上添加@MapperScan注解,实现对指定包下Dao接口的扫描:</p>
<pre><code>@Configuration
@MapperScan(&quot;com.cy.pj.goods.dao&quot;)//扫描dao
public class SpringRepositoryConfig {
  //....
}</code></pre><p>编写单元测试类TestGoodsDao,然后getRowCount方法进行测试</p>
<pre><code>public class TestGoodsDao extends TestBase{
     @Test
     public void testFindGoods() {
           GoodsDao dao=ctx.getBean(&quot;goodsDao&quot;,GoodsDao.class);
           List&lt;Goods&gt; list=dao.findGoods();
           for(Goods g:list) {
            System.out.println(g);
           }
     }
}</code></pre><h3 id="2-5-4-Service实现"><a href="#2-5-4-Service实现" class="headerlink" title="2.5.4.Service实现"></a>2.5.4.Service实现</h3><p>创建GoodsService接口,实现具体业务:</p>
<pre><code>package com.cy.pj.goods.service;
import java.util.List;
import com.cy.pj.goods.pojo.Goods;
public interface GoodsService {
     List&lt;Goods&gt; findGoods();
}</code></pre><p>创建接口实现类:</p>
<pre><code>package com.cy.pj.goods.service.impl;
import java.util.List;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import com.cy.pj.goods.dao.GoodsDao;
import com.cy.pj.goods.pojo.Goods;
import com.cy.pj.goods.service.GoodsService;
@Service
public class GoodsServiceImpl implements GoodsService {
    @Autowired
    private GoodsDao goodsDao;
    @Override
    public List&lt;Goods&gt; findGoods() {
        //...
        List&lt;Goods&gt; list=goodsDao.findGoods();
        //...
        return list;
    }
}</code></pre><p>编写Service配置类(需要在容器启动时加载),对service对象进行扫描</p>
<pre><code>package com.cy.pj.common.config;
import org.springframework.context.annotation.ComponentScan;
import org.springframework.context.annotation.Configuration;
@Configuration
@ComponentScan(&quot;com.cy.pj.goods.service&quot;)
public class SpringServiceConfig {

    //.....
}</code></pre><p>编写测试类执行单元测试:</p>
<pre><code>public class TestGoodsService extends TestBase{
    @Test
    public void testFindGoods() {
        GoodsService gs=
        ctx.getBean(&quot;goodsServiceImpl&quot;, GoodsService.class);
        List&lt;Goods&gt; list=gs.findGoods();
        for(Goods g:list) {
            System.out.println(g);
        }
    }
}</code></pre><p>2.5.5.Controller实现<br>编写controller,用于处理客户端的请求:</p>
<pre><code>package com.cy.pj.goods.controller;

import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.ResponseBody;

import com.cy.pj.goods.pojo.Goods;
import com.cy.pj.goods.service.GoodsService;

@Controller
@RequestMapping(&quot;/goods/&quot;)
public class GoodsController {
    @Autowired
    private GoodsService goodsService;
    @RequestMapping(&quot;doFindGoods&quot;)
    @ResponseBody
    public List&lt;Goods&gt; doFindGoods(){
        return goodsService.findGoods();
    }//json 串:spring mvc 启动API将对象转换为JSON串
}</code></pre><p>2.6.项目部署及运行分析<br>项目部署到tomcat,然后启动进行访问测试.</p>
<p><a href="http://localhost/CGB-SSM-01/goods/doFindGoods" target="_blank" rel="noopener">http://localhost/CGB-SSM-01/goods/doFindGoods</a></p>
<h1 id="少年易老学难成，一寸光阴不可轻。"><a href="#少年易老学难成，一寸光阴不可轻。" class="headerlink" title="少年易老学难成，一寸光阴不可轻。"></a>少年易老学难成，一寸光阴不可轻。</h1>]]></content>
      <categories>
        <category>后端</category>
      </categories>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBoot系列 - Redis数据库</title>
    <url>/2020/06/08/SpringBoot%E7%B3%BB%E5%88%97-Redis%E6%95%B0%E6%8D%AE%E5%BA%93/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="SpringBoot系列-Redis数据库"><a href="#SpringBoot系列-Redis数据库" class="headerlink" title="SpringBoot系列 - Redis数据库"></a>SpringBoot系列 - Redis数据库</h1><p>在互联网场景下，尤其 2C 端大流量场景下，需要将一些经常展现和不会频繁变更的数据，存放在存取速率更快的地方。 缓存就是一个存储器，在技术选型中，常用 Redis 作为缓存数据库。缓存主要是在获取资源方便性能优化的关键方面。</p>
<p>如果使用Redis缓存技术，SpringBoot中有两种方式实现缓存，一个是上一篇中通过CacheManager实现， 不过这个是对于简单的缓存场景，而更为强大的是通过<code>RedisTemplate</code>来直接操作Redis数据库实现缓存。</p>
<p>Redis 是一个高性能的 key-value 数据库。GitHub 地址：<a href="https://github.com/antirez/redis" target="_blank" rel="noopener">https://github.com/antirez/redis</a> 。</p>
<p>Github 是这么描述的：</p>
<p>Redis is an in-memory database that persists on disk. The data model is key-value, but many different kind of values are supported: Strings, Lists, Sets, Sorted Sets, Hashes, HyperLogLogs, Bitmaps.</p>
<p>缓存的应用场景有哪些呢？</p>
<p>比如常见的电商场景，根据商品 ID 获取商品信息时，店铺信息和商品详情信息就可以缓存在 Redis，直接从 Redis 获取。 减少了去数据库查询的次数。但会出现新的问题，就是如何对缓存进行更新？这就是下面要讲的。</p>
<h2 id="缓存更新策略"><a href="#缓存更新策略" class="headerlink" title="缓存更新策略"></a>缓存更新策略</h2><p>参考<a href="http://coolshell.cn/articles/17416.html" target="_blank" rel="noopener">《缓存更新的套路》</a> ，缓存更新的模式有四种：</p>
<ol>
<li>Cache aside</li>
<li>Read through</li>
<li>Write through</li>
<li>Write behind caching</li>
</ol>
<p>这里我们使用的是 Cache Aside 策略，从三个维度：</p>
<ul>
<li>失效：应用程序先从cache取数据，没有得到，则从数据库中取数据，成功后，放到缓存中。</li>
<li>命中：应用程序从cache中取数据，取到后返回。</li>
<li>更新：先把数据存到数据库中，成功后，再让缓存失效。</li>
</ul>
<p>大致流程如下：</p>
<p>获取商品详情举例</p>
<ol>
<li>从商品 Cache 中获取商品详情，如果存在，则返回获取 Cache 数据返回。</li>
<li>如果不存在，则从商品 DB 中获取。获取成功后，将数据存到 Cache 中。则下次获取商品详情，就可以从 Cache 就可以得到商品详情数据。</li>
<li>从商品 DB 中更新或者删除商品详情成功后，则从缓存中删除对应商品的详情缓存</li>
</ol>
<p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591544110-b3d7bc67537ad6ee8a56babe2402340c.png" alt=""></p>
<h2 id="添加maven依赖"><a href="#添加maven依赖" class="headerlink" title="添加maven依赖"></a>添加maven依赖</h2><p>这里仍然是MyBatis做数据库DAO操作，Redis做缓存操作。</p>
<p>SpringBoot 2开始默认的Redis客户端实现是Lettuce，同时你需要添加commons-pool2的依赖。</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.commons<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-pool2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;jackson-databind-version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-databind<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;jackson-databind-version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-annotations<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;jackson-databind-version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.vaadin.external.google<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>android-json<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mysql-connector.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;druid.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- MyBatis plus增强和springboot的集成--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mybatis-plus.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatisplus-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mybatisplus-spring-boot-starter.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>注意上面我添加了Jackson的依赖，后面要用到。</p>
<h3 id="配置application-yml"><a href="#配置application-yml" class="headerlink" title="配置application.yml"></a>配置application.yml</h3><p>增加 Redis 相关配置</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cache:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">REDIS</span></span><br><span class="line">    <span class="attr">redis:</span></span><br><span class="line">      <span class="attr">cache-null-values:</span> <span class="literal">false</span></span><br><span class="line">      <span class="attr">time-to-live:</span> <span class="string">600000ms</span></span><br><span class="line">      <span class="attr">use-key-prefix:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">cache-names:</span> <span class="string">userCache,allUsersCache</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">6379</span></span><br><span class="line">    <span class="attr">database:</span> <span class="number">0</span></span><br><span class="line">    <span class="attr">lettuce:</span></span><br><span class="line">      <span class="attr">shutdown-timeout:</span> <span class="string">200ms</span></span><br><span class="line">      <span class="attr">pool:</span></span><br><span class="line">        <span class="attr">max-active:</span> <span class="number">7</span></span><br><span class="line">        <span class="attr">max-idle:</span> <span class="number">7</span></span><br><span class="line">        <span class="attr">min-idle:</span> <span class="number">2</span></span><br><span class="line">        <span class="attr">max-wait:</span> <span class="string">-1ms</span></span><br></pre></td></tr></table></figure>

<p>对应的配置类：</p>
<p><code>org.springframework.boot.autoconfigure.data.redis.RedisProperties</code></p>
<h2 id="添加配置类"><a href="#添加配置类" class="headerlink" title="添加配置类"></a>添加配置类</h2><p>这里自定义RedisTemplate的配置类，主要是想使用Jackson替换默认的序列化机制：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisConfig</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * redisTemplate 默认使用JDK的序列化机制, 存储二进制字节码, 所以自定义序列化类</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> redisConnectionFactory redis连接工厂类</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> RedisTemplate</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RedisTemplate&lt;Object, Object&gt; <span class="title">redisTemplate</span><span class="params">(RedisConnectionFactory redisConnectionFactory)</span> </span>&#123;</span><br><span class="line">        RedisTemplate&lt;Object, Object&gt; redisTemplate = <span class="keyword">new</span> RedisTemplate&lt;&gt;();</span><br><span class="line">        redisTemplate.setConnectionFactory(redisConnectionFactory);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 使用Jackson2JsonRedisSerialize 替换默认序列化</span></span><br><span class="line">        Jackson2JsonRedisSerializer jackson2JsonRedisSerializer = <span class="keyword">new</span> Jackson2JsonRedisSerializer(Object<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line">        ObjectMapper objectMapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">        objectMapper.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);</span><br><span class="line">        objectMapper.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL);</span><br><span class="line"></span><br><span class="line">        jackson2JsonRedisSerializer.setObjectMapper(objectMapper);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 设置value的序列化规则和 key的序列化规则</span></span><br><span class="line">        redisTemplate.setKeySerializer(<span class="keyword">new</span> StringRedisSerializer());</span><br><span class="line">        redisTemplate.setValueSerializer(jackson2JsonRedisSerializer);</span><br><span class="line">        redisTemplate.afterPropertiesSet();</span><br><span class="line">        <span class="keyword">return</span> redisTemplate;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="使用演示"><a href="#使用演示" class="headerlink" title="使用演示"></a>使用演示</h2><p>MyBatis实现的DAO层，以及User实体类我就不贴在这里了，只贴Service核心增删改查操作：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Logger logger = LoggerFactory.getLogger(<span class="keyword">this</span>.getClass());</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate&lt;String, User&gt; redisTemplate;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建用户</span></span><br><span class="line"><span class="comment">     * 不会对缓存做任何操作</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">createUser</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">        logger.info(<span class="string">"创建用户start..."</span>);</span><br><span class="line">        userMapper.insert(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取用户信息</span></span><br><span class="line"><span class="comment">     * 如果缓存存在，从缓存中获取城市信息</span></span><br><span class="line"><span class="comment">     * 如果缓存不存在，从 DB 中获取城市信息，然后插入缓存</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id 用户ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 用户</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">getById</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        logger.info(<span class="string">"获取用户start..."</span>);</span><br><span class="line">        <span class="comment">// 从缓存中获取用户信息</span></span><br><span class="line">        String key = <span class="string">"user_"</span> + id;</span><br><span class="line">        ValueOperations&lt;String, User&gt; operations = redisTemplate.opsForValue();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 缓存存在</span></span><br><span class="line">        <span class="keyword">boolean</span> hasKey = redisTemplate.hasKey(key);</span><br><span class="line">        <span class="keyword">if</span> (hasKey) &#123;</span><br><span class="line">            User user = operations.get(key);</span><br><span class="line">            logger.info(<span class="string">"从缓存中获取了用户 id = "</span> + id);</span><br><span class="line">            <span class="keyword">return</span> user;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 缓存不存在，从 DB 中获取</span></span><br><span class="line">        User user = userMapper.selectById(id);</span><br><span class="line">        <span class="comment">// 插入缓存</span></span><br><span class="line">        operations.set(key, user, <span class="number">10</span>, TimeUnit.SECONDS);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 更新用户</span></span><br><span class="line"><span class="comment">     * 如果缓存存在，删除</span></span><br><span class="line"><span class="comment">     * 如果缓存不存在，不操作</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> user 用户</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateUser</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">        logger.info(<span class="string">"更新用户start..."</span>);</span><br><span class="line">        userMapper.updateById(user);</span><br><span class="line">        <span class="keyword">int</span> userId = user.getId();</span><br><span class="line">        <span class="comment">// 缓存存在，删除缓存</span></span><br><span class="line">        String key = <span class="string">"user_"</span> + userId;</span><br><span class="line">        <span class="keyword">boolean</span> hasKey = redisTemplate.hasKey(key);</span><br><span class="line">        <span class="keyword">if</span> (hasKey) &#123;</span><br><span class="line">            redisTemplate.delete(key);</span><br><span class="line">            logger.info(<span class="string">"更新用户时候，从缓存中删除用户 &gt;&gt; "</span> + userId);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除用户</span></span><br><span class="line"><span class="comment">     * 如果缓存中存在，删除</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteById</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        logger.info(<span class="string">"删除用户start..."</span>);</span><br><span class="line">        userMapper.deleteById(id);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 缓存存在，删除缓存</span></span><br><span class="line">        String key = <span class="string">"user_"</span> + id;</span><br><span class="line">        <span class="keyword">boolean</span> hasKey = redisTemplate.hasKey(key);</span><br><span class="line">        <span class="keyword">if</span> (hasKey) &#123;</span><br><span class="line">            redisTemplate.delete(key);</span><br><span class="line">            logger.info(<span class="string">"删除用户时候，从缓存中删除用户 &gt;&gt; "</span> + id);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>RedisTemplate 封装了 RedisConnection，具有连接管理，序列化和 Redis 操作等功能。 还有专门针对 String 的模板对象 StringRedisTemplate。</p>
<p>Redis 操作视图接口类用的是 ValueOperations，对应的是 Redis String/Value 操作。</p>
<p>还有其他的操作视图，ListOperations、SetOperations、ZSetOperations 和 HashOperations 。 ValueOperations 插入缓存是可以设置失效时间，这里设置的失效时间是 10 s。</p>
<p>然后写个测试类测试运行看看效果：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RunWith</span>(SpringRunner<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">@<span class="title">SpringBootTest</span>(<span class="title">classes</span> </span>= Application<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">@<span class="title">Transactional</span></span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">UserServiceTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testCache</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> id = <span class="keyword">new</span> Random().nextInt(<span class="number">1000</span>);</span><br><span class="line">        User user = <span class="keyword">new</span> User(id, <span class="string">"admin"</span>, <span class="string">"admin"</span>);</span><br><span class="line">        userService.createUser(user);</span><br><span class="line">        User user1 = userService.getById(id); <span class="comment">// 第1次访问</span></span><br><span class="line">        assertEquals(user1.getPassword(), <span class="string">"admin"</span>);</span><br><span class="line">        User user2 = userService.getById(id); <span class="comment">// 第2次访问</span></span><br><span class="line">        assertEquals(user2.getPassword(), <span class="string">"admin"</span>);</span><br><span class="line">        user.setPassword(<span class="string">"123456"</span>);</span><br><span class="line">        userService.updateUser(user);</span><br><span class="line">        User user3 = userService.getById(id); <span class="comment">// 第3次访问</span></span><br><span class="line">        assertEquals(user3.getPassword(), <span class="string">"123456"</span>);</span><br><span class="line">        userService.deleteById(id);</span><br><span class="line">        assertNull(userService.getById(id));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行SpringBoot集成测试，查看日志如下：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">创建用户start...</span><br><span class="line">==&gt;  Preparing: <span class="keyword">INSERT</span> <span class="keyword">INTO</span> t_user ( <span class="keyword">id</span>, username, <span class="string">`password`</span> ) <span class="keyword">VALUES</span> ( ?, ?, ? )</span><br><span class="line">==&gt; <span class="keyword">Parameters</span>: <span class="number">89</span>(<span class="built_in">Integer</span>), <span class="keyword">admin</span>(<span class="keyword">String</span>), <span class="keyword">admin</span>(<span class="keyword">String</span>)</span><br><span class="line">&lt;==    Updates: <span class="number">1</span></span><br><span class="line">获取用户start...</span><br><span class="line"><span class="keyword">Starting</span> <span class="keyword">without</span> optional epoll <span class="keyword">library</span></span><br><span class="line"><span class="keyword">Starting</span> <span class="keyword">without</span> optional kqueue <span class="keyword">library</span></span><br><span class="line">==&gt;  Preparing: <span class="keyword">SELECT</span> <span class="keyword">id</span> <span class="keyword">AS</span> <span class="keyword">id</span>,username,<span class="string">`password`</span> <span class="keyword">FROM</span> t_user <span class="keyword">WHERE</span> <span class="keyword">id</span>=?</span><br><span class="line">==&gt; <span class="keyword">Parameters</span>: <span class="number">89</span>(<span class="built_in">Integer</span>)</span><br><span class="line">&lt;==      Total: <span class="number">1</span></span><br><span class="line">获取用户start...</span><br><span class="line">从缓存中获取了用户 <span class="keyword">id</span> = <span class="number">89</span></span><br><span class="line">更新用户start...</span><br><span class="line">==&gt;  Preparing: <span class="keyword">UPDATE</span> t_user <span class="keyword">SET</span> username=?, <span class="string">`password`</span>=? <span class="keyword">WHERE</span> <span class="keyword">id</span>=?</span><br><span class="line">==&gt; <span class="keyword">Parameters</span>: <span class="keyword">admin</span>(<span class="keyword">String</span>), <span class="number">123456</span>(<span class="keyword">String</span>), <span class="number">89</span>(<span class="built_in">Integer</span>)</span><br><span class="line">&lt;==    Updates: <span class="number">1</span></span><br><span class="line">更新用户时候，从缓存中删除用户 &gt;&gt; <span class="number">89</span></span><br><span class="line">获取用户start...</span><br><span class="line">==&gt;  Preparing: <span class="keyword">SELECT</span> <span class="keyword">id</span> <span class="keyword">AS</span> <span class="keyword">id</span>,username,<span class="string">`password`</span> <span class="keyword">FROM</span> t_user <span class="keyword">WHERE</span> <span class="keyword">id</span>=?</span><br><span class="line">==&gt; <span class="keyword">Parameters</span>: <span class="number">89</span>(<span class="built_in">Integer</span>)</span><br><span class="line">&lt;==      Total: <span class="number">1</span></span><br><span class="line">删除用户start...</span><br><span class="line">==&gt;  Preparing: <span class="keyword">DELETE</span> <span class="keyword">FROM</span> t_user <span class="keyword">WHERE</span> <span class="keyword">id</span>=?</span><br><span class="line">==&gt; <span class="keyword">Parameters</span>: <span class="number">89</span>(<span class="built_in">Integer</span>)</span><br><span class="line">&lt;==    Updates: <span class="number">1</span></span><br><span class="line">更新用户时候，从缓存中删除用户 &gt;&gt; <span class="number">89</span></span><br><span class="line">获取用户start...</span><br><span class="line">==&gt;  Preparing: <span class="keyword">SELECT</span> <span class="keyword">id</span> <span class="keyword">AS</span> <span class="keyword">id</span>,username,<span class="string">`password`</span> <span class="keyword">FROM</span> t_user <span class="keyword">WHERE</span> <span class="keyword">id</span>=?</span><br><span class="line">==&gt; <span class="keyword">Parameters</span>: <span class="number">89</span>(<span class="built_in">Integer</span>)</span><br><span class="line">&lt;==      Total: <span class="number">0</span></span><br><span class="line">Rolled back <span class="keyword">transaction</span> <span class="keyword">for</span> <span class="keyword">test</span>: [DefaultTestContext@<span class="number">6e20</span>b53a testClass = UserServiceTest</span><br><span class="line">Closing org.springframework.context.annotation.AnnotationConfigApplicationContext@<span class="number">503</span>f91c3</span><br><span class="line">&#123;dataSource<span class="number">-1</span>&#125; closed</span><br></pre></td></tr></table></figure>

<p>可以看出第一次取的时候，缓存未命中，会从DB中取数据，而第2次取的时候缓存命中直接从缓存中取出来。 后面不管是更新和删除，都会从缓存中删除。再去取的时候缓存未命中，从DB中取最新的。</p>
<h2 id="GitHub源码"><a href="#GitHub源码" class="headerlink" title="GitHub源码"></a>GitHub源码</h2><p><a href="https://github.com/yidao620c/SpringBootBucket/tree/master/springboot-redis" target="_blank" rel="noopener">springboot-redis</a>   —已测试</p>
<h2 id="来源"><a href="#来源" class="headerlink" title="来源"></a>来源</h2><p><a href="https://www.xncoding.com/" target="_blank" rel="noopener">https://www.xncoding.com/</a></p>
]]></content>
      <categories>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>redis</tag>
        <tag>springboot</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBoot系列 - cxf实现WebService</title>
    <url>/2020/06/08/SpringBoot%E7%B3%BB%E5%88%97-cxf%E5%AE%9E%E7%8E%B0WebService/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="SpringBoot系列-cxf实现WebService"><a href="#SpringBoot系列-cxf实现WebService" class="headerlink" title="SpringBoot系列 - cxf实现WebService"></a>SpringBoot系列 - cxf实现WebService</h1><p>说起web service最近几年restful大行其道，大有取代传统soap web service的趋势， 但是一些特有或相对老旧的系统依然使用了传统的soap web service，例如银行、航空公司的机票查询接口等。 本篇主要讲解spring boot整合cxf发布webservice服务和spring boot整合cxf客户端调用webservice服务。</p>
<h2 id="maven依赖"><a href="#maven依赖" class="headerlink" title="maven依赖"></a>maven依赖</h2><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jetty<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- CXF webservice --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.cxf<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cxf-spring-boot-starter-jaxws<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.2.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- CXF webservice --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.hamcrest<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hamcrest-all<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="服务接口"><a href="#服务接口" class="headerlink" title="服务接口"></a>服务接口</h2><p>先定义一个简单的用户类User：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xncoding.webservice.model;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">(Long id, String name, Integer age)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// getter and setter</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意，上面的包名是下面接口定义的targetNamespace的倒序。</p>
<p>创建一个简单的服务接口，定义了两个方法，一个返回字符串，一个返回一个实体类User：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xncoding.webservice.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.xncoding.webservice.model.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.jws.WebMethod;</span><br><span class="line"><span class="keyword">import</span> javax.jws.WebParam;</span><br><span class="line"><span class="keyword">import</span> javax.jws.WebService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebService</span>(name = <span class="string">"CommonService"</span>, <span class="comment">// 暴露服务名称</span></span><br><span class="line">        targetNamespace = <span class="string">"http://model.webservice.xncoding.com/"</span><span class="comment">// 命名空间,一般是接口的包名倒序</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ICommonService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@WebMethod</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">sayHello</span><span class="params">(@WebParam(name = <span class="string">"userName"</span>)</span> String name)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@WebMethod</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">getUser</span><span class="params">(@WebParam(name = <span class="string">"userName"</span>)</span> String name)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="接口实现"><a href="#接口实现" class="headerlink" title="接口实现"></a>接口实现</h2><p>接下来实现这个接口，编写相应的业务逻辑：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xncoding.webservice.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.xncoding.webservice.model.User;</span><br><span class="line"><span class="keyword">import</span> com.xncoding.webservice.service.ICommonService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.jws.WebService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebService</span>(serviceName = <span class="string">"CommonService"</span>, <span class="comment">// 与接口中指定的name一致</span></span><br><span class="line">        targetNamespace = <span class="string">"http://model.webservice.xncoding.com/"</span>, <span class="comment">// 与接口中的命名空间一致,一般是接口的包名倒</span></span><br><span class="line">        endpointInterface = <span class="string">"com.xncoding.webservice.service.ICommonService"</span><span class="comment">// 接口地址</span></span><br><span class="line">)</span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CommonServiceImpl</span> <span class="keyword">implements</span> <span class="title">ICommonService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">sayHello</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Hello ,"</span> + name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">getUser</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> User(<span class="number">1000L</span>, name, <span class="number">23</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="配置类"><a href="#配置类" class="headerlink" title="配置类"></a>配置类</h2><p>接下来编写cxf的配置类：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CxfConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> Bus bus;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    ICommonService commonService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * JAX-WS</span></span><br><span class="line"><span class="comment">     **/</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Endpoint <span class="title">endpoint</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        EndpointImpl endpoint = <span class="keyword">new</span> EndpointImpl(bus, commonService);</span><br><span class="line">        endpoint.publish(<span class="string">"/CommonService"</span>);</span><br><span class="line">        <span class="keyword">return</span> endpoint;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里把<code>Commonservice</code>接口发布在了路径<code>/services/CommonService</code>下，wsdl文档路径为<code>http://localhost:{port}/services/CommonService?wsdl</code></p>
<p>如果你想自定义wsdl的访问url，那么可以在application.yml中自定义：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">cxf:</span></span><br><span class="line">  <span class="attr">path:</span> <span class="string">/services</span>  <span class="comment"># 替换默认的/services路径</span></span><br></pre></td></tr></table></figure>

<h2 id="客户端访问"><a href="#客户端访问" class="headerlink" title="客户端访问"></a>客户端访问</h2><p>直接客户端去访问有两种方式</p>
<h3 id="代理类工厂的方式"><a href="#代理类工厂的方式" class="headerlink" title="代理类工厂的方式"></a>代理类工厂的方式</h3><p>这种方式需要拿到对方的接口</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">cl1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 接口地址</span></span><br><span class="line">        <span class="comment">// 代理工厂</span></span><br><span class="line">        JaxWsProxyFactoryBean jaxWsProxyFactoryBean = <span class="keyword">new</span> JaxWsProxyFactoryBean();</span><br><span class="line">        <span class="comment">// 设置代理地址</span></span><br><span class="line">        jaxWsProxyFactoryBean.setAddress(wsdlAddress);</span><br><span class="line">        <span class="comment">// 设置接口类型</span></span><br><span class="line">        jaxWsProxyFactoryBean.setServiceClass(ICommonService<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        <span class="comment">// 创建一个代理接口实现</span></span><br><span class="line">        ICommonService cs = (ICommonService) jaxWsProxyFactoryBean.create();</span><br><span class="line">        <span class="comment">// 数据准备</span></span><br><span class="line">        String userName = <span class="string">"Leftso"</span>;</span><br><span class="line">        <span class="comment">// 调用代理接口的方法调用并返回结果</span></span><br><span class="line">        String result = cs.sayHello(userName);</span><br><span class="line">        System.out.println(<span class="string">"返回结果:"</span> + result);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="动态调用方式"><a href="#动态调用方式" class="headerlink" title="动态调用方式"></a>动态调用方式</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">cl2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 创建动态客户端</span></span><br><span class="line">    JaxWsDynamicClientFactory dcf = JaxWsDynamicClientFactory.newInstance();</span><br><span class="line">    Client client = dcf.createClient(wsdlAddress);</span><br><span class="line">    <span class="comment">// 需要密码的情况需要加上用户名和密码</span></span><br><span class="line">    <span class="comment">// client.getOutInterceptors().add(new ClientLoginInterceptor(USER_NAME, PASS_WORD));</span></span><br><span class="line">    Object[] objects;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// invoke("方法名",参数1,参数2,参数3....);</span></span><br><span class="line">        objects = client.invoke(<span class="string">"sayHello"</span>, <span class="string">"Leftso"</span>);</span><br><span class="line">        System.out.println(<span class="string">"返回类型："</span> + objects[<span class="number">0</span>].getClass());</span><br><span class="line">        System.out.println(<span class="string">"返回数据:"</span> + objects[<span class="number">0</span>]);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (java.lang.Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">cl3</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 创建动态客户端</span></span><br><span class="line">    JaxWsDynamicClientFactory dcf = JaxWsDynamicClientFactory.newInstance();</span><br><span class="line">    Client client = dcf.createClient(wsdlAddress);</span><br><span class="line">    Object[] objects;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// invoke("方法名",参数1,参数2,参数3....);</span></span><br><span class="line">        objects = client.invoke(<span class="string">"getUser"</span>, <span class="string">"张三"</span>);</span><br><span class="line">        System.out.println(<span class="string">"返回类型："</span> + objects[<span class="number">0</span>].getClass());</span><br><span class="line">        System.out.println(<span class="string">"返回数据:"</span> + objects[<span class="number">0</span>]);</span><br><span class="line">        User user = (User) objects[<span class="number">0</span>];</span><br><span class="line">        System.out.println(<span class="string">"返回对象User.name="</span> + user.getName());</span><br><span class="line">    &#125; <span class="keyword">catch</span> (java.lang.Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意到如果方法返回对象的话，那么对象所在的包一定是targetNamespace的倒序。</p>
<h2 id="生成客户端代码"><a href="#生成客户端代码" class="headerlink" title="生成客户端代码"></a>生成客户端代码</h2><p>这是推荐做法，就是根据wsdl的访问路径来生成客户端代码。这里有两种生成方式</p>
<h3 id="Apache的wsdl2java工具"><a href="#Apache的wsdl2java工具" class="headerlink" title="Apache的wsdl2java工具"></a>Apache的wsdl2java工具</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">wsdl2java -autoNameResolution http:&#x2F;&#x2F;xxx?wsdl</span><br></pre></td></tr></table></figure>

<h3 id="JDK自带的工具（推荐）"><a href="#JDK自带的工具（推荐）" class="headerlink" title="JDK自带的工具（推荐）"></a>JDK自带的工具（推荐）</h3><p>JDK自己内置了一个wsimport工具，这个是推荐的生成方式。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">wsimport -encoding utf-8 -p com.xncoding.webservice.client -keep http:&#x2F;&#x2F;xxx?wsdl -s d:&#x2F;ws -B-XautoNameResolution</span><br></pre></td></tr></table></figure>

<p>其中：</p>
<figure class="highlight haml"><table><tr><td class="code"><pre><span class="line">-<span class="ruby">encoding ：指定编码格式（此处是utf-<span class="number">8</span>的指定格式）</span></span><br><span class="line"><span class="ruby">-keep：是否生成Java源文件</span></span><br><span class="line"><span class="ruby">-s：指定.java文件的输出目录</span></span><br><span class="line"><span class="ruby">-d：指定<span class="class">.<span class="keyword">class</span>文件的输出目录</span></span></span><br><span class="line"><span class="ruby">-p：定义生成类的包名，不定义的话有默认包名</span></span><br><span class="line"><span class="ruby">-verbose：在控制台显示输出信息</span></span><br><span class="line"><span class="ruby">-b：指定jaxws/jaxb绑定文件或额外的schemas</span></span><br><span class="line"><span class="ruby">-extension：使用扩展来支持SOAP1.<span class="number">2</span></span></span><br></pre></td></tr></table></figure>

<p>上面的命令会在<code>d:/ws</code>目录下面生成相应的客户端代码。</p>
<p>客户端使用例子：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">CommonService_Service c = <span class="keyword">new</span> CommonService_Service();</span><br><span class="line">com.xncoding.webservice.client.User user = c.getCommonServiceImplPort().getUser(<span class="string">"Tom"</span>);</span><br><span class="line">assertThat(user.getName(), is(<span class="string">"Tom"</span>));</span><br></pre></td></tr></table></figure>

<h2 id="GitHub源码"><a href="#GitHub源码" class="headerlink" title="GitHub源码"></a>GitHub源码</h2><p><a href="https://github.com/yidao620c/SpringBootBucket/tree/master/springboot-cxf" target="_blank" rel="noopener">springboot-cxf</a>    —已测试</p>
<h2 id="来源"><a href="#来源" class="headerlink" title="来源"></a>来源</h2><p><a href="https://www.xncoding.com/" target="_blank" rel="noopener">https://www.xncoding.com/</a></p>
]]></content>
      <categories>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>springboot</tag>
        <tag>crf</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBoot系列 - 使用AOP</title>
    <url>/2020/06/08/SpringBoot%E7%B3%BB%E5%88%97-%E4%BD%BF%E7%94%A8AOP/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="SpringBoot系列-使用AOP"><a href="#SpringBoot系列-使用AOP" class="headerlink" title="SpringBoot系列 - 使用AOP"></a>SpringBoot系列 - 使用AOP</h1><p>AOP（面向切面编程）是Spring的两大核心功能之一，功能非常强大，为解耦提供了非常优秀的解决方案。 现在就以springboot中aop的使用来了解一下如何使用aop。 写几个简单的Spring RESTful服务接口方法，实现方法前面或后面打印日志。</p>
<h2 id="AOP术语定义"><a href="#AOP术语定义" class="headerlink" title="AOP术语定义"></a>AOP术语定义</h2><p>Spring的AOP中有几个重要概念搞清楚就行</p>
<ul>
<li>执行点（Executepoint） - 类初始化，方法调用。</li>
<li>连接点（Joinpoint） - 执行点+方位的组合，可确定Joinpoint，比如类开始初始化前，类初始化后，方法调用前，方法调用后。</li>
<li>切点（Pointcut） - 在众多执行点中，定位感兴趣的执行点。Executepoint相当于数据库表中的记录，而Pointcut相当于查询条件。</li>
<li>增强（Advice） - 织入到目标类连接点上的一段程序代码。除了一段程序代码外，还拥有执行点的方位信息。</li>
<li>目标对象（Target） - 增强逻辑的织入目标类</li>
<li>引介（Introduction） - 一种特殊的增强（advice），它为类添加一些额外的属性和方法，动态为业务类添加其他接口的实现逻辑，让业务类成为这个接口的实现类。</li>
<li>代理（Proxy） - 一个类被AOP织入后，产生一个结果类，它便是融合了原类和增强逻辑的代理类。</li>
<li>切面（Aspect） - 切面由切点（Pointcut）和增强（Advice/Introduction）组成，既包括横切逻辑定义，也包括连接点定义。</li>
</ul>
<p>AOP工作重点：</p>
<ol>
<li>如何通过切点（Pointcut）和增强（Advice）定位到连接点（Jointpoint）上；</li>
<li>如何在增强（Advice）中编写切面的代码。</li>
</ol>
<h2 id="添加maven依赖"><a href="#添加maven依赖" class="headerlink" title="添加maven依赖"></a>添加maven依赖</h2><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.4.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jetty<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-aop<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="配置application-yml"><a href="#配置application-yml" class="headerlink" title="配置application.yml"></a>配置application.yml</h2><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server.port:</span> <span class="number">8092</span></span><br></pre></td></tr></table></figure>

<h2 id="创建Controller"><a href="#创建Controller" class="headerlink" title="创建Controller"></a>创建Controller</h2><p>没有结果返回的示例：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Description:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/first"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">first</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"first controller"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/doError"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">error</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span> / <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="创建切面类"><a href="#创建切面类" class="headerlink" title="创建切面类"></a>创建切面类</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 日志切面</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LogAspect</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Pointcut</span>(<span class="string">"execution(public * com.xncoding.aop.controller.*.*(..))"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">webLog</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before</span>(<span class="string">"webLog()"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deBefore</span><span class="params">(JoinPoint joinPoint)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        <span class="comment">// 接收到请求，记录请求内容</span></span><br><span class="line">        ServletRequestAttributes attributes = (ServletRequestAttributes) RequestContextHolder.getRequestAttributes();</span><br><span class="line">        HttpServletRequest request = attributes.getRequest();</span><br><span class="line">        <span class="comment">// 记录下请求内容</span></span><br><span class="line">        System.out.println(<span class="string">"URL : "</span> + request.getRequestURL().toString());</span><br><span class="line">        System.out.println(<span class="string">"HTTP_METHOD : "</span> + request.getMethod());</span><br><span class="line">        System.out.println(<span class="string">"IP : "</span> + request.getRemoteAddr());</span><br><span class="line">        System.out.println(<span class="string">"CLASS_METHOD : "</span> + joinPoint.getSignature().getDeclaringTypeName() + <span class="string">"."</span> + joinPoint.getSignature().getName());</span><br><span class="line">        System.out.println(<span class="string">"ARGS : "</span> + Arrays.toString(joinPoint.getArgs()));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterReturning</span>(returning = <span class="string">"ret"</span>, pointcut = <span class="string">"webLog()"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doAfterReturning</span><span class="params">(Object ret)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        <span class="comment">// 处理完请求，返回内容</span></span><br><span class="line">        System.out.println(<span class="string">"方法的返回值 : "</span> + ret);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//后置异常通知</span></span><br><span class="line">    <span class="meta">@AfterThrowing</span>(<span class="string">"webLog()"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">throwss</span><span class="params">(JoinPoint jp)</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"方法异常时执行....."</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//后置最终通知,final增强，不管是抛出异常或者正常退出都会执行</span></span><br><span class="line">    <span class="meta">@After</span>(<span class="string">"webLog()"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">after</span><span class="params">(JoinPoint jp)</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"方法最后执行....."</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//环绕通知,环绕增强，相当于MethodInterceptor</span></span><br><span class="line">    <span class="meta">@Around</span>(<span class="string">"webLog()"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">arround</span><span class="params">(ProceedingJoinPoint pjp)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"方法环绕start....."</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Object o =  pjp.proceed();</span><br><span class="line">            System.out.println(<span class="string">"方法环绕proceed，结果是 :"</span> + o);</span><br><span class="line">            <span class="keyword">return</span> o;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="测试效果"><a href="#测试效果" class="headerlink" title="测试效果"></a>测试效果</h2><p>启动项目，执行如下mvn命令：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mvn spring-boot:run</span><br></pre></td></tr></table></figure>

<p>模拟正常执行的情况，访问<code>http://localhost:8092/first</code>，看控制台结果：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">方法环绕start.....</span><br><span class="line">URL : http:&#x2F;&#x2F;localhost:8092&#x2F;first</span><br><span class="line">HTTP_METHOD : GET</span><br><span class="line">IP : 0:0:0:0:0:0:0:1</span><br><span class="line">CLASS_METHOD : com.xncoding.aop.controller.UserController.first</span><br><span class="line">ARGS : []</span><br><span class="line">方法环绕proceed，结果是 :first controller</span><br><span class="line">方法最后执行.....</span><br><span class="line">方法的返回值 : first controller</span><br></pre></td></tr></table></figure>

<p>模拟出现异常时的情况，访问<code>http://localhost:8092/doError</code>，看控制台结果：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">方法环绕start.....</span><br><span class="line">URL : http:&#x2F;&#x2F;localhost:8092&#x2F;doError</span><br><span class="line">HTTP_METHOD : GET</span><br><span class="line">IP : 0:0:0:0:0:0:0:1</span><br><span class="line">CLASS_METHOD : com.xncoding.aop.controller.UserController.error</span><br><span class="line">ARGS : []</span><br><span class="line">java.lang.ArithmeticException: &#x2F; by zero</span><br><span class="line"></span><br><span class="line">...中间省略...</span><br><span class="line"></span><br><span class="line">方法最后执行.....</span><br><span class="line">方法的返回值 : null</span><br></pre></td></tr></table></figure>

<p>通过上面的简单的例子，可以看到aop的执行顺序。知道了顺序后，就可以在相应的位置做切面处理了。</p>
<h2 id="切面注解说明"><a href="#切面注解说明" class="headerlink" title="切面注解说明"></a>切面注解说明</h2><ul>
<li>@Aspect 作用是把当前类标识为一个切面供容器读取</li>
<li>@Pointcut 定义切点，切点方法不用任何代码，返回值是void，重要的是条件表达式</li>
<li>@Before 标识一个前置增强方法，相当于BeforeAdvice的功能</li>
<li>@AfterReturning 后置增强，相当于AfterReturningAdvice，方法退出时执行</li>
<li>@AfterThrowing 异常抛出增强，相当于ThrowsAdvice</li>
<li>@After final增强，不管是抛出异常或者正常退出都会执行</li>
<li>@Around 环绕增强，相当于MethodInterceptor</li>
</ul>
<p>方法参数说明：</p>
<p>除了@Around外，每个方法里都可以加或者不加参数JoinPoint。</p>
<p>JoinPoint里包含了类名、被切面的方法名，参数等属性，可供读取使用。</p>
<p>@Around参数必须为ProceedingJoinPoint，pjp.proceed相应于执行被切面的方法。</p>
<p>@AfterReturning方法里，可以加returning = “xxx”，xxx即为在controller里方法的返回值，本例中的返回值是“first controller”。</p>
<p>@AfterThrowing方法里，可以加throwing = “XXX”，读取异常信息，如本例中可以改为：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//后置异常通知</span></span><br><span class="line"><span class="meta">@AfterThrowing</span>(throwing = <span class="string">"ex"</span>, pointcut = <span class="string">"webLog()"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">throwss</span><span class="params">(JoinPoint jp, Exception ex)</span></span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"方法异常时执行....."</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>一般常用的有before和afterReturn组合，或者单独使用Around，即可获取方法开始前和结束后的切面。</p>
<h2 id="关于切点PointCut"><a href="#关于切点PointCut" class="headerlink" title="关于切点PointCut"></a>关于切点PointCut</h2><p>execution函数用于匹配方法执行的连接点，语法为：</p>
<figure class="highlight lisp"><table><tr><td class="code"><pre><span class="line">execution(方法修饰符(可选)  返回类型  方法名  参数  异常模式(可选))</span><br></pre></td></tr></table></figure>

<p>参数部分允许使用通配符：</p>
<ol>
<li><ul>
<li>匹配任意字符，但只能匹配一个元素</li>
</ul>
</li>
<li>.. 匹配任意字符，可以匹配任意多个元素，表示类时，必须和*联合使用</li>
<li><ul>
<li>必须跟在类名后面，如Horseman+，表示类本身和继承或扩展指定类的所有类</li>
</ul>
</li>
</ol>
<p>除了execution()，Spring中还支持其他多个函数，这里列出名称和简单介绍</p>
<ol>
<li>@annotation() 表示标注了指定注解的目标类方法</li>
<li>args() 通过目标类方法的参数类型指定切点</li>
<li>@args() 通过目标类参数的对象类型是否标注了指定注解指定切点</li>
<li>within() 通过类名指定，它将匹配指定类型</li>
<li>target() 通过类名指定，同时包含所有子类</li>
<li>@within() 匹配标注了指定注解的类及其子类，必须是在目标对象上声明这个注解，在接口上声明的对它不起作用</li>
<li>@target() 匹配标注了指定注解的类，必须是在目标对象上声明这个注解，在接口上声明的对它不起作用</li>
</ol>
<p>逻辑运算符</p>
<p>表达式可由多个切点函数通过逻辑运算组成，与(&amp;&amp;)、 或(||)、 非(!)</p>
<p>比如<code>execution(* chop(..)) &amp;&amp; target(Horseman) 表示Horseman及其子类的chop方法</code></p>
<h2 id="自定义注解"><a href="#自定义注解" class="headerlink" title="自定义注解"></a>自定义注解</h2><p>一般多用于某些特定的功能，我们来自定义一个注解：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Target</span>(&#123;ElementType.METHOD, ElementType.TYPE&#125;)</span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> UserAccess &#123;</span><br><span class="line">    <span class="function">String <span class="title">desc</span><span class="params">()</span> <span class="keyword">default</span> "无信息"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在Controller里加个方法：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/second"</span>)</span><br><span class="line"><span class="meta">@UserAccess</span>(desc = <span class="string">"second"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">second</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"second controller"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>创建一个新的切面类：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.JoinPoint;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.ProceedingJoinPoint;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserAccessAspect</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Pointcut</span>(value = <span class="string">"@annotation(com.xncoding.aop.aspect.UserAccess)"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">access</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before</span>(<span class="string">"access()"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deBefore</span><span class="params">(JoinPoint joinPoint)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"second before"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Around</span>(<span class="string">"@annotation(userAccess)"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">around</span><span class="params">(ProceedingJoinPoint pjp, UserAccess userAccess)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//获取注解里的值</span></span><br><span class="line">        System.out.println(<span class="string">"second around:"</span> + userAccess.desc());</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> pjp.proceed();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable throwable) &#123;</span><br><span class="line">            throwable.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>主要看一下@Around注解这里，如果需要获取在controller注解中赋给UserAccess的desc里的值，就需要这种写法，这样UserAccess参数就有值了。</p>
<p>执行：<code>mvn spring-boot:run</code></p>
<p>启动项目，访问<code>http://localhost:8092/second</code>，看控制台：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">方法环绕start.....</span><br><span class="line">URL : http:&#x2F;&#x2F;localhost:8092&#x2F;second</span><br><span class="line">HTTP_METHOD : GET</span><br><span class="line">IP : 0:0:0:0:0:0:0:1</span><br><span class="line">CLASS_METHOD : com.xncoding.aop.controller.UserController.second</span><br><span class="line">ARGS : []</span><br><span class="line">second around:second</span><br><span class="line">second before</span><br><span class="line">方法环绕proceed，结果是 :second controller</span><br><span class="line">方法最后执行.....</span><br><span class="line">方法的返回值 : second controller</span><br></pre></td></tr></table></figure>

<p>通知结果可以看到，两个aop切面类都工作了，顺序呢就是下面的</p>
<p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591543646-c24a8d72523ce63c315ba2010e0a1207.png" alt=""></p>
<p>spring aop就是一个同心圆，要执行的方法为圆心，最外层的order最小。从最外层按照AOP1、AOP2的顺序依次执行doAround方法，doBefore方法。然后执行method方法，最后按照AOP2、AOP1的顺序依次执行doAfter、doAfterReturn方法。也就是说对多个AOP来说，先before的，一定后after。</p>
<p>对于上面的例子就是，先外层的就是对所有controller的切面，内层就是自定义注解的。 那不同的切面，顺序怎么决定呢，尤其是同格式的切面处理，譬如两个execution的情况，那spring就是随机决定哪个在外哪个在内了。</p>
<p>所以大部分情况下，我们需要指定顺序，最简单的方式就是在Aspect切面类上加上@Order(1)注解即可，order越小最先执行，也就是位于最外层。像一些全局处理的就可以把order设小一点，具体到某个细节的就设大一点。</p>
<h2 id="GitHub源码"><a href="#GitHub源码" class="headerlink" title="GitHub源码"></a>GitHub源码</h2><p><a href="https://github.com/yidao620c/SpringBootBucket/tree/master/springboot-aop" target="_blank" rel="noopener">springboot-aop</a>   —已测试</p>
<h2 id="来源"><a href="#来源" class="headerlink" title="来源"></a>来源</h2><p><a href="https://www.xncoding.com/" target="_blank" rel="noopener">https://www.xncoding.com/</a></p>
]]></content>
      <categories>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>springboot</tag>
        <tag>aop</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBoot系列 - 使用RestTemplate</title>
    <url>/2020/06/08/SpringBoot%E7%B3%BB%E5%88%97-%E4%BD%BF%E7%94%A8RestTemplate/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="SpringBoot系列-使用RestTemplate"><a href="#SpringBoot系列-使用RestTemplate" class="headerlink" title="SpringBoot系列 - 使用RestTemplate"></a>SpringBoot系列 - 使用RestTemplate</h1><p>spring框架提供的RestTemplate类可用于在应用中调用rest服务，它简化了与http服务的通信方式，统一了RESTful的标准，封装了http链接， 我们只需要传入url及返回值类型即可。相较于之前常用的HttpClient，RestTemplate是一种更优雅的调用RESTful服务的方式。</p>
<p>RestTemplate默认依赖JDK提供http连接的能力（HttpURLConnection），如果有需要的话也可以通过setRequestFactory方法替换为例如 Apache HttpComponents、Netty或OkHttp等其它HTTP library。</p>
<p>本篇介绍如何使用RestTemplate，以及在SpringBoot里面的配置和注入。</p>
<h2 id="实现逻辑"><a href="#实现逻辑" class="headerlink" title="实现逻辑"></a>实现逻辑</h2><p>RestTemplate包含以下几个部分：</p>
<ul>
<li>HttpMessageConverter 对象转换器</li>
<li>ClientHttpRequestFactory 默认是JDK的HttpURLConnection</li>
<li>ResponseErrorHandler 异常处理</li>
<li>ClientHttpRequestInterceptor 请求拦截器</li>
</ul>
<p>用一张图可以很直观的理解：</p>
<p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591541739-db62a5cdf220fad877b16009e6f23c61.png" alt=""></p>
<p>直接使用方式很简单：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RestTemplateTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        RestTemplate restT = <span class="keyword">new</span> RestTemplate();</span><br><span class="line">        <span class="comment">//通过Jackson JSON processing library直接将返回值绑定到对象</span></span><br><span class="line">        Quote quote = restT.getForObject(<span class="string">"http://gturnquist-quoters.cfapps.io/api/random"</span>, Quote<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        String quoteString = restT.getForObject(<span class="string">"http://gturnquist-quoters.cfapps.io/api/random"</span>, String<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        System.out.println(quoteString);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="发送GET请求"><a href="#发送GET请求" class="headerlink" title="发送GET请求"></a>发送GET请求</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1-getForObject()</span></span><br><span class="line">User user1 = <span class="keyword">this</span>.restTemplate.getForObject(uri, User<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2-getForEntity()</span></span><br><span class="line">ResponseEntity&lt;User&gt; responseEntity1 = <span class="keyword">this</span>.restTemplate.getForEntity(uri, User<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">HttpStatus statusCode = responseEntity1.getStatusCode();</span><br><span class="line">HttpHeaders header = responseEntity1.getHeaders();</span><br><span class="line">User user2 = responseEntity1.getBody();</span><br><span class="line">  </span><br><span class="line"><span class="comment">// 3-exchange()</span></span><br><span class="line">RequestEntity requestEntity = RequestEntity.get(<span class="keyword">new</span> URI(uri)).build();</span><br><span class="line">ResponseEntity&lt;User&gt; responseEntity2 = <span class="keyword">this</span>.restTemplate.exchange(requestEntity, User<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">User user3 = responseEntity2.getBody();</span><br></pre></td></tr></table></figure>

<h2 id="发送POST请求"><a href="#发送POST请求" class="headerlink" title="发送POST请求"></a>发送POST请求</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1-postForObject()</span></span><br><span class="line">User user1 = <span class="keyword">this</span>.restTemplate.postForObject(uri, user, User<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2-postForEntity()</span></span><br><span class="line">ResponseEntity&lt;User&gt; responseEntity1 = <span class="keyword">this</span>.restTemplate.postForEntity(uri, user, User<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3-exchange()</span></span><br><span class="line">RequestEntity&lt;User&gt; requestEntity = RequestEntity.post(<span class="keyword">new</span> URI(uri)).body(user);</span><br><span class="line">ResponseEntity&lt;User&gt; responseEntity2 = <span class="keyword">this</span>.restTemplate.exchange(requestEntity, User<span class="class">.<span class="keyword">class</span>)</span>;</span><br></pre></td></tr></table></figure>

<h2 id="设置HTTP-Header"><a href="#设置HTTP-Header" class="headerlink" title="设置HTTP Header"></a>设置HTTP Header</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1-Content-Type</span></span><br><span class="line">RequestEntity&lt;User&gt; requestEntity = RequestEntity</span><br><span class="line">        .post(<span class="keyword">new</span> URI(uri))</span><br><span class="line">        .contentType(MediaType.APPLICATION_JSON)</span><br><span class="line">        .body(user);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2-Accept</span></span><br><span class="line">RequestEntity&lt;User&gt; requestEntity = RequestEntity</span><br><span class="line">        .post(<span class="keyword">new</span> URI(uri))</span><br><span class="line">        .accept(MediaType.APPLICATION_JSON)</span><br><span class="line">        .body(user);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3-Other</span></span><br><span class="line">RequestEntity&lt;User&gt; requestEntity = RequestEntity</span><br><span class="line">        .post(<span class="keyword">new</span> URI(uri))</span><br><span class="line">        .header(<span class="string">"Authorization"</span>, <span class="string">"Basic "</span> + base64Credentials)</span><br><span class="line">        .body(user);</span><br></pre></td></tr></table></figure>

<h2 id="捕获异常"><a href="#捕获异常" class="headerlink" title="捕获异常"></a>捕获异常</h2><p>捕获<code>HttpServerErrorException</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    responseEntity = restTemplate.exchange(requestEntity, String<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">&#125; <span class="keyword">catch</span> (HttpServerErrorException e) &#123;</span><br><span class="line">    <span class="comment">// log error</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="自定义异常处理器"><a href="#自定义异常处理器" class="headerlink" title="自定义异常处理器"></a>自定义异常处理器</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomErrorHandler</span> <span class="keyword">extends</span> <span class="title">DefaultResponseErrorHandler</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleError</span><span class="params">(ClientHttpResponse response)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="comment">// todo</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后设置下异常处理器：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RestClientConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RestTemplate <span class="title">restTemplate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        RestTemplate restTemplate = <span class="keyword">new</span> RestTemplate();</span><br><span class="line">        restTemplate.setErrorHandler(<span class="keyword">new</span> CustomErrorHandler());</span><br><span class="line">        <span class="keyword">return</span> restTemplate;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="配置类"><a href="#配置类" class="headerlink" title="配置类"></a>配置类</h2><p>创建<code>HttpClientConfig</code>类，设置连接池大小、超时时间、重试机制等。配置如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * - Supports both HTTP and HTTPS</span></span><br><span class="line"><span class="comment"> * - Uses a connection pool to re-use connections and save overhead of creating connections.</span></span><br><span class="line"><span class="comment"> * - Has a custom connection keep-alive strategy (to apply a default keep-alive if one isn't specified)</span></span><br><span class="line"><span class="comment"> * - Starts an idle connection monitor to continuously clean up stale connections.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> XiongNeng</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2018/7/5</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableScheduling</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HttpClientConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger LOGGER = LoggerFactory.getLogger(HttpClientConfig<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> HttpClientProperties p;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> PoolingHttpClientConnectionManager <span class="title">poolingConnectionManager</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        SSLContextBuilder builder = <span class="keyword">new</span> SSLContextBuilder();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            builder.loadTrustMaterial(<span class="keyword">null</span>, <span class="keyword">new</span> TrustStrategy() &#123;</span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isTrusted</span><span class="params">(X509Certificate[] arg0, String arg1)</span> </span>&#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchAlgorithmException | KeyStoreException e) &#123;</span><br><span class="line">            LOGGER.error(<span class="string">"Pooling Connection Manager Initialisation failure because of "</span> + e.getMessage(), e);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        SSLConnectionSocketFactory sslsf = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            sslsf = <span class="keyword">new</span> SSLConnectionSocketFactory(builder.build());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (KeyManagementException | NoSuchAlgorithmException e) &#123;</span><br><span class="line">            LOGGER.error(<span class="string">"Pooling Connection Manager Initialisation failure because of "</span> + e.getMessage(), e);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Registry&lt;ConnectionSocketFactory&gt; socketFactoryRegistry = RegistryBuilder</span><br><span class="line">                .&lt;ConnectionSocketFactory&gt;create()</span><br><span class="line">                .register(<span class="string">"https"</span>, sslsf)</span><br><span class="line">                .register(<span class="string">"http"</span>, <span class="keyword">new</span> PlainConnectionSocketFactory())</span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">        PoolingHttpClientConnectionManager poolingConnectionManager = <span class="keyword">new</span> PoolingHttpClientConnectionManager(socketFactoryRegistry);</span><br><span class="line">        poolingConnectionManager.setMaxTotal(p.getMaxTotalConnections());  <span class="comment">//最大连接数</span></span><br><span class="line">        poolingConnectionManager.setDefaultMaxPerRoute(p.getDefaultMaxPerRoute());  <span class="comment">//同路由并发数</span></span><br><span class="line">        <span class="keyword">return</span> poolingConnectionManager;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ConnectionKeepAliveStrategy <span class="title">connectionKeepAliveStrategy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ConnectionKeepAliveStrategy() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getKeepAliveDuration</span><span class="params">(HttpResponse response, HttpContext httpContext)</span> </span>&#123;</span><br><span class="line">                HeaderElementIterator it = <span class="keyword">new</span> BasicHeaderElementIterator</span><br><span class="line">                        (response.headerIterator(HTTP.CONN_KEEP_ALIVE));</span><br><span class="line">                <span class="keyword">while</span> (it.hasNext()) &#123;</span><br><span class="line">                    HeaderElement he = it.nextElement();</span><br><span class="line">                    String param = he.getName();</span><br><span class="line">                    String value = he.getValue();</span><br><span class="line">                    <span class="keyword">if</span> (value != <span class="keyword">null</span> &amp;&amp; param.equalsIgnoreCase(<span class="string">"timeout"</span>)) &#123;</span><br><span class="line">                        <span class="keyword">return</span> Long.parseLong(value) * <span class="number">1000</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> p.getDefaultKeepAliveTimeMillis();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CloseableHttpClient <span class="title">httpClient</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        RequestConfig requestConfig = RequestConfig.custom()</span><br><span class="line">                .setConnectionRequestTimeout(p.getRequestTimeout())</span><br><span class="line">                .setConnectTimeout(p.getConnectTimeout())</span><br><span class="line">                .setSocketTimeout(p.getSocketTimeout()).build();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> HttpClients.custom()</span><br><span class="line">                .setDefaultRequestConfig(requestConfig)</span><br><span class="line">                .setConnectionManager(poolingConnectionManager())</span><br><span class="line">                .setKeepAliveStrategy(connectionKeepAliveStrategy())</span><br><span class="line">                .setRetryHandler(<span class="keyword">new</span> DefaultHttpRequestRetryHandler(<span class="number">3</span>, <span class="keyword">true</span>))  <span class="comment">// 重试次数</span></span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Runnable <span class="title">idleConnectionMonitor</span><span class="params">(<span class="keyword">final</span> PoolingHttpClientConnectionManager connectionManager)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="meta">@Scheduled</span>(fixedDelay = <span class="number">10000</span>)</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (connectionManager != <span class="keyword">null</span>) &#123;</span><br><span class="line">                        LOGGER.trace(<span class="string">"run IdleConnectionMonitor - Closing expired and idle connections..."</span>);</span><br><span class="line">                        connectionManager.closeExpiredConnections();</span><br><span class="line">                        connectionManager.closeIdleConnections(p.getCloseIdleConnectionWaitTimeSecs(), TimeUnit.SECONDS);</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        LOGGER.trace(<span class="string">"run IdleConnectionMonitor - Http Client Connection manager is not initialised"</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                    LOGGER.error(<span class="string">"run IdleConnectionMonitor - Exception occurred. msg=&#123;&#125;, e=&#123;&#125;"</span>, e.getMessage(), e);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> TaskScheduler <span class="title">taskScheduler</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ThreadPoolTaskScheduler scheduler = <span class="keyword">new</span> ThreadPoolTaskScheduler();</span><br><span class="line">        scheduler.setThreadNamePrefix(<span class="string">"poolScheduler"</span>);</span><br><span class="line">        scheduler.setPoolSize(<span class="number">50</span>);</span><br><span class="line">        <span class="keyword">return</span> scheduler;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后再配置RestTemplateConfig类，使用之前配置好的CloseableHttpClient类注入，同时配置一些默认的消息转换器：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * RestTemplate客户端连接池配置</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> XiongNeng</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2018/1/24</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableAspectJAutoProxy</span>(proxyTargetClass = <span class="keyword">true</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RestTemplateConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> CloseableHttpClient httpClient;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RestTemplate <span class="title">restTemplate</span><span class="params">(MappingJackson2HttpMessageConverter jackson2HttpMessageConverter)</span> </span>&#123;</span><br><span class="line">        RestTemplate restTemplate = <span class="keyword">new</span> RestTemplate(clientHttpRequestFactory());</span><br><span class="line"></span><br><span class="line">        List&lt;HttpMessageConverter&lt;?&gt;&gt; messageConverters = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        StringHttpMessageConverter stringHttpMessageConverter = <span class="keyword">new</span> StringHttpMessageConverter(Charset.forName(<span class="string">"utf-8"</span>));</span><br><span class="line">        messageConverters.add(stringHttpMessageConverter);</span><br><span class="line">        messageConverters.add(jackson2HttpMessageConverter);</span><br><span class="line">        restTemplate.setMessageConverters(messageConverters);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> restTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> HttpComponentsClientHttpRequestFactory <span class="title">clientHttpRequestFactory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        HttpComponentsClientHttpRequestFactory rf = <span class="keyword">new</span> HttpComponentsClientHttpRequestFactory();</span><br><span class="line">        rf.setHttpClient(httpClient);</span><br><span class="line">        <span class="keyword">return</span> rf;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意，如果没有apache的HttpClient类，需要在pom文件中添加：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.httpcomponents<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>httpclient<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.5.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="发送文件"><a href="#发送文件" class="headerlink" title="发送文件"></a>发送文件</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">MultiValueMap&lt;String, Object&gt; multiPartBody = <span class="keyword">new</span> LinkedMultiValueMap&lt;&gt;();</span><br><span class="line">multiPartBody.add(<span class="string">"file"</span>, <span class="keyword">new</span> ClassPathResource(<span class="string">"/tmp/user.txt"</span>));</span><br><span class="line">RequestEntity&lt;MultiValueMap&lt;String, Object&gt;&gt; requestEntity = RequestEntity</span><br><span class="line">        .post(uri)</span><br><span class="line">        .contentType(MediaType.MULTIPART_FORM_DATA)</span><br><span class="line">        .body(multiPartBody);</span><br></pre></td></tr></table></figure>

<h2 id="下载文件"><a href="#下载文件" class="headerlink" title="下载文件"></a>下载文件</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 小文件</span></span><br><span class="line">RequestEntity requestEntity = RequestEntity.get(uri).build();</span><br><span class="line">ResponseEntity&lt;<span class="keyword">byte</span>[]&gt; responseEntity = restTemplate.exchange(requestEntity, <span class="keyword">byte</span>[]<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"><span class="keyword">byte</span>[] downloadContent = responseEntity.getBody();</span><br><span class="line">  </span><br><span class="line"><span class="comment">// 大文件  </span></span><br><span class="line">ResponseExtractor&lt;ResponseEntity&lt;File&gt;&gt; responseExtractor = <span class="keyword">new</span> ResponseExtractor&lt;ResponseEntity&lt;File&gt;&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResponseEntity&lt;File&gt; <span class="title">extractData</span><span class="params">(ClientHttpResponse response)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        File rcvFile = File.createTempFile(<span class="string">"rcvFile"</span>, <span class="string">"zip"</span>);</span><br><span class="line">        FileCopyUtils.copy(response.getBody(), <span class="keyword">new</span> FileOutputStream(rcvFile));</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.status(response.getStatusCode()).headers(response.getHeaders()).body(rcvFile);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">File getFile = <span class="keyword">this</span>.restTemplate.execute(targetUri, HttpMethod.GET, <span class="keyword">null</span>, responseExtractor);</span><br></pre></td></tr></table></figure>

<h2 id="Service注入"><a href="#Service注入" class="headerlink" title="Service注入"></a>Service注入</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DeviceService</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger logger = LoggerFactory.getLogger(DeviceService<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RestTemplate restTemplate;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="实际使用例子"><a href="#实际使用例子" class="headerlink" title="实际使用例子"></a>实际使用例子</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 开始推送消息</span></span><br><span class="line">logger.info(<span class="string">"解绑成功后推送消息给对应的POS机"</span>);</span><br><span class="line">LoginParam loginParam = <span class="keyword">new</span> LoginParam();</span><br><span class="line">loginParam.setUsername(managerInfo.getUsername());</span><br><span class="line">loginParam.setPassword(managerInfo.getPassword());</span><br><span class="line">HttpBaseResponse r = restTemplate.postForObject(</span><br><span class="line">        p.getPosapiUrlPrefix() + <span class="string">"/notifyLogin"</span>, loginParam, HttpBaseResponse<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"><span class="keyword">if</span> (r.isSuccess()) &#123;</span><br><span class="line">    logger.info(<span class="string">"推送消息登录认证成功"</span>);</span><br><span class="line">    String token = (String) r.getData();</span><br><span class="line">    UnbindParam unbindParam = <span class="keyword">new</span> UnbindParam();</span><br><span class="line">    unbindParam.setImei(pos.getImei());</span><br><span class="line">    unbindParam.setLocation(location);</span><br><span class="line">    <span class="comment">// 设置HTTP Header信息</span></span><br><span class="line">    URI uri;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        uri = <span class="keyword">new</span> URI(p.getPosapiUrlPrefix() + <span class="string">"/notify/unbind"</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (URISyntaxException e) &#123;</span><br><span class="line">        logger.error(<span class="string">"URI构建失败"</span>, e);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    RequestEntity&lt;UnbindParam&gt; requestEntity = RequestEntity</span><br><span class="line">            .post(uri)</span><br><span class="line">            .contentType(MediaType.APPLICATION_JSON)</span><br><span class="line">            .accept(MediaType.APPLICATION_JSON)</span><br><span class="line">            .header(<span class="string">"Authorization"</span>, token)</span><br><span class="line">            .body(unbindParam);</span><br><span class="line">    ResponseEntity&lt;HttpBaseResponse&gt; responseEntity = restTemplate.exchange(requestEntity, HttpBaseResponse<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">    HttpBaseResponse r2 = responseEntity.getBody();</span><br><span class="line">    <span class="keyword">if</span> (r2.isSuccess()) &#123;</span><br><span class="line">        logger.info(<span class="string">"推送消息解绑网点成功"</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        logger.error(<span class="string">"推送消息解绑网点失败，errmsg = "</span> + r2.getMsg());</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    logger.error(<span class="string">"推送消息登录认证失败"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="GitHub源码"><a href="#GitHub源码" class="headerlink" title="GitHub源码"></a>GitHub源码</h2><p><a href="https://github.com/yidao620c/SpringBootBucket/tree/master/springboot-resttemplate" target="_blank" rel="noopener">springboot-resttemplate</a>    —已测试</p>
<h2 id="来源"><a href="#来源" class="headerlink" title="来源"></a>来源</h2><p><a href="https://www.xncoding.com/" target="_blank" rel="noopener">https://www.xncoding.com/</a></p>
]]></content>
      <categories>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>springboot</tag>
        <tag>resttemplate</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBoot系列 - 使用消息队列RabbitMQ</title>
    <url>/2020/06/08/SpringBoot%E7%B3%BB%E5%88%97-%E4%BD%BF%E7%94%A8%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97RabbitMQ/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="SpringBoot系列-使用消息队列RabbitMQ"><a href="#SpringBoot系列-使用消息队列RabbitMQ" class="headerlink" title="SpringBoot系列 - 使用消息队列RabbitMQ"></a>SpringBoot系列 - 使用消息队列RabbitMQ</h1><p>RabbitMQ 即一个消息队列，主要是用来实现应用程序的异步和解耦，同时也能起到消息缓冲，消息分发的作用。</p>
<p>RabbitMQ是实现AMQP（高级消息队列协议）的消息中间件的一种，AMQP，即Advanced Message Queuing Protocol， 高级消息队列协议，是应用层协议的一个开放标准，为面向消息的中间件设计。</p>
<p>在项目中，将一些无需即时返回且耗时的操作提取出来，进行了异步处理，而这种异步处理的方式大大的节省了服务器的请求响应时间， 提高了系统的吞吐量。</p>
<p>本篇将详细介绍RabbitMQ以及如何在SpringBoot中使用。</p>
<h2 id="简单概念"><a href="#简单概念" class="headerlink" title="简单概念"></a>简单概念</h2><p>关于消息中间件RabbitMQ的详细介绍可以参考我的博客系列教程：<a href="https://www.xncoding.com/tags/rabbitmq/" target="_blank" rel="noopener">RabbitMQ简易教程</a></p>
<p>这里我只对一些最核心的概念拿出来讲一下，不理解这些就根本无法理解下面的代码。</p>
<p>几个名词术语：</p>
<ul>
<li>Broker - 简单来说就是消息队列服务器的实体。</li>
<li>Exchange - 消息路由器，转发消息到绑定的队列上，指定消息按什么规则，路由到哪个队列。</li>
<li>Queue - 消息队列，用来存储消息，每个消息都会被投入到一个或多个队列。</li>
<li>Binding - 绑定，它的作用就是把 Exchange 和 Queue 按照路由规则绑定起来。</li>
<li>RoutingKey - 路由关键字，Exchange 根据这个关键字进行消息投递。</li>
<li>Producter - 消息生产者，产生消息的程序。</li>
<li>Consumer - 消息消费者，接收消息的程序。</li>
<li>Channel - 消息通道，在客户端的每个连接里可建立多个Channel，每个channel代表一个会话。</li>
</ul>
<p>一般消息队列都是生产者将消息发送到队列，消费者监听队列进行消费。rabbitmq中一个虚拟主机（默认 /）持有一个或者多个交换机（Exchange）。 用户只能在虚拟主机的粒度进行权限控制，交换机根据一定的策略（RoutingKey）绑定(Binding)到队列(Queue)上， 这样生产者和队列就没有直接联系，而是将消息发送的交换机，交换机再把消息转发到对应绑定的队列上。</p>
<p>上面说了交换机（Exchange）作为rabbitmq的一个独特的重要的概念，单独拿出来讲一下。我们用到的最常见的是4中类型：</p>
<ol>
<li>Direct: 先匹配, 再投送。即在绑定时设定一个routing_key, 消息的routing_key匹配时, 才会被交换器投送到绑定的队列中去. 交换机跟队列必须是精确的对应关系，这种最为简单。</li>
<li>Topic: 转发消息主要是根据通配符。在这种交换机下，队列和交换机的绑定会定义一种路由模式，那么，通配符就要在这种路由模式和路由键之间匹配后交换机才能转发消息 这种可以认为是Direct 的灵活版</li>
<li>Headers: 也是根据规则匹配, 相较于 direct 和 topic 固定地使用 routingkey , headers则是一个自定义匹配规则的类型， 在队列与交换器绑定时会设定一组键值对规则，消息中也包括一组键值对( headers属性)，当这些键值对有一对或全部匹配时，消息被投送到对应队列</li>
<li>Fanout : 消息广播模式，不管路由键或者是路由模式，会把消息发给绑定给它的全部队列，如果配置了routingkey会被忽略</li>
</ol>
<p>理解交换机如何投送消息的原理后，后面的就比较简单了。</p>
<h2 id="Ack机制"><a href="#Ack机制" class="headerlink" title="Ack机制"></a>Ack机制</h2><p>在RabbitMQ的消息队列编程中，有个非常重要的概率叫消息确认机制，也就是Ack机制，这里我需要单独讲一下。</p>
<p>每个Consumer可能需要一段时间才能处理完收到的数据。如果在这个过程中，Consumer出错了或者异常退出了，而数据还没有处理完成，那么非常不幸，这段数据就丢失了。</p>
<p>因为我们采用no-ack的方式进行确认，也就是说，每次Consumer接到数据后，而不管是否处理完成，RabbitMQ Server会立即把这个Message标记为完成，然后从queue中删除了。 如果一个Consumer异常退出了，它处理的数据能够被另外的Consumer处理，这样数据在这种情况下就不会丢失了（注意是这种情况下）。</p>
<p>为了保证数据不被丢失，RabbitMQ支持消息确认机制，即acknowledgments。为了保证数据能被正确处理而不仅仅是被Consumer收到，那么我们不能采用no-ack。而应该是在处理完数据后发送ack。 在处理数据后发送的ack，就是告诉RabbitMQ数据已经被接收，处理完成，RabbitMQ可以去安全的删除它了。</p>
<p>如果Consumer退出了但是没有发送ack，那么RabbitMQ就会把这个Message发送到下一个Consumer。这样就保证了在Consumer异常退出的情况下数据也不会丢失。</p>
<p>这里并没有用到超时机制。RabbitMQ仅仅通过Consumer的连接中断来确认该Message并没有被正确处理。也就是说，RabbitMQ给了Consumer足够长的时间来做数据处理。 这样即使你通过Ctr-C中断了Recieve.cs，那么Message也不会丢失了，它会被分发到下一个Consumer。</p>
<p>如果忘记了ack，那么后果很严重。当Consumer退出时，Message会重新分发。然后RabbitMQ会占用越来越多的内存，由于RabbitMQ会长时间运行，因此这个“内存泄漏”是致命的。</p>
<p>下面的例子中我会使用手动Ack模式。</p>
<h2 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h2><p>RabbitMQ需要安装erlang和RabbitMQ Server， 安装教程请参考：<a href="https://www.xncoding.com/2017/05/06/mq/rabbitmq-tutorial01.html" target="_blank" rel="noopener">RabbitMQ简易教程 - 安装</a></p>
<p>请先按照教程安装好RabbitMQ后，添加一个用户spring/123456，后面配置要用到。</p>
<h2 id="SpringBoot中集成"><a href="#SpringBoot中集成" class="headerlink" title="SpringBoot中集成"></a>SpringBoot中集成</h2><p>接下来正式开始讲解如何在SpringBoot中集成了。</p>
<h3 id="maven依赖"><a href="#maven依赖" class="headerlink" title="maven依赖"></a>maven依赖</h3><p>第一版当然是先添加maven依赖了，有官方现成的starter依赖，如下：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-amqp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-databind<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.vaadin.external.google<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>android-json<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h3><p>在application.yml中添加rabbitmq相关配置：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">rabbitmq:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">5672</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">spring</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line">    <span class="attr">publisher-confirms:</span> <span class="literal">true</span> <span class="comment">#支持发布确认</span></span><br><span class="line">    <span class="attr">publisher-returns:</span> <span class="literal">true</span>  <span class="comment">#支持发布返回</span></span><br><span class="line">    <span class="attr">listener:</span></span><br><span class="line">      <span class="attr">simple:</span></span><br><span class="line">        <span class="attr">acknowledge-mode:</span> <span class="string">manual</span> <span class="comment">#采用手动应答</span></span><br><span class="line">        <span class="attr">concurrency:</span> <span class="number">1</span> <span class="comment">#指定最小的消费者数量</span></span><br><span class="line">        <span class="attr">max-concurrency:</span> <span class="number">1</span> <span class="comment">#指定最大的消费者数量</span></span><br><span class="line">        <span class="attr">retry:</span></span><br><span class="line">          <span class="attr">enabled:</span> <span class="literal">true</span> <span class="comment">#是否支持重试</span></span><br></pre></td></tr></table></figure>

<h3 id="配置类"><a href="#配置类" class="headerlink" title="配置类"></a>配置类</h3><p>最核心的类就是RabbitMQ的配置类，在里面定制模版类、声明交换机、队列、绑定交换机到队列。</p>
<p>这里我声明了一个Direct类型的交换机，并通过路由键绑定到一个队列中来测试Direct模式， 另外还声明了Fanout类型的交换机，并绑定到2个队列来测试广播模式。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RabbitConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RabbitTemplate rabbitTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 定制化amqp模版      可根据需要定制多个</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * 此处为模版类定义 Jackson消息转换器</span></span><br><span class="line"><span class="comment">     * ConfirmCallback接口用于实现消息发送到RabbitMQ交换器后接收ack回调   即消息发送到exchange  ack</span></span><br><span class="line"><span class="comment">     * ReturnCallback接口用于实现消息发送到RabbitMQ 交换器，但无相应队列与交换器绑定时的回调  即消息发送不到任何一个队列中  ack</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the amqp template</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="comment">// @Primary</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> AmqpTemplate <span class="title">amqpTemplate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Logger log = LoggerFactory.getLogger(RabbitTemplate<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        <span class="comment">// 使用jackson 消息转换器</span></span><br><span class="line">        rabbitTemplate.setMessageConverter(<span class="keyword">new</span> Jackson2JsonMessageConverter());</span><br><span class="line">        rabbitTemplate.setEncoding(<span class="string">"UTF-8"</span>);</span><br><span class="line">        <span class="comment">// 消息发送失败返回到队列中，yml需要配置 publisher-returns: true</span></span><br><span class="line">        rabbitTemplate.setMandatory(<span class="keyword">true</span>);</span><br><span class="line">        rabbitTemplate.setReturnCallback((message, replyCode, replyText, exchange, routingKey) -&gt; &#123;</span><br><span class="line">            String correlationId = message.getMessageProperties().getCorrelationIdString();</span><br><span class="line">            log.debug(<span class="string">"消息：&#123;&#125; 发送失败, 应答码：&#123;&#125; 原因：&#123;&#125; 交换机: &#123;&#125;  路由键: &#123;&#125;"</span>, correlationId, replyCode, replyText, exchange, routingKey);</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// 消息确认，yml需要配置 publisher-confirms: true</span></span><br><span class="line">        rabbitTemplate.setConfirmCallback((correlationData, ack, cause) -&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (ack) &#123;</span><br><span class="line">                log.debug(<span class="string">"消息发送到exchange成功,id: &#123;&#125;"</span>, correlationData.getId());</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                log.debug(<span class="string">"消息发送到exchange失败,原因: &#123;&#125;"</span>, cause);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> rabbitTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* ----------------------------------------------------------------------------Direct exchange test--------------------------------------------------------------------------- */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 声明Direct交换机 支持持久化.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the exchange</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span>(<span class="string">"directExchange"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Exchange <span class="title">directExchange</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ExchangeBuilder.directExchange(<span class="string">"DIRECT_EXCHANGE"</span>).durable(<span class="keyword">true</span>).build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 声明一个队列 支持持久化.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the queue</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span>(<span class="string">"directQueue"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Queue <span class="title">directQueue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> QueueBuilder.durable(<span class="string">"DIRECT_QUEUE"</span>).build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 通过绑定键 将指定队列绑定到一个指定的交换机 .</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> queue    the queue</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> exchange the exchange</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the binding</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Binding <span class="title">directBinding</span><span class="params">(@Qualifier(<span class="string">"directQueue"</span>)</span> Queue queue,</span></span><br><span class="line"><span class="function">                                 @<span class="title">Qualifier</span><span class="params">(<span class="string">"directExchange"</span>)</span> Exchange exchange) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(queue).to(exchange).with(<span class="string">"DIRECT_ROUTING_KEY"</span>).noargs();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* ----------------------------------------------------------------------------Fanout exchange test--------------------------------------------------------------------------- */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 声明 fanout 交换机.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the exchange</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span>(<span class="string">"fanoutExchange"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> FanoutExchange <span class="title">fanoutExchange</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (FanoutExchange) ExchangeBuilder.fanoutExchange(<span class="string">"FANOUT_EXCHANGE"</span>).durable(<span class="keyword">true</span>).build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Fanout queue A.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the queue</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span>(<span class="string">"fanoutQueueA"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Queue <span class="title">fanoutQueueA</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> QueueBuilder.durable(<span class="string">"FANOUT_QUEUE_A"</span>).build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Fanout queue B .</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the queue</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span>(<span class="string">"fanoutQueueB"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Queue <span class="title">fanoutQueueB</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> QueueBuilder.durable(<span class="string">"FANOUT_QUEUE_B"</span>).build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 绑定队列A 到Fanout 交换机.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> queue          the queue</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fanoutExchange the fanout exchange</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the binding</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Binding <span class="title">bindingA</span><span class="params">(@Qualifier(<span class="string">"fanoutQueueA"</span>)</span> Queue queue,</span></span><br><span class="line"><span class="function">                            @<span class="title">Qualifier</span><span class="params">(<span class="string">"fanoutExchange"</span>)</span> FanoutExchange fanoutExchange) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(queue).to(fanoutExchange);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 绑定队列B 到Fanout 交换机.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> queue          the queue</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fanoutExchange the fanout exchange</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the binding</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Binding <span class="title">bindingB</span><span class="params">(@Qualifier(<span class="string">"fanoutQueueB"</span>)</span> Queue queue,</span></span><br><span class="line"><span class="function">                            @<span class="title">Qualifier</span><span class="params">(<span class="string">"fanoutExchange"</span>)</span> FanoutExchange fanoutExchange) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(queue).to(fanoutExchange);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="监听器"><a href="#监听器" class="headerlink" title="监听器"></a>监听器</h3><p>接下来编写消息队列的监听器类，监听队列消息并做相应的处理，并通过Ack机制确认处理完成：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 消息监听器</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> XiongNeng</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Receiver</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger log = LoggerFactory.getLogger(Receiver<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * FANOUT广播队列监听一.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> message the message</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> channel the channel</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException the io exception  这里异常需要处理</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RabbitListener</span>(queues = &#123;<span class="string">"FANOUT_QUEUE_A"</span>&#125;)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">on</span><span class="params">(Message message, Channel channel)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        channel.basicAck(message.getMessageProperties().getDeliveryTag(), <span class="keyword">true</span>);</span><br><span class="line">        log.debug(<span class="string">"FANOUT_QUEUE_A "</span> + <span class="keyword">new</span> String(message.getBody()));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * FANOUT广播队列监听二.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> message the message</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> channel the channel</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException the io exception   这里异常需要处理</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RabbitListener</span>(queues = &#123;<span class="string">"FANOUT_QUEUE_B"</span>&#125;)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">t</span><span class="params">(Message message, Channel channel)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        channel.basicAck(message.getMessageProperties().getDeliveryTag(), <span class="keyword">true</span>);</span><br><span class="line">        log.debug(<span class="string">"FANOUT_QUEUE_B "</span> + <span class="keyword">new</span> String(message.getBody()));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * DIRECT模式.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> message the message</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> channel the channel</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException the io exception  这里异常需要处理</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RabbitListener</span>(queues = &#123;<span class="string">"DIRECT_QUEUE"</span>&#125;)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">message</span><span class="params">(Message message, Channel channel)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        channel.basicAck(message.getMessageProperties().getDeliveryTag(), <span class="keyword">true</span>);</span><br><span class="line">        log.debug(<span class="string">"DIRECT "</span> + <span class="keyword">new</span> String(message.getBody()));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="消息发送者"><a href="#消息发送者" class="headerlink" title="消息发送者"></a>消息发送者</h3><p>再写一个消息发送服务，用来向交换机发送消息：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 消息发送服务</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SenderService</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Logger logger = LoggerFactory.getLogger(<span class="keyword">this</span>.getClass());</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RabbitTemplate rabbitTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 测试广播模式.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> p the p</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the response entity</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">broadcast</span><span class="params">(String p)</span> </span>&#123;</span><br><span class="line">        CorrelationData correlationData = <span class="keyword">new</span> CorrelationData(UUID.randomUUID().toString());</span><br><span class="line">        rabbitTemplate.convertAndSend(<span class="string">"FANOUT_EXCHANGE"</span>, <span class="string">""</span>, p, correlationData);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 测试Direct模式.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> p the p</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the response entity</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">direct</span><span class="params">(String p)</span> </span>&#123;</span><br><span class="line">        CorrelationData correlationData = <span class="keyword">new</span> CorrelationData(UUID.randomUUID().toString());</span><br><span class="line">        rabbitTemplate.convertAndSend(<span class="string">"DIRECT_EXCHANGE"</span>, <span class="string">"DIRECT_ROUTING_KEY"</span>, p, correlationData);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="运行测试"><a href="#运行测试" class="headerlink" title="运行测试"></a>运行测试</h2><p>代码写完后当然要写个测试用例测一下嘛。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * SenderServiceTest</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> XiongNeng</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RunWith</span>(SpringRunner<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">@<span class="title">SpringBootTest</span>(<span class="title">classes</span> </span>= Application<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">SenderServiceTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SenderService senderService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testCache</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 测试广播模式</span></span><br><span class="line">        senderService.broadcast(<span class="string">"同学们集合啦！"</span>);</span><br><span class="line">        <span class="comment">// 测试Direct模式</span></span><br><span class="line">        senderService.direct(<span class="string">"定点消息"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-attr">[cTaskExecutor-1]</span> <span class="selector-tag">com</span><span class="selector-class">.xncoding</span><span class="selector-class">.pos</span><span class="selector-class">.mq</span><span class="selector-class">.Receiver</span>             : <span class="selector-tag">FANOUT_QUEUE_A</span> "同学们集合啦！"</span><br><span class="line"><span class="selector-attr">[cTaskExecutor-1]</span> <span class="selector-tag">com</span><span class="selector-class">.xncoding</span><span class="selector-class">.pos</span><span class="selector-class">.mq</span><span class="selector-class">.Receiver</span>             : <span class="selector-tag">DIRECT</span> "定点消息"</span><br><span class="line"><span class="selector-attr">[cTaskExecutor-1]</span> <span class="selector-tag">com</span><span class="selector-class">.xncoding</span><span class="selector-class">.pos</span><span class="selector-class">.mq</span><span class="selector-class">.Receiver</span>             : <span class="selector-tag">FANOUT_QUEUE_B</span> "同学们集合啦！"</span><br></pre></td></tr></table></figure>

<p>可以看到，广播消息被两个队列收到了，Direct消息只有一个收到。完美！</p>
<h2 id="GitHub源码"><a href="#GitHub源码" class="headerlink" title="GitHub源码"></a>GitHub源码</h2><p><a href="https://github.com/yidao620c/SpringBootBucket/tree/master/springboot-rabbitmq" target="_blank" rel="noopener">springboot-rabbitmq</a>   —已测试</p>
<h2 id="来源"><a href="#来源" class="headerlink" title="来源"></a>来源</h2><p><a href="https://www.xncoding.com/" target="_blank" rel="noopener">https://www.xncoding.com/</a></p>
]]></content>
      <categories>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>springboot</tag>
        <tag>rabbitmq</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBoot系列 - 声明式事务</title>
    <url>/2020/06/08/SpringBoot%E7%B3%BB%E5%88%97-%E5%A3%B0%E6%98%8E%E5%BC%8F%E4%BA%8B%E5%8A%A1/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="SpringBoot系列-声明式事务"><a href="#SpringBoot系列-声明式事务" class="headerlink" title="SpringBoot系列 - 声明式事务"></a>SpringBoot系列 - 声明式事务</h1><p>所有数据访问技术都有事务机制，这些技术提供了API来开启事务、提交事务完成数据操作，或者在发生错误的时候回滚数据。</p>
<p>Spring采用统一的机制来处理不同的数据访问技术的事务， Spring的事务提供一个<code>PlatformTransactionManager</code>的接口，不同的数据访问技术使用不同的接口实现。</p>
<table>
<thead>
<tr>
<th>Data Tech</th>
<th>实现</th>
</tr>
</thead>
<tbody><tr>
<td>JDBC</td>
<td>DataSourceTransactionManager</td>
</tr>
<tr>
<td>JPA</td>
<td>JPATransactionManager</td>
</tr>
<tr>
<td>Hibernate</td>
<td>HibernateTransactionManager</td>
</tr>
<tr>
<td>JDO</td>
<td>JDOTransactionManager</td>
</tr>
<tr>
<td>分布式事务</td>
<td>JtaTransactionManager</td>
</tr>
</tbody></table>
<p>而得益于SpringBoot的自动配置机制，为我们自动开启了声明式事务支持， 我们无需添加注解<code>@EnableTransactionManagement</code></p>
<h2 id="事务基础"><a href="#事务基础" class="headerlink" title="事务基础"></a>事务基础</h2><p>Spring提供一个@EnableTransactionManagement注解在配置类上开启声明式事务支持， 自动扫描加了@Transactional注解的类和方法，加入事务支持。</p>
<p>这里重点讲下@Transactional注解的几个属性</p>
<p><strong>propagation</strong></p>
<p>事务的传播机制，主要有以下几种，默认是REQUIRED：</p>
<ol>
<li>REQUIRED - 方法A调用时候没有事务新建一个事务，在方法A中调用方法B，将使用相同的事务，如果方法B发生异常需要回滚，整个事务回滚。</li>
<li>REQUIRES_NEW - 方法A调用方法B时，无论是否存在事务都开启一个新事务，这样B方法异常不会导致A的数据回滚。</li>
<li>NESTED - 和REQUIRES_NEW类似，但是只支持JDBC，不支持JPA或Hibernate</li>
<li>SUPPORTS - 方法调用时有事务就用事务，没事务就不用事务</li>
<li>NOT_SUPPORTED - 强制方法不在事务中执行，若有事务，在方法调用到结束阶段先挂起事务。</li>
<li>NEVER - 强制不能有事务，若有事务就抛出异常</li>
<li>MANDATORY - 强制必须有事务，如果没有事务就抛出异常</li>
</ol>
<p><strong>isolation</strong></p>
<p>事务的隔离级别，决定了事务的完整性，主要一下几种，默认是DEFAULT：</p>
<ol>
<li>READ_UNCOMMITTED - A事务修改记录但没提交，B事务可读取到修改后的值。可导致脏读、不可重复读、幻读。</li>
<li>READ_COMMITTED - A事务修改并提交后，B事务才能读取到修改后的值，阻止了脏读，但可能导致不可重复读和幻读。</li>
<li>REPEATABLE_READ - A事务读取了一条记录，B事务将不能修改这条记录，阻止脏读和不可重复读，但是可能出现幻读。</li>
<li>SERIALIZABLE - 事务是顺序执行的，可避免所有缺陷，但是开销很大。</li>
<li>DEFAULT - 使用当前数据库默认隔离级别，入Oracle、SQL Server是READ_COMMITTED，MySQL是REPEATABLE_READ</li>
</ol>
<p><strong>timeout</strong></p>
<p>事务过期时间，默认是当前数据库默认事务过期时间。</p>
<p><strong>readOnly</strong></p>
<p>指定是否为只读事务，默认是false</p>
<p>如果你一次执行单条查询语句，则没有必要启用事务支持，数据库默认支持SQL执行期间的读一致性；</p>
<p>如果你一次执行多条查询语句，例如统计查询，报表查询，在这种场景下，多条查询SQL必须保证整体的读一致性， 否则，在前条SQL查询之后，后条SQL查询之前，数据被其他用户改变，则该次整体的统计查询将会出现读数据不一致的状态， 此时，应该启用只读事务支持。</p>
<p>只读事务与读写事务区别：</p>
<p>对于只读查询，可以指定事务类型为readonly，即只读事务。由于只读事务不存在数据的修改， 因此数据库将会为只读事务提供一些优化手段，例如Oracle对于只读事务，不启动回滚段，不记录回滚log。</p>
<p><strong>rollbackFor</strong></p>
<p>指定哪些异常可以导致事务回滚，默认是Throwable的子类</p>
<p><strong>noRollbackFor</strong></p>
<p>执行哪些异常不可用引起事务回滚，默认是Throwable的子类</p>
<h2 id="实战篇"><a href="#实战篇" class="headerlink" title="实战篇"></a>实战篇</h2><p>实际项目中，使用SpringBoot的默认配置就已经足够满足我们的需求了。 本篇将通过几个例子来演示如何使用@Transactional注解，在出现异常时候回滚或不回滚数据。</p>
<p>使用我最喜欢的DAO技术就是MyBatis进行数据访问，使用druid数据库连接池， 另外配合mybatis-plus，实现数据访问层。</p>
<p>引入依赖：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mysql-connector.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;druid.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- MyBatis plus增强和springboot的集成--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mybatis-plus.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatisplus-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mybatisplus-spring-boot-starter.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>配置数据库连接：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment">###################  spring配置  ###################</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">dev</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://123.207.66.156:3306/test?useSSL=false&amp;autoReconnect=true&amp;tinyInt1isBit=false&amp;useUnicode=true&amp;characterEncoding=utf8</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">mysql</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">xxxxx</span></span><br></pre></td></tr></table></figure>

<p>然后增加mybatis个性化配置：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment">###################  mybatis-plus配置  ###################</span></span><br><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath*:com/xncoding/trans/dao/repository/mapping/*.xml</span></span><br><span class="line">  <span class="attr">typeAliasesPackage:</span> <span class="string">&gt;</span></span><br><span class="line">    <span class="string">com.xncoding.trans.dao.entity</span></span><br><span class="line">  <span class="attr">global-config:</span></span><br><span class="line">    <span class="attr">id-type:</span> <span class="number">0</span>  <span class="comment"># 0:数据库ID自增   1:用户输入id  2:全局唯一id(IdWorker)  3:全局唯一ID(uuid)</span></span><br><span class="line">    <span class="attr">db-column-underline:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">refresh-mapper:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">configuration:</span></span><br><span class="line">    <span class="attr">map-underscore-to-camel-case:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">cache-enabled:</span> <span class="literal">true</span> <span class="comment">#配置的缓存的全局开关</span></span><br><span class="line">    <span class="attr">lazyLoadingEnabled:</span> <span class="literal">true</span> <span class="comment">#延时加载的开关</span></span><br><span class="line">    <span class="attr">multipleResultSetsEnabled:</span> <span class="literal">true</span> <span class="comment">#开启的话，延时加载一个属性时会加载该对象全部属性，否则按需加载属性</span></span><br></pre></td></tr></table></figure>

<p>增加实体类User：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@TableName</span>(value = <span class="string">"t_user"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">extends</span> <span class="title">Model</span>&lt;<span class="title">User</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 主键ID</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@TableId</span>(value=<span class="string">"id"</span>, type= IdType.AUTO)</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUsername</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUsername</span><span class="params">(String username)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.username = username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getPassword</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> password;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPassword</span><span class="params">(String password)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.password = password;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> Serializable <span class="title">pkVal</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.id;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>增加UserMapper类：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapper</span> <span class="keyword">extends</span> <span class="title">BaseMapper</span>&lt;<span class="title">User</span>&gt; </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>增加Mybatis配置类：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableTransactionManagement</span>(order = <span class="number">2</span>)</span><br><span class="line"><span class="meta">@MapperScan</span>(basePackages = &#123;<span class="string">"com.xncoding.trans.dao.repository"</span>&#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MybatisPlusConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> DruidProperties druidProperties;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 单数据源连接池配置</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DruidDataSource <span class="title">singleDatasource</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        DruidDataSource dataSource = <span class="keyword">new</span> DruidDataSource();</span><br><span class="line">        druidProperties.config(dataSource);</span><br><span class="line">        <span class="keyword">return</span> dataSource;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>定义Service，并注入UserMapper：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>增加Controller，注入Service，定义几个url来做测试用：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>到此为止项目初始化完成，可以在Service中添加方法进行声明式事务测试了。</p>
<h2 id="异常回滚"><a href="#异常回滚" class="headerlink" title="异常回滚"></a>异常回滚</h2><p>@Transactional注解可以放到类也可以放到方法上，如果放到类上面会对所有public方法添加注解， 不过你仍然可以在方法上面加这个注解，会覆盖类上面声明的事务注解。</p>
<p>先实验一个抛出异常会回滚的方法：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 增删改要写 ReadOnly=false 为可写</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> user 用户</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Transactional</span>(readOnly = <span class="keyword">false</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateUserError</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">    userMapper.updateById(user);</span><br><span class="line">    errMethod(); <span class="comment">// 执行一个会抛出异常的方法</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">errMethod</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"error"</span>);</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"runtime"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后在Controller里面添加一个url调用此方法：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/errorUpdate"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">first</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User user = <span class="keyword">new</span> User();</span><br><span class="line">        user.setId(<span class="number">1</span>);</span><br><span class="line">        user.setUsername(<span class="string">"admin"</span>);</span><br><span class="line">        user.setPassword(<span class="string">"admin"</span>);</span><br><span class="line">        userService.updateUserError(user);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"first controller"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>数据库里面先插入一条数据：<code>1|admin|123</code></p>
<p>启动应用后访问地址：<code>http://localhost:8092/errorUpdate</code></p>
<p>控制台打印异常：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">Caused</span> <span class="selector-tag">by</span>: <span class="selector-tag">java</span><span class="selector-class">.lang</span><span class="selector-class">.RuntimeException</span>: <span class="selector-tag">runtime</span></span><br><span class="line">    <span class="selector-tag">at</span> <span class="selector-tag">com</span><span class="selector-class">.xncoding</span><span class="selector-class">.trans</span><span class="selector-class">.service</span><span class="selector-class">.UserService</span><span class="selector-class">.errMethod</span>(<span class="selector-tag">UserService</span><span class="selector-class">.java</span><span class="selector-pseudo">:32)</span> ~<span class="selector-attr">[classes/:na]</span></span><br><span class="line">    <span class="selector-tag">at</span> <span class="selector-tag">com</span><span class="selector-class">.xncoding</span><span class="selector-class">.trans</span><span class="selector-class">.service</span><span class="selector-class">.UserService</span><span class="selector-class">.updateUserError</span>(<span class="selector-tag">UserService</span><span class="selector-class">.java</span><span class="selector-pseudo">:27)</span> ~<span class="selector-attr">[classes/:na]</span></span><br></pre></td></tr></table></figure>

<p>查看数据库中记录：<code>1|admin|123</code>，没有变动，说明回滚成功。</p>
<h2 id="异常不会滚"><a href="#异常不会滚" class="headerlink" title="异常不会滚"></a>异常不会滚</h2><p>你还可以指定特定异常不回滚，比如自定义一个MyException，抛出这个异常不回滚。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyException</span> <span class="keyword">extends</span> <span class="title">RuntimeException</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyException</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyException</span><span class="params">(String runtime)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(runtime);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后通过指定这个异常不回滚：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Transactional</span>(readOnly = <span class="keyword">false</span>, noRollbackFor = &#123;MyException<span class="class">.<span class="keyword">class</span>&#125;)</span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">void</span> <span class="title">updateUserError2</span>(<span class="title">User</span> <span class="title">user</span>) </span>&#123;</span><br><span class="line">    userMapper.updateById(user);</span><br><span class="line">    errMethod2(); <span class="comment">// 执行一个会抛出自定义异常的方法</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">errMethod2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"error"</span>);</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> MyException(<span class="string">"runtime"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后再定义一个url来验证：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/errorUpdate2"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">second</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    User user = <span class="keyword">new</span> User();</span><br><span class="line">    user.setId(<span class="number">1</span>);</span><br><span class="line">    user.setUsername(<span class="string">"admin"</span>);</span><br><span class="line">    user.setPassword(<span class="string">"admin"</span>);</span><br><span class="line">    userService.updateUserError(user);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"second controller"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>重启服务器，访问地址：<code>http://localhost:8092/errorUpdate2</code></p>
<p>控制台仍然报异常：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">Caused</span> <span class="selector-tag">by</span>: <span class="selector-tag">com</span><span class="selector-class">.xncoding</span><span class="selector-class">.trans</span><span class="selector-class">.exception</span><span class="selector-class">.MyException</span>: <span class="selector-tag">runtime</span></span><br><span class="line">    <span class="selector-tag">at</span> <span class="selector-tag">com</span><span class="selector-class">.xncoding</span><span class="selector-class">.trans</span><span class="selector-class">.service</span><span class="selector-class">.UserService</span><span class="selector-class">.errMethod2</span>(<span class="selector-tag">UserService</span><span class="selector-class">.java</span><span class="selector-pseudo">:43)</span> ~<span class="selector-attr">[classes/:na]</span></span><br><span class="line">    <span class="selector-tag">at</span> <span class="selector-tag">com</span><span class="selector-class">.xncoding</span><span class="selector-class">.trans</span><span class="selector-class">.service</span><span class="selector-class">.UserService</span><span class="selector-class">.updateUserError2</span>(<span class="selector-tag">UserService</span><span class="selector-class">.java</span><span class="selector-pseudo">:34)</span> ~<span class="selector-attr">[classes/:na]</span></span><br></pre></td></tr></table></figure>

<p>看看数据库中记录：<code>1|admin|admin</code>，更改成功，说明抛出这个MyException异常后并不会回滚。</p>
<h2 id="GitHub源码"><a href="#GitHub源码" class="headerlink" title="GitHub源码"></a>GitHub源码</h2><p><a href="https://github.com/yidao620c/SpringBootBucket/tree/master/springboot-transaction" target="_blank" rel="noopener">springboot-transaction</a>   —已测试</p>
<h2 id="来源"><a href="#来源" class="headerlink" title="来源"></a>来源</h2><p><a href="https://www.xncoding.com/" target="_blank" rel="noopener">https://www.xncoding.com/</a></p>
]]></content>
      <categories>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>springboot</tag>
        <tag>transaction</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBoot系列 - 多数据源配置</title>
    <url>/2020/06/08/SpringBoot%E7%B3%BB%E5%88%97-%E5%A4%9A%E6%95%B0%E6%8D%AE%E6%BA%90%E9%85%8D%E7%BD%AE/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="SpringBoot系列-多数据源配置"><a href="#SpringBoot系列-多数据源配置" class="headerlink" title="SpringBoot系列 - 多数据源配置"></a>SpringBoot系列 - 多数据源配置</h1><p>项目中经常会出现需要同时连接两个数据源的情况，这里还是演示基于MyBatis来配置两个数据源，并演示如何切换不同的数据源。</p>
<p>网上的一些例子都写的有点冗余，这里我通过自定义注解+AOP的方式，来简化这种数据源的切换操作。</p>
<h2 id="maven依赖"><a href="#maven依赖" class="headerlink" title="maven依赖"></a>maven依赖</h2><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">project.reporting.outputEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.reporting.outputEncoding</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">druid.version</span>&gt;</span>1.1.2<span class="tag">&lt;/<span class="name">druid.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mysql-connector.version</span>&gt;</span>8.0.7-dmr<span class="tag">&lt;/<span class="name">mysql-connector.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mybatis-plus.version</span>&gt;</span>2.1.8<span class="tag">&lt;/<span class="name">mybatis-plus.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mybatisplus-spring-boot-starter.version</span>&gt;</span>1.0.5<span class="tag">&lt;/<span class="name">mybatisplus-spring-boot-starter.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-aop<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mysql-connector.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;druid.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- MyBatis plus增强和springboot的集成--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mybatis-plus.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatisplus-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mybatisplus-spring-boot-starter.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.hamcrest<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hamcrest-all<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="初始化数据库"><a href="#初始化数据库" class="headerlink" title="初始化数据库"></a>初始化数据库</h2><p>这里我们需要创建两个数据库，初始化脚本如下：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -------------------------------------以下是pos业务库开始-------------------------------------------</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> <span class="keyword">IF</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> pos <span class="keyword">default</span> <span class="keyword">charset</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci;</span><br><span class="line"><span class="keyword">SET</span> FOREIGN_KEY_CHECKS=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">USE</span> pos;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 后台管理用户表</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> <span class="string">`t_user`</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`t_user`</span> (</span><br><span class="line">  <span class="string">`id`</span>                        <span class="built_in">INT</span>(<span class="number">11</span>) PRIMARY <span class="keyword">KEY</span> AUTO_INCREMENT <span class="keyword">COMMENT</span> <span class="string">'主键ID'</span>,</span><br><span class="line">  <span class="string">`username`</span>                  <span class="built_in">VARCHAR</span>(<span class="number">32</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'账号'</span>,</span><br><span class="line">  <span class="string">`name`</span>                      <span class="built_in">VARCHAR</span>(<span class="number">16</span>) <span class="keyword">DEFAULT</span> <span class="string">''</span> <span class="keyword">COMMENT</span> <span class="string">'名字'</span>,</span><br><span class="line">  <span class="string">`password`</span>                  <span class="built_in">VARCHAR</span>(<span class="number">128</span>) <span class="keyword">DEFAULT</span> <span class="string">''</span> <span class="keyword">COMMENT</span> <span class="string">'密码'</span>,</span><br><span class="line">  <span class="string">`salt`</span>                      <span class="built_in">VARCHAR</span>(<span class="number">64</span>) <span class="keyword">DEFAULT</span> <span class="string">''</span> <span class="keyword">COMMENT</span> <span class="string">'md5密码盐'</span>,</span><br><span class="line">  <span class="string">`phone`</span>                     <span class="built_in">VARCHAR</span>(<span class="number">32</span>) <span class="keyword">DEFAULT</span> <span class="string">''</span> <span class="keyword">COMMENT</span> <span class="string">'联系电话'</span>,</span><br><span class="line">  <span class="string">`tips`</span>                      <span class="built_in">VARCHAR</span>(<span class="number">255</span>) <span class="keyword">COMMENT</span> <span class="string">'备注'</span>,</span><br><span class="line">  <span class="string">`state`</span>                     <span class="built_in">TINYINT</span>(<span class="number">1</span>) <span class="keyword">DEFAULT</span> <span class="number">1</span> <span class="keyword">COMMENT</span> <span class="string">'状态 1:正常 2:禁用'</span>,</span><br><span class="line">  <span class="string">`created_time`</span>              DATETIME <span class="keyword">DEFAULT</span> <span class="keyword">CURRENT_TIMESTAMP</span> <span class="keyword">COMMENT</span> <span class="string">'创建时间'</span>,</span><br><span class="line">  <span class="string">`updated_time`</span>              DATETIME <span class="keyword">DEFAULT</span> <span class="keyword">CURRENT_TIMESTAMP</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="keyword">CURRENT_TIMESTAMP</span> <span class="keyword">COMMENT</span> <span class="string">'更新时间'</span></span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> AUTO_INCREMENT=<span class="number">1</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8 <span class="keyword">COMMENT</span>=<span class="string">'后台管理用户表'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 下面是pos数据库中的插入数据</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`t_user`</span> <span class="keyword">VALUES</span> (<span class="number">1</span>,<span class="string">'admin'</span>,<span class="string">'系统管理员'</span>,<span class="string">'123456'</span>,<span class="string">'www'</span>, <span class="string">'17890908889'</span>, <span class="string">'系统管理员'</span>, <span class="number">1</span>, <span class="string">'2017-12-12 09:46:12'</span>, <span class="string">'2017-12-12 09:46:12'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`t_user`</span> <span class="keyword">VALUES</span> (<span class="number">2</span>,<span class="string">'aix'</span>,<span class="string">'张三'</span>,<span class="string">'123456'</span>,<span class="string">'eee'</span>, <span class="string">'17859569358'</span>, <span class="string">''</span>, <span class="number">1</span>, <span class="string">'2017-12-12 09:46:12'</span>, <span class="string">'2017-12-12 09:46:12'</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># -------------------------------------以下biz业务库开始-------------------------------------------</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> <span class="keyword">IF</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> pos <span class="keyword">default</span> <span class="keyword">charset</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci;</span><br><span class="line"><span class="keyword">SET</span> FOREIGN_KEY_CHECKS=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">USE</span> biz;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 后台管理用户表</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> <span class="string">`t_user`</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`t_user`</span> (</span><br><span class="line">  <span class="string">`id`</span>                        <span class="built_in">INT</span>(<span class="number">11</span>) PRIMARY <span class="keyword">KEY</span> AUTO_INCREMENT <span class="keyword">COMMENT</span> <span class="string">'主键ID'</span>,</span><br><span class="line">  <span class="string">`username`</span>                  <span class="built_in">VARCHAR</span>(<span class="number">32</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'账号'</span>,</span><br><span class="line">  <span class="string">`name`</span>                      <span class="built_in">VARCHAR</span>(<span class="number">16</span>) <span class="keyword">DEFAULT</span> <span class="string">''</span> <span class="keyword">COMMENT</span> <span class="string">'名字'</span>,</span><br><span class="line">  <span class="string">`password`</span>                  <span class="built_in">VARCHAR</span>(<span class="number">128</span>) <span class="keyword">DEFAULT</span> <span class="string">''</span> <span class="keyword">COMMENT</span> <span class="string">'密码'</span>,</span><br><span class="line">  <span class="string">`salt`</span>                      <span class="built_in">VARCHAR</span>(<span class="number">64</span>) <span class="keyword">DEFAULT</span> <span class="string">''</span> <span class="keyword">COMMENT</span> <span class="string">'md5密码盐'</span>,</span><br><span class="line">  <span class="string">`phone`</span>                     <span class="built_in">VARCHAR</span>(<span class="number">32</span>) <span class="keyword">DEFAULT</span> <span class="string">''</span> <span class="keyword">COMMENT</span> <span class="string">'联系电话'</span>,</span><br><span class="line">  <span class="string">`tips`</span>                      <span class="built_in">VARCHAR</span>(<span class="number">255</span>) <span class="keyword">COMMENT</span> <span class="string">'备注'</span>,</span><br><span class="line">  <span class="string">`state`</span>                     <span class="built_in">TINYINT</span>(<span class="number">1</span>) <span class="keyword">DEFAULT</span> <span class="number">1</span> <span class="keyword">COMMENT</span> <span class="string">'状态 1:正常 2:禁用'</span>,</span><br><span class="line">  <span class="string">`created_time`</span>              DATETIME <span class="keyword">DEFAULT</span> <span class="keyword">CURRENT_TIMESTAMP</span> <span class="keyword">COMMENT</span> <span class="string">'创建时间'</span>,</span><br><span class="line">  <span class="string">`updated_time`</span>              DATETIME <span class="keyword">DEFAULT</span> <span class="keyword">CURRENT_TIMESTAMP</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="keyword">CURRENT_TIMESTAMP</span> <span class="keyword">COMMENT</span> <span class="string">'更新时间'</span></span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> AUTO_INCREMENT=<span class="number">1</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8 <span class="keyword">COMMENT</span>=<span class="string">'后台管理用户表'</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 下面是biz数据库中的插入数据</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`t_user`</span> <span class="keyword">VALUES</span> (<span class="number">1</span>,<span class="string">'admin1'</span>,<span class="string">'系统管理员'</span>,<span class="string">'123456'</span>,<span class="string">'www'</span>, <span class="string">'17890908889'</span>, <span class="string">'系统管理员'</span>, <span class="number">1</span>, <span class="string">'2017-12-12 09:46:12'</span>, <span class="string">'2017-12-12 09:46:12'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`t_user`</span> <span class="keyword">VALUES</span> (<span class="number">2</span>,<span class="string">'aix1'</span>,<span class="string">'张三'</span>,<span class="string">'123456'</span>,<span class="string">'eee'</span>, <span class="string">'17859569358'</span>, <span class="string">''</span>, <span class="number">1</span>, <span class="string">'2017-12-12 09:46:12'</span>, <span class="string">'2017-12-12 09:46:12'</span>);</span><br></pre></td></tr></table></figure>

<p>可以看到我创建了两个数据库pos和biz，同时还初始化了用户表，并分别插入两条初始数据。注意用户名数据不相同。</p>
<h2 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h2><p>接下来修改application.yml配置文件，如下：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment">###################  自定义配置  ###################</span></span><br><span class="line"><span class="attr">xncoding:</span></span><br><span class="line">  <span class="attr">muti-datasource-open:</span> <span class="literal">true</span> <span class="comment">#是否开启多数据源(true/false)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">###################  mybatis-plus配置  ###################</span></span><br><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath*:com/xncoding/pos/common/dao/repository/mapping/*.xml</span></span><br><span class="line">  <span class="attr">typeAliasesPackage:</span> <span class="string">&gt;</span></span><br><span class="line">    <span class="string">com.xncoding.pos.common.dao.entity</span></span><br><span class="line">  <span class="attr">global-config:</span></span><br><span class="line">    <span class="attr">id-type:</span> <span class="number">0</span>  <span class="comment"># 0:数据库ID自增   1:用户输入id  2:全局唯一id(IdWorker)  3:全局唯一ID(uuid)</span></span><br><span class="line">    <span class="attr">db-column-underline:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">refresh-mapper:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">configuration:</span></span><br><span class="line">    <span class="attr">map-underscore-to-camel-case:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">cache-enabled:</span> <span class="literal">true</span> <span class="comment">#配置的缓存的全局开关</span></span><br><span class="line">    <span class="attr">lazyLoadingEnabled:</span> <span class="literal">true</span> <span class="comment">#延时加载的开关</span></span><br><span class="line">    <span class="attr">multipleResultSetsEnabled:</span> <span class="literal">true</span> <span class="comment">#开启的话，延时加载一个属性时会加载该对象全部属性，否则按需加载属性</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#默认数据源</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://127.0.0.1:3306/pos?useSSL=false&amp;autoReconnect=true&amp;tinyInt1isBit=false&amp;useUnicode=true&amp;characterEncoding=utf8</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#多数据源</span></span><br><span class="line"><span class="attr">biz:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://127.0.0.1:3306/biz?useSSL=false&amp;autoReconnect=true&amp;tinyInt1isBit=false&amp;useUnicode=true&amp;characterEncoding=utf8</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123456</span></span><br></pre></td></tr></table></figure>

<p>解释一下：</p>
<p>这里我添加了一个自定义配置项<code>muti-datasource-open</code>，用来控制是否开启多数据源支持。这个配置项后面我会用到。 接下来定义MyBatis的配置，最后定义了两个MySQL数据库的连接信息，一个是pos库，一个是biz库。</p>
<h2 id="动态切换数据源"><a href="#动态切换数据源" class="headerlink" title="动态切换数据源"></a>动态切换数据源</h2><p>这里通过Spring的AOP技术实现数据源的动态切换。</p>
<p>多数据源的常量类：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">DSEnum</span> </span>&#123;</span><br><span class="line">    String DATA_SOURCE_CORE = <span class="string">"dataSourceCore"</span>;         <span class="comment">//核心数据源</span></span><br><span class="line">    String DATA_SOURCE_BIZ = <span class="string">"dataSourceBiz"</span>;            <span class="comment">//其他业务的数据源</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>datasource的上下文，用来存储当前线程的数据源类型：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DataSourceContextHolder</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ThreadLocal&lt;String&gt; contextHolder = <span class="keyword">new</span> ThreadLocal&lt;String&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> dataSourceType 数据库类型</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Description</span>: 设置数据源类型</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">setDataSourceType</span><span class="params">(String dataSourceType)</span> </span>&#123;</span><br><span class="line">        contextHolder.set(dataSourceType);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Description</span>: 获取数据源类型</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getDataSourceType</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> contextHolder.get();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Description</span>: 清除数据源类型</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">clearDataSourceType</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        contextHolder.remove();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>定义动态数据源，继承<code>AbstractRoutingDataSource</code> ：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DynamicDataSource</span> <span class="keyword">extends</span> <span class="title">AbstractRoutingDataSource</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> Object <span class="title">determineCurrentLookupKey</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> DataSourceContextHolder.getDataSourceType();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>接下来自定义一个注解，用来在Service方法上面注解使用哪个数据源：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 多数据源标识</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> xiongneng</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Inherited</span></span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="meta">@Target</span>(&#123;ElementType.METHOD&#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> DataSource &#123;</span><br><span class="line">    <span class="function">String <span class="title">name</span><span class="params">()</span> <span class="keyword">default</span> ""</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最后，最核心的AOP类定义：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 多数据源切换的aop</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> xiongneng</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConditionalOnProperty</span>(prefix = <span class="string">"xncoding"</span>, name = <span class="string">"muti-datasource-open"</span>, havingValue = <span class="string">"true"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MultiSourceExAop</span> <span class="keyword">implements</span> <span class="title">Ordered</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Logger log = Logger.getLogger(<span class="keyword">this</span>.getClass());</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Pointcut</span>(value = <span class="string">"@annotation(com.xncoding.pos.common.annotion.DataSource)"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">cut</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Around</span>(<span class="string">"cut()"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">around</span><span class="params">(ProceedingJoinPoint point)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line"></span><br><span class="line">        Signature signature = point.getSignature();</span><br><span class="line">        MethodSignature methodSignature = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (!(signature <span class="keyword">instanceof</span> MethodSignature)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"该注解只能用于方法"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        methodSignature = (MethodSignature) signature;</span><br><span class="line"></span><br><span class="line">        Object target = point.getTarget();</span><br><span class="line">        Method currentMethod = target.getClass().getMethod(methodSignature.getName(), methodSignature.getParameterTypes());</span><br><span class="line"></span><br><span class="line">        DataSource datasource = currentMethod.getAnnotation(DataSource<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        <span class="keyword">if</span> (datasource != <span class="keyword">null</span>) &#123;</span><br><span class="line">            DataSourceContextHolder.setDataSourceType(datasource.name());</span><br><span class="line">            log.debug(<span class="string">"设置数据源为："</span> + datasource.name());</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            DataSourceContextHolder.setDataSourceType(DSEnum.DATA_SOURCE_CORE);</span><br><span class="line">            log.debug(<span class="string">"设置数据源为：dataSourceCore"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> point.proceed();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            log.debug(<span class="string">"清空数据源信息！"</span>);</span><br><span class="line">            DataSourceContextHolder.clearDataSourceType();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * aop的顺序要早于spring的事务</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getOrder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里使用到了注解@ConditionalOnProperty，只有当我的配置文件中muti-datasource-open=true的时候注解才会生效。</p>
<p>另外还有一个要注意的地方，就是order，aop的顺序一定要早于spring的事务，这里我将它设置成1，后面你会看到我将spring事务顺序设置成2。</p>
<h2 id="配置类"><a href="#配置类" class="headerlink" title="配置类"></a>配置类</h2><p>首先有两个属性类：</p>
<ol>
<li><code>DruidProperties</code> 连接池的属性类</li>
<li><code>MutiDataSourceProperties</code> biz数据源的属性类</li>
</ol>
<p>然后定义配置类：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableTransactionManagement</span>(order = <span class="number">2</span>)</span><br><span class="line"><span class="meta">@MapperScan</span>(basePackages = &#123;<span class="string">"com.xncoding.pos.common.dao.repository"</span>&#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MybatisPlusConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    DruidProperties druidProperties;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    MutiDataSourceProperties mutiDataSourceProperties;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 核心数据源</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> DruidDataSource <span class="title">coreDataSource</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        DruidDataSource dataSource = <span class="keyword">new</span> DruidDataSource();</span><br><span class="line">        druidProperties.config(dataSource);</span><br><span class="line">        <span class="keyword">return</span> dataSource;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 另一个数据源</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> DruidDataSource <span class="title">bizDataSource</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        DruidDataSource dataSource = <span class="keyword">new</span> DruidDataSource();</span><br><span class="line">        druidProperties.config(dataSource);</span><br><span class="line">        mutiDataSourceProperties.config(dataSource);</span><br><span class="line">        <span class="keyword">return</span> dataSource;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 单数据源连接池配置</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnProperty</span>(prefix = <span class="string">"xncoding"</span>, name = <span class="string">"muti-datasource-open"</span>, havingValue = <span class="string">"false"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> DruidDataSource <span class="title">singleDatasource</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> coreDataSource();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 多数据源连接池配置</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnProperty</span>(prefix = <span class="string">"xncoding"</span>, name = <span class="string">"muti-datasource-open"</span>, havingValue = <span class="string">"true"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> DynamicDataSource <span class="title">mutiDataSource</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        DruidDataSource coreDataSource = coreDataSource();</span><br><span class="line">        DruidDataSource bizDataSource = bizDataSource();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            coreDataSource.init();</span><br><span class="line">            bizDataSource.init();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException sql) &#123;</span><br><span class="line">            sql.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        DynamicDataSource dynamicDataSource = <span class="keyword">new</span> DynamicDataSource();</span><br><span class="line">        HashMap&lt;Object, Object&gt; hashMap = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        hashMap.put(DSEnum.DATA_SOURCE_CORE, coreDataSource);</span><br><span class="line">        hashMap.put(DSEnum.DATA_SOURCE_BIZ, bizDataSource);</span><br><span class="line">        dynamicDataSource.setTargetDataSources(hashMap);</span><br><span class="line">        dynamicDataSource.setDefaultTargetDataSource(coreDataSource);</span><br><span class="line">        <span class="keyword">return</span> dynamicDataSource;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>代码其实很好理解，我就不再多做解释了。</p>
<p>然后步骤跟普通的集成MyBatis是一样的，我简单的过一遍。</p>
<h2 id="实体类"><a href="#实体类" class="headerlink" title="实体类"></a>实体类</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@TableName</span>(value = <span class="string">"t_user"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">extends</span> <span class="title">Model</span>&lt;<span class="title">User</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 主键ID</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@TableId</span>(value=<span class="string">"id"</span>, type= IdType.AUTO)</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 账号</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 名字</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 密码</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * md5密码盐</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String salt;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 联系电话</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String phone;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 备注</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String tips;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 状态 1:正常 2:禁用</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer state;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建时间</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Date createdTime;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 更新时间</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Date updatedTime;</span><br><span class="line">    <span class="comment">// 省略getter/setter方法</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="定义DAO"><a href="#定义DAO" class="headerlink" title="定义DAO"></a>定义DAO</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapper</span> <span class="keyword">extends</span> <span class="title">BaseMapper</span>&lt;<span class="title">User</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="定义Service"><a href="#定义Service" class="headerlink" title="定义Service"></a>定义Service</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 通过ID查找用户</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">findById</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userMapper.selectById(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 通过ID查找用户</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@DataSource</span>(name = DSEnum.DATA_SOURCE_BIZ)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">findById1</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userMapper.selectById(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 新增用户</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> user</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertUser</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">        userMapper.insert(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改用户</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> user</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateUser</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">        userMapper.updateById(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除用户</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteUser</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">        userMapper.deleteById(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里唯一要说明的就是我在方法<code>findById1()</code>上面增加了注解<code>@DataSource(name = DSEnum.DATA_SOURCE_BIZ)</code>，这样这个方法就会访问biz数据库。</p>
<p>注意，不加注解就会访问默认数据库pos。</p>
<h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><p>最后编写一个简单的测试，我只测试<code>findById()</code>方法和<code>findById1()</code>方法，看它们是否访问的是不同的数据源。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RunWith</span>(SpringRunner<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">@<span class="title">SpringBootTest</span></span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">ApplicationTests</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger log = LoggerFactory.getLogger(ApplicationTests<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 测试增删改查</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 核心数据库中的用户id=1</span></span><br><span class="line">        User user = userService.findById(<span class="number">1</span>);</span><br><span class="line">        assertThat(user.getUsername(), is(<span class="string">"admin"</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// biz数据库中的用户id=1</span></span><br><span class="line">        User user1 = userService.findById1(<span class="number">1</span>);</span><br><span class="line">        assertThat(user1.getUsername(), is(<span class="string">"admin1"</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行测试，结果显示为green bar，成功！</p>
<h2 id="GitHub源码"><a href="#GitHub源码" class="headerlink" title="GitHub源码"></a>GitHub源码</h2><p><a href="https://github.com/yidao620c/SpringBootBucket/tree/master/springboot-multisource" target="_blank" rel="noopener">springboot-multisource</a>    —已测试</p>
<h2 id="来源"><a href="#来源" class="headerlink" title="来源"></a>来源</h2><p><a href="https://www.xncoding.com/" target="_blank" rel="noopener">https://www.xncoding.com/</a></p>
]]></content>
      <categories>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>springboot</tag>
        <tag>datasource</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBoot系列 - 定时任务</title>
    <url>/2020/06/08/SpringBoot%E7%B3%BB%E5%88%97-%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="SpringBoot系列-定时任务"><a href="#SpringBoot系列-定时任务" class="headerlink" title="SpringBoot系列 - 定时任务"></a>SpringBoot系列 - 定时任务</h1><p>很多时候，我们需要在每天的某个固定时间或者每隔一段时间让应用去执行某一个任务。 为了实现这个需求，通常我们会通过多线程来实现这个功能，但是这样我们需要自己做一些比较麻烦的工作。 接下来，让我们看看如何使用Spring scheduling task简化定时任务功能的实现。</p>
<p>默认，springboot已经支持了定时任务Schedule模块，所以一般情况已经完全能够满足我们的实际需求， 一般来说，没有必要再加入Quartz2了，不过你要是有更高级需求也可以整合Quartz2进来。</p>
<h2 id="定时任务架构"><a href="#定时任务架构" class="headerlink" title="定时任务架构"></a>定时任务架构</h2><p>一般来说，实际项目中，为了提高服务的响应能力，我们一般会通过负载均衡的方式，或者反向代理多个节点的方式来进行。 如果我们将定时任务写在我们的项目中，那么在同一个时间点，定时任务会一起执行，也就是会执行多次，这样很可能会导致我们的业务出现错误。</p>
<p>建议使用逻辑分离的方式来解决这个问题。就是我们将真正要定时任务处理的逻辑，写成rest或者rpc服务， 然后我们可以新建一个单独的定时任务项目，这个项目应该是没有任何的业务代码的，他纯粹只有定时任务功能， 几点启动，或者每隔多少时间启动。启动后，通过rest或者rpc的方式，调用真正处理逻辑的服务。</p>
<h2 id="添加依赖"><a href="#添加依赖" class="headerlink" title="添加依赖"></a>添加依赖</h2><p>实际上只要添加最基础的start依赖即可支持定时任务：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.4.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="添加注解配置类"><a href="#添加注解配置类" class="headerlink" title="添加注解配置类"></a>添加注解配置类</h2><p>如果有多个耗时任务，最好使用线程池来执行，添加一个配置类专门用来配置定时任务执行的线程池：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableScheduling</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ScheduleConfig</span> <span class="keyword">implements</span> <span class="title">SchedulingConfigurer</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configureTasks</span><span class="params">(ScheduledTaskRegistrar taskRegistrar)</span> </span>&#123;</span><br><span class="line">        taskRegistrar.setScheduler(taskExecutor());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span>(destroyMethod=<span class="string">"shutdown"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ExecutorService <span class="title">taskExecutor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Executors.newScheduledThreadPool(<span class="number">20</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="添加执行任务类"><a href="#添加执行任务类" class="headerlink" title="添加执行任务类"></a>添加执行任务类</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyJob</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Logger logger = LoggerFactory.getLogger(MyJob<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">long</span> ONE_Minute =  <span class="number">10</span> * <span class="number">1000</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Scheduled</span>(fixedDelay=ONE_Minute)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fixedDelayJob</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        logger.info(DateTimeKit.formatDateTime(<span class="keyword">new</span> Date())+<span class="string">" &gt;&gt;fixedDelay执行.... start"</span>);</span><br><span class="line">        Thread.sleep(<span class="number">5000L</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Scheduled</span>(fixedRate=ONE_Minute)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fixedRateJob</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        logger.info(DateTimeKit.formatDateTime(<span class="keyword">new</span> Date())+<span class="string">" &gt;&gt;fixedRate执行...."</span>);</span><br><span class="line">        Thread.sleep(<span class="number">8000L</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 第一位，表示秒，取值0-59</span></span><br><span class="line"><span class="comment">     * 第二位，表示分，取值0-59</span></span><br><span class="line"><span class="comment">     * 第三位，表示小时，取值0-23</span></span><br><span class="line"><span class="comment">     * 第四位，日期天/日，取值1-31</span></span><br><span class="line"><span class="comment">     * 第五位，日期月份，取值1-12</span></span><br><span class="line"><span class="comment">     * 第六位，星期，取值1-7，1表示星期天，2表示星期一</span></span><br><span class="line"><span class="comment">     * 第七位，年份，可以留空，取值1970-2099</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Scheduled</span>(cron=<span class="string">"0 40 19 * * ?"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">cronJob</span><span class="params">()</span></span>&#123;</span><br><span class="line">        logger.info(DateTimeKit.formatDateTime(<span class="keyword">new</span> Date())+<span class="string">" &gt;&gt;cron执行...."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="三种定时任务类型"><a href="#三种定时任务类型" class="headerlink" title="三种定时任务类型"></a>三种定时任务类型</h2><p>上面的例子中有三种典型的定时任务，先将前面最简单的两种，单位都是毫秒，比如1分钟=60秒×1000：</p>
<ol>
<li>fixedDelay：当任务执行完毕后x毫秒后再执行下一个任务</li>
<li>fixedRate： 每隔x毫秒执行一次，不论你业务执行花费了多少时间</li>
</ol>
<p>而还有一类定时任务，比如是每天的3点15分执行，那么我们就需要用另外一种方式：cron表达式</p>
<h2 id="cron表达式"><a href="#cron表达式" class="headerlink" title="cron表达式"></a>cron表达式</h2><p>cron表达式，有专门的语法，而且感觉有点绕人，不过简单来说，大家记住一些常用的用法即可，特殊的语法可以单独去查。</p>
<p>cron一共有7位，但是最后一位是年，可以留空，所以我们可以写6位：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">* 第一位，秒，取值0-59</span><br><span class="line">* 第二位，分，取值0-59</span><br><span class="line">* 第三位，时，取值0-23</span><br><span class="line">* 第四位，日，取值1-31</span><br><span class="line">* 第五位，月，取值1-12</span><br><span class="line">* 第六位，星期，取值1-7，1表示星期天，2表示星期一</span><br><span class="line">* 第七位，年份，可以留空，取值1970-2099</span><br></pre></td></tr></table></figure>

<p>cron中，还有一些特殊的符号，含义如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">(*)星号：可以理解为每的意思，每秒，每分，每时，每日，每月，每星期，每年...</span><br><span class="line">(?)问号：问号只能出现在日和星期这两个位置，表示这个位置的值不确定，每天3点执行，所以第六位星期的位置，</span><br><span class="line">我们是不需要关注的，就是不确定的值。同时：日和星期是两个相互排斥的元素，通过问号来表明不指定值。</span><br><span class="line">比如，1月10日，比如是星期1，如果在星期的位置是另指定星期二，就前后冲突矛盾了。</span><br><span class="line">(-)减号：表达一个范围，如在小时字段中使用“10-12”，则表示从10到12点，即10,11,12</span><br><span class="line">(,)逗号：表达一个列表值，如在星期字段中使用“1,2,4”，则表示星期一，星期二，星期四</span><br><span class="line">(&#x2F;)斜杠：如：x&#x2F;y，x是开始值，y是步长，比如在第一位（秒） 0&#x2F;15就是，从0秒开始，每15秒，最后就是0，15，30，45，60 另：*&#x2F;y，等同于0&#x2F;y</span><br><span class="line">(L)字符：用在日表示一个月中的最后一天，用在周表示该月最后一个星期X</span><br><span class="line">(W)字符：指定离给定日期最近的工作日(周一到周五)</span><br><span class="line">(#)字符：表示该月第几个周X。6#3表示该月第3个周五</span><br></pre></td></tr></table></figure>

<p>下面列举几个例子供大家来验证：</p>
<figure class="highlight basic"><table><tr><td class="code"><pre><span class="line"><span class="symbol">0 </span><span class="number">0</span> <span class="number">3</span> * * ?     每天<span class="number">3</span>点执行</span><br><span class="line"><span class="symbol">0 </span><span class="number">5</span> <span class="number">3</span> * * ?     每天<span class="number">3</span>点<span class="number">5</span>分执行</span><br><span class="line"><span class="symbol">0 </span><span class="number">5</span> <span class="number">3</span> ? * *     每天<span class="number">3</span>点<span class="number">5</span>分执行，与上面作用相同</span><br><span class="line"><span class="symbol">0 </span><span class="number">5</span>/<span class="number">10</span> <span class="number">3</span> * * ?  每天<span class="number">3</span>点的 <span class="number">5</span>分，<span class="number">15</span>分，<span class="number">25</span>分，<span class="number">35</span>分，<span class="number">45</span>分，<span class="number">55</span>分这几个时间点执行</span><br><span class="line"><span class="symbol">0 </span><span class="number">10</span> <span class="number">3</span> ? * <span class="number">1</span>    每周星期天，<span class="number">3</span>点<span class="number">10</span>分 执行，注：<span class="number">1</span>表示星期天    </span><br><span class="line"><span class="symbol">0 </span><span class="number">10</span> <span class="number">3</span> ? * <span class="number">1#</span><span class="number">3</span>  每个月的第三个星期，星期天执行，#号只能出现在星期的位置</span><br></pre></td></tr></table></figure>

<h2 id="GitHub源码"><a href="#GitHub源码" class="headerlink" title="GitHub源码"></a>GitHub源码</h2><p><a href="https://github.com/yidao620c/SpringBootBucket/tree/master/springboot-schedule" target="_blank" rel="noopener">springboot-schedule</a>    —已测试</p>
<h2 id="来源"><a href="#来源" class="headerlink" title="来源"></a>来源</h2><p><a href="https://www.xncoding.com/" target="_blank" rel="noopener">https://www.xncoding.com/</a></p>
]]></content>
      <categories>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>springboot</tag>
        <tag>schedule</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBoot系列 - 实现RESTful接口</title>
    <url>/2020/06/08/SpringBoot%E7%B3%BB%E5%88%97-%E5%AE%9E%E7%8E%B0RESTful%E6%8E%A5%E5%8F%A3/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="SpringBoot系列-实现RESTful接口"><a href="#SpringBoot系列-实现RESTful接口" class="headerlink" title="SpringBoot系列 - 实现RESTful接口"></a>SpringBoot系列 - 实现RESTful接口</h1><p>REST，即Representational State Transfer的缩写，对这个词组的翻译是<code>表现层状态转化</code>。</p>
<p>RESTful是一种软件设计风格，就是目前最流行的一种互联网软件架构。它结构清晰、符合标准、易于理解、扩展方便，所以正得到越来越多网站的采用。</p>
<p>SpringMVC对RESTful风格的接口有着天然的支持，本篇将讲述如何在SpringBoot中怎样写。</p>
<h2 id="几个注解"><a href="#几个注解" class="headerlink" title="几个注解"></a>几个注解</h2><p>在讲述使用之前，想要理解SpringMVC的几个常用注解：</p>
<ol>
<li>@Controller：修饰class，用来创建处理http请求的对象</li>
<li>@RestController：Spring4之后加入的注解，原来在@Controller中返回json需要@ResponseBody来配合，如果直接用@RestController替代@Controller就不需要再配置@ResponseBody，默认返回json格式。</li>
<li>@RequestMapping：配置url映射</li>
<li>@PostMapping: 这个是@RequestMapping+POST方法的简写</li>
<li>@RequestHeader: 请求Header参数</li>
<li>@PathVariable: URL路径参数，比如/user/{id}中的id参数</li>
<li>@RequestParam: URL请求参数，比如/user?id=1中的id参数</li>
<li>@RequestBody: 请求Body参数</li>
</ol>
<p>下面我们尝试使用Spring MVC来实现一组对User对象操作的RESTful API，配合注释详细说明在Spring MVC中如何映射HTTP请求、如何传参、如何编写单元测试。</p>
<h2 id="API设计"><a href="#API设计" class="headerlink" title="API设计"></a>API设计</h2><p>RESTful API具体设计如下：</p>
<table>
<thead>
<tr>
<th>请求类型</th>
<th>URL</th>
<th>功能说明</th>
</tr>
</thead>
<tbody><tr>
<td>GET</td>
<td>/users</td>
<td>查询用户列表</td>
</tr>
<tr>
<td>POST</td>
<td>/users</td>
<td>创建一个用户</td>
</tr>
<tr>
<td>GET</td>
<td>/users/{id}</td>
<td>根据id查询用户</td>
</tr>
<tr>
<td>PUT</td>
<td>/users/{id}</td>
<td>根据id更新用户</td>
</tr>
<tr>
<td>DELTE</td>
<td>/users/{id}</td>
<td>更加id删除用户</td>
</tr>
</tbody></table>
<p>RESTful架构有一些典型的设计误区，就是URI包含动词。因为”资源”表示一种实体，所以应该是名词，URI不应该有动词，动词应该放在HTTP协议中。 上面设计的API的URI中都是名词。</p>
<h2 id="实体定义"><a href="#实体定义" class="headerlink" title="实体定义"></a>实体定义</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="comment">// 下面省略getter/setter</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Controller实现"><a href="#Controller实现" class="headerlink" title="Controller实现"></a>Controller实现</h2><p>接下来就可以编写RestController了，这里为了演示，会将数据保存到内存Map中，实际使用肯定是保存到数据库中。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 接口类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(value = <span class="string">"/users"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger _logger = LoggerFactory.getLogger(UserController<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建线程安全的Map</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Map&lt;Long, User&gt; users = Collections.synchronizedMap(<span class="keyword">new</span> HashMap&lt;Long, User&gt;());</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(value = <span class="string">"/"</span>, method = RequestMethod.GET)</span><br><span class="line">    <span class="keyword">public</span> BaseResponse&lt;List&lt;User&gt;&gt; getUserList() &#123;</span><br><span class="line">        <span class="comment">// 处理"/users/"的GET请求，用来获取用户列表</span></span><br><span class="line">        <span class="comment">// 还可以通过@RequestParam从页面中传递参数来进行查询条件或者翻页信息的传递</span></span><br><span class="line">        List&lt;User&gt; r = <span class="keyword">new</span> ArrayList&lt;&gt;(users.values());</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> BaseResponse&lt;&gt;(<span class="keyword">true</span>, <span class="string">"查询列表成功"</span>, r);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(value = <span class="string">"/"</span>, method = RequestMethod.POST)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> BaseResponse&lt;String&gt; <span class="title">postUser</span><span class="params">(@ModelAttribute User user)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 处理"/users/"的POST请求，用来创建User</span></span><br><span class="line">        <span class="comment">// 除了@ModelAttribute绑定参数之外，还可以通过@RequestParam从页面中传递参数</span></span><br><span class="line">        users.put(user.getId(), user);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> BaseResponse&lt;&gt;(<span class="keyword">true</span>, <span class="string">"新增成功"</span>, <span class="string">""</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(value = <span class="string">"/&#123;id&#125;"</span>, method = RequestMethod.GET)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> BaseResponse&lt;User&gt; <span class="title">getUser</span><span class="params">(@PathVariable Long id)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 处理"/users/&#123;id&#125;"的GET请求，用来获取url中id值的User信息</span></span><br><span class="line">        <span class="comment">// url中的id可通过@PathVariable绑定到函数的参数中</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> BaseResponse&lt;&gt;(<span class="keyword">true</span>, <span class="string">"查询成功"</span>, users.get(id));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(value = <span class="string">"/&#123;id&#125;"</span>, method = RequestMethod.PUT)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> BaseResponse&lt;String&gt; <span class="title">putUser</span><span class="params">(@PathVariable Long id, @ModelAttribute User user)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 处理"/users/&#123;id&#125;"的PUT请求，用来更新User信息</span></span><br><span class="line">        User u = users.get(id);</span><br><span class="line">        u.setName(user.getName());</span><br><span class="line">        u.setAge(user.getAge());</span><br><span class="line">        users.put(id, u);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> BaseResponse&lt;&gt;(<span class="keyword">true</span>, <span class="string">"更新成功"</span>, <span class="string">""</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(value = <span class="string">"/&#123;id&#125;"</span>, method = RequestMethod.DELETE)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> BaseResponse&lt;String&gt; <span class="title">deleteUser</span><span class="params">(@PathVariable Long id)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 处理"/users/&#123;id&#125;"的DELETE请求，用来删除User</span></span><br><span class="line">        users.remove(id);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> BaseResponse&lt;&gt;(<span class="keyword">true</span>, <span class="string">"删除成功"</span>, <span class="string">""</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><p>接下来就是写一个测试来测一下，SpringMVC的内置测试支持非常方便。</p>
<p>先写一个json和对象之间相互转化的工具类，使用Jackson库：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JacksonUtil</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ObjectMapper mapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">bean2Json</span><span class="params">(Object obj)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> mapper.writeValueAsString(obj);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (JsonProcessingException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">T <span class="title">json2Bean</span><span class="params">(String jsonStr, TypeReference&lt;T&gt; typeReference)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> mapper.readValue(jsonStr, typeReference);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后再编写单元测试：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@AutoConfigureMockMvc</span></span><br><span class="line"><span class="meta">@RunWith</span>(SpringRunner<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">@<span class="title">SpringBootTest</span>(<span class="title">classes</span> </span>= Application<span class="class">.<span class="keyword">class</span>, <span class="title">webEnvironment</span> </span>= SpringBootTest.WebEnvironment.RANDOM_PORT)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ApplicationTests</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MockMvc mvc;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testUserController</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// 测试UserController</span></span><br><span class="line">        RequestBuilder request;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1、get查一下user列表，应该为空</span></span><br><span class="line">        request = get(<span class="string">"/users/"</span>);</span><br><span class="line">        MvcResult result = mvc.perform(request)</span><br><span class="line">                .andExpect(status().isOk())</span><br><span class="line">                .andReturn();</span><br><span class="line">        String content = result.getResponse().getContentAsString();</span><br><span class="line">        BaseResponse&lt;List&lt;User&gt;&gt; response = JacksonUtil.json2Bean(content, <span class="keyword">new</span> TypeReference&lt;BaseResponse&lt;List&lt;User&gt;&gt;&gt;() &#123;&#125;);</span><br><span class="line">        assertThat(response.isSuccess(), is(<span class="keyword">true</span>));</span><br><span class="line">        assertThat(response.getMsg(), is(<span class="string">"查询列表成功"</span>));</span><br><span class="line">        assertThat(((List) response.getData()).size(), is(<span class="number">0</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2、post提交一个user</span></span><br><span class="line">        request = post(<span class="string">"/users/"</span>)</span><br><span class="line">                .param(<span class="string">"id"</span>, <span class="string">"1"</span>)</span><br><span class="line">                .param(<span class="string">"name"</span>, <span class="string">"测试大师"</span>)</span><br><span class="line">                .param(<span class="string">"age"</span>, <span class="string">"20"</span>);</span><br><span class="line">        result = mvc.perform(request)</span><br><span class="line">                .andExpect(status().isOk())</span><br><span class="line">                .andReturn();</span><br><span class="line">        content = result.getResponse().getContentAsString();</span><br><span class="line">        BaseResponse&lt;String&gt; response1 = JacksonUtil.json2Bean(content, <span class="keyword">new</span> TypeReference&lt;BaseResponse&lt;String&gt;&gt;() &#123;&#125;);</span><br><span class="line">        assertThat(response1.isSuccess(), is(<span class="keyword">true</span>));</span><br><span class="line">        assertThat(response1.getMsg(), is(<span class="string">"新增成功"</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3、get获取user列表，应该有刚才插入的数据</span></span><br><span class="line">        request = get(<span class="string">"/users/"</span>);</span><br><span class="line">        result = mvc.perform(request)</span><br><span class="line">                .andExpect(status().isOk())</span><br><span class="line">                .andReturn();</span><br><span class="line">        content = result.getResponse().getContentAsString();</span><br><span class="line">        BaseResponse&lt;List&lt;User&gt;&gt; response2 = JacksonUtil.json2Bean(content, <span class="keyword">new</span> TypeReference&lt;BaseResponse&lt;List&lt;User&gt;&gt;&gt;() &#123;&#125;);</span><br><span class="line">        assertThat(response2.isSuccess(), is(<span class="keyword">true</span>));</span><br><span class="line">        assertThat(response2.getMsg(), is(<span class="string">"查询列表成功"</span>));</span><br><span class="line">        assertThat((response2.getData()).size(), is(<span class="number">1</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4、put修改id为1的user</span></span><br><span class="line">        request = put(<span class="string">"/users/1"</span>)</span><br><span class="line">                .param(<span class="string">"name"</span>, <span class="string">"测试终极大师"</span>)</span><br><span class="line">                .param(<span class="string">"age"</span>, <span class="string">"30"</span>);</span><br><span class="line">        result = mvc.perform(request)</span><br><span class="line">                .andExpect(status().isOk())</span><br><span class="line">                .andReturn();</span><br><span class="line">        content = result.getResponse().getContentAsString();</span><br><span class="line">        BaseResponse&lt;String&gt; response3 = JacksonUtil.json2Bean(content, <span class="keyword">new</span> TypeReference&lt;BaseResponse&lt;String&gt;&gt;() &#123;&#125;);</span><br><span class="line">        assertThat(response3.isSuccess(), is(<span class="keyword">true</span>));</span><br><span class="line">        assertThat(response3.getMsg(), is(<span class="string">"更新成功"</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 5、get一个id为1的user</span></span><br><span class="line">        request = get(<span class="string">"/users/1"</span>);</span><br><span class="line">        result = mvc.perform(request)</span><br><span class="line">                .andExpect(status().isOk())</span><br><span class="line">                .andReturn();</span><br><span class="line">        content = result.getResponse().getContentAsString();</span><br><span class="line">        BaseResponse&lt;User&gt; response4 = JacksonUtil.json2Bean(content, <span class="keyword">new</span> TypeReference&lt;BaseResponse&lt;User&gt;&gt;() &#123;&#125;);</span><br><span class="line">        assertThat(response4.isSuccess(), is(<span class="keyword">true</span>));</span><br><span class="line">        assertThat(response4.getMsg(), is(<span class="string">"查询成功"</span>));</span><br><span class="line">        User user = response4.getData();</span><br><span class="line">        assertThat(user.getId(), is(<span class="number">1L</span>));</span><br><span class="line">        assertThat(user.getName(), is(<span class="string">"测试终极大师"</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 6、del删除id为1的user</span></span><br><span class="line">        request = delete(<span class="string">"/users/1"</span>);</span><br><span class="line">        result = mvc.perform(request)</span><br><span class="line">                .andExpect(status().isOk())</span><br><span class="line">                .andReturn();</span><br><span class="line">        content = result.getResponse().getContentAsString();</span><br><span class="line">        BaseResponse&lt;String&gt; response5 = JacksonUtil.json2Bean(content, <span class="keyword">new</span> TypeReference&lt;BaseResponse&lt;String&gt;&gt;() &#123;&#125;);</span><br><span class="line">        assertThat(response5.isSuccess(), is(<span class="keyword">true</span>));</span><br><span class="line">        assertThat(response5.getMsg(), is(<span class="string">"删除成功"</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 7、get查一下user列表，应该为空</span></span><br><span class="line">        request = get(<span class="string">"/users/"</span>);</span><br><span class="line">        result = mvc.perform(request)</span><br><span class="line">                .andExpect(status().isOk())</span><br><span class="line">                .andReturn();</span><br><span class="line">        content = result.getResponse().getContentAsString();</span><br><span class="line">        BaseResponse&lt;List&lt;User&gt;&gt; response6 = JacksonUtil.json2Bean(content, <span class="keyword">new</span> TypeReference&lt;BaseResponse&lt;List&lt;User&gt;&gt;&gt;() &#123;&#125;);</span><br><span class="line">        assertThat(response6.isSuccess(), is(<span class="keyword">true</span>));</span><br><span class="line">        assertThat(response6.getMsg(), is(<span class="string">"查询列表成功"</span>));</span><br><span class="line">        assertThat((response6.getData()).size(), is(<span class="number">0</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行测试，结果为green bar，测试通过。</p>
<h2 id="GitHub源码"><a href="#GitHub源码" class="headerlink" title="GitHub源码"></a>GitHub源码</h2><p><a href="https://github.com/yidao620c/SpringBootBucket/tree/master/springboot-restful" target="_blank" rel="noopener">springboot-restful</a>   —已测试</p>
<h2 id="来源"><a href="#来源" class="headerlink" title="来源"></a>来源</h2><p><a href="https://www.xncoding.com/" target="_blank" rel="noopener">https://www.xncoding.com/</a></p>
]]></content>
      <categories>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>springboot</tag>
        <tag>restful</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBoot系列 - 异步线程池</title>
    <url>/2020/06/08/SpringBoot%E7%B3%BB%E5%88%97-%E5%BC%82%E6%AD%A5%E7%BA%BF%E7%A8%8B%E6%B1%A0/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="SpringBoot系列-异步线程池"><a href="#SpringBoot系列-异步线程池" class="headerlink" title="SpringBoot系列 - 异步线程池"></a>SpringBoot系列 - 异步线程池</h1><p>在项目中，当访问其他人的接口较慢或者做耗时任务时，不想程序一直卡在耗时任务上，想程序能够并行执行， 我们可以使用多线程来并行的处理任务，也可以使用spring提供的异步处理方式@Async。</p>
<p>Spring异步线程池的接口类，其实质是<code>java.util.concurrent.Executor</code>。</p>
<p>Spring 已经实现的异常线程池：</p>
<ol>
<li><code>SimpleAsyncTaskExecutor</code>：不是真的线程池，这个类不重用线程，每次调用都会创建一个新的线程。</li>
<li><code>SyncTaskExecutor</code>：这个类没有实现异步调用，只是一个同步操作，只适用于不需要多线程的地方</li>
<li><code>ConcurrentTaskExecutor</code>：Executor的适配类，不推荐使用。如果<code>ThreadPoolTaskExecutor</code>不满足要求时，才用考虑使用这个类</li>
<li><code>SimpleThreadPoolTaskExecutor</code>：是Quartz的<code>SimpleThreadPool</code>的类。线程池同时被quartz和非quartz使用，才需要使用此类</li>
<li><code>ThreadPoolTaskExecutor</code>：最常使用，推荐。其实质是对<code>java.util.concurrent.ThreadPoolExecutor</code>的包装</li>
</ol>
<p>在异步处理的方法上添加注解<code>@Async</code>，就会启动一个新的线程去执行。</p>
<h2 id="开启异步配置"><a href="#开启异步配置" class="headerlink" title="开启异步配置"></a>开启异步配置</h2><p>SpringBoot中开启异步支持非常简单，只需要在配置类上面加上注解<code>@EnableAsync</code>，同时定义自己的线程池即可。 也可以不定义自己的线程池，则使用系统默认的线程池。这个注解可以放在Application启动类上，但是更推荐放在配置类上面。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableAsync</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AsyncConfig</span> <span class="keyword">implements</span> <span class="title">AsyncConfigurer</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 省略...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>异步处理方法分为不返回结果和返回结果，这两者的处理是有区别的。</p>
<h2 id="返回void"><a href="#返回void" class="headerlink" title="返回void"></a>返回void</h2><p>没有结果返回的示例：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AsyncTask</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Async</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dealNoReturnTask</span><span class="params">()</span></span>&#123;</span><br><span class="line">        log.info(<span class="string">"返回值为void的异步调用开始"</span> + Thread.currentThread().getName());</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">3000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        log.info(<span class="string">"返回值为void的异步调用结束"</span> + Thread.currentThread().getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="返回Future"><a href="#返回Future" class="headerlink" title="返回Future"></a>返回Future</h2><p>异步调用返回数据，Future表示在未来某个点获取执行结果，返回数据类型可以自定义</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Async</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Future&lt;String&gt; <span class="title">dealHaveReturnTask</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">    log.info(<span class="string">"asyncInvokeReturnFuture, parementer="</span> + i);</span><br><span class="line">    Future&lt;String&gt; future;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        Thread.sleep(<span class="number">1000</span> * i);</span><br><span class="line">        future = <span class="keyword">new</span> AsyncResult&lt;String&gt;(<span class="string">"success:"</span> + i);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">        future = <span class="keyword">new</span> AsyncResult&lt;String&gt;(<span class="string">"error"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> future;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>以上的异步方法和普通的方法调用相同：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Future&lt;String&gt; future = asyncDemo.asyncInvokeReturnFuture(<span class="number">100</span>);</span><br><span class="line">System.out.println(future.get());</span><br></pre></td></tr></table></figure>

<h2 id="异常处理"><a href="#异常处理" class="headerlink" title="异常处理"></a>异常处理</h2><p>我们可以实现<code>AsyncConfigurer</code>接口，也可以继承<code>AsyncConfigurerSupport</code>类来实现。</p>
<p>在方法getAsyncExecutor()中创建线程池的时候，必须使用 <code>executor.initialize()</code>，不然在调用时会报线程池未初始化的异常。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableAsync</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AsyncConfig</span> <span class="keyword">implements</span> <span class="title">AsyncConfigurer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Executor <span class="title">getAsyncExecutor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ThreadPoolTaskExecutor executor = <span class="keyword">new</span> ThreadPoolTaskExecutor();</span><br><span class="line">        executor.setCorePoolSize(<span class="number">10</span>);</span><br><span class="line">        executor.setMaxPoolSize(<span class="number">100</span>);</span><br><span class="line">        executor.setQueueCapacity(<span class="number">100</span>);</span><br><span class="line">        executor.setWaitForTasksToCompleteOnShutdown(<span class="keyword">true</span>);</span><br><span class="line">        executor.setAwaitTerminationSeconds(<span class="number">60</span> * <span class="number">10</span>);</span><br><span class="line">        executor.setThreadNamePrefix(<span class="string">"AsyncThread-"</span>);</span><br><span class="line">        executor.initialize(); <span class="comment">//如果不初始化，导致找到不到执行器</span></span><br><span class="line">        <span class="keyword">return</span> executor;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> AsyncUncaughtExceptionHandler <span class="title">getAsyncUncaughtExceptionHandler</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> AsyncExceptionHandler();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>异步异常处理类：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AsyncExceptionHandler</span> <span class="keyword">implements</span> <span class="title">AsyncUncaughtExceptionHandler</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger log = LoggerFactory.getLogger(AsyncExceptionHandler<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleUncaughtException</span><span class="params">(Throwable ex, Method method, Object... params)</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">"Async method has uncaught exception, params: "</span> + params);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (ex <span class="keyword">instanceof</span> AsyncException) &#123;</span><br><span class="line">            AsyncException asyncException = (AsyncException) ex;</span><br><span class="line">            log.info(<span class="string">"asyncException:"</span>  + asyncException.getMsg());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        log.error(<span class="string">"Exception :"</span>, ex);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>异步处理异常类：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AsyncException</span> <span class="keyword">extends</span> <span class="title">Exception</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> code;</span><br><span class="line">    <span class="keyword">private</span> String msg;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCode</span><span class="params">(<span class="keyword">int</span> code)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.code = code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getMsg</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> msg;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMsg</span><span class="params">(String msg)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.msg = msg;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在调用方法时，可能出现方法中抛出异常的情况。Spring对于2种异步方法的异常处理机制如下：</p>
<ol>
<li>对于方法返回值是Futrue的异步方法: a) 在调用future的get时捕获异常; b) 在异常方法中直接捕获异常</li>
<li>对于返回值是void的异步方法：通过<code>AsyncUncaughtExceptionHandler</code>处理异常</li>
</ol>
<h2 id="测试代码"><a href="#测试代码" class="headerlink" title="测试代码"></a>测试代码</h2><p>最后写个测试代码看看是否跟预期一致：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 测试异步任务</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RunWith</span>(SpringRunner<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">@<span class="title">SpringBootTest</span></span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">ApplicationTests</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger log = LoggerFactory.getLogger(ApplicationTests<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AsyncTask asyncTask;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAsync</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException, ExecutionException </span>&#123;</span><br><span class="line">        asyncTask.dealNoReturnTask();</span><br><span class="line">        Future&lt;String&gt; f = asyncTask.dealHaveReturnTask(<span class="number">5</span>);</span><br><span class="line">        log.info(<span class="string">"主线程执行finished"</span>);</span><br><span class="line">        log.info(f.get());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>执行日志如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">INFO 4180 --- [           main] com.xncoding.pos.ApplicationTests         : 主线程执行finished</span><br><span class="line">INFO 4180 --- [  AsyncThread-2] com.xncoding.pos.async.AsyncTask          : asyncInvokeReturnFuture, parementer&#x3D;5</span><br><span class="line">INFO 4180 --- [  AsyncThread-1] com.xncoding.pos.async.AsyncTask          : 返回值为void的异步调用开始AsyncThread-1</span><br><span class="line">INFO 4180 --- [  AsyncThread-1] com.xncoding.pos.async.AsyncTask          : 返回值为void的异步调用结束AsyncThread-1</span><br><span class="line">INFO 4180 --- [           main] com.xncoding.pos.ApplicationTests         : success:5</span><br><span class="line">INFO 4180 --- [       Thread-4] o.s.w.c.s.GenericWebApplicationContext   : Closing ....</span><br><span class="line">INFO 4180 --- [       Thread-4] com.alibaba.druid.pool.DruidDataSource   : &#123;dataSource-1&#125; closed</span><br></pre></td></tr></table></figure>

<p>根据日志的线程名称很清楚的看出，每个异步方法在线程池的不同线程中执行。</p>
<h2 id="FAQ"><a href="#FAQ" class="headerlink" title="FAQ"></a>FAQ</h2><p>实际运行中，还出现过一个问题，一个Service中的方法调用自己的另一个方法，然后我将这个方法加上@Async注解，然而并不起作用。 异步方法都应该放到单独的异步任务Bean里面去，然后将这个Bean注入到Service中即可。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DeviceService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> AsyncTask asyncTask;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">unbind</span><span class="params">(Integer id, ManagerInfo managerInfo)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 前面省略...</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 开始异步推送消息</span></span><br><span class="line">        asyncTask.pushUnbindMsg(managerInfo, pos, location);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="GitHub源码"><a href="#GitHub源码" class="headerlink" title="GitHub源码"></a>GitHub源码</h2><p><a href="https://github.com/yidao620c/SpringBootBucket/tree/master/springboot-async" target="_blank" rel="noopener">springboot-async</a>   —已测试</p>
<h2 id="来源"><a href="#来源" class="headerlink" title="来源"></a>来源</h2><p><a href="https://www.xncoding.com/" target="_blank" rel="noopener">https://www.xncoding.com/</a></p>
]]></content>
      <categories>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>springboot</tag>
        <tag>async</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBoot系列 - 批处理</title>
    <url>/2020/06/08/SpringBoot%E7%B3%BB%E5%88%97-%E6%89%B9%E5%A4%84%E7%90%86/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="SpringBoot系列-批处理"><a href="#SpringBoot系列-批处理" class="headerlink" title="SpringBoot系列 - 批处理"></a>SpringBoot系列 - 批处理</h1><p>Spring Batch是一个轻量级的框架,完全面向Spring的批处理框架,用于企业级大量的数据读写处理系统。以POJO和Spring 框架为基础， 包括日志记录/跟踪，事务管理、 作业处理统计工作重新启动、跳过、资源管理等功能。</p>
<p>Spring Batch官网是这样介绍的自己：一款轻量的、全面的批处理框架，用于开发强大的日常运营的企业级批处理应用程序。</p>
<p>框架主要有以下功能：</p>
<ul>
<li>Transaction management（事务管理）</li>
<li>Chunk based processing（基于块的处理）</li>
<li>Declarative I/O（声明式的输入输出）</li>
<li>Start/Stop/Restart（启动/停止/再启动）</li>
<li>Retry/Skip（重试/跳过）</li>
</ul>
<p>如果你的批处理程序需要使用上面的功能，那就大胆地使用它吧。</p>
<h2 id="框架介绍"><a href="#框架介绍" class="headerlink" title="框架介绍"></a>框架介绍</h2><p>先用一个图让你有一个大概印象，这个东西是什么：</p>
<p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591544341-a776ee194e582070b8185676b40dc425.png" alt=""></p>
<p>框架一共有5个主要角色：</p>
<ol>
<li>JobRepository是用户注册Job的容器，就是存储数据的地方，可以看做是一个数据库的接口，在任务执行的时候需要通过它来记录任务状态等等信息。</li>
<li>JobLauncher是任务启动器，通过它来启动任务，可以看做是程序的入口。</li>
<li>Job代表着一个具体的任务。</li>
<li>Step代表着一个具体的步骤，一个Job可以包含多个Step（想象把大象放进冰箱这个任务需要多少个步骤你就明白了）。</li>
<li>Item就是输出-&gt;处理-&gt;输出，一个完整Step流程。</li>
</ol>
<p>下面简要的介绍一下这5个角色</p>
<h3 id="JobRepository"><a href="#JobRepository" class="headerlink" title="JobRepository"></a>JobRepository</h3><p>JobRepository用于存储任务执行的状态信息，比如什么时间点执行了什么任务、任务执行结果如何等等。 框架提供了2种实现，一种是通过Map形式保存在内存中，当Java程序重启后任务信息也就丢失了， 并且在分布式下无法获取其他节点的任务执行情况；另一种是保存在数据库中，并且将数据保存在下面6张表里：</p>
<ul>
<li>BATCH_JOB_INSTANCE</li>
<li>BATCH_JOB_EXECUTION_PARAMS</li>
<li>BATCH_JOB_EXECUTION</li>
<li>BATCH_STEP_EXECUTION</li>
<li>BATCH_JOB_EXECUTION_CONTEXT</li>
<li>BATCH_STEP_EXECUTION_CONTEXT</li>
</ul>
<p>Spring Batch框架的JobRepository支持主流的数据库：DB2、Derby、H2、HSQLDB、MySQL、Oracle、PostgreSQL、SQLServer、Sybase。</p>
<h3 id="JobLauncher"><a href="#JobLauncher" class="headerlink" title="JobLauncher"></a>JobLauncher</h3><p>JobLauncher是任务启动器，该接口只有一个run方法：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">JobLauncher</span> </span>&#123;</span><br><span class="line">    <span class="function">JobExecution <span class="title">run</span><span class="params">(Job job, JobParameters jobParameters)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>除了传入Job对象之外，还需要传入JobParameters对象，后续讲到Job再解释为什么要多传一个JobParameters。 通过JobLauncher可以在Java程序中调用批处理任务，也可以通过命令行或者其他框架 （如定时调度框架Quartz、Web后台框架Spring MVC）中调用批处理任务。 Spring Batch框架提供了一个JobLauncher的实现类SimpleJobLauncher。</p>
<h3 id="Job"><a href="#Job" class="headerlink" title="Job"></a>Job</h3><p>Job代表着一个任务，一个Job与一个或者多个JobInstance相关联，而一个JobInstance又与一个或者多个JobExecution相关联：</p>
<p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591544341-f1831bc0d4a68903ca1e0ae13a161461.png" alt=""></p>
<p>考虑到任务可能不是只执行一次就再也不执行了，更多的情况可能是定时任务，如每天执行一次，每个星期执行一次等等， 那么为了区分每次执行的任务，框架使用了JobInstance。如上图所示，Job是一个EndOfDay（每天最后时刻执行的任务）， 那么其中一个JobInstance就代表着2007年5月5日那天执行的任务实例。 框架通过在执行JobLauncher.run(Job, JobParameters)方法时传入的JobParameters来区分是哪一天的任务。</p>
<p>由于2007年5月5日那天执行的任务可能不会一次就执行完成，比如中途被停止，或者出现异常导致中断， 需要多执行几次才能完成，所以框架使用了JobExecution来表示每次执行的任务。</p>
<h3 id="Step"><a href="#Step" class="headerlink" title="Step"></a>Step</h3><p>一个Job任务可以分为几个Step步骤，与JobExection相同，每次执行Step的时候使用StepExecution来表示执行的步骤。 每一个Step还包含着一个ItemReader、ItemProcessor、ItemWriter，下面分别介绍这三者。</p>
<p><strong>ItemReader</strong></p>
<p>ItemReader代表着读操作，其接口如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ItemReader</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function">T <span class="title">read</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>框架已经提供了多种ItemReader接口的实现类，包括对文本文件、CSV文件、XML文件、数据库、JMS消息等读的处理，当然我们也可以自己实现该接口。</p>
<p><strong>ItemProcessor</strong></p>
<p>ItemReader代表着处理操作，其接口如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ItemProcessor</span>&lt;<span class="title">I</span>, <span class="title">O</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function">O <span class="title">process</span><span class="params">(I item)</span> <span class="keyword">throws</span> Exception</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>process方法的形参传入I类型的对象，通过处理后返回O型的对象。开发者可以实现自己的业务代码来对数据进行处理。</p>
<p><strong>ItemWriter</strong></p>
<p>ItemReader代表着写操作，其接口如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ItemWriter</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">write</span><span class="params">(List&lt;? extends T&gt; items)</span> <span class="keyword">throws</span> Exception</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>框架已经提供了多种ItemWriter接口的实现类，包括对文本文件、CSV文件、XML文件、数据库、JMS消息等写的处理，当然我们也可以自己实现该接口。</p>
<h3 id="Job监听器"><a href="#Job监听器" class="headerlink" title="Job监听器"></a>Job监听器</h3><p>还可以自定义任务监听器，在任务启动和完成之后进行相应的通知和响应。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 监听器实现JobExecutionListener接口，并重写其beforeJob，afterJob方法即可</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyJobListener</span> <span class="keyword">implements</span> <span class="title">JobExecutionListener</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">beforeJob</span><span class="params">(JobExecution jobExecution)</span> </span>&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterJob</span><span class="params">(JobExecution jobExecution)</span> </span>&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="数据校验"><a href="#数据校验" class="headerlink" title="数据校验"></a>数据校验</h3><p>我们可以JSR-303(主要实现由hibernate-validator)的注解，来校验ItemReader读取到的数据是否满足要求。</p>
<p>首先让我们的ItemProcessor实现ValidatingItemProcessor接口：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyItemProcessor</span> <span class="keyword">extends</span> <span class="title">ValidatingItemProcessor</span>&lt;<span class="title">User</span>&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">process</span><span class="params">(User item)</span> <span class="keyword">throws</span> ValidationException </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.process(item);</span><br><span class="line">        <span class="keyword">return</span> item;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后定义自己的校验器，实现的Validator接口来自于Spring，我们将使用JSR-303的Validator来校验：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBeanValidator</span>&lt;<span class="title">T</span>&gt; <span class="keyword">implements</span> <span class="title">Validator</span>&lt;<span class="title">T</span>&gt;,<span class="title">InitializingBean</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Validator validator;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterPropertiesSet</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">validate</span><span class="params">(T value)</span><span class="keyword">throws</span> ValidationException</span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在定义我们的MyItemProcessor时必须将MyBeanValidator设置进去，代码如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ItemProcessor&lt;User,User&gt; <span class="title">processor</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">//新建ItemProcessor接口的实现类返回</span></span><br><span class="line">    MyItemProcessor processor = <span class="keyword">new</span> MyItemProcessor();</span><br><span class="line">    processor.setValidator(myBeanValidator());</span><br><span class="line">    <span class="keyword">return</span> processor;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Validator&lt;User&gt; <span class="title">myBeanValidator</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> MyBeanValidator&lt;User&gt;();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="SpringBoot集成实例"><a href="#SpringBoot集成实例" class="headerlink" title="SpringBoot集成实例"></a>SpringBoot集成实例</h2><p>Spring Boot对Spring Batch支持的源码位于<code>org.springframework.boot.autoconfigure.batch</code>下。</p>
<p>Spring Boot为我们自动初始化了Spring Batch存储批处理记录的数据库，且当我们程序启动时， 会自动执行我们定义的Job的Bean，不过我们可以通过配置定时器或手动触发方式启动。</p>
<p>Spring Boot提供如下属性来定制Spring Batch：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#启动时要执行的job，默认执行全部job</span><br><span class="line">spring.batch.job.name&#x3D;job1,job2</span><br><span class="line">#是否自动执行定义的job，默认是</span><br><span class="line">spring.batch.job.enabled&#x3D;true</span><br><span class="line">#是否初始化Spring Batch的数据库，默认为是</span><br><span class="line">spring.batch.initializer.enabled&#x3D;true</span><br><span class="line">spring.batch.schema&#x3D;</span><br><span class="line">#设置Spring Batch的数据库表的前缀</span><br><span class="line">spring.batch.table-prefix&#x3D;</span><br></pre></td></tr></table></figure>

<p>下面通过一个真实的例子，需要将客户导过来的csv文件导入到我们的业务Oracle数据库中，来说明怎样在SpringBoot中使用批处理框架。</p>
<h3 id="添加maven依赖"><a href="#添加maven依赖" class="headerlink" title="添加maven依赖"></a>添加maven依赖</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-batch<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.hsqldb<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hsqldb<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--添加hibernate-validator依赖，作为数据校验使用--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.hibernate.validator<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hibernate-validator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>6.0.7.Final<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.validation<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>validation-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.1.Final<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.el<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.el-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.1-b04<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.glassfish.web<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.el<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--添加hibernate-validator依赖 END--&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- Oracle驱动包 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.oracle<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>ojdbc6<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>11.2.0.4.0-atlassian-hosted<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="配置application-yml"><a href="#配置application-yml" class="headerlink" title="配置application.yml"></a>配置application.yml</h3><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment">###################  spring配置  ###################</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">dev</span></span><br><span class="line">  <span class="attr">batch:</span></span><br><span class="line">    <span class="attr">job:</span></span><br><span class="line">      <span class="attr">enabled:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">oracle.jdbc.driver.OracleDriver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:oracle:thin:@xxx.xxx.xxx.xxx:1521:orcl11g</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">adm_real</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">adm_real</span></span><br></pre></td></tr></table></figure>

<p>真实csv数据，位于<code>src/main/resources/NT_BSC_BUDGETVTOLL.csv</code>中</p>
<p>表定义如下：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">"ADM_REAL"</span>.<span class="string">"NT_BSC_BUDGETVTOLL"</span> (</span><br><span class="line">    <span class="string">"F_ID"</span> <span class="built_in">VARCHAR2</span>(<span class="number">100</span> <span class="keyword">BYTE</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> ,</span><br><span class="line">    <span class="string">"F_YEAR"</span> <span class="built_in">VARCHAR2</span>(<span class="number">4</span> <span class="keyword">BYTE</span>) <span class="literal">NULL</span> ,</span><br><span class="line">    <span class="string">"F_TOLLID"</span> <span class="built_in">VARCHAR2</span>(<span class="number">50</span> <span class="keyword">BYTE</span>) <span class="literal">NULL</span> ,</span><br><span class="line">    <span class="string">"F_BUDGETID"</span> <span class="built_in">VARCHAR2</span>(<span class="number">50</span> <span class="keyword">BYTE</span>) <span class="literal">NULL</span> ,</span><br><span class="line">    <span class="string">"F_CBUDGETID"</span> <span class="built_in">VARCHAR2</span>(<span class="number">50</span> <span class="keyword">BYTE</span>) <span class="literal">NULL</span> ,</span><br><span class="line">    <span class="string">"F_VERSION"</span> <span class="built_in">VARCHAR2</span>(<span class="number">1</span> <span class="keyword">BYTE</span>) <span class="keyword">DEFAULT</span> <span class="string">'1'</span>  <span class="literal">NULL</span> ,</span><br><span class="line">    <span class="string">"F_AUDITMSG"</span> <span class="built_in">VARCHAR2</span>(<span class="number">100</span> <span class="keyword">BYTE</span>) <span class="literal">NULL</span> ,</span><br><span class="line">    <span class="string">"F_TRIALSTATUS"</span> <span class="built_in">VARCHAR2</span>(<span class="number">1</span> <span class="keyword">BYTE</span>) <span class="keyword">DEFAULT</span> <span class="string">'0'</span>  <span class="literal">NULL</span> ,</span><br><span class="line">    <span class="string">"F_FIRAUDITER"</span> <span class="built_in">VARCHAR2</span>(<span class="number">50</span> <span class="keyword">BYTE</span>) <span class="literal">NULL</span> ,</span><br><span class="line">    <span class="string">"F_FIRAUDITTIME"</span> <span class="built_in">VARCHAR2</span>(<span class="number">20</span> <span class="keyword">BYTE</span>) <span class="literal">NULL</span> ,</span><br><span class="line">    <span class="string">"F_FINAUDITER"</span> <span class="built_in">VARCHAR2</span>(<span class="number">50</span> <span class="keyword">BYTE</span>) <span class="literal">NULL</span> ,</span><br><span class="line">    <span class="string">"F_FINAUDITTIME"</span> <span class="built_in">VARCHAR2</span>(<span class="number">64</span> <span class="keyword">BYTE</span>) <span class="literal">NULL</span> ,</span><br><span class="line">    <span class="string">"F_EDITTIME"</span> <span class="built_in">VARCHAR2</span>(<span class="number">64</span> <span class="keyword">BYTE</span>) <span class="literal">NULL</span> ,</span><br><span class="line">    <span class="string">"F_STARTDATE"</span> <span class="built_in">VARCHAR2</span>(<span class="number">8</span> <span class="keyword">BYTE</span>) <span class="literal">NULL</span> ,</span><br><span class="line">    <span class="string">"F_ENDDATE"</span> <span class="built_in">VARCHAR2</span>(<span class="number">8</span> <span class="keyword">BYTE</span>) <span class="literal">NULL</span> ,</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h3 id="领域模型类"><a href="#领域模型类" class="headerlink" title="领域模型类"></a>领域模型类</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BudgetVtoll</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line">    <span class="keyword">private</span> String year;</span><br><span class="line">    <span class="keyword">private</span> String tollid;</span><br><span class="line">    <span class="keyword">private</span> String budgetid;</span><br><span class="line">    <span class="keyword">private</span> String cbudgetid;</span><br><span class="line">    <span class="keyword">private</span> String version;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 使用JSR-303注解来校验数据</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Size</span>(max = <span class="number">100</span>)</span><br><span class="line">    <span class="keyword">private</span> String auditmsg;</span><br><span class="line">    <span class="keyword">private</span> String trialstatus;</span><br><span class="line">    <span class="keyword">private</span> String firauditer;</span><br><span class="line">    <span class="keyword">private</span> String firaudittime;</span><br><span class="line">    <span class="keyword">private</span> String finauditer;</span><br><span class="line">    <span class="keyword">private</span> String finaudittime;</span><br><span class="line">    <span class="keyword">private</span> String edittime;</span><br><span class="line">    <span class="keyword">private</span> String startdate;</span><br><span class="line">    <span class="keyword">private</span> String enddate;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 下面省略get/set方法</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="数据处理及校验"><a href="#数据处理及校验" class="headerlink" title="数据处理及校验"></a>数据处理及校验</h3><p>定义处理器</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CsvItemProcessor</span> <span class="keyword">extends</span> <span class="title">ValidatingItemProcessor</span>&lt;<span class="title">BudgetVtoll</span>&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> BudgetVtoll <span class="title">process</span><span class="params">(BudgetVtoll item)</span> <span class="keyword">throws</span> ValidationException </span>&#123;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * 需要执行super.process(item)才会调用自定义校验器</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">super</span>.process(item);</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * 对数据进行简单的处理和转换 todo</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">return</span> item;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>校验器定义：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CsvBeanValidator</span>&lt;<span class="title">T</span>&gt; <span class="keyword">implements</span> <span class="title">Validator</span>&lt;<span class="title">T</span>&gt;, <span class="title">InitializingBean</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> javax.validation.Validator validator;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">validate</span><span class="params">(T value)</span> <span class="keyword">throws</span> ValidationException </span>&#123;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * 使用Validator的validate方法校验数据</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        Set&lt;ConstraintViolation&lt;T&gt;&gt; constraintViolations = validator.validate(value);</span><br><span class="line">        <span class="keyword">if</span> (constraintViolations.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            StringBuilder message = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">            <span class="keyword">for</span> (ConstraintViolation&lt;T&gt; constraintViolation : constraintViolations) &#123;</span><br><span class="line">                message.append(constraintViolation.getMessage()).append(<span class="string">"\n"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ValidationException(message.toString());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 使用JSR-303的Validator来校验我们的数据，在此进行JSR-303的Validator的初始化</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterPropertiesSet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ValidatorFactory validatorFactory = Validation.buildDefaultValidatorFactory();</span><br><span class="line">        validator = validatorFactory.usingContext().getValidator();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="任务监听器"><a href="#任务监听器" class="headerlink" title="任务监听器"></a>任务监听器</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CsvJobListener</span> <span class="keyword">implements</span> <span class="title">JobExecutionListener</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Logger logger = LoggerFactory.getLogger(<span class="keyword">this</span>.getClass());</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> startTime;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> endTime;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">beforeJob</span><span class="params">(JobExecution jobExecution)</span> </span>&#123;</span><br><span class="line">        startTime = System.currentTimeMillis();</span><br><span class="line">        logger.info(<span class="string">"任务处理开始"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterJob</span><span class="params">(JobExecution jobExecution)</span> </span>&#123;</span><br><span class="line">        endTime = System.currentTimeMillis();</span><br><span class="line">        logger.info(<span class="string">"任务处理结束，总耗时="</span> + (endTime - startTime) + <span class="string">"ms"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="配置类"><a href="#配置类" class="headerlink" title="配置类"></a>配置类</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableBatchProcessing</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CsvBatchConfig</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ItemReader定义,用来读取数据</span></span><br><span class="line"><span class="comment">     * 1，使用FlatFileItemReader读取文件</span></span><br><span class="line"><span class="comment">     * 2，使用FlatFileItemReader的setResource方法设置csv文件的路径</span></span><br><span class="line"><span class="comment">     * 3，对此对cvs文件的数据和领域模型类做对应映射</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> FlatFileItemReader</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@StepScope</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> FlatFileItemReader&lt;BudgetVtoll&gt; <span class="title">reader</span><span class="params">(@Value(<span class="string">"#&#123;jobParameters['input.file.name']&#125;"</span>)</span> String pathToFile) </span>&#123;</span><br><span class="line">        FlatFileItemReader&lt;BudgetVtoll&gt; reader = <span class="keyword">new</span> FlatFileItemReader&lt;&gt;();</span><br><span class="line">        <span class="comment">// reader.setResource(new ClassPathResource(pathToFile));</span></span><br><span class="line">        reader.setResource(<span class="keyword">new</span> FileSystemResource(pathToFile));</span><br><span class="line">        reader.setLineMapper(<span class="keyword">new</span> DefaultLineMapper&lt;BudgetVtoll&gt;() &#123;</span><br><span class="line">            &#123;</span><br><span class="line">                setLineTokenizer(<span class="keyword">new</span> DelimitedLineTokenizer(<span class="string">","</span>) &#123;</span><br><span class="line">                    &#123;</span><br><span class="line">                        setNames(<span class="keyword">new</span> String[]&#123;</span><br><span class="line">                                <span class="string">"id"</span>,<span class="string">"year"</span>,<span class="string">"tollid"</span>,<span class="string">"budgetid"</span>, <span class="string">"cbudgetid"</span>, <span class="string">"version"</span>, <span class="string">"auditmsg"</span>, <span class="string">"trialstatus"</span>,</span><br><span class="line">                                <span class="string">"firauditer"</span>, <span class="string">"firaudittime"</span>, <span class="string">"finauditer"</span>, <span class="string">"finaudittime"</span>, <span class="string">"edittime"</span>, <span class="string">"startdate"</span>, <span class="string">"enddate"</span></span><br><span class="line">                        &#125;);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">                setFieldSetMapper(<span class="keyword">new</span> BeanWrapperFieldSetMapper&lt;BudgetVtoll&gt;() &#123;</span><br><span class="line">                    &#123;</span><br><span class="line">                        setTargetType(BudgetVtoll<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> reader;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ItemProcessor定义，用来处理数据</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ItemProcessor&lt;BudgetVtoll, BudgetVtoll&gt; <span class="title">processor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//使用我们自定义的ItemProcessor的实现CsvItemProcessor</span></span><br><span class="line">        CsvItemProcessor processor = <span class="keyword">new</span> CsvItemProcessor();</span><br><span class="line">        <span class="comment">//为processor指定校验器为CsvBeanValidator()</span></span><br><span class="line">        processor.setValidator(csvBeanValidator());</span><br><span class="line">        <span class="keyword">return</span> processor;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ItemWriter定义，用来输出数据</span></span><br><span class="line"><span class="comment">     * spring能让容器中已有的Bean以参数的形式注入，Spring Boot已经为我们定义了dataSource</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> dataSource</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ItemWriter&lt;BudgetVtoll&gt; <span class="title">writer</span><span class="params">(DruidDataSource dataSource)</span> </span>&#123;</span><br><span class="line">        JdbcBatchItemWriter&lt;BudgetVtoll&gt; writer = <span class="keyword">new</span> JdbcBatchItemWriter&lt;&gt;();</span><br><span class="line">        <span class="comment">//我们使用JDBC批处理的JdbcBatchItemWriter来写数据到数据库</span></span><br><span class="line">        writer.setItemSqlParameterSourceProvider(<span class="keyword">new</span> BeanPropertyItemSqlParameterSourceProvider&lt;&gt;());</span><br><span class="line"></span><br><span class="line">        String sql = <span class="string">"insert into BudgetVtoll "</span> + <span class="string">" (f_id,f_year,f_tollid,f_budgetid,f_cbudgetid,f_version,f_auditmsg,f_trialstatus,f_firauditer,f_firaudittime,f_finauditer,f_finaudittime,f_edittime,f_startdate,f_enddate) "</span></span><br><span class="line">                + <span class="string">" values(:id,:year,:tollid,:budgetid,:cbudgetid,:version,:auditmsg,:trialstatus,:firauditer,:firaudittime,:finauditer,:finaudittime,:edittime,:startdate,:enddate)"</span>;</span><br><span class="line">        <span class="comment">//在此设置要执行批处理的SQL语句</span></span><br><span class="line">        writer.setSql(sql);</span><br><span class="line">        writer.setDataSource(dataSource);</span><br><span class="line">        <span class="keyword">return</span> writer;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * JobRepository，用来注册Job的容器</span></span><br><span class="line"><span class="comment">     * jobRepositor的定义需要dataSource和transactionManager，Spring Boot已为我们自动配置了</span></span><br><span class="line"><span class="comment">     * 这两个类，Spring可通过方法注入已有的Bean</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> dataSource</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> transactionManager</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> JobRepository <span class="title">jobRepository</span><span class="params">(DruidDataSource dataSource, PlatformTransactionManager transactionManager)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">        JobRepositoryFactoryBean jobRepositoryFactoryBean = <span class="keyword">new</span> JobRepositoryFactoryBean();</span><br><span class="line">        jobRepositoryFactoryBean.setDataSource(dataSource);</span><br><span class="line">        jobRepositoryFactoryBean.setTransactionManager(transactionManager);</span><br><span class="line">        jobRepositoryFactoryBean.setDatabaseType(String.valueOf(DatabaseType.ORACLE));</span><br><span class="line">        <span class="comment">// 下面事务隔离级别的配置是针对Oracle的</span></span><br><span class="line">        jobRepositoryFactoryBean.setIsolationLevelForCreate(<span class="string">"ISOLATION_READ_COMMITTED"</span>);</span><br><span class="line">        jobRepositoryFactoryBean.afterPropertiesSet();</span><br><span class="line">        <span class="keyword">return</span> jobRepositoryFactoryBean.getObject();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * JobLauncher定义，用来启动Job的接口</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> dataSource</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> transactionManager</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> SimpleJobLauncher <span class="title">jobLauncher</span><span class="params">(DruidDataSource dataSource, PlatformTransactionManager transactionManager)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        SimpleJobLauncher jobLauncher = <span class="keyword">new</span> SimpleJobLauncher();</span><br><span class="line">        jobLauncher.setJobRepository(jobRepository(dataSource, transactionManager));</span><br><span class="line">        <span class="keyword">return</span> jobLauncher;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Job定义，我们要实际执行的任务，包含一个或多个Step</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> jobBuilderFactory</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> s1</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Job <span class="title">importJob</span><span class="params">(JobBuilderFactory jobBuilderFactory, Step s1)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> jobBuilderFactory.get(<span class="string">"importJob"</span>)</span><br><span class="line">                .incrementer(<span class="keyword">new</span> RunIdIncrementer())</span><br><span class="line">                .flow(s1)<span class="comment">//为Job指定Step</span></span><br><span class="line">                .end()</span><br><span class="line">                .listener(csvJobListener())<span class="comment">//绑定监听器csvJobListener</span></span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * step步骤，包含ItemReader，ItemProcessor和ItemWriter</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> stepBuilderFactory</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> reader</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> writer</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> processor</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Step <span class="title">step1</span><span class="params">(StepBuilderFactory stepBuilderFactory, ItemReader&lt;BudgetVtoll&gt; reader, ItemWriter&lt;BudgetVtoll&gt; writer,</span></span></span><br><span class="line"><span class="function"><span class="params">                      ItemProcessor&lt;BudgetVtoll, BudgetVtoll&gt; processor)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> stepBuilderFactory</span><br><span class="line">                .get(<span class="string">"step1"</span>)</span><br><span class="line">                .&lt;BudgetVtoll, BudgetVtoll&gt;chunk(<span class="number">65000</span>)<span class="comment">//批处理每次提交65000条数据</span></span><br><span class="line">                .reader(reader)<span class="comment">//给step绑定reader</span></span><br><span class="line">                .processor(processor)<span class="comment">//给step绑定processor</span></span><br><span class="line">                .writer(writer)<span class="comment">//给step绑定writer</span></span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CsvJobListener <span class="title">csvJobListener</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> CsvJobListener();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Validator&lt;BudgetVtoll&gt; <span class="title">csvBeanValidator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> MyBeanValidator&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意，在定义Job的时候，我通过<code>@StepScope</code>注解，可以通过传递参数的方式将csv文件路径传进去。</p>
<h3 id="测试类"><a href="#测试类" class="headerlink" title="测试类"></a>测试类</h3><p>最后再让我们写个测试类看看能不能成功：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RunWith</span>(SpringRunner<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">@<span class="title">SpringBootTest</span>(<span class="title">classes</span> </span>= Application<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">BatchServiceTest</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Logger logger = LoggerFactory.getLogger(<span class="keyword">this</span>.getClass());</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JobLauncher jobLauncher;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> Job importJob;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testBatch1</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        JobParameters jobParameters = <span class="keyword">new</span> JobParametersBuilder()</span><br><span class="line">                .addLong(<span class="string">"time"</span>, System.currentTimeMillis())</span><br><span class="line">                .addString(<span class="string">"input.file.name"</span>, <span class="string">"E:\\NT_BSC_BUDGETVTOLL.csv"</span>)</span><br><span class="line">                .toJobParameters();</span><br><span class="line">        jobLauncher.run(importJob, jobParameters);</span><br><span class="line">        logger.info(<span class="string">"testBatch1执行完成"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>把csv文件放入resources/目录下面，然后执行测试。看看输出结果：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">: Job: [FlowJob: [name&#x3D;importJob]] launched with the following parameters: [&#123;time&#x3D;1517654976174, input.file.name&#x3D;E:\NT_BSC_BUDGETVTOLL.csv&#125;]</span><br><span class="line">: 任务处理开始</span><br><span class="line">: Executing step: [step1]</span><br><span class="line">: 任务处理结束，总耗时&#x3D;810ms</span><br><span class="line">: Job: [FlowJob: [name&#x3D;importJob]] completed with the following parameters: [&#123;time&#x3D;1517654976174, input.file.name&#x3D;E:\NT_BSC_BUDGETVTOLL.csv&#125;] and the following status: [COMPLETED]</span><br><span class="line">: testBatch1执行完成</span><br></pre></td></tr></table></figure>

<p>再去查看数据库里面的数据，已经正常写入了。</p>
<p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591544341-fad499fdc2f2364e7ef7a66409492f41.png" alt=""></p>
<h2 id="并发执行多个Job"><a href="#并发执行多个Job" class="headerlink" title="并发执行多个Job"></a>并发执行多个Job</h2><p>SpringBatch批处理框架默认使用单线程完成所有任务的执行，官方推荐配置任务执行器来并发执行， 提高批处理的效率。</p>
<p>Spring Core 为我们提供了多种执行器实现（包括多种异步执行器），我们可以根据实际情况灵活选择使用。</p>
<table>
<thead>
<tr>
<th>类名</th>
<th>描述</th>
<th>是否异步</th>
</tr>
</thead>
<tbody><tr>
<td>SyncTaskExecutor</td>
<td>简单同步执行器</td>
<td>否</td>
</tr>
<tr>
<td>SimpleAsyncTaskExecutor</td>
<td>简单异步执行器，提供最基本的异步实现</td>
<td>是</td>
</tr>
<tr>
<td>WorkManagerTaskExecutor</td>
<td>该类作为通过 JCA 规范进行任务执行的实现</td>
<td>是</td>
</tr>
<tr>
<td>ThreadPoolTaskExecutor</td>
<td>线程池任务执行器</td>
<td>是</td>
</tr>
</tbody></table>
<p>配置线程池执行Job：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ThreadPoolTaskExecutor <span class="title">taskExecutor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ThreadPoolTaskExecutor taskExecutor = <span class="keyword">new</span> ThreadPoolTaskExecutor();</span><br><span class="line">    taskExecutor.setCorePoolSize(<span class="number">5</span>);</span><br><span class="line">    taskExecutor.setMaxPoolSize(<span class="number">10</span>);</span><br><span class="line">    taskExecutor.setQueueCapacity(<span class="number">200</span>);</span><br><span class="line">    <span class="keyword">return</span> taskExecutor;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> SimpleJobLauncher <span class="title">jobLauncher</span><span class="params">(ThreadPoolTaskExecutor taskExecutor, DruidDataSource dataSource,</span></span></span><br><span class="line"><span class="function"><span class="params">                                     PlatformTransactionManager transactionManager)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    SimpleJobLauncher jobLauncher = <span class="keyword">new</span> SimpleJobLauncher();</span><br><span class="line">    jobLauncher.setTaskExecutor(taskExecutor);</span><br><span class="line">    jobLauncher.setJobRepository(jobRepository(dataSource, transactionManager));</span><br><span class="line">    <span class="keyword">return</span> jobLauncher;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>重点是上面的那句<code>jobLauncher.setTaskExecutor(taskExecutor);</code></p>
<p>这里的并发表示的是执行不同的Job使用线程池，每个Job实例会分配一个线程去执行。这个是最推荐的做法。</p>
<p>如果你还想对单个Job执行逻辑采用多线程，可以再Step配置中加入线程池支持，不过需要保证你所有的Step都是线程安全的：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">return</span> stepBuilderFactory</span><br><span class="line">    .get(<span class="string">"logStep1"</span>)</span><br><span class="line">    <span class="comment">//设置每个Job通过并发方式执行，一般来讲一个Job就让它串行完成的好</span></span><br><span class="line">    .taskExecutor(<span class="keyword">new</span> SimpleAsyncTaskExecutor())</span><br><span class="line">    <span class="comment">//并发任务数为 10,默认为4</span></span><br><span class="line">    .throttleLimit(<span class="number">10</span>)</span><br><span class="line">    .build();</span><br></pre></td></tr></table></figure>

<p>这里我通过一个实际例子展示如何编写多个Job并发执行。</p>
<p>还是跟上面例子一样，将csv文件导入到表中，但是这个时候有两个csv文件，我要导入到两张表。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> Z_TEST_APP (</span><br><span class="line">    appid <span class="built_in">INT</span>,</span><br><span class="line">    zname <span class="built_in">VARCHAR2</span> (<span class="number">20</span>),</span><br><span class="line">    flag <span class="built_in">VARCHAR2</span> (<span class="number">2</span>),</span><br><span class="line">    <span class="keyword">CONSTRAINT</span> app_pk PRIMARY <span class="keyword">KEY</span> (appid)</span><br><span class="line"> );</span><br><span class="line"></span><br><span class="line"> <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> Z_TEST_LOG (</span><br><span class="line">    logid <span class="built_in">INT</span>,</span><br><span class="line">    msg <span class="built_in">VARCHAR2</span> (<span class="number">20</span>),</span><br><span class="line">    logtime <span class="built_in">VARCHAR2</span> (<span class="number">8</span>),</span><br><span class="line">    <span class="keyword">CONSTRAINT</span> log_pk PRIMARY <span class="keyword">KEY</span> (logid)</span><br><span class="line"> );</span><br></pre></td></tr></table></figure>

<p>每个类型任务单独创建一个package，然后里面放两个类。以APP为例：</p>
<p>创建一个App类：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> appid;</span><br><span class="line">    <span class="keyword">private</span> String zname;</span><br><span class="line">    <span class="keyword">private</span> String flag;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后创建一个AppConfig类配置任务：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppConfig</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ItemReader定义,用来读取数据</span></span><br><span class="line"><span class="comment">     * 1，使用FlatFileItemReader读取文件</span></span><br><span class="line"><span class="comment">     * 2，使用FlatFileItemReader的setResource方法设置csv文件的路径</span></span><br><span class="line"><span class="comment">     * 3，对此对cvs文件的数据和领域模型类做对应映射</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> FlatFileItemReader</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span>(name = <span class="string">"appReader"</span>)</span><br><span class="line">    <span class="meta">@StepScope</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> FlatFileItemReader&lt;App&gt; <span class="title">reader</span><span class="params">(@Value(<span class="string">"#&#123;jobParameters['input.file.name']&#125;"</span>)</span> String pathToFile) </span>&#123;</span><br><span class="line">        FlatFileItemReader&lt;App&gt; reader = <span class="keyword">new</span> FlatFileItemReader&lt;&gt;();</span><br><span class="line">        reader.setResource(<span class="keyword">new</span> FileSystemResource(pathToFile));</span><br><span class="line">        reader.setLineMapper(<span class="keyword">new</span> DefaultLineMapper&lt;App&gt;() &#123;</span><br><span class="line">            &#123;</span><br><span class="line">                setLineTokenizer(<span class="keyword">new</span> DelimitedLineTokenizer(<span class="string">"|"</span>) &#123;</span><br><span class="line">                    &#123;</span><br><span class="line">                        setNames(<span class="keyword">new</span> String[]&#123;</span><br><span class="line">                                <span class="string">"appid"</span>, <span class="string">"zname"</span>, <span class="string">"flag"</span></span><br><span class="line">                        &#125;);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">                setFieldSetMapper(<span class="keyword">new</span> BeanWrapperFieldSetMapper&lt;App&gt;() &#123;</span><br><span class="line">                    &#123;</span><br><span class="line">                        setTargetType(App<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> reader;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ....后面省略</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意，每个Bean配置都加一个name属性，然后自动注入里面需要通过@Qualifier注解来指定当前类中的Bean， 因为如果不指定name，Spring默认只会初始化一个Bean实例。</p>
<p>比如定义Job：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span>(name = <span class="string">"zappJob"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> Job <span class="title">zappJob</span><span class="params">(JobBuilderFactory jobBuilderFactory, @Qualifier(<span class="string">"zappStep1"</span>)</span> Step s1) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> jobBuilderFactory.get(<span class="string">"zappJob"</span>)</span><br><span class="line">            .incrementer(<span class="keyword">new</span> RunIdIncrementer())</span><br><span class="line">            .flow(s1)<span class="comment">//为Job指定Step</span></span><br><span class="line">            .end()</span><br><span class="line">            .listener(<span class="keyword">new</span> MyJobListener(<span class="string">"App"</span>))<span class="comment">//绑定监听器csvJobListener</span></span><br><span class="line">            .build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>另外一个LOG任务的配置也是同样。</p>
<p>好了，定义完成之后开始写测试方法：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testTwoJobs</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    JobParameters jobParameters1 = <span class="keyword">new</span> JobParametersBuilder()</span><br><span class="line">            .addLong(<span class="string">"time"</span>, System.currentTimeMillis())</span><br><span class="line">            .addString(<span class="string">"input.file.name"</span>, p.getCsvApp())</span><br><span class="line">            .toJobParameters();</span><br><span class="line">    jobLauncher.run(zappJob, jobParameters1);</span><br><span class="line"></span><br><span class="line">    JobParameters jobParameters2 = <span class="keyword">new</span> JobParametersBuilder()</span><br><span class="line">            .addLong(<span class="string">"time"</span>, System.currentTimeMillis())</span><br><span class="line">            .addString(<span class="string">"input.file.name"</span>, p.getCsvLog())</span><br><span class="line">            .toJobParameters();</span><br><span class="line">    jobLauncher.run(zlogJob, jobParameters2);</span><br><span class="line"></span><br><span class="line">    logger.info(<span class="string">"main线程完成"</span>);</span><br><span class="line">    <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">        Thread.sleep(<span class="number">2000000L</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个是运行日志:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[ taskExecutor-1] o.s.b.c.l.support.SimpleJobLauncher      : Job: [FlowJob: [name&#x3D;zappJob]] launched with t</span><br><span class="line">[ taskExecutor-1] com.xncoding.trans.modules.MyJobListener  : 任务-App处理开始</span><br><span class="line">[           main] com.xncoding.service.BatchServiceTest     : main线程完成</span><br><span class="line">[ taskExecutor-2] o.s.b.c.l.support.SimpleJobLauncher      : Job: [FlowJob: [name&#x3D;zlogJob]] launched with t</span><br><span class="line">[ taskExecutor-2] com.xncoding.trans.modules.MyJobListener  : 任务-Log处理开始</span><br><span class="line">[ taskExecutor-1] o.s.batch.core.job.SimpleStepHandler     : Executing step: [zappStep1]</span><br><span class="line">[ taskExecutor-2] o.s.batch.core.job.SimpleStepHandler     : Executing step: [logStep1]</span><br><span class="line">[ taskExecutor-2] com.xncoding.trans.modules.MyJobListener  : 任务-Log处理结束，总耗时&#x3D;495ms</span><br><span class="line">[ taskExecutor-1] com.xncoding.trans.modules.MyJobListener  : 任务-App处理结束，总耗时&#x3D;585ms</span><br><span class="line">[ taskExecutor-2] o.s.b.c.l.support.SimpleJobLauncher      : Job: [FlowJob: [name&#x3D;zlogJob]] completed with </span><br><span class="line">[ taskExecutor-1] o.s.b.c.l.support.SimpleJobLauncher      : Job: [FlowJob: [name&#x3D;zappJob]] completed with</span><br></pre></td></tr></table></figure>

<h2 id="异常处理"><a href="#异常处理" class="headerlink" title="异常处理"></a>异常处理</h2><p>默认情况下，Spring Batch遇到异常的时候会终止处理，比如遇到csv文件中解析错误就会终止异常。如果我想忽略掉这些异常继续处理， 可以配置在Reader中忽略异常。</p>
<p>这个在Step的定义中配置：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">return</span> stepBuilderFactory</span><br><span class="line">    .get(<span class="string">"logStep1"</span>)</span><br><span class="line">    .&lt;Log, Log&gt;chunk(<span class="number">5000</span>)<span class="comment">//批处理每次提交5000条数据</span></span><br><span class="line">    .reader(reader)<span class="comment">//给step绑定reader</span></span><br><span class="line">    .processor(processor)<span class="comment">//给step绑定processor</span></span><br><span class="line">    .writer(writer)<span class="comment">//给step绑定writer</span></span><br><span class="line">    .faultTolerant()</span><br><span class="line">    .retry(Exception<span class="class">.<span class="keyword">class</span>)   // 重试</span></span><br><span class="line"><span class="class">    .<span class="title">noRetry</span>(<span class="title">ParseException</span>.<span class="title">class</span>)</span></span><br><span class="line"><span class="class">    .<span class="title">retryLimit</span>(1)           //每条记录重试一次</span></span><br><span class="line"><span class="class">    .<span class="title">skip</span>(<span class="title">Exception</span>.<span class="title">class</span>)</span></span><br><span class="line"><span class="class">    .<span class="title">skipLimit</span>(200)         //一共允许跳过200次异常</span></span><br><span class="line"><span class="class">//                .<span class="title">taskExecutor</span>(<span class="title">new</span> <span class="title">SimpleAsyncTaskExecutor</span>()) //设置每个<span class="title">Job</span>通过并发方式执行，一般来讲一个<span class="title">Job</span>就让它串行完成的好</span></span><br><span class="line"><span class="class">//                .<span class="title">throttleLimit</span>(10)        //并发任务数为 10,默认为4</span></span><br><span class="line"><span class="class">    .<span class="title">build</span>()</span>;</span><br></pre></td></tr></table></figure>

<p>上面定义了使用可容忍异常模式，遇到Exception异常就重试1次，对于ParseException异常不重试，所有异常都会忽略掉，不会导致程序终止。 但是最大允许跳过200次异常，超过这个数字就终止执行了。</p>
<p>然后改一下csv文件，把某个字段改大点，超过数据库中定义长度：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1|等哈哈哈|01</span><br><span class="line">2|等哈哈哈|02</span><br><span class="line">3|等哈哈哈|025555</span><br><span class="line">4|等哈哈哈|02</span><br><span class="line">5|等哈哈哈|02</span><br></pre></td></tr></table></figure>

<p>重新执行发现正常执行完成，数据库中只插入了4条数据，id为3的没有。</p>
<h2 id="通用配置"><a href="#通用配置" class="headerlink" title="通用配置"></a>通用配置</h2><p>更进一步，如果有多个CSV文件需要导入，那么安装上面的写法。每次都要定义一个新的Config类，一个新的Bean类，代码重复率很高。</p>
<p>实际上可以定义一个通用配置，去掉里面的显示Bean类，通过Java反射机制，还有@StepScope注解， 实现每次运行时候根据JobParameters初始化不同的Job。</p>
<p>如果有一个新的CSV文件需要导入，只需要新建一个Bean，定义好相应的列，然后将Bean的属性列表、插入SQL语句作为参数传入即可。</p>
<p>测试代码：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 测试一个配置类，可同时运行多个任务</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> Exception 异常</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testCommonJobs</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    JobParameters jobParameters1 = <span class="keyword">new</span> JobParametersBuilder()</span><br><span class="line">            .addLong(<span class="string">"time"</span>,System.currentTimeMillis())</span><br><span class="line">            .addString(KEY_JOB_NAME, <span class="string">"App"</span>)</span><br><span class="line">            .addString(KEY_FILE_NAME, p.getCsvApp())</span><br><span class="line">            .addString(KEY_VO_NAME, <span class="string">"com.xncoding.trans.modules.zapp.App"</span>)</span><br><span class="line">            .addString(KEY_COLUMNS, String.join(<span class="string">","</span>, <span class="keyword">new</span> String[]&#123;</span><br><span class="line">                    <span class="string">"appid"</span>, <span class="string">"zname"</span>, <span class="string">"flag"</span></span><br><span class="line">            &#125;))</span><br><span class="line">            .addString(KEY_SQL, <span class="string">"insert into z_test_App (appid, zname, flag) values(:appid, :zname, :flag)"</span>)</span><br><span class="line">            .toJobParameters();</span><br><span class="line">    jobLauncher.run(commonJob, jobParameters1);</span><br><span class="line"></span><br><span class="line">    JobParameters jobParameters2 = <span class="keyword">new</span> JobParametersBuilder()</span><br><span class="line">            .addLong(<span class="string">"time"</span>,System.currentTimeMillis())</span><br><span class="line">            .addString(KEY_JOB_NAME, <span class="string">"Log"</span>)</span><br><span class="line">            .addString(KEY_FILE_NAME, p.getCsvLog())</span><br><span class="line">            .addString(KEY_VO_NAME, <span class="string">"com.xncoding.trans.modules.zlog.Log"</span>)</span><br><span class="line">            .addString(KEY_COLUMNS, String.join(<span class="string">","</span>, <span class="keyword">new</span> String[]&#123;</span><br><span class="line">                    <span class="string">"logid"</span>, <span class="string">"msg"</span>, <span class="string">"logtime"</span></span><br><span class="line">            &#125;))</span><br><span class="line">            .addString(KEY_SQL, <span class="string">"insert into z_test_Log (logid, msg, logtime) values(:logid, :msg, :logtime)"</span>)</span><br><span class="line">            .toJobParameters();</span><br><span class="line">    jobLauncher.run(commonJob, jobParameters2);</span><br><span class="line"></span><br><span class="line">    logger.info(<span class="string">"Main线程执行完成"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">        Thread.sleep(<span class="number">2000000L</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="FAQ"><a href="#FAQ" class="headerlink" title="FAQ"></a>FAQ</h2><p>在进行Oracle操作的时候报一个错误：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ORA-08177: 无法连续访问此事务处理</span><br></pre></td></tr></table></figure>

<p>原因：Spring Batch 默认是 <code>ISOLATION_SERIALIZABLE</code></p>
<p>官方文档说明：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">The default is ISOLATION_SERIALIZABLE, which prevents accidental concurrent execution of the same job (ISOLATION_REPEATABLE_READ would work as well).</span><br></pre></td></tr></table></figure>

<p>而Oracle默认的事务隔离级别是ISOLATION_READ_COMMITTED</p>
<p>解决方案就是修改<code>JobRepositoryFactoryBean</code>的定义，加一个配置：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">jobRepositoryFactoryBean.setIsolationLevelForCreate(<span class="string">"ISOLATION_READ_COMMITTED"</span>);</span><br></pre></td></tr></table></figure>

<h2 id="GitHub源码"><a href="#GitHub源码" class="headerlink" title="GitHub源码"></a>GitHub源码</h2><p><a href="https://github.com/yidao620c/SpringBootBucket/tree/master/springboot-batch" target="_blank" rel="noopener">springboot-batch</a>   —已测试</p>
<h2 id="来源"><a href="#来源" class="headerlink" title="来源"></a>来源</h2><p><a href="https://www.xncoding.com/" target="_blank" rel="noopener">https://www.xncoding.com/</a></p>
]]></content>
      <categories>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>springboot</tag>
        <tag>batch</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBoot系列 - 缓存</title>
    <url>/2020/06/08/SpringBoot%E7%B3%BB%E5%88%97-%E7%BC%93%E5%AD%98/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="SpringBoot系列-缓存"><a href="#SpringBoot系列-缓存" class="headerlink" title="SpringBoot系列 - 缓存"></a>SpringBoot系列 - 缓存</h1><p>内存的速度远远大于硬盘的速度，当我们需要重复获取相同的数据的时候，一次又一次的请求数据库或远程服务， 导致大量时间都消耗在数据库查询或远程方法调用上面，性能下降，这时候就需要使用到缓存技术了。</p>
<p>本文介绍SpringBoot 如何使用redis做缓存，如何对redis缓存进行定制化配置(如key的有效期)以及初始化redis做缓存。 使用具体的代码介绍了<code>@Cacheable</code>，<code>@CacheEvict</code>，<code>@CachePut</code>，<code>@CacheConfig</code>等注解及其属性的用法。</p>
<h2 id="Spring缓存支持"><a href="#Spring缓存支持" class="headerlink" title="Spring缓存支持"></a>Spring缓存支持</h2><p>Spring定义了<code>org.springframework.cache.CacheManager</code> 和 <code>org.springframework.cache.Cache</code> 接口来统一不同缓存技术。 其中CacheManager是Spring提供的各种缓存技术抽象接口，内部使用Cache接口进行缓存的增删改查操作，我们一般不会直接和Cache打交道。</p>
<p>针对不同的缓存技术，Spring有不同的CacheManager实现类，定义如下表：</p>
<table>
<thead>
<tr>
<th>CacheManager</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>SimpleCacheManager</td>
<td>使用简单的Collection存储缓存数据，用来做测试用</td>
</tr>
<tr>
<td>ConcurrentMapCacheManager</td>
<td>使用ConcurrentMap存储缓存数据</td>
</tr>
<tr>
<td>EhCacheCacheManager</td>
<td>使用EhCache作为缓存技术</td>
</tr>
<tr>
<td>GuavaCacheManager</td>
<td>使用Google Guava的GuavaCache作为缓存技术</td>
</tr>
<tr>
<td>JCacheCacheManager</td>
<td>使用JCache(JSR-107)标准的实现作为缓存技术，比如Apache Commons JCS</td>
</tr>
<tr>
<td>RedisCacheManager</td>
<td>使用Redis作为缓存技术</td>
</tr>
</tbody></table>
<p>在我们使用任意一个实现的CacheManager的时候，需要注册实现Bean：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * EhCache的配置</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> EhCacheCacheManager <span class="title">cacheManager</span><span class="params">(CacheManager cacheManager)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> EhCacheCacheManager(cacheManager);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当然，各种缓存技术都有很多其他配置，但是配置cacheManager是必不可少的。</p>
<h2 id="声明式缓存注解"><a href="#声明式缓存注解" class="headerlink" title="声明式缓存注解"></a>声明式缓存注解</h2><p>Spring提供4个注解来声明缓存规则，如下表所示：</p>
<table>
<thead>
<tr>
<th>注解</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>@Cacheable</td>
<td>方法执行前先看缓存中是否有数据，如果有直接返回。如果没有就调用方法，并将方法返回值放入缓存</td>
</tr>
<tr>
<td>@CachePut</td>
<td>无论怎样都会执行方法，并将方法返回值放入缓存</td>
</tr>
<tr>
<td>@CacheEvict</td>
<td>将数据从缓存中删除</td>
</tr>
<tr>
<td>@Caching</td>
<td>可通过此注解组合多个注解策略在一个方法上面</td>
</tr>
</tbody></table>
<p>@Cacheable 、@CachePut 、@CacheEvict都有value属性，指定要使用的缓存名称，而key属性指定缓存中存储的键。</p>
<h2 id="集成Redis缓存"><a href="#集成Redis缓存" class="headerlink" title="集成Redis缓存"></a>集成Redis缓存</h2><p>接下来将讲解如何集成redis来实现缓存，现在使用的是最新的SpringBoot 2，改动还是比较大的。</p>
<h3 id="安装redis"><a href="#安装redis" class="headerlink" title="安装redis"></a>安装redis</h3><p>安装和配置redis服务器网上很多教程，这里就不多讲了。在linux服务器上面安装一个redis，启动后端口号为默认的6379。</p>
<h3 id="添加maven依赖"><a href="#添加maven依赖" class="headerlink" title="添加maven依赖"></a>添加maven依赖</h3><p>SpringBoot 2开始默认的Redis客户端实现是Lettuce，同时你需要添加commons-pool2的依赖。</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.commons<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-pool2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="配置application-yml"><a href="#配置application-yml" class="headerlink" title="配置application.yml"></a>配置application.yml</h3><ul>
<li>指定缓存的类型</li>
<li>配置redis的服务器信息</li>
<li>配置lettuce连接池信息</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span> <span class="string">dev</span></span><br><span class="line">  <span class="attr">cache:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">REDIS</span></span><br><span class="line">    <span class="attr">redis:</span></span><br><span class="line">      <span class="attr">cache-null-values:</span> <span class="literal">false</span></span><br><span class="line">      <span class="attr">time-to-live:</span> <span class="string">600000ms</span></span><br><span class="line">      <span class="attr">use-key-prefix:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">cache-names:</span> <span class="string">userCache,allUsersCache</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">6379</span></span><br><span class="line">    <span class="attr">database:</span> <span class="number">0</span></span><br><span class="line">    <span class="attr">lettuce:</span></span><br><span class="line">      <span class="attr">shutdown-timeout:</span> <span class="string">200ms</span></span><br><span class="line">      <span class="attr">pool:</span></span><br><span class="line">        <span class="attr">max-active:</span> <span class="number">7</span></span><br><span class="line">        <span class="attr">max-idle:</span> <span class="number">7</span></span><br><span class="line">        <span class="attr">min-idle:</span> <span class="number">2</span></span><br><span class="line">        <span class="attr">max-wait:</span> <span class="string">-1ms</span></span><br></pre></td></tr></table></figure>

<p>这里我还指定了缓存名称列表：userCache,allUsersCache</p>
<h3 id="缓存配置类"><a href="#缓存配置类" class="headerlink" title="缓存配置类"></a>缓存配置类</h3><p>重新配置<code>RedisCacheManager</code>，使用新的自定义配置值：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableCaching</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisCacheConfig</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Logger logger = LoggerFactory.getLogger(<span class="keyword">this</span>.getClass());</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> Environment env;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> LettuceConnectionFactory <span class="title">redisConnectionFactory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        RedisStandaloneConfiguration redisConf = <span class="keyword">new</span> RedisStandaloneConfiguration();</span><br><span class="line">        redisConf.setHostName(env.getProperty(<span class="string">"spring.redis.host"</span>));</span><br><span class="line">        redisConf.setPort(Integer.parseInt(env.getProperty(<span class="string">"spring.redis.port"</span>)));</span><br><span class="line">        redisConf.setPassword(RedisPassword.of(env.getProperty(<span class="string">"spring.redis.password"</span>)));</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> LettuceConnectionFactory(redisConf);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RedisCacheConfiguration <span class="title">cacheConfiguration</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        RedisCacheConfiguration cacheConfig = RedisCacheConfiguration.defaultCacheConfig()</span><br><span class="line">                .entryTtl(Duration.ofSeconds(<span class="number">600</span>))</span><br><span class="line">                .disableCachingNullValues();</span><br><span class="line">        <span class="keyword">return</span> cacheConfig;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RedisCacheManager <span class="title">cacheManager</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        RedisCacheManager rcm = RedisCacheManager.builder(redisConnectionFactory())</span><br><span class="line">                .cacheDefaults(cacheConfiguration())</span><br><span class="line">                .transactionAware()</span><br><span class="line">                .build();</span><br><span class="line">        <span class="keyword">return</span> rcm;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="keyGenerator"><a href="#keyGenerator" class="headerlink" title="keyGenerator"></a>keyGenerator</h3><p>一般来讲我们使用key属性就可以满足大部分要求，但是如果你还想更好的自定义key，可以实现keyGenerator。</p>
<p>这个属性为定义key生成的类，和key属性不能同时存在。</p>
<p>在<code>RedisCacheConfig</code>配置类中添加我自定义的KeyGenerator：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 自定义缓存key的生成类实现</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Bean</span>(name = <span class="string">"myKeyGenerator"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> KeyGenerator <span class="title">myKeyGenerator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> KeyGenerator() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Object <span class="title">generate</span><span class="params">(Object o, Method method, Object... params)</span> </span>&#123;</span><br><span class="line">            logger.info(<span class="string">"自定义缓存，使用第一参数作为缓存key，params = "</span> + Arrays.toString(params));</span><br><span class="line">            <span class="comment">// 仅仅用于测试，实际不可能这么写</span></span><br><span class="line">            <span class="keyword">return</span> params[<span class="number">0</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>经过以上配置后，redis缓存管理对象已经生成，下面简单介绍如何使用。</p>
<h2 id="缓存注解"><a href="#缓存注解" class="headerlink" title="缓存注解"></a>缓存注解</h2><p>缓存是通过注解实现的，这里详细讲解一下这几个缓存注解，以及注解参数含义。</p>
<h3 id="Cacheable"><a href="#Cacheable" class="headerlink" title="@Cacheable"></a>@Cacheable</h3><p>这个注解含义是方法结果会被放入缓存，并且一旦缓存后，下一次调用此方法，会通过key去查找缓存是否存在，如果存在就直接取缓存值，不再执行方法。</p>
<p>这个注解有几个参数值，定义如下</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>解释</th>
</tr>
</thead>
<tbody><tr>
<td>cacheNames</td>
<td>缓存名称</td>
</tr>
<tr>
<td>value</td>
<td>缓存名称的别名</td>
</tr>
<tr>
<td>condition</td>
<td>Spring SpEL 表达式，用来确定是否缓存</td>
</tr>
<tr>
<td>key</td>
<td>SpEL 表达式，用来动态计算key</td>
</tr>
<tr>
<td>keyGenerator</td>
<td>Bean 名字，用来自定义key生成算法，跟key不能同时用</td>
</tr>
<tr>
<td>unless</td>
<td>SpEL 表达式，用来否决缓存，作用跟condition相反</td>
</tr>
<tr>
<td>sync</td>
<td>多线程同时访问时候进行同步</td>
</tr>
</tbody></table>
<p>在计算key、condition或者unless的值得时候，可以使用到以下的特有的SpEL表达式</p>
<table>
<thead>
<tr>
<th>表达式</th>
<th>解释</th>
</tr>
</thead>
<tbody><tr>
<td>#result</td>
<td>表示方法的返回结果</td>
</tr>
<tr>
<td>#root.method</td>
<td>当前方法</td>
</tr>
<tr>
<td>#root.target</td>
<td>目标对象</td>
</tr>
<tr>
<td>#root.caches</td>
<td>被影响到的缓存列表</td>
</tr>
<tr>
<td>#root.methodName</td>
<td>方法名称简称</td>
</tr>
<tr>
<td>#root.targetClass</td>
<td>目标类</td>
</tr>
<tr>
<td>#root.args[x]</td>
<td>方法的第x个参数</td>
</tr>
</tbody></table>
<h3 id="CachePut"><a href="#CachePut" class="headerlink" title="@CachePut"></a>@CachePut</h3><p>该注解在执行完方法后会触发一次缓存put操作，参数跟@Cacheable一致</p>
<h3 id="CacheEvict"><a href="#CacheEvict" class="headerlink" title="@CacheEvict"></a>@CacheEvict</h3><p>该注解在执行完方法后会触发一次缓存evict操作，参数除了@Cacheable里的外，还有个特殊的<code>allEntries</code>， 表示将清空缓存中所有的值。</p>
<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><p>在service中定义增删改的几个常见方法，通过注解实现缓存：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Logger logger = LoggerFactory.getLogger(<span class="keyword">this</span>.getClass());</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * cacheNames 设置缓存的值</span></span><br><span class="line"><span class="comment">     * key：指定缓存的key，这是指参数id值。key可以使用spEl表达式</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Cacheable</span>(value = <span class="string">"userCache"</span>, key = <span class="string">"#id"</span>, unless=<span class="string">"#result == null"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">getById</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        logger.info(<span class="string">"获取用户start..."</span>);</span><br><span class="line">        <span class="keyword">return</span> userMapper.selectById(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Cacheable</span>(value = <span class="string">"allUsersCache"</span>, unless = <span class="string">"#result.size() == 0"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">getAllUsers</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        logger.info(<span class="string">"获取所有用户列表"</span>);</span><br><span class="line">        <span class="keyword">return</span> userMapper.selectList(<span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建用户，同时使用新的返回值的替换缓存中的值</span></span><br><span class="line"><span class="comment">     * 创建用户后会将allUsersCache缓存全部清空</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Caching</span>(</span><br><span class="line">            put = &#123;<span class="meta">@CachePut</span>(value = <span class="string">"userCache"</span>, key = <span class="string">"#user.id"</span>)&#125;,</span><br><span class="line">            evict = &#123;<span class="meta">@CacheEvict</span>(value = <span class="string">"allUsersCache"</span>, allEntries = <span class="keyword">true</span>)&#125;</span><br><span class="line">    )</span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">createUser</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">        logger.info(<span class="string">"创建用户start..., user.id="</span> + user.getId());</span><br><span class="line">        userMapper.insert(user);</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 更新用户，同时使用新的返回值的替换缓存中的值</span></span><br><span class="line"><span class="comment">     * 更新用户后会将allUsersCache缓存全部清空</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Caching</span>(</span><br><span class="line">            put = &#123;<span class="meta">@CachePut</span>(value = <span class="string">"userCache"</span>, key = <span class="string">"#user.id"</span>)&#125;,</span><br><span class="line">            evict = &#123;<span class="meta">@CacheEvict</span>(value = <span class="string">"allUsersCache"</span>, allEntries = <span class="keyword">true</span>)&#125;</span><br><span class="line">    )</span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">updateUser</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">        logger.info(<span class="string">"更新用户start..."</span>);</span><br><span class="line">        userMapper.updateById(user);</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 对符合key条件的记录从缓存中移除</span></span><br><span class="line"><span class="comment">     * 删除用户后会将allUsersCache缓存全部清空</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Caching</span>(</span><br><span class="line">            evict = &#123;</span><br><span class="line">                    <span class="meta">@CacheEvict</span>(value = <span class="string">"userCache"</span>, key = <span class="string">"#id"</span>),</span><br><span class="line">                    <span class="meta">@CacheEvict</span>(value = <span class="string">"allUsersCache"</span>, allEntries = <span class="keyword">true</span>)</span><br><span class="line">            &#125;</span><br><span class="line">    )</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteById</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        logger.info(<span class="string">"删除用户start..."</span>);</span><br><span class="line">        userMapper.deleteById(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后写个测试类：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RunWith</span>(SpringRunner<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">@<span class="title">SpringBootTest</span>(<span class="title">classes</span> </span>= Application<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">@<span class="title">Transactional</span></span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">UserServiceTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testCache</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 创建一个用户admin</span></span><br><span class="line">        <span class="keyword">int</span> id = <span class="keyword">new</span> Random().nextInt(<span class="number">1000</span>);</span><br><span class="line">        User user = <span class="keyword">new</span> User(id, <span class="string">"admin"</span>, <span class="string">"admin"</span>);</span><br><span class="line">        userService.createUser(user);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 再创建一个用户xiong</span></span><br><span class="line">        <span class="keyword">int</span> id2 = <span class="keyword">new</span> Random().nextInt(<span class="number">1000</span>);</span><br><span class="line">        User user2 = <span class="keyword">new</span> User(id2, <span class="string">"xiong"</span>, <span class="string">"neng"</span>);</span><br><span class="line">        userService.createUser(user2);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 查询所有用户列表</span></span><br><span class="line">        List&lt;User&gt; list = userService.getAllUsers();</span><br><span class="line">        assertEquals(list.size(), <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 两次访问看看缓存命中情况</span></span><br><span class="line">        User user3 = userService.getById(id); <span class="comment">// 第1次访问</span></span><br><span class="line">        assertEquals(user3.getPassword(), <span class="string">"admin"</span>);</span><br><span class="line">        User user4 = userService.getById(id); <span class="comment">// 第2次访问</span></span><br><span class="line">        assertEquals(user4.getPassword(), <span class="string">"admin"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 更新用户密码</span></span><br><span class="line">        user4.setPassword(<span class="string">"123456"</span>);</span><br><span class="line">        userService.updateUser(user4);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 更新完成后再次访问用户</span></span><br><span class="line">        User user5 = userService.getById(id); <span class="comment">// 第4次访问</span></span><br><span class="line">        assertEquals(user5.getPassword(), <span class="string">"123456"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 删除用户admin</span></span><br><span class="line">        userService.deleteById(id);</span><br><span class="line">        assertNull(userService.getById(id));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>下面是测试的打印日志一部分：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">创建用户start..., user.id=<span class="number">444</span></span><br><span class="line">==&gt;  Preparing: <span class="keyword">INSERT</span> <span class="keyword">INTO</span> t_user ( <span class="keyword">id</span>, username, <span class="string">`password`</span> ) <span class="keyword">VALUES</span> ( ?, ?, ? )</span><br><span class="line">==&gt; <span class="keyword">Parameters</span>: <span class="number">444</span>(<span class="built_in">Integer</span>), <span class="keyword">admin</span>(<span class="keyword">String</span>), <span class="keyword">admin</span>(<span class="keyword">String</span>)</span><br><span class="line">&lt;==    Updates: <span class="number">1</span></span><br><span class="line">创建用户start..., user.id=<span class="number">895</span></span><br><span class="line">==&gt;  Preparing: <span class="keyword">INSERT</span> <span class="keyword">INTO</span> t_user ( <span class="keyword">id</span>, username, <span class="string">`password`</span> ) <span class="keyword">VALUES</span> ( ?, ?, ? )</span><br><span class="line">==&gt; <span class="keyword">Parameters</span>: <span class="number">895</span>(<span class="built_in">Integer</span>), xiong(<span class="keyword">String</span>), neng(<span class="keyword">String</span>)</span><br><span class="line">&lt;==    Updates: <span class="number">1</span></span><br><span class="line"><span class="keyword">Starting</span> <span class="keyword">without</span> optional epoll <span class="keyword">library</span></span><br><span class="line"><span class="keyword">Starting</span> <span class="keyword">without</span> optional kqueue <span class="keyword">library</span></span><br><span class="line">获取所有用户列表</span><br><span class="line">==&gt;  Preparing: <span class="keyword">SELECT</span> <span class="keyword">id</span> <span class="keyword">AS</span> <span class="keyword">id</span>,username,<span class="string">`password`</span> <span class="keyword">FROM</span> t_user</span><br><span class="line">==&gt; <span class="keyword">Parameters</span>:</span><br><span class="line">&lt;==      Total: <span class="number">2</span></span><br><span class="line">获取用户start...</span><br><span class="line">==&gt;  Preparing: <span class="keyword">SELECT</span> <span class="keyword">id</span> <span class="keyword">AS</span> <span class="keyword">id</span>,username,<span class="string">`password`</span> <span class="keyword">FROM</span> t_user <span class="keyword">WHERE</span> <span class="keyword">id</span>=?</span><br><span class="line">==&gt; <span class="keyword">Parameters</span>: <span class="number">444</span>(<span class="built_in">Integer</span>)</span><br><span class="line">&lt;==      Total: <span class="number">1</span></span><br><span class="line">获取用户start...</span><br><span class="line">更新用户start...</span><br><span class="line">==&gt;  Preparing: <span class="keyword">UPDATE</span> t_user <span class="keyword">SET</span> username=?, <span class="string">`password`</span>=? <span class="keyword">WHERE</span> <span class="keyword">id</span>=?</span><br><span class="line">==&gt; <span class="keyword">Parameters</span>: <span class="keyword">admin</span>(<span class="keyword">String</span>), <span class="number">123456</span>(<span class="keyword">String</span>), <span class="number">444</span>(<span class="built_in">Integer</span>)</span><br><span class="line">&lt;==    Updates: <span class="number">1</span></span><br><span class="line">获取用户start...</span><br><span class="line">==&gt;  Preparing: <span class="keyword">SELECT</span> <span class="keyword">id</span> <span class="keyword">AS</span> <span class="keyword">id</span>,username,<span class="string">`password`</span> <span class="keyword">FROM</span> t_user <span class="keyword">WHERE</span> <span class="keyword">id</span>=?</span><br><span class="line">==&gt; <span class="keyword">Parameters</span>: <span class="number">444</span>(<span class="built_in">Integer</span>)</span><br><span class="line">&lt;==      Total: <span class="number">1</span></span><br><span class="line">删除用户start...</span><br><span class="line">==&gt;  Preparing: <span class="keyword">DELETE</span> <span class="keyword">FROM</span> t_user <span class="keyword">WHERE</span> <span class="keyword">id</span>=?</span><br><span class="line">==&gt; <span class="keyword">Parameters</span>: <span class="number">444</span>(<span class="built_in">Integer</span>)</span><br><span class="line">&lt;==    Updates: <span class="number">1</span></span><br><span class="line">获取用户start...</span><br><span class="line">==&gt;  Preparing: <span class="keyword">SELECT</span> <span class="keyword">id</span> <span class="keyword">AS</span> <span class="keyword">id</span>,username,<span class="string">`password`</span> <span class="keyword">FROM</span> t_user <span class="keyword">WHERE</span> <span class="keyword">id</span>=?</span><br><span class="line">==&gt; <span class="keyword">Parameters</span>: <span class="number">444</span>(<span class="built_in">Integer</span>)</span><br><span class="line">&lt;==      Total: <span class="number">0</span></span><br><span class="line">Rolled back <span class="keyword">transaction</span> <span class="keyword">for</span> <span class="keyword">test</span>: [DefaultTestContext@<span class="number">44</span>ebcd03 testClass = UserServiceTest,</span><br><span class="line">Closing org.springframework.context.annotation.AnnotationConfigApplicationContext@<span class="number">1</span>a5a4e19:</span><br><span class="line">&#123;dataSource<span class="number">-1</span>&#125; closed</span><br></pre></td></tr></table></figure>

<p>可以看到，第2次、第3次获取的时候并没有执行方法，说明缓存生效了。后面更新会同时更新缓存，取出来的也是更新后的数据。</p>
<h2 id="切换缓存技术"><a href="#切换缓存技术" class="headerlink" title="切换缓存技术"></a>切换缓存技术</h2><p>得益于SpringBoot的自动配置机制，切换缓存技术除了替换相关maven依赖包和配置Bean外，使用方式和实例中一样， 不需要修改业务代码。如果你要切换到其他缓存技术非常简单。</p>
<p><strong>EhCache</strong></p>
<p>当我们需要使用EhCache作为缓存技术的时候，只需要在pom.xml中添加EhCache的依赖：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>net.sf.ehcache<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>ehcahe<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>EhCache的配置文件ehcache.xml只需要放到类路径下面，SpringBoot会自动扫描，例如：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ehcache</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:noNamespaceSchemaLocation</span>=<span class="string">"http://ehcache.org/ehcache.xsd"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">updateCheck</span>=<span class="string">"false"</span> <span class="attr">monitoring</span>=<span class="string">"autodetect"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">dynamicConfig</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">diskStore</span> <span class="attr">path</span>=<span class="string">"java.io.tmpdir/ehcache"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">defaultCache</span></span></span><br><span class="line"><span class="tag">            <span class="attr">maxElementsInMemory</span>=<span class="string">"50000"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">eternal</span>=<span class="string">"false"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">timeToIdleSeconds</span>=<span class="string">"3600"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">timeToLiveSeconds</span>=<span class="string">"3600"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">overflowToDisk</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">diskPersistent</span>=<span class="string">"false"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">diskExpiryThreadIntervalSeconds</span>=<span class="string">"120"</span></span></span><br><span class="line"><span class="tag">    /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">cache</span> <span class="attr">name</span>=<span class="string">"authorizationCache"</span></span></span><br><span class="line"><span class="tag">           <span class="attr">maxEntriesLocalHeap</span>=<span class="string">"2000"</span></span></span><br><span class="line"><span class="tag">           <span class="attr">eternal</span>=<span class="string">"false"</span></span></span><br><span class="line"><span class="tag">           <span class="attr">timeToIdleSeconds</span>=<span class="string">"3600"</span></span></span><br><span class="line"><span class="tag">           <span class="attr">timeToLiveSeconds</span>=<span class="string">"3600"</span></span></span><br><span class="line"><span class="tag">           <span class="attr">overflowToDisk</span>=<span class="string">"false"</span></span></span><br><span class="line"><span class="tag">           <span class="attr">statistics</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">cache</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ehcache</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>SpringBoot会为我们自动配置<code>EhCacheCacheManager</code>这个Bean，不过你也可以自己定义。</p>
<p><strong>Guava</strong></p>
<p>当我们需要Guava作为缓存技术的时候，只需要在pom.xml中增加Guava的依赖即可：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.google.guava<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>guava<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>18.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>SpringBoot会为我们自动配置<code>GuavaCacheManager</code>这个Bean。</p>
<p><strong>Redis</strong></p>
<p>最后还提一点，本篇采用Redis作为缓存技术，添加了依赖：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>SpringBoot会为我们自动配置<code>RedisCacheManager</code>这个Bean，同时还会配置<code>RedisTemplate</code>这个Bean。 后面这个Bean就是下一篇要讲解的操作Redis数据库用，这个就比单纯注解缓存强大和灵活的多了。</p>
<h2 id="GitHub源码"><a href="#GitHub源码" class="headerlink" title="GitHub源码"></a>GitHub源码</h2><p><a href="https://github.com/yidao620c/SpringBootBucket/tree/master/springboot-cache" target="_blank" rel="noopener">springboot-cache</a>   —已测试</p>
<h2 id="来源"><a href="#来源" class="headerlink" title="来源"></a>来源</h2><p><a href="https://www.xncoding.com/" target="_blank" rel="noopener">https://www.xncoding.com/</a></p>
]]></content>
      <categories>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>springboot</tag>
        <tag>cache</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBoot系列 - 自己写starter</title>
    <url>/2020/06/08/SpringBoot%E7%B3%BB%E5%88%97-%E8%87%AA%E5%B7%B1%E5%86%99starter/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="SpringBoot系列-自己写starter"><a href="#SpringBoot系列-自己写starter" class="headerlink" title="SpringBoot系列 - 自己写starter"></a>SpringBoot系列 - 自己写starter</h1><p>Spring Boot由众多Starter组成，随着版本的推移Starter家族成员也与日俱增。在传统Maven项目中通常将一些层、组件拆分为模块来管理， 以便相互依赖复用，在Spring Boot项目中我们则可以创建自定义Spring Boot Starter来达成该目的。</p>
<p>可以认为starter是一种服务——使得使用某个功能的开发者不需要关注各种依赖库的处理，不需要具体的配置信息， 由Spring Boot自动通过classpath路径下的类发现需要的Bean，并织入相应的Bean。举个栗子，spring-boot-starter-jdbc这个starter的存在， 使得我们只需要在BookPubApplication下用@Autowired引入DataSource的bean就可以，Spring Boot会自动创建DataSource的实例。</p>
<p>本篇将通过一个简单的例子来演示如何编写自己的starter。</p>
<p>这里讲一下我们的Starter要实现的功能，很简单，提供一个Service，包含一个能够将字符串加上前后缀的方法String wrap(String word)。 而具体的前缀和后缀是通过读取SpringBoot配置文件<code>application.yml</code>而获取的。</p>
<h2 id="添加maven依赖"><a href="#添加maven依赖" class="headerlink" title="添加maven依赖"></a>添加maven依赖</h2><p>第一步当然是创建一个maven工程，添加SpringBoot的自动配置的依赖：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.xncoding<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>simple-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>simple-spring-boot-starter<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>一个简单的自定义starter<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://maven.apache.org<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.4.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- @ConfigurationProperties annotation processing (metadata for IDEs)</span></span><br><span class="line"><span class="comment">                 生成spring-configuration-metadata.json类，需要引入此类--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-autoconfigure<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>注意其中 <code>spring-boot-configuration-processor</code> 的作用是编译时生成<code>spring-configuration-metadata.json</code>， 此文件主要给IDE使用，用于提示使用。如在intellij idea中，当配置此jar相关配置属性在<code>application.yml</code>， 你可以用ctlr+鼠标左键，IDE会跳转到你配置此属性的类中。</p>
<p>这里说下artifactId的命名问题，Spring 官方 Starter通常命名为<code>spring-boot-starter-{name}</code> 如 <code>spring-boot-starter-web</code>。</p>
<p>Spring官方建议非官方Starter命名应遵循<code>{name}-spring-boot-starter</code>的格式。</p>
<h2 id="编写Service"><a href="#编写Service" class="headerlink" title="编写Service"></a>编写Service</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExampleService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String prefix;</span><br><span class="line">    <span class="keyword">private</span> String suffix;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ExampleService</span><span class="params">(String prefix, String suffix)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.prefix = prefix;</span><br><span class="line">        <span class="keyword">this</span>.suffix = suffix;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">wrap</span><span class="params">(String word)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> prefix + word + suffix;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="编写属性类"><a href="#编写属性类" class="headerlink" title="编写属性类"></a>编写属性类</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties</span>(<span class="string">"example.service"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExampleServiceProperties</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String prefix;</span><br><span class="line">    <span class="keyword">private</span> String suffix;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getPrefix</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> prefix;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPrefix</span><span class="params">(String prefix)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.prefix = prefix;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getSuffix</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> suffix;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSuffix</span><span class="params">(String suffix)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.suffix = suffix;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="编写自动配置类"><a href="#编写自动配置类" class="headerlink" title="编写自动配置类"></a>编写自动配置类</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConditionalOnClass</span>(ExampleService<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">@<span class="title">EnableConfigurationProperties</span>(<span class="title">ExampleServiceProperties</span>.<span class="title">class</span>)</span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">ExampleAutoConfigure</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ExampleServiceProperties properties;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ExampleAutoConfigure</span><span class="params">(ExampleServiceProperties properties)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.properties = properties;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line">    <span class="meta">@ConditionalOnProperty</span>(prefix = <span class="string">"example.service"</span>, value = <span class="string">"enabled"</span>,havingValue = <span class="string">"true"</span>)</span><br><span class="line">    <span class="function">ExampleService <span class="title">exampleService</span> <span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span>  <span class="keyword">new</span> ExampleService(properties.getPrefix(),properties.getSuffix());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>解释下用到的几个和Starter相关的注解：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1. @ConditionalOnClass，当classpath下发现该类的情况下进行自动配置。</span><br><span class="line">2. @ConditionalOnMissingBean，当Spring Context中不存在该Bean时。</span><br><span class="line">3. @ConditionalOnProperty(prefix &#x3D; &quot;example.service&quot;,value &#x3D; &quot;enabled&quot;,havingValue &#x3D; &quot;true&quot;)，当配置文件中example.service.enabled&#x3D;true时。</span><br></pre></td></tr></table></figure>

<h2 id="添加spring-factories"><a href="#添加spring-factories" class="headerlink" title="添加spring.factories"></a>添加spring.factories</h2><p>最后一步，在<code>resources/META-INF/</code>下创建<code>spring.factories</code>文件，内容供参考下面：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">org.springframework.boot.autoconfigure.EnableAutoConfiguration&#x3D;\</span><br><span class="line">com.xncoding.starter.config.ExampleAutoConfigure</span><br></pre></td></tr></table></figure>

<p>如果有多个自动配置类，用逗号分隔换行即可。</p>
<p>OK，完事，运行 <code>mvn:install</code> 打包安装，一个Spring Boot Starter便开发完成了。</p>
<h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><p>打包好了当然要测试一下看看了。另外创建一个SpringBoot工程，在maven中引入这个starter依赖， 然后在单元测试中引入这个Service看看效果。</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.xncoding<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>simple-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>修改<code>application.yml</code>配置文件，添加如下内容：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">example.service:</span></span><br><span class="line">  <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">prefix:</span> <span class="string">ppp</span></span><br><span class="line">  <span class="attr">suffix:</span> <span class="string">sss</span></span><br></pre></td></tr></table></figure>

<p>测试类：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RunWith</span>(SpringRunner<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">@<span class="title">SpringBootTest</span></span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">ApplicationTests</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ExampleService exampleService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testStarter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(exampleService.wrap(<span class="string">"hello"</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行结果：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ppphellosss</span><br></pre></td></tr></table></figure>

<p>完美！</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>总结下Starter的工作原理:</p>
<ol>
<li>Spring Boot在启动时扫描项目所依赖的JAR包，寻找包含<code>spring.factories</code>文件的JAR包</li>
<li>根据<code>spring.factories</code>配置加载AutoConfigure类</li>
<li>根据 <code>@Conditional</code> 注解的条件，进行自动配置并将Bean注入Spring Context</li>
</ol>
<h2 id="GitHub源码"><a href="#GitHub源码" class="headerlink" title="GitHub源码"></a>GitHub源码</h2><p><a href="https://github.com/yidao620c/SpringBootBucket/tree/master/springboot-starter" target="_blank" rel="noopener">springboot-starter</a>    —已测试</p>
<h2 id="来源"><a href="#来源" class="headerlink" title="来源"></a>来源</h2><p><a href="https://www.xncoding.com/" target="_blank" rel="noopener">https://www.xncoding.com/</a></p>
]]></content>
      <categories>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>springboot</tag>
        <tag>starter</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBoot系列 - 集成Echarts导出图片</title>
    <url>/2020/06/08/SpringBoot%E7%B3%BB%E5%88%97-%E9%9B%86%E6%88%90Echarts%E5%AF%BC%E5%87%BA%E5%9B%BE%E7%89%87/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="SpringBoot系列-集成Echarts导出图片"><a href="#SpringBoot系列-集成Echarts导出图片" class="headerlink" title="SpringBoot系列 - 集成Echarts导出图片"></a>SpringBoot系列 - 集成Echarts导出图片</h1><p>Echarts是百度一款开源可视化图表库，基于html5 Canvas的。能够快速让你看到漂亮的效果。也是百度开源产品中的良心之作。</p>
<p>有时候在Java程序中也需要导出好看的图表，比如我经常会基于JMH做各种微基准测试，想将测试结果可视化导出为图表形式。 试用了一下JFreeChart，跟Echarts导出的图比起来还是弱了不少。但是Echarts是基于js的，只能在浏览器中解析和导出图片，怎么办呢？</p>
<p>后来我想到一个方法，就是基于WebSocket技术，服务器将图表数据推送到页面，然后页面再触发导出动作。 本篇将介绍如何通过SpringBoot、SocketIO、Echarts技术来实现这个图表导出功能。</p>
<p>大致步骤是这样的：</p>
<ol>
<li>编写一个RESTful API接口，用来接收生成图表需要的数据，然后向页面推送<code>导出图片</code>的消息请求。</li>
<li>编写一个WebSocket接口，接收Base64格式的图片编码，然后将其转换为图片保存到磁盘上</li>
<li>启动应用后打开websocket服务端，并监听页面发送的<code>Echarts图片导出</code>消息</li>
<li>打开页面，自动连接上websocket服务器，并监听<code>导出图片</code>的消息请求，收到消息后发送<code>Echarts图片导出</code>消息</li>
<li>后面就可以调用这个RESTful API接口来讲数据可视化为Echarts图片并保存了。</li>
</ol>
<p>我曾经尝试过，Java程序通过phantomjs启动浏览器打开页面，最后导出来的图片有1.5M，而直接用浏览器打开后导出大小只有50K， 所以放弃了phantomjs方案。</p>
<h2 id="maven依赖"><a href="#maven依赖" class="headerlink" title="maven依赖"></a>maven依赖</h2><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">project.reporting.outputEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.reporting.outputEncoding</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">netty.version</span>&gt;</span>4.1.19.Final<span class="tag">&lt;/<span class="name">netty.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">thymeleaf.version</span>&gt;</span>3.0.7.RELEASE<span class="tag">&lt;/<span class="name">thymeleaf.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">thymeleaf-layout-dialect.version</span>&gt;</span>2.2.2<span class="tag">&lt;/<span class="name">thymeleaf-layout-dialect.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">jmh.version</span>&gt;</span>1.20<span class="tag">&lt;/<span class="name">jmh.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jetty<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.commons<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-lang3<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-codec<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-codec<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.11<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.hamcrest<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hamcrest-all<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- netty-socketio--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.corundumstudio.socketio<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>netty-socketio<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.13<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.netty<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>netty-buffer<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;netty.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.netty<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>netty-codec<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;netty.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.netty<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>netty-codec-http<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;netty.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.netty<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>netty-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;netty.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.netty<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>netty-handler<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;netty.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.netty<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>netty-resolver<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;netty.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.netty<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>netty-transport<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;netty.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.netty<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>netty-transport-native-epoll<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;netty.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.netty<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>netty-transport-native-unix-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;netty.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.socket<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>socket.io-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h2><p>修改application.yml，配置web端口、socket服务端口、图片保存路径等：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment">###################  自定义项目配置 ###################</span></span><br><span class="line"><span class="attr">xncoding:</span></span><br><span class="line">  <span class="attr">socket-port:</span> <span class="number">9076</span>    <span class="comment">#socket端口</span></span><br><span class="line">  <span class="attr">ping-interval:</span> <span class="number">60000</span> <span class="comment">#Ping消息间隔（毫秒）</span></span><br><span class="line">  <span class="attr">ping-timeout:</span> <span class="number">180000</span> <span class="comment">#Ping消息超时时间（毫秒）</span></span><br><span class="line">  <span class="attr">image-dir:</span> <span class="string">E:/pics/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">###################  项目启动端口  ###################</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">9075</span></span><br><span class="line">  <span class="attr">jetty:</span></span><br><span class="line">    <span class="attr">max-http-post-size:</span> <span class="number">20000000</span></span><br></pre></td></tr></table></figure>

<h2 id="WebSocket服务"><a href="#WebSocket服务" class="headerlink" title="WebSocket服务"></a>WebSocket服务</h2><p>基于Socket.IO来实现WebSocket服务，关于这个我专门写了一篇博客：<a href="https://www.xncoding.com/2017/07/16/spring/sb-socketio.html" target="_blank" rel="noopener">集成SocketIO实时通信</a></p>
<p>这里我不再多讲怎么集成，我只贴一下监听方法：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 保存客户端传来的图片数据</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> client     客户端</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> ackRequest 回执消息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> imgData    Base64的图形数据</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@OnEvent</span>(value = <span class="string">"savePic"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSavePic</span><span class="params">(SocketIOClient client, AckRequest ackRequest, String imgData)</span> </span>&#123;</span><br><span class="line">    logger.info(<span class="string">"保存客户端传来的图片数据 start, sessionId="</span> + client.getSessionId().toString());</span><br><span class="line">    String r = apiService.saveBase64Pic(imgData);</span><br><span class="line">    logger.info(<span class="string">"保存客户端传来的图片 = &#123;&#125;"</span>, r);</span><br><span class="line">    ackRequest.sendAckData(<span class="string">"图片保存结果="</span> + r);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里WebSocket服务器会监听消息<code>savePic</code>，参数为Base64的图形数据，然后将其保存到磁盘上面。</p>
<h2 id="Echarts配置类"><a href="#Echarts配置类" class="headerlink" title="Echarts配置类"></a>Echarts配置类</h2><p>Echarts可以到处非常多类型的图表，每个图表初始化需要一个特定json对象，里面的配置不一样。我使用了其中的一种用来显示性能测试对比的纵向柱状图。 然后需要编写这个配置对象，包括各个内嵌对象，具体我就不贴出来了，参考最后面的github源码。</p>
<h2 id="图片导出接口"><a href="#图片导出接口" class="headerlink" title="图片导出接口"></a>图片导出接口</h2><p>接下来编写对外开放的图片导出RESTful API接口：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 对外API接口类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(value = <span class="string">"/api/v1"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PublicController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> ApiService apiService;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger _logger = LoggerFactory.getLogger(PublicController<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@RequestMapping</span>(value = <span class="string">"/data"</span>, method = RequestMethod.POST)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResponseEntity&lt;BaseResponse&gt; <span class="title">doJoin</span><span class="params">(HttpServletRequest request)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        _logger.info(<span class="string">"数据上传消息push接口 start...."</span>);</span><br><span class="line">        String jsonBody = IOUtils.toString(request.getInputStream(), Charset.forName(<span class="string">"UTF-8"</span>));</span><br><span class="line">        EchartsData echartsData = <span class="keyword">new</span> EchartsData(<span class="string">""</span>, jsonBody);</span><br><span class="line">        String jsonString = <span class="keyword">new</span> ObjectMapper().writeValueAsString(echartsData);</span><br><span class="line">        apiService.pushMsg(<span class="string">"notify"</span>, jsonString);</span><br><span class="line">        BaseResponse result = <span class="keyword">new</span> BaseResponse&lt;&gt;(<span class="keyword">true</span>, <span class="string">"数据上传消息push成功"</span>, <span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ResponseEntity&lt;&gt;(result, HttpStatus.OK);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面的pushMsg方法定义：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 服务器主动推送消息</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> msgType 消息类型</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> jsonData echarts图表数据</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pushMsg</span><span class="params">(String msgType, String jsonData)</span> </span>&#123;</span><br><span class="line">    SocketIOClient targetClient = <span class="keyword">this</span>.server.getClient(UUID.fromString(sessionId));</span><br><span class="line">    <span class="keyword">if</span> (targetClient == <span class="keyword">null</span>) &#123;</span><br><span class="line">        logger.error(<span class="string">"sessionId="</span> + sessionId + <span class="string">"在server中获取不到client"</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        targetClient.sendEvent(msgType, jsonData);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>服务器将数据转换成echarts的配置json字符串后，就给浏览器推送一个<code>notify</code>的消息。</p>
<h2 id="页面客户端"><a href="#页面客户端" class="headerlink" title="页面客户端"></a>页面客户端</h2><p>接下来编写js客户端来连接WebSocket服务，并监听<code>notify</code>的消息，在页面上生成Echarts图表后， 再给服务器发送一个<code>savePic</code>的消息，并把图表的Base64编码数据传过去。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns</span>=<span class="string">"http://www.w3.org/1999/xhtml"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">xmlns:th</span>=<span class="string">"http://www.thymeleaf.org"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"renderer"</span> <span class="attr">content</span>=<span class="string">"webkit"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Echarts Demo<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"shortcut icon"</span> <span class="attr">th:href</span>=<span class="string">"@&#123;/favicon.ico&#125;"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">th:href</span>=<span class="string">"@&#123;/static/css/bootstrap.css&#125;"</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line">        body &#123;</span><br><span class="line">            padding: 20px;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="css">        <span class="selector-id">#console</span> &#123;</span></span><br><span class="line">            height: 100px;</span><br><span class="line">            overflow: auto;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="css">        <span class="selector-class">.connect-msg</span> &#123;</span></span><br><span class="line">            color: green;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="css">        <span class="selector-class">.disconnect-msg</span> &#123;</span></span><br><span class="line">            color: red;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="css">        <span class="selector-class">.send-msg</span> &#123;</span></span><br><span class="line"><span class="css">            <span class="selector-tag">color</span>: <span class="selector-id">#888</span></span></span><br><span class="line">        &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Netty-socketio Demo Chat<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"console"</span> <span class="attr">class</span>=<span class="string">"well"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 为 ECharts 准备一个具备大小（宽高）的 DOM --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"main"</span> <span class="attr">style</span>=<span class="string">"width:860px; height:470px;"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">class</span>=<span class="string">"well form-inline"</span> <span class="attr">onsubmit</span>=<span class="string">"return false;"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"msg"</span> <span class="attr">class</span>=<span class="string">"input-xlarge"</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">placeholder</span>=<span class="string">"Type something..."</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">onClick</span>=<span class="string">"sendDisconnect()"</span> <span class="attr">class</span>=<span class="string">"btn"</span>&gt;</span>Disconnect<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">onClick</span>=<span class="string">"sendSavePic()"</span> <span class="attr">class</span>=<span class="string">"btn"</span>&gt;</span>Save Picture<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">th:src</span>=<span class="string">"@&#123;/static/js/jquery-1.10.1.min.js&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">th:src</span>=<span class="string">"@&#123;/static/js/socket.io.js&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">th:src</span>=<span class="string">"@&#123;/static/js/moment.min.js&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">th:src</span>=<span class="string">"@&#123;/static/js/echarts.common.min.js&#125;"</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript">    <span class="keyword">var</span> socket;</span></span><br><span class="line"><span class="actionscript">    <span class="keyword">var</span> myChart;</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">    <span class="function"><span class="keyword">function</span> <span class="title">sendDisconnect</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line">        socket.disconnect();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="actionscript">    <span class="function"><span class="keyword">function</span> <span class="title">output</span><span class="params">(message)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">var</span> currentTime = <span class="string">"&lt;span class='time'&gt;"</span> + moment().format(<span class="string">'HH:mm:ss.SSS'</span>) + <span class="string">"&lt;/span&gt;"</span>;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> element = $(<span class="string">"&lt;div&gt;"</span> + currentTime + <span class="string">" "</span> + message + <span class="string">"&lt;/div&gt;"</span>);</span></span><br><span class="line"><span class="javascript">        $(<span class="string">'#console'</span>).prepend(element);</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="actionscript">    <span class="function"><span class="keyword">function</span> <span class="title">sendSavePic</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">        socket.emit(<span class="string">'savePic'</span>, myChart.getDataURL(), <span class="function"><span class="keyword">function</span> <span class="params">(result)</span> </span>&#123;</span></span><br><span class="line"><span class="handlebars"><span class="xml">            output('<span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"connect-msg"</span>&gt;</span>' + result + '<span class="tag">&lt;/<span class="name">span</span>&gt;</span>');</span></span></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="actionscript">    <span class="function"><span class="keyword">function</span> <span class="title">initPage</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(<span class="string">'this is index.html log...'</span>);</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> userName = <span class="string">'user'</span> + <span class="built_in">Math</span>.floor((<span class="built_in">Math</span>.random() * <span class="number">1000</span>) + <span class="number">1</span>);</span></span><br><span class="line"><span class="actionscript">        socket = io.connect(<span class="string">'http://localhost:9076'</span>);</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(<span class="string">'socket = '</span> + socket);</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">        socket.on(<span class="string">'connect'</span>, <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="string">'connect successful'</span>);</span></span><br><span class="line"><span class="handlebars"><span class="xml">            output('<span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"connect-msg"</span>&gt;</span>Client has connected to the server!<span class="tag">&lt;/<span class="name">span</span>&gt;</span>');</span></span></span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line"><span class="actionscript">        socket.on(<span class="string">'disconnect'</span>, <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="string">'disconnect successful'</span>);</span></span><br><span class="line"><span class="handlebars"><span class="xml">            output('<span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"disconnect-msg"</span>&gt;</span>The client has disconnected!<span class="tag">&lt;/<span class="name">span</span>&gt;</span>');</span></span></span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line"><span class="actionscript">        socket.on(<span class="string">'notify'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(jsonBody)</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="string">'get notify message from server...'</span>);</span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> msg = <span class="built_in">JSON</span>.parse(jsonBody);</span></span><br><span class="line"><span class="handlebars"><span class="xml">            output('<span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"connect-msg"</span>&gt;</span>接收到notify消息, 去给我保存图片<span class="tag">&lt;/<span class="name">span</span>&gt;</span>');</span></span></span><br><span class="line"><span class="actionscript">            <span class="keyword">var</span> option = msg.option;</span></span><br><span class="line"><span class="actionscript">            <span class="comment">// 使用刚指定的配置项和数据显示图表。</span></span></span><br><span class="line"><span class="javascript">            myChart.setOption(<span class="built_in">JSON</span>.parse(option));</span></span><br><span class="line"><span class="actionscript">            <span class="comment">// 渲染完成之后再给服务器发送保存图片消息</span></span></span><br><span class="line">            sendSavePic();</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line"><span class="actionscript">        <span class="comment">/**************************************分割线***********************************/</span></span></span><br><span class="line"><span class="actionscript">        <span class="comment">// 基于准备好的dom，初始化echarts实例</span></span></span><br><span class="line"><span class="javascript">        myChart = echarts.init(<span class="built_in">document</span>.getElementById(<span class="string">'main'</span>));</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(<span class="string">'index initPage finished!'</span>)</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="javascript">    $(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line">        initPage();</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><p>编写测试类：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ApplicationTests</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testOption</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        String titleStr = <span class="string">"对象序列化为JSON字符串"</span>;</span><br><span class="line">        <span class="comment">// 几个测试对象</span></span><br><span class="line">        List&lt;String&gt; objects = Arrays.asList(<span class="string">"FastJson"</span>, <span class="string">"Jackson"</span>, <span class="string">"Gson"</span>, <span class="string">"Json-lib"</span>);</span><br><span class="line">        <span class="comment">// 测试维度，输入值n</span></span><br><span class="line">        List&lt;String&gt; dimensions = Arrays.asList(<span class="string">"10000次"</span>, <span class="string">"100000次"</span>, <span class="string">"1000000次"</span>);</span><br><span class="line">        <span class="comment">// 有几个测试对象，就有几组测试数据，每组测试数据中对应几个维度的结果</span></span><br><span class="line">        List&lt;List&lt;Double&gt;&gt; allData = <span class="keyword">new</span> ArrayList&lt;List&lt;Double&gt;&gt;()&#123;</span><br><span class="line">            &#123;</span><br><span class="line">               add(Arrays.asList(<span class="number">2.17</span>, <span class="number">9.10</span>, <span class="number">21.70</span>));</span><br><span class="line">               add(Arrays.asList(<span class="number">1.94</span>, <span class="number">8.94</span>, <span class="number">19.43</span>));</span><br><span class="line">               add(Arrays.asList(<span class="number">4.88</span>, <span class="number">22.88</span>, <span class="number">48.89</span>));</span><br><span class="line">               add(Arrays.asList(<span class="number">9.11</span>, <span class="number">58.14</span>, <span class="number">108.44</span>));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        String optionStr = generateOption(titleStr, objects, dimensions, allData, <span class="string">"秒"</span>);</span><br><span class="line">        <span class="comment">// POST到接口上</span></span><br><span class="line">        postOption(optionStr, <span class="string">"http://localhost:9075/api/v1/data"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>一切准备就绪后，就可以开始测试了，步骤如下：</p>
<ol>
<li>启动应用</li>
<li>打开首页 <a href="http://localhost:9075/" target="_blank" rel="noopener">http://localhost:9075/</a></li>
<li>运行测试类<code>ApplicationTests.java</code></li>
</ol>
<p>结果首页显示如下：</p>
<p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591544602-086fbf54631f3fd9a592d984fdb20482.png" alt=""></p>
<p>同时去<code>E:/pics/</code>目录去看看，图片也成功保存。</p>
<h2 id="GitHub源码"><a href="#GitHub源码" class="headerlink" title="GitHub源码"></a>GitHub源码</h2><p><a href="https://github.com/yidao620c/SpringBootBucket/tree/master/springboot-echarts" target="_blank" rel="noopener">springboot-echarts</a>   –已测试</p>
<h2 id="来源"><a href="#来源" class="headerlink" title="来源"></a>来源</h2><p><a href="https://www.xncoding.com/" target="_blank" rel="noopener">https://www.xncoding.com/</a></p>
]]></content>
      <categories>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>springboot</tag>
        <tag>echarts</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBoot系列 - 集成Hibernate</title>
    <url>/2020/06/08/SpringBoot%E7%B3%BB%E5%88%97-%E9%9B%86%E6%88%90Hibernate/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="SpringBoot系列-集成Hibernate"><a href="#SpringBoot系列-集成Hibernate" class="headerlink" title="SpringBoot系列 - 集成Hibernate"></a>SpringBoot系列 - 集成Hibernate</h1><p>Hibernate与MyBatis都是流行的持久层开发框架，前一遍介绍了怎样在SpringBoot中集成MyBatis，本篇来介绍如何集成Hibernate作为DAO层。</p>
<p>Hibernate 是一个高性能的对象/关系映射（ORM）持久化存储和查询的服务，不仅负责从Java类到数据库表的映射 （还包括从Java数据类型到SQL数据类型的映射），还提供了面向对象的数据查询检索机制，从而极大地缩短了手动处理SQL和JDBC上的开发时间。 同时，Hibernate还实现了JPA规范，在SpringBoot中，JPA的默认实现就是使用的Hibernate。</p>
<h2 id="JPA和Hibernate"><a href="#JPA和Hibernate" class="headerlink" title="JPA和Hibernate"></a>JPA和Hibernate</h2><p>在讲解如何在SpringBoot中使用Hibernate框架之前，先要弄清几个基本概念以及它们之间的关系。</p>
<ol>
<li>JPA</li>
<li>Hibernate</li>
<li>Spring Data</li>
<li>Spring Data JPA</li>
</ol>
<h3 id="JPA"><a href="#JPA" class="headerlink" title="JPA"></a>JPA</h3><p>JPA(Java Persistence API)是Sun官方提出的Java持久化规范，它为Java开发人员提供了一种对象/关系映射工具来管理Java应用中的关系数据。</p>
<p>上面已经描述很清楚了，JPA是一种规范和标准，也就是类似于Java中的接口，由Sun公司官方定义，但是并没有指定谁来实现。</p>
<p>现在几个主要的JPA实现技术有Hibernate、EclipseLink、OpenJPA等。</p>
<h3 id="Hibernate"><a href="#Hibernate" class="headerlink" title="Hibernate"></a>Hibernate</h3><p>Hibernate是一个开放源代码的对象关系映射框架，它对JDBC进行了非常轻量级的对象封装，它将POJO与数据库表建立映射关系，是一个全自动的ORM框架。 Hibernate可以自动生成SQL语句、自动执行，从而使得Java程序员可以随心所欲的使用对象编程思维来操纵数据库。</p>
<p>实际上，JPA规范制定过程中就是借鉴了Hibernate等这些开源的持久框架，也就是说Hibernate的出现比JPA还要早些。</p>
<p>在Hibernate中使用的注解就是JPA注解，Hibernate实现了JPA规范。</p>
<h3 id="Spring-Data"><a href="#Spring-Data" class="headerlink" title="Spring Data"></a>Spring Data</h3><p>Spring Data是一个用于简化数据库访问，并支持云服务的开源框架。其主要目标是使得数据库的访问变得方便快捷， 并支持map-reduce框架和云计算数据服务。此外，它还支持基于关系型数据库的数据服务，如Oracle RAC等。</p>
<p>所以Spring Data本身就是一个开源的框架。</p>
<h3 id="Spring-Data-JPA"><a href="#Spring-Data-JPA" class="headerlink" title="Spring Data JPA"></a>Spring Data JPA</h3><p>上面说过Spring Data是一个开源框架，在这个框架中Spring Data JPA只是这个框架中的一个模块。</p>
<p>它可以极大的简化JPA的写法，可以在几乎不用写实现的情况下，实现对数据的访问和操作。除了CRUD外，还包括如分页、排序等一些常用的功能。</p>
<p>好了，现在你应该对这些概念有一个基本认识了，接下来进入正题，演示如何在SpringBoot中使用Hibernate。</p>
<h2 id="maven依赖"><a href="#maven依赖" class="headerlink" title="maven依赖"></a>maven依赖</h2><p>第一步添加maven依赖：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-jpa<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mysql-connector.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;druid.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>注意，使用mysql数据库来演示的话还要添加数据库驱动包，另外还添加了druid连接池。</p>
<h2 id="准备数据库"><a href="#准备数据库" class="headerlink" title="准备数据库"></a>准备数据库</h2><p>如何安装mysql，配置用户名和密码之类我就不在这里讲了，请自行google。</p>
<p>下面是我的schema.sql文件，创建一个pos数据库，并创建一个article表，插入几条初始数据：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- Dumping database structure for concretepage</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> <span class="keyword">IF</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> <span class="string">`pos`</span> <span class="keyword">default</span> <span class="keyword">charset</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci;</span><br><span class="line"><span class="keyword">SET</span> FOREIGN_KEY_CHECKS=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">USE</span> <span class="string">`pos`</span>;</span><br><span class="line"><span class="comment">-- Dumping structure for table concretepage.articles</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> <span class="string">`articles`</span> (</span><br><span class="line">  <span class="string">`article_id`</span> <span class="built_in">int</span>(<span class="number">5</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="string">`title`</span> <span class="built_in">varchar</span>(<span class="number">200</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`category`</span> <span class="built_in">varchar</span>(<span class="number">100</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`article_id`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> AUTO_INCREMENT=<span class="number">1</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8 <span class="keyword">COMMENT</span>=<span class="string">'文章表'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- Dumping data for table concretepage.articles: ~3 rows (approximately)</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`articles`</span> (<span class="string">`article_id`</span>, <span class="string">`title`</span>, <span class="string">`category`</span>) <span class="keyword">VALUES</span></span><br><span class="line">    (<span class="number">1</span>, <span class="string">'Java Concurrency'</span>, <span class="string">'Java'</span>),</span><br><span class="line">    (<span class="number">2</span>, <span class="string">'Hibernate HQL '</span>, <span class="string">'Hibernate'</span>),</span><br><span class="line">    (<span class="number">3</span>, <span class="string">'Spring MVC with Hibernate'</span>, <span class="string">'Spring'</span>);</span><br></pre></td></tr></table></figure>

<p>注意，Hibernate可以根据实体类自动创建表，本篇我不介绍这个功能，还是手动创建表结构。</p>
<h2 id="修改配置文件"><a href="#修改配置文件" class="headerlink" title="修改配置文件"></a>修改配置文件</h2><p>数据库创建好后，修改application.yml配置文件，新增如下数据库连接配置：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment">###################  spring配置  ###################</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">dev</span></span><br><span class="line">  <span class="attr">jpa:</span></span><br><span class="line">    <span class="attr">properties:</span></span><br><span class="line">      <span class="attr">hibernate:</span></span><br><span class="line">        <span class="attr">dialect:</span> <span class="string">org.hibernate.dialect.MySQLDialect</span></span><br><span class="line">        <span class="attr">new_generator_mappings:</span> <span class="literal">false</span></span><br><span class="line">        <span class="attr">format_sql:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">      <span class="attr">url:</span> <span class="string">jdbc:mysql://127.0.0.1:3306/pos?serverTimezone=UTC&amp;useSSL=false&amp;autoReconnect=true&amp;tinyInt1isBit=false&amp;useUnicode=true&amp;characterEncoding=utf8</span></span><br><span class="line">      <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">      <span class="attr">password:</span> <span class="number">123456</span></span><br></pre></td></tr></table></figure>

<h2 id="实体类"><a href="#实体类" class="headerlink" title="实体类"></a>实体类</h2><p>article表对应的实体类如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table</span>(name = <span class="string">"articles"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Article</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue</span>(strategy = GenerationType.AUTO)</span><br><span class="line">    <span class="meta">@Column</span>(name = <span class="string">"article_id"</span>)</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> articleId;</span><br><span class="line">    <span class="meta">@Column</span>(name = <span class="string">"title"</span>)</span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">    <span class="meta">@Column</span>(name = <span class="string">"category"</span>)</span><br><span class="line">    <span class="keyword">private</span> String category;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 省略getter/setter</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="DAO设计"><a href="#DAO设计" class="headerlink" title="DAO设计"></a>DAO设计</h2><p>先创建一个DAO的接口类：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IArticleDAO</span> </span>&#123;</span><br><span class="line">    <span class="function">List&lt;Article&gt; <span class="title">getAllArticles</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">Article <span class="title">getArticleById</span><span class="params">(<span class="keyword">int</span> articleId)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">addArticle</span><span class="params">(Article article)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">updateArticle</span><span class="params">(Article article)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">deleteArticle</span><span class="params">(<span class="keyword">int</span> articleId)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">articleExists</span><span class="params">(String title, String category)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后写一个实现类，在这类中注入<code>EntityManager</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ArticleDAO</span> <span class="keyword">implements</span> <span class="title">IArticleDAO</span> </span>&#123;</span><br><span class="line">    <span class="meta">@PersistenceContext</span></span><br><span class="line">    <span class="keyword">private</span> EntityManager entityManager;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Article <span class="title">getArticleById</span><span class="params">(<span class="keyword">int</span> articleId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> entityManager.find(Article<span class="class">.<span class="keyword">class</span>, <span class="title">articleId</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Article&gt; <span class="title">getAllArticles</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String hql = <span class="string">"FROM Article as atcl ORDER BY atcl.articleId"</span>;</span><br><span class="line">        <span class="keyword">return</span> (List&lt;Article&gt;) entityManager.createQuery(hql).getResultList();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addArticle</span><span class="params">(Article article)</span> </span>&#123;</span><br><span class="line">        entityManager.persist(article);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateArticle</span><span class="params">(Article article)</span> </span>&#123;</span><br><span class="line">        Article artcl = getArticleById(article.getArticleId());</span><br><span class="line">        artcl.setTitle(article.getTitle());</span><br><span class="line">        artcl.setCategory(article.getCategory());</span><br><span class="line">        entityManager.flush();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteArticle</span><span class="params">(<span class="keyword">int</span> articleId)</span> </span>&#123;</span><br><span class="line">        entityManager.remove(getArticleById(articleId));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">articleExists</span><span class="params">(String title, String category)</span> </span>&#123;</span><br><span class="line">        String hql = <span class="string">"FROM Article as atcl WHERE atcl.title = ? and atcl.category = ?"</span>;</span><br><span class="line">        <span class="keyword">int</span> count = entityManager.createQuery(hql).setParameter(<span class="number">0</span>, title)</span><br><span class="line">                .setParameter(<span class="number">1</span>, category).getResultList().size();</span><br><span class="line">        <span class="keyword">return</span> count &gt; <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="业务Service"><a href="#业务Service" class="headerlink" title="业务Service"></a>业务Service</h2><p>编写业务逻辑Service类，注入DAO类：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ArticleService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> IArticleDAO articleDAO;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Article <span class="title">getArticleById</span><span class="params">(<span class="keyword">int</span> articleId)</span> </span>&#123;</span><br><span class="line">        Article obj = articleDAO.getArticleById(articleId);</span><br><span class="line">        <span class="keyword">return</span> obj;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Article&gt; <span class="title">getAllArticles</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> articleDAO.getAllArticles();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">boolean</span> <span class="title">addArticle</span><span class="params">(Article article)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (articleDAO.articleExists(article.getTitle(), article.getCategory())) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            articleDAO.addArticle(article);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateArticle</span><span class="params">(Article article)</span> </span>&#123;</span><br><span class="line">        articleDAO.updateArticle(article);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteArticle</span><span class="params">(<span class="keyword">int</span> articleId)</span> </span>&#123;</span><br><span class="line">        articleDAO.deleteArticle(articleId);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="编写测试用例"><a href="#编写测试用例" class="headerlink" title="编写测试用例"></a>编写测试用例</h2><p>OK，一切写完后，就来编写我们的测试用例：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RunWith</span>(SpringRunner<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">@<span class="title">SpringBootTest</span></span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">ApplicationTests</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger log = LoggerFactory.getLogger(ApplicationTests<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> ArticleService articleService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 测试增删改查</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Article article = articleService.getArticleById(<span class="number">1</span>);</span><br><span class="line">        assertThat(article.getTitle(), is(<span class="string">"Java Concurrency"</span>));</span><br><span class="line"></span><br><span class="line">        List&lt;Article&gt; list = articleService.getAllArticles();</span><br><span class="line">        assertThat(list, notNullValue());</span><br><span class="line">        assertThat(list.size(), is(<span class="number">3</span>));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">boolean</span> flag = articleService.addArticle(article);</span><br><span class="line">        assertThat(flag, is(<span class="keyword">false</span>));</span><br><span class="line"></span><br><span class="line">        article.setTitle(<span class="string">"Python Concurrency"</span>);</span><br><span class="line">        articleService.updateArticle(article);</span><br><span class="line">        Article article1 = articleService.getArticleById(<span class="number">1</span>);</span><br><span class="line">        assertThat(article1.getTitle(), is(<span class="string">"Python Concurrency"</span>));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        articleService.deleteArticle(<span class="number">1</span>);</span><br><span class="line">        Article article2 = articleService.getArticleById(<span class="number">1</span>);</span><br><span class="line">        assertThat(article2, nullValue());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面先查询id=1的文章，看看标题是否为<code>Java Concurrency</code>，然后查询所有文章列表，之后更新文章标题后再次查询看看是否更新成功。 最后删除这篇文章，再次查询结果为null。</p>
<p>运行结果green bar，测试通过。</p>
<p>更多Hibernate相关文档，请参考 <a href="http://hibernate.org/" target="_blank" rel="noopener">官网</a> 。</p>
<h2 id="GitHub源码"><a href="#GitHub源码" class="headerlink" title="GitHub源码"></a>GitHub源码</h2><p><a href="https://github.com/yidao620c/SpringBootBucket/tree/master/springboot-hibernate" target="_blank" rel="noopener">springboot-hibernate</a></p>
<h2 id="来源"><a href="#来源" class="headerlink" title="来源"></a>来源</h2><p><a href="https://www.xncoding.com/" target="_blank" rel="noopener">https://www.xncoding.com/</a></p>
]]></content>
      <categories>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>springboot</tag>
        <tag>hibernate</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBoot系列 - 集成MyBatis</title>
    <url>/2020/06/08/SpringBoot%E7%B3%BB%E5%88%97-%E9%9B%86%E6%88%90MyBatis/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="SpringBoot系列-集成MyBatis"><a href="#SpringBoot系列-集成MyBatis" class="headerlink" title="SpringBoot系列 - 集成MyBatis"></a>SpringBoot系列 - 集成MyBatis</h1><p>MyBatis 是一款优秀的持久层框架，它支持定制化 SQL、存储过程以及高级映射。MyBatis 避免了几乎所有的 JDBC 代码和手动设置参数以及获取结果集。 MyBatis 可以使用简单的 XML 或注解来配置和映射原生信息，将接口和 Java 的 POJOs映射成数据库中的记录。</p>
<p>使用MyBatis的时候需要自己手动编写SQL语句，也有代码自动生成工具来简化开发，我一般会使用Mybatis-Plus增强工具包来简化MyBatis的开发。</p>
<p>Mybatis-Plus官网：<a href="https://github.com/baomidou/mybatis-plus" target="_blank" rel="noopener">https://github.com/baomidou/mybatis-plus</a></p>
<p>同时它还提供了与SpringBoot的集成starter，非常的方便，本篇我将讲解如何在SpringBoot中集成MyBatis-Plus。</p>
<h2 id="maven依赖"><a href="#maven依赖" class="headerlink" title="maven依赖"></a>maven依赖</h2><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">project.reporting.outputEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.reporting.outputEncoding</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">druid.version</span>&gt;</span>1.1.2<span class="tag">&lt;/<span class="name">druid.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mysql-connector.version</span>&gt;</span>8.0.7-dmr<span class="tag">&lt;/<span class="name">mysql-connector.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mybatis-plus.version</span>&gt;</span>2.1.8<span class="tag">&lt;/<span class="name">mybatis-plus.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mybatisplus-spring-boot-starter.version</span>&gt;</span>1.0.5<span class="tag">&lt;/<span class="name">mybatisplus-spring-boot-starter.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mysql-connector.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;druid.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- MyBatis plus增强和springboot的集成--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mybatis-plus.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatisplus-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mybatisplus-spring-boot-starter.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.hamcrest<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hamcrest-all<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这里我使用mysql数据库，阿里的druid连接池。</p>
<h2 id="初始化表"><a href="#初始化表" class="headerlink" title="初始化表"></a>初始化表</h2><p>关于mysql数据库的安装我这里就不讲了，只提供schema.sql文件初始化一个用户表，用作演示：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> <span class="keyword">IF</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> pos <span class="keyword">default</span> <span class="keyword">charset</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci;</span><br><span class="line"><span class="keyword">SET</span> FOREIGN_KEY_CHECKS=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">USE</span> pos;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 用户表</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> <span class="string">`t_user`</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`t_user`</span> (</span><br><span class="line">  <span class="string">`id`</span>                        <span class="built_in">INT</span>(<span class="number">11</span>) PRIMARY <span class="keyword">KEY</span> AUTO_INCREMENT <span class="keyword">COMMENT</span> <span class="string">'主键ID'</span>,</span><br><span class="line">  <span class="string">`username`</span>                  <span class="built_in">VARCHAR</span>(<span class="number">32</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'账号'</span>,</span><br><span class="line">  <span class="string">`name`</span>                      <span class="built_in">VARCHAR</span>(<span class="number">16</span>) <span class="keyword">DEFAULT</span> <span class="string">''</span> <span class="keyword">COMMENT</span> <span class="string">'名字'</span>,</span><br><span class="line">  <span class="string">`password`</span>                  <span class="built_in">VARCHAR</span>(<span class="number">128</span>) <span class="keyword">DEFAULT</span> <span class="string">''</span> <span class="keyword">COMMENT</span> <span class="string">'密码'</span>,</span><br><span class="line">  <span class="string">`salt`</span>                      <span class="built_in">VARCHAR</span>(<span class="number">64</span>) <span class="keyword">DEFAULT</span> <span class="string">''</span> <span class="keyword">COMMENT</span> <span class="string">'md5密码盐'</span>,</span><br><span class="line">  <span class="string">`phone`</span>                     <span class="built_in">VARCHAR</span>(<span class="number">32</span>) <span class="keyword">DEFAULT</span> <span class="string">''</span> <span class="keyword">COMMENT</span> <span class="string">'联系电话'</span>,</span><br><span class="line">  <span class="string">`tips`</span>                      <span class="built_in">VARCHAR</span>(<span class="number">255</span>) <span class="keyword">COMMENT</span> <span class="string">'备注'</span>,</span><br><span class="line">  <span class="string">`state`</span>                     <span class="built_in">TINYINT</span>(<span class="number">1</span>) <span class="keyword">DEFAULT</span> <span class="number">1</span> <span class="keyword">COMMENT</span> <span class="string">'状态 1:正常 2:禁用'</span>,</span><br><span class="line">  <span class="string">`created_time`</span>              DATETIME <span class="keyword">DEFAULT</span> <span class="keyword">CURRENT_TIMESTAMP</span> <span class="keyword">COMMENT</span> <span class="string">'创建时间'</span>,</span><br><span class="line">  <span class="string">`updated_time`</span>              DATETIME <span class="keyword">DEFAULT</span> <span class="keyword">CURRENT_TIMESTAMP</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="keyword">CURRENT_TIMESTAMP</span> <span class="keyword">COMMENT</span> <span class="string">'更新时间'</span></span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> AUTO_INCREMENT=<span class="number">1</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8 <span class="keyword">COMMENT</span>=<span class="string">'用户表'</span>;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`t_user`</span> <span class="keyword">VALUES</span> (<span class="number">1</span>,<span class="string">'admin'</span>,<span class="string">'系统管理员'</span>,<span class="string">'123456'</span>,<span class="string">'www'</span>, <span class="string">'17890908889'</span>, <span class="string">'系统管理员'</span>, <span class="number">1</span>, <span class="string">'2017-12-12 09:46:12'</span>, <span class="string">'2017-12-12 09:46:12'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`t_user`</span> <span class="keyword">VALUES</span> (<span class="number">2</span>,<span class="string">'aix'</span>,<span class="string">'张三'</span>,<span class="string">'123456'</span>,<span class="string">'eee'</span>, <span class="string">'17859569358'</span>, <span class="string">''</span>, <span class="number">1</span>, <span class="string">'2017-12-12 09:46:12'</span>, <span class="string">'2017-12-12 09:46:12'</span>);</span><br></pre></td></tr></table></figure>

<h2 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h2><p>修改application.yml配置文件，注意是mysql连接信息和mybatis-plus的配置：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment">###################  mybatis-plus配置  ###################</span></span><br><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath*:com/xncoding/pos/common/dao/repository/mapping/*.xml</span></span><br><span class="line">  <span class="attr">typeAliasesPackage:</span> <span class="string">&gt;</span></span><br><span class="line">    <span class="string">com.xncoding.pos.common.dao.entity</span></span><br><span class="line">  <span class="attr">global-config:</span></span><br><span class="line">    <span class="attr">id-type:</span> <span class="number">0</span>  <span class="comment"># 0:数据库ID自增   1:用户输入id  2:全局唯一id(IdWorker)  3:全局唯一ID(uuid)</span></span><br><span class="line">    <span class="attr">db-column-underline:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">refresh-mapper:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">configuration:</span></span><br><span class="line">    <span class="attr">map-underscore-to-camel-case:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">cache-enabled:</span> <span class="literal">true</span> <span class="comment">#配置的缓存的全局开关</span></span><br><span class="line">    <span class="attr">lazyLoadingEnabled:</span> <span class="literal">true</span> <span class="comment">#延时加载的开关</span></span><br><span class="line">    <span class="attr">multipleResultSetsEnabled:</span> <span class="literal">true</span> <span class="comment">#开启的话，延时加载一个属性时会加载该对象全部属性，否则按需加载属性</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">      <span class="attr">url:</span> <span class="string">jdbc:mysql://127.0.0.1:3306/pos?useSSL=false&amp;autoReconnect=true&amp;tinyInt1isBit=false&amp;useUnicode=true&amp;characterEncoding=utf8</span></span><br><span class="line">      <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">      <span class="attr">password:</span> <span class="number">123456</span></span><br></pre></td></tr></table></figure>

<p>主要解释两个配置：</p>
<ol>
<li>mapper-locations 这个是你定义的mapping文件，支持通配符，如果有多个用逗号隔开。</li>
<li>typeAliasesPackage 这个定义实体类所在的包名，或者其他能使用别名的类所在的包。</li>
</ol>
<h2 id="配置类"><a href="#配置类" class="headerlink" title="配置类"></a>配置类</h2><p>由于使用到的Druid连接池的配置项非常多，可先定义一个<code>DruidProperties</code>属性类，具体的数据源配置我就不贴了。 然后再定义<code>MybatisPlusConfig</code>如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableTransactionManagement</span>(order = <span class="number">2</span>)</span><br><span class="line"><span class="meta">@MapperScan</span>(basePackages = &#123;</span><br><span class="line">        <span class="string">"com.xncoding.pos.common.dao.repository"</span>,</span><br><span class="line">        <span class="string">"com.xncoding.pos.dao.repository"</span>&#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MybatisPlusConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> DruidProperties druidProperties;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 单数据源连接池配置</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DruidDataSource <span class="title">singleDatasource</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        DruidDataSource dataSource = <span class="keyword">new</span> DruidDataSource();</span><br><span class="line">        druidProperties.config(dataSource);</span><br><span class="line">        <span class="keyword">return</span> dataSource;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * mybatis-plus分页插件</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> PaginationInterceptor <span class="title">paginationInterceptor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> PaginationInterceptor();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里要说明一下：</p>
<p>@EnableTransactionManagement开启了事务支持。</p>
<p>@MapperScan注解扫描DAO类，支持多个包，用逗号隔开。</p>
<p>然后在里面定义了一个数据源的类，另外还定义了分页插件，这个用在分页查询上面，本篇演示还用不到。</p>
<h2 id="实体类"><a href="#实体类" class="headerlink" title="实体类"></a>实体类</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@TableName</span>(value = <span class="string">"t_user"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">extends</span> <span class="title">Model</span>&lt;<span class="title">User</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 主键ID</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@TableId</span>(value=<span class="string">"id"</span>, type= IdType.AUTO)</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 账号</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 名字</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 密码</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * md5密码盐</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String salt;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 联系电话</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String phone;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 备注</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String tips;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 状态 1:正常 2:禁用</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer state;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建时间</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Date createdTime;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 更新时间</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Date updatedTime;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 省略getter/setter</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="DAO类"><a href="#DAO类" class="headerlink" title="DAO类"></a>DAO类</h2><p>接下来定义DAO操作类：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapper</span> <span class="keyword">extends</span> <span class="title">BaseMapper</span>&lt;<span class="title">User</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个接口继承 <code>BaseMapper&lt;User&gt;</code>后即可获得常用的增删改查的方法， 如果有其他复杂的操作，就再定义自己的方法，并同时定义mapping文件即可。</p>
<p>这里演示比较简单，无需自己再去写mapping文件。</p>
<h2 id="业务逻辑Servcie"><a href="#业务逻辑Servcie" class="headerlink" title="业务逻辑Servcie"></a>业务逻辑Servcie</h2><p>接下来定义业务逻辑处理类，并将DAO类注入进去：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 通过ID查找用户</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">findById</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userMapper.selectById(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 新增用户</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> user</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertUser</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">        userMapper.insert(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改用户</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> user</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateUser</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">        userMapper.updateById(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除用户</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteUser</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">        userMapper.deleteById(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="测试类"><a href="#测试类" class="headerlink" title="测试类"></a>测试类</h2><p>一切搞定后，接下来开始编写测试用例试试看：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 测试</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RunWith</span>(SpringRunner<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">@<span class="title">SpringBootTest</span></span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">ApplicationTests</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger log = LoggerFactory.getLogger(ApplicationTests<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 测试增删改查</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        User user = <span class="keyword">new</span> User();</span><br><span class="line">        user.setUsername(<span class="string">"xiaoxx"</span>);</span><br><span class="line">        user.setName(<span class="string">"小星星"</span>);</span><br><span class="line">        user.setPassword(<span class="string">"222222"</span>);</span><br><span class="line">        user.setPhone(<span class="string">"13890907676"</span>);</span><br><span class="line">        userService.insertUser(user);</span><br><span class="line"></span><br><span class="line">        User user1 = userService.findById(user.getId());</span><br><span class="line">        assertThat(user1.getUsername(), is(<span class="string">"xiaoxx"</span>));</span><br><span class="line">        assertThat(user1.getName(), is(<span class="string">"小星星"</span>));</span><br><span class="line"></span><br><span class="line">        user1.setPassword(<span class="string">"888888"</span>);</span><br><span class="line">        userService.updateUser(user1);</span><br><span class="line">        User user2 = userService.findById(user.getId());</span><br><span class="line">        assertThat(user2.getPassword(), is(<span class="string">"888888"</span>));</span><br><span class="line"></span><br><span class="line">        userService.deleteUser(user.getId());</span><br><span class="line"></span><br><span class="line">        User user3 = userService.findById(user.getId());</span><br><span class="line">        assertThat(user3, nullValue());</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>先创建一个用户，插入到表中，使用了数据库的自增主键，调用<code>insertUser</code>成功后，user的id会被自动设置上。 然后再通过id查询用户，确保能查询到。后面更新用户并确认，删除用户并确认。</p>
<p>运行测试用例，结果是green bar，测试通过。</p>
<h2 id="GitHub源码"><a href="#GitHub源码" class="headerlink" title="GitHub源码"></a>GitHub源码</h2><p><a href="https://github.com/yidao620c/SpringBootBucket/tree/master/springboot-mybatis" target="_blank" rel="noopener">springboot-mybatis</a>   —已测试</p>
<h2 id="来源"><a href="#来源" class="headerlink" title="来源"></a>来源</h2><p><a href="https://www.xncoding.com/" target="_blank" rel="noopener">https://www.xncoding.com/</a></p>
]]></content>
      <categories>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>mybatis</tag>
        <tag>springboot</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBoot系列 - 集成MongoDB</title>
    <url>/2020/06/08/SpringBoot%E7%B3%BB%E5%88%97-%E9%9B%86%E6%88%90MongoDB/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="SpringBoot系列-集成MongoDB"><a href="#SpringBoot系列-集成MongoDB" class="headerlink" title="SpringBoot系列 - 集成MongoDB"></a>SpringBoot系列 - 集成MongoDB</h1><p>MongoDB是一个高性能、开源、无模式的文档型数据库，是当前NoSql数据库中比较热门的一种。 适合对大量或者无固定格式的数据进行存储，比如：日志、缓存等。对事物支持较弱，不适用复杂的多文档（多表）的级联查询。</p>
<p>MongoDB的适用场景：</p>
<ol>
<li>在应用服务器的日志记录</li>
<li>存储一些监控数据</li>
<li>应用不需要事务及复杂 join 支持</li>
<li>应用需要2000-3000以上的读写QPS</li>
<li>应用需要TB甚至 PB 级别数据存储</li>
<li>应用发展迅速，需要能快速水平扩展</li>
<li>应用要求存储的数据不丢失</li>
<li>应用需要99.999%高可用</li>
<li>应用需要大量的地理位置查询、文本查询</li>
</ol>
<p>本篇将介绍如何在SpringBoot中使用MongoDB数据库。</p>
<h2 id="maven依赖"><a href="#maven依赖" class="headerlink" title="maven依赖"></a>maven依赖</h2><p>只需要添加：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-mongodb<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="安装MongoDB"><a href="#安装MongoDB" class="headerlink" title="安装MongoDB"></a>安装MongoDB</h2><p>MongoDB的安装教程请参考 <a href="https://docs.mongodb.com/manual/tutorial/install-mongodb-on-red-hat/" target="_blank" rel="noopener">官网安装</a></p>
<p>我是在centos7上面安装的MongoDB 4.0，并且修改配置文件<code>/etc/mongod.conf</code>，将绑定端口设置成<code>0.0.0.0</code>，让其他主机也能访问。</p>
<p>启动mongodb后，添加一个用户，步骤如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mongo --port 27017</span><br><span class="line">use test</span><br><span class="line">db.createUser(</span><br><span class="line">   &#123;</span><br><span class="line">     user: &quot;xiongneng&quot;,</span><br><span class="line">     pwd: &quot;123456&quot;,</span><br><span class="line">     roles: [ &#123; role: &quot;readWrite&quot;, db: &quot;test&quot; &#125; ]</span><br><span class="line">   &#125;</span><br><span class="line"> )</span><br></pre></td></tr></table></figure>

<h2 id="修改配置文件"><a href="#修改配置文件" class="headerlink" title="修改配置文件"></a>修改配置文件</h2><p>修改<code>application.yml</code>配置，增加mongodb的配置项：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">data:</span></span><br><span class="line">    <span class="attr">mongodb:</span></span><br><span class="line">      <span class="attr">uri:</span> <span class="string">mongodb://xiongneng:123456@localhost:27017/test</span></span><br></pre></td></tr></table></figure>

<h2 id="定义实体类"><a href="#定义实体类" class="headerlink" title="定义实体类"></a>定义实体类</h2><p>这里只是为了测试，我就定义一个简单的客户类：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Document</span>(collection = <span class="string">"customer"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Customer</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line">    <span class="keyword">private</span> String firstName;</span><br><span class="line">    <span class="keyword">private</span> String lastName;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Customer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Customer</span><span class="params">(String firstName, String lastName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.firstName = firstName;</span><br><span class="line">        <span class="keyword">this</span>.lastName = lastName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 省略get、set方法</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> String.format(</span><br><span class="line">                <span class="string">"Customer[id=%s, firstName='%s', lastName='%s']"</span>,</span><br><span class="line">                id, firstName, lastName);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其中的id属性是MongoDB用来唯一识别客户的主键，其实这里可以不用注解，因为默认就叫id。</p>
<p>另外MongoDB里面的数据会存储到集合中，Spring Data MongoDB会将Customer类的数据映射到名字叫<code>customer</code>的集合中。</p>
<h2 id="定义DAO类"><a href="#定义DAO类" class="headerlink" title="定义DAO类"></a>定义DAO类</h2><p>这里可继承<code>MongoRepository</code>，这样一些通用操作的方法，比如增删改查你就不用写了，只需要添加你自己自定义的其他方法：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CustomerRepository</span> <span class="keyword">extends</span> <span class="title">MongoRepository</span>&lt;<span class="title">Customer</span>, <span class="title">String</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function">Customer <span class="title">findByFirstName</span><span class="params">(String firstName)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">List&lt;Customer&gt; <span class="title">findByLastName</span><span class="params">(String lastName)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里我定义了两个简单查询方法，一个是根据名称查找单个客户，一个是根据姓来查找客户列表。 你无需去写实现类，运行时SpringBoot会自动帮你生成实现，这也是它的强大之处，将你从代码樊笼中解脱出来。</p>
<h2 id="编写服务类"><a href="#编写服务类" class="headerlink" title="编写服务类"></a>编写服务类</h2><p>接下来编写核心的业务服务类 <code>CustomerService</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomerService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> CustomerRepository repository;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除所有的客户</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        repository.deleteAll();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 保存客户</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> customer 客户</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">(Customer customer)</span> </span>&#123;</span><br><span class="line">        repository.save(customer);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询所有客户列表</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 客户列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Iterable&lt;Customer&gt; <span class="title">findAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> repository.findAll();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 通过名查找某个客户</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> firstName</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Customer <span class="title">findByFirstName</span><span class="params">(String firstName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> repository.findByFirstName(firstName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 通过姓查找客户列表</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> lastName</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Customer&gt; <span class="title">findByLastName</span><span class="params">(String lastName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> repository.findByLastName(lastName);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="编写测试用例"><a href="#编写测试用例" class="headerlink" title="编写测试用例"></a>编写测试用例</h2><p>OK，一切准备妥当之后，我们来编写测试用例：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RunWith</span>(SpringRunner<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">@<span class="title">SpringBootTest</span></span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">ApplicationTests</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger log = LoggerFactory.getLogger(ApplicationTests<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> CustomerService service;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 测试增删改查</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        service.deleteAll();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// save a couple of customers</span></span><br><span class="line">        service.save(<span class="keyword">new</span> Customer(<span class="string">"Alice"</span>, <span class="string">"Smith"</span>));</span><br><span class="line">        service.save(<span class="keyword">new</span> Customer(<span class="string">"Bob"</span>, <span class="string">"Smith"</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// fetch all customers</span></span><br><span class="line">        System.out.println(<span class="string">"Customers found with findAll():"</span>);</span><br><span class="line">        System.out.println(<span class="string">"-------------------------------"</span>);</span><br><span class="line">        <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (Customer customer : service.findAll()) &#123;</span><br><span class="line">            System.out.println(customer);</span><br><span class="line">            count++;</span><br><span class="line">        &#125;</span><br><span class="line">        assertThat(count, is(<span class="number">2</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// fetch an individual customer</span></span><br><span class="line">        System.out.println(<span class="string">"Customer found with findByFirstName('Alice'):"</span>);</span><br><span class="line">        System.out.println(<span class="string">"--------------------------------"</span>);</span><br><span class="line">        Customer c = service.findByFirstName(<span class="string">"Alice"</span>);</span><br><span class="line">        assertThat(c, notNullValue());</span><br><span class="line">        assertThat(c.getFirstName(), is(<span class="string">"Alice"</span>));</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"Customers found with findByLastName('Smith'):"</span>);</span><br><span class="line">        System.out.println(<span class="string">"--------------------------------"</span>);</span><br><span class="line"></span><br><span class="line">        List&lt;Customer&gt; list = service.findByLastName(<span class="string">"Smith"</span>);</span><br><span class="line">        assertThat(list, notNullValue());</span><br><span class="line">        assertThat(list.size(), greaterThan(<span class="number">1</span>));</span><br><span class="line">        assertThat(list.size(), is(<span class="number">2</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在上面的测试中，我先删掉数据库中所有客户数据，然后新增两条数据，查询所有的数据，根据姓或名查询。</p>
<p>运行测试结果为green bar，同时输出：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Customers found with findAll():</span><br><span class="line">-------------------------------</span><br><span class="line">Customer[id&#x3D;5a9a30e616afd63f48afeea6, firstName&#x3D;&#39;Alice&#39;, lastName&#x3D;&#39;Smith&#39;]</span><br><span class="line">Customer[id&#x3D;5a9a30e616afd63f48afeea7, firstName&#x3D;&#39;Bob&#39;, lastName&#x3D;&#39;Smith&#39;]</span><br><span class="line">Customer found with findByFirstName(&#39;Alice&#39;):</span><br><span class="line">--------------------------------</span><br><span class="line">Customers found with findByLastName(&#39;Smith&#39;):</span><br></pre></td></tr></table></figure>

<p>更多关于MongoDB的使用，请移步 <a href="https://www.mongodb.com/" target="_blank" rel="noopener">官网</a></p>
<h2 id="GitHub源码"><a href="#GitHub源码" class="headerlink" title="GitHub源码"></a>GitHub源码</h2><p><a href="https://github.com/yidao620c/SpringBootBucket/tree/master/springboot-mongodb" target="_blank" rel="noopener">springboot-mongodb</a></p>
<h2 id="来源"><a href="#来源" class="headerlink" title="来源"></a>来源</h2><p><a href="https://www.xncoding.com/" target="_blank" rel="noopener">https://www.xncoding.com/</a></p>
]]></content>
      <categories>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>springboot</tag>
        <tag>mongodb</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBoot系列 - 集成Shiro权限管理</title>
    <url>/2020/06/08/SpringBoot%E7%B3%BB%E5%88%97-%E9%9B%86%E6%88%90Shiro%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="SpringBoot系列-集成Shiro权限管理"><a href="#SpringBoot系列-集成Shiro权限管理" class="headerlink" title="SpringBoot系列 - 集成Shiro权限管理"></a>SpringBoot系列 - 集成Shiro权限管理</h1><p><code>Apache Shiro</code>是Java的一个安全框架。目前，使用<code>Apache Shiro</code>的人越来越多，相比<code>Spring Security</code>而言相当简单， 可能没有<code>Spring Security</code>做的功能强大，但是在实际工作时可能并不需要那么复杂的东西， 所以使用小而简单的Shiro就足够了。对于它俩到底哪个好，这个不必纠结，能更简单的解决项目问题就好了。</p>
<p>本教程只介绍基本的Shiro使用，不会过多分析源码等，重在使用。</p>
<h2 id="Shiro架构"><a href="#Shiro架构" class="headerlink" title="Shiro架构"></a>Shiro架构</h2><p>Shiro可以非常容易的开发出足够好的应用，其不仅可以用在JavaSE环境，也可以用在JavaEE环境。 Shiro可以帮助我们完成：认证、授权、加密、会话管理、与Web集成、缓存等。这不就是我们想要的嘛， 而且Shiro的API也是非常简单；其基本功能点如下图所示：</p>
<p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591541990-7423bbe4e69fb2cc25b5a2a09ab09a5e.png" alt=""></p>
<ul>
<li>Authentication：身份认证/登录，验证用户是不是拥有相应的身份；</li>
<li>Authorization：授权，即权限验证，验证某个已认证的用户是否拥有某个权限；即判断用户是否能做事情，常见的如：验证某个用户是否拥有某个角色。或者细粒度的验证某个用户对某个资源是否具有某个权限；</li>
<li>Session Manager：会话管理，即用户登录后就是一次会话，在没有退出之前，它的所有信息都在会话中；会话可以是普通JavaSE环境的，也可以是如Web环境的；</li>
<li>Cryptography：加密，保护数据的安全性，如密码加密存储到数据库，而不是明文存储；</li>
<li>Web Support：Web支持，可以非常容易的集成到Web环境；</li>
<li>Caching：缓存，比如用户登录后，其用户信息、拥有的角色/权限不必每次去查，这样可以提高效率；</li>
<li>Concurrency：shiro支持多线程应用的并发验证，即如在一个线程中开启另一个线程，能把权限自动传播过去；</li>
<li>Testing：提供测试支持；</li>
<li>Run As：允许一个用户假装为另一个用户（如果他们允许）的身份进行访问；</li>
<li>Remember Me：记住我，这个是非常常见的功能，即一次登录后，下次再来的话不用登录了。</li>
</ul>
<p>记住一点，Shiro不会去维护用户、维护权限；这些需要我们自己去设计/提供；然后通过相应的接口注入给Shiro即可。</p>
<p>接下来我们分别从外部和内部来看看Shiro的架构，对于一个好的框架，从外部来看应该具有非常简单易于使用的API， 且API契约明确；从内部来看的话，其应该有一个可扩展的架构，即非常容易插入用户自定义实现，因为任何框架都不能满足所有需求。</p>
<p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591541990-d5dd266072a3cfece1811ece11d99aa9.png" alt=""></p>
<p>可以看到：应用代码直接交互的对象是Subject，也就是说Shiro的对外API核心就是Subject。</p>
<ul>
<li>Subject：主体，代表了当前“用户”，这个用户不一定是一个具体的人，与当前应用交互的任何东西都是Subject，如网络爬虫，机器人等；即一个抽象概念；所有Subject都绑定到SecurityManager，与Subject的所有交互都会委托给SecurityManager；可以把Subject认为是一个门面；SecurityManager才是实际的执行者；</li>
<li>SecurityManager：安全管理器；即所有与安全有关的操作都会与SecurityManager交互；且它管理着所有Subject；可以看出它是Shiro的核心，它负责与后边介绍的其他组件进行交互，如果学习过SpringMVC，你可以把它看成DispatcherServlet前端控制器；</li>
<li>Realm：域，Shiro从从Realm获取安全数据（如用户、角色、权限），就是说SecurityManager要验证用户身份，那么它需要从Realm获取相应的用户进行比较以确定用户身份是否合法；也需要从Realm得到用户相应的角色/权限进行验证用户是否能进行操作；可以把Realm看成DataSource，即安全数据源。</li>
</ul>
<p>也就是说对于我们而言，最简单的一个Shiro应用：</p>
<ol>
<li>应用代码通过Subject来进行认证和授权，而Subject又委托给SecurityManager；</li>
<li>我们需要给Shiro的SecurityManager注入Realm，从而让SecurityManager能得到合法的用户及其权限进行判断。</li>
</ol>
<p>从以上也可以看出，Shiro不提供维护用户/权限，而是通过Realm让开发人员自己注入。</p>
<p>接下来我们来从Shiro内部来看下Shiro的架构，如下图所示：</p>
<p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591541990-b4239eb4af9485aaef0f2d6e2dc997bc.png" alt=""></p>
<ul>
<li>Subject：主体，可以看到主体可以是任何可以与应用交互的“用户”；</li>
<li>SecurityManager：相当于SpringMVC中的DispatcherServlet或者Struts2中的FilterDispatcher；是Shiro的心脏；所有具体的交互都通过SecurityManager进行控制；它管理着所有Subject、且负责进行认证和授权、及会话、缓存的管理。</li>
<li>Authenticator：认证器，负责主体认证的，这是一个扩展点，如果用户觉得Shiro默认的不好，可以自定义实现；其需要认证策略（Authentication Strategy），即什么情况下算用户认证通过了；</li>
<li>Authorizer：授权器，或者访问控制器，用来决定主体是否有权限进行相应的操作；即控制着用户能访问应用中的哪些功能；</li>
<li>Realm：可以有1个或多个Realm，可以认为是安全实体数据源，即用于获取安全实体的；可以是JDBC实现，也可以是LDAP实现，或者内存实现等等；由用户提供；注意：Shiro不知道你的用户/权限存储在哪及以何种格式存储；所以我们一般在应用中都需要实现自己的Realm；</li>
<li>SessionManager：如果写过Servlet就应该知道Session的概念，Session呢需要有人去管理它的生命周期，这个组件就是SessionManager；而Shiro并不仅仅可以用在Web环境，也可以用在如普通的JavaSE环境、EJB等环境；所有呢，Shiro就抽象了一个自己的Session来管理主体与应用之间交互的数据；这样的话，比如我们在Web环境用，刚开始是一台Web服务器；接着又上了台EJB服务器；这时想把两台服务器的会话数据放到一个地方，这个时候就可以实现自己的分布式会话（如把数据放到Memcached服务器）；</li>
<li>SessionDAO：DAO大家都用过，数据访问对象，用于会话的CRUD，比如我们想把Session保存到数据库，那么可以实现自己的SessionDAO，通过如JDBC写到数据库；比如想把Session放到Memcached中，可以实现自己的Memcached SessionDAO；另外SessionDAO中可以使用Cache进行缓存，以提高性能；</li>
<li>CacheManager：缓存控制器，来管理如用户、角色、权限等的缓存的；因为这些数据基本上很少去改变，放到缓存中后可以提高访问的性能</li>
<li>Cryptography：密码模块，Shiro提高了一些常见的加密组件用于如密码加密/解密的。</li>
</ul>
<p>参考 <a href="http://shiro.apache.org/reference.html" target="_blank" rel="noopener">Shiro官网</a></p>
<h2 id="SpringBoot集成"><a href="#SpringBoot集成" class="headerlink" title="SpringBoot集成"></a>SpringBoot集成</h2><p>实现一个最长见的验证码登录、记住我、权限自定义（or），缓存功能的SpringBoot应用，模板使用Thymeleaf 3</p>
<p>Maven依赖：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- thymeleaf模板中shiro标签--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.theborakompanioni<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>thymeleaf-extras-shiro<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- shiro 权限控制 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.shiro<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>shiro-spring<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- shiro ehcache (shiro缓存)--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.shiro<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>shiro-ehcache<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--验证码框架--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.axet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>kaptcha<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.9<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>新建一个配置类<code>ShiroConfig.java</code>，内容如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Description  : Apache Shiro 核心通过 Filter 来实现，就好像SpringMvc 通过DispachServlet 来主控制一样。</span></span><br><span class="line"><span class="comment"> * 既然是使用 Filter 一般也就能猜到，是通过URL规则来进行过滤和权限校验，所以我们需要定义一系列关于URL的规则和访问权限。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@Order</span>(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShiroConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//配置kaptcha图片验证码框架提供的Servlet,,这是个坑,很多人忘记注册(注意)</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ServletRegistrationBean <span class="title">kaptchaServlet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ServletRegistrationBean servlet = <span class="keyword">new</span> ServletRegistrationBean(<span class="keyword">new</span> KaptchaServlet(), <span class="string">"/kaptcha.jpg"</span>);</span><br><span class="line">        servlet.addInitParameter(Constants.KAPTCHA_SESSION_CONFIG_KEY, Constants.KAPTCHA_SESSION_KEY);<span class="comment">//session key</span></span><br><span class="line">        servlet.addInitParameter(Constants.KAPTCHA_TEXTPRODUCER_FONT_SIZE, <span class="string">"50"</span>);<span class="comment">//字体大小</span></span><br><span class="line">        servlet.addInitParameter(Constants.KAPTCHA_BORDER, <span class="string">"no"</span>);</span><br><span class="line">        servlet.addInitParameter(Constants.KAPTCHA_BORDER_COLOR, <span class="string">"105,179,90"</span>);</span><br><span class="line">        servlet.addInitParameter(Constants.KAPTCHA_TEXTPRODUCER_FONT_SIZE, <span class="string">"45"</span>);</span><br><span class="line">        servlet.addInitParameter(Constants.KAPTCHA_TEXTPRODUCER_CHAR_LENGTH, <span class="string">"4"</span>);</span><br><span class="line">        servlet.addInitParameter(Constants.KAPTCHA_TEXTPRODUCER_FONT_NAMES, <span class="string">"宋体,楷体,微软雅黑"</span>);</span><br><span class="line">        servlet.addInitParameter(Constants.KAPTCHA_TEXTPRODUCER_FONT_COLOR, <span class="string">"blue"</span>);</span><br><span class="line">        servlet.addInitParameter(Constants.KAPTCHA_IMAGE_WIDTH, <span class="string">"125"</span>);</span><br><span class="line">        servlet.addInitParameter(Constants.KAPTCHA_IMAGE_HEIGHT, <span class="string">"60"</span>);</span><br><span class="line">        <span class="comment">//可以设置很多属性,具体看com.google.code.kaptcha.Constants</span></span><br><span class="line">        <span class="keyword">return</span> servlet;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//注入异常处理类</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> MyExceptionResolver <span class="title">myExceptionResolver</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> MyExceptionResolver();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ShiroFilterFactoryBean 处理拦截资源文件问题。</span></span><br><span class="line"><span class="comment">     * 注意：单独一个ShiroFilterFactoryBean配置是或报错的，以为在</span></span><br><span class="line"><span class="comment">     * 初始化ShiroFilterFactoryBean的时候需要注入：SecurityManager Filter Chain定义说明</span></span><br><span class="line"><span class="comment">     * 1、一个URL可以配置多个Filter，使用逗号分隔</span></span><br><span class="line"><span class="comment">     * 2、当设置多个过滤器时，全部验证通过，才视为通过</span></span><br><span class="line"><span class="comment">     * 3、部分过滤器可指定参数，如perms，roles</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ShiroFilterFactoryBean <span class="title">shirFilter</span><span class="params">(SecurityManager securityManager)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        ShiroFilterFactoryBean shiroFilterFactoryBean = <span class="keyword">new</span> ShiroFilterFactoryBean();</span><br><span class="line">        <span class="comment">// 必须设置 SecurityManager</span></span><br><span class="line">        shiroFilterFactoryBean.setSecurityManager(securityManager);</span><br><span class="line">        <span class="comment">//验证码过滤器</span></span><br><span class="line">        Map&lt;String, Filter&gt; filtersMap = shiroFilterFactoryBean.getFilters();</span><br><span class="line">        KaptchaFilter kaptchaFilter = <span class="keyword">new</span> KaptchaFilter();</span><br><span class="line">        filtersMap.put(<span class="string">"kaptchaFilter"</span>, kaptchaFilter);</span><br><span class="line">        <span class="comment">//实现自己规则roles,这是为了实现or的效果</span></span><br><span class="line">        <span class="comment">//RoleFilter roleFilter = new RoleFilter();</span></span><br><span class="line">        <span class="comment">//filtersMap.put("roles", roleFilter);</span></span><br><span class="line">        shiroFilterFactoryBean.setFilters(filtersMap);</span><br><span class="line">        <span class="comment">// 拦截器</span></span><br><span class="line">        <span class="comment">//rest：比如/admins/user/**=rest[user],根据请求的方法，相当于/admins/user/**=perms[user：method] ,其中method为post，get，delete等。</span></span><br><span class="line">        <span class="comment">//port：比如/admins/user/**=port[8081],当请求的url的端口不是8081是跳转到schemal：//serverName：8081?queryString,其中schmal是协议http或https等，serverName是你访问的host,8081是url配置里port的端口，queryString是你访问的url里的？后面的参数。</span></span><br><span class="line">        <span class="comment">//perms：比如/admins/user/**=perms[user：add：*],perms参数可以写多个，多个时必须加上引号，并且参数之间用逗号分割，比如/admins/user/**=perms["user：add：*,user：modify：*"]，当有多个参数时必须每个参数都通过才通过，想当于isPermitedAll()方法。</span></span><br><span class="line">        <span class="comment">//roles：比如/admins/user/**=roles[admin],参数可以写多个，多个时必须加上引号，并且参数之间用逗号分割，当有多个参数时，比如/admins/user/**=roles["admin,guest"],每个参数通过才算通过，相当于hasAllRoles()方法。//要实现or的效果看http://zgzty.blog.163.com/blog/static/83831226201302983358670/</span></span><br><span class="line">        <span class="comment">//anon：比如/admins/**=anon 没有参数，表示可以匿名使用。</span></span><br><span class="line">        <span class="comment">//authc：比如/admins/user/**=authc表示需要认证才能使用，没有参数</span></span><br><span class="line">        <span class="comment">//authcBasic：比如/admins/user/**=authcBasic没有参数表示httpBasic认证</span></span><br><span class="line">        <span class="comment">//ssl：比如/admins/user/**=ssl没有参数，表示安全的url请求，协议为https</span></span><br><span class="line">        <span class="comment">//user：比如/admins/user/**=user没有参数表示必须存在用户，当登入操作时不做检查</span></span><br><span class="line">        Map&lt;String, String&gt; filterChainDefinitionMap = <span class="keyword">new</span> LinkedHashMap&lt;String, String&gt;();</span><br><span class="line">        <span class="comment">// 配置退出过滤器,其中的具体的退出代码Shiro已经替我们实现了</span></span><br><span class="line">        filterChainDefinitionMap.put(<span class="string">"/logout"</span>, <span class="string">"logout"</span>);</span><br><span class="line">        <span class="comment">//配置记住我或认证通过可以访问的地址</span></span><br><span class="line">        filterChainDefinitionMap.put(<span class="string">"/index"</span>, <span class="string">"user"</span>);</span><br><span class="line">        filterChainDefinitionMap.put(<span class="string">"/"</span>, <span class="string">"user"</span>);</span><br><span class="line">        filterChainDefinitionMap.put(<span class="string">"/login"</span>, <span class="string">"kaptchaFilter"</span>);</span><br><span class="line">        <span class="comment">// &lt;!-- 过滤链定义，从上向下顺序执行，一般将 /**放在最为下边 --&gt;:这是一个坑呢，一不小心代码就不好使了;</span></span><br><span class="line">        <span class="comment">//这段是配合 actuator框架使用的，配置相应的角色才能访问</span></span><br><span class="line">        <span class="comment">// filterChainDefinitionMap.put("/health", "roles[aix]");//服务器健康状况页面</span></span><br><span class="line">        <span class="comment">// filterChainDefinitionMap.put("/info", "roles[aix]");//服务器信息页面</span></span><br><span class="line">        <span class="comment">// filterChainDefinitionMap.put("/env", "roles[aix]");//应用程序的环境变量</span></span><br><span class="line">        <span class="comment">// filterChainDefinitionMap.put("/metrics", "roles[aix]");</span></span><br><span class="line">        <span class="comment">// filterChainDefinitionMap.put("/configprops", "roles[aix]");</span></span><br><span class="line">        <span class="comment">//开放的静态资源</span></span><br><span class="line">        filterChainDefinitionMap.put(<span class="string">"/favicon.ico"</span>, <span class="string">"anon"</span>);<span class="comment">//网站图标</span></span><br><span class="line">        filterChainDefinitionMap.put(<span class="string">"/static/**"</span>, <span class="string">"anon"</span>);<span class="comment">//配置static文件下资源能被访问的，这是个例子</span></span><br><span class="line">        filterChainDefinitionMap.put(<span class="string">"/kaptcha.jpg"</span>, <span class="string">"anon"</span>);<span class="comment">//图片验证码(kaptcha框架)</span></span><br><span class="line"></span><br><span class="line">        filterChainDefinitionMap.put(<span class="string">"/api/v1/**"</span>, <span class="string">"anon"</span>);<span class="comment">//API接口</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// swagger接口文档</span></span><br><span class="line">        filterChainDefinitionMap.put(<span class="string">"/v2/api-docs"</span>, <span class="string">"anon"</span>);</span><br><span class="line">        filterChainDefinitionMap.put(<span class="string">"/webjars/**"</span>, <span class="string">"anon"</span>);</span><br><span class="line">        filterChainDefinitionMap.put(<span class="string">"/swagger-resources/**"</span>, <span class="string">"anon"</span>);</span><br><span class="line">        filterChainDefinitionMap.put(<span class="string">"/swagger-ui.html"</span>, <span class="string">"anon"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 其他的</span></span><br><span class="line">        filterChainDefinitionMap.put(<span class="string">"/**"</span>, <span class="string">"authc"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 如果不设置默认会自动寻找Web工程根目录下的"/login.jsp"页面</span></span><br><span class="line">        shiroFilterFactoryBean.setLoginUrl(<span class="string">"/login"</span>);</span><br><span class="line">        <span class="comment">// 登录成功后要跳转的链接</span></span><br><span class="line">        shiroFilterFactoryBean.setSuccessUrl(<span class="string">"/index"</span>);</span><br><span class="line">        <span class="comment">// 未授权界面，不生效(详情原因看MyExceptionResolver)</span></span><br><span class="line">        shiroFilterFactoryBean.setUnauthorizedUrl(<span class="string">"/errorView/403_error.html"</span>);</span><br><span class="line">        shiroFilterFactoryBean.setFilterChainDefinitionMap(filterChainDefinitionMap);</span><br><span class="line">        <span class="keyword">return</span> shiroFilterFactoryBean;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> SecurityManager <span class="title">securityManager</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        DefaultWebSecurityManager securityManager = <span class="keyword">new</span> DefaultWebSecurityManager();</span><br><span class="line">        <span class="comment">// 设置realm.</span></span><br><span class="line">        securityManager.setRealm(myShiroRealm());</span><br><span class="line">        <span class="comment">//注入缓存管理器</span></span><br><span class="line">        securityManager.setCacheManager(ehCacheManager());<span class="comment">//这个如果执行多次，也是同样的一个对象;</span></span><br><span class="line">        <span class="comment">//注入记住我管理器;</span></span><br><span class="line">        securityManager.setRememberMeManager(rememberMeManager());</span><br><span class="line">        <span class="keyword">return</span> securityManager;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 身份认证realm; (这个需要自己写，账号密码校验；权限等)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> MyShiroRealm <span class="title">myShiroRealm</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        MyShiroRealm myShiroRealm = <span class="keyword">new</span> MyShiroRealm();</span><br><span class="line">        myShiroRealm.setCredentialsMatcher(hashedCredentialsMatcher());</span><br><span class="line">        <span class="keyword">return</span> myShiroRealm;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 凭证匹配器 （由于我们的密码校验交给Shiro的SimpleAuthenticationInfo进行处理了</span></span><br><span class="line"><span class="comment">     * 所以我们需要修改下doGetAuthenticationInfo中的代码; <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> HashedCredentialsMatcher <span class="title">hashedCredentialsMatcher</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        HashedCredentialsMatcher hashedCredentialsMatcher = <span class="keyword">new</span> HashedCredentialsMatcher();</span><br><span class="line">        hashedCredentialsMatcher.setHashAlgorithmName(<span class="string">"md5"</span>);<span class="comment">// 散列算法:这里使用MD5算法;</span></span><br><span class="line">        hashedCredentialsMatcher.setHashIterations(<span class="number">2</span>);<span class="comment">// 散列的次数，比如散列两次，相当于md5(md5(""));</span></span><br><span class="line">        hashedCredentialsMatcher.setStoredCredentialsHexEncoded(<span class="keyword">true</span>);<span class="comment">//表示是否存储散列后的密码为16进制，需要和生成密码时的一样，默认是base64；</span></span><br><span class="line">        <span class="keyword">return</span> hashedCredentialsMatcher;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 开启shiro aop注解支持. 使用代理方式; 所以需要开启代码支持;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> securityManager</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> AuthorizationAttributeSourceAdvisor <span class="title">authorizationAttributeSourceAdvisor</span><span class="params">(SecurityManager securityManager)</span> </span>&#123;</span><br><span class="line">        AuthorizationAttributeSourceAdvisor authorizationAttributeSourceAdvisor = <span class="keyword">new</span> AuthorizationAttributeSourceAdvisor();</span><br><span class="line">        authorizationAttributeSourceAdvisor.setSecurityManager(securityManager);</span><br><span class="line">        <span class="keyword">return</span> authorizationAttributeSourceAdvisor;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * shiro缓存管理器;</span></span><br><span class="line"><span class="comment">     * 需要注入对应的其它的实体类中：</span></span><br><span class="line"><span class="comment">     * 1、安全管理器：securityManager</span></span><br><span class="line"><span class="comment">     * 可见securityManager是整个shiro的核心；</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> EhCacheManager <span class="title">ehCacheManager</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        EhCacheManager cacheManager = <span class="keyword">new</span> EhCacheManager();</span><br><span class="line">        cacheManager.setCacheManagerConfigFile(<span class="string">"classpath:ehcache.xml"</span>);</span><br><span class="line">        <span class="keyword">return</span> cacheManager;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * cookie对象;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> SimpleCookie <span class="title">rememberMeCookie</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//System.out.println("ShiroConfiguration.rememberMeCookie()");</span></span><br><span class="line">        <span class="comment">//这个参数是cookie的名称，对应前端的checkbox的name = rememberMe</span></span><br><span class="line">        SimpleCookie simpleCookie = <span class="keyword">new</span> SimpleCookie(<span class="string">"rememberMe"</span>);</span><br><span class="line">        <span class="comment">//&lt;!-- 记住我cookie生效时间30天 ,单位秒;--&gt;</span></span><br><span class="line">        simpleCookie.setMaxAge(<span class="number">259200</span>);</span><br><span class="line">        <span class="keyword">return</span> simpleCookie;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * cookie管理对象;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CookieRememberMeManager <span class="title">rememberMeManager</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//System.out.println("ShiroConfiguration.rememberMeManager()");</span></span><br><span class="line">        CookieRememberMeManager cookieRememberMeManager = <span class="keyword">new</span> CookieRememberMeManager();</span><br><span class="line">        cookieRememberMeManager.setCookie(rememberMeCookie());</span><br><span class="line">        <span class="keyword">return</span> cookieRememberMeManager;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span>(name = <span class="string">"shiroDialect"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ShiroDialect <span class="title">shiroDialect</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ShiroDialect();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>代码中解释都非常清楚。</p>
<p><code>MyShiroRealm.java</code>的内容如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyShiroRealm</span> <span class="keyword">extends</span> <span class="title">AuthorizingRealm</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger _logger = LoggerFactory.getLogger(MyShiroRealm<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    ManagerInfoService managerInfoService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 认证信息.(身份验证)</span></span><br><span class="line"><span class="comment">     * Authentication 是用来验证用户身份</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> AuthenticationInfo <span class="title">doGetAuthenticationInfo</span><span class="params">(AuthenticationToken token)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> AuthenticationException </span>&#123;</span><br><span class="line"></span><br><span class="line">        _logger.info(<span class="string">"MyShiroRealm.doGetAuthenticationInfo()"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//获取用户的输入的账号.</span></span><br><span class="line">        String username = (String) token.getPrincipal();</span><br><span class="line">        <span class="comment">//_logger.info("用户的账号:"+username);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//通过username从数据库中查找 ManagerInfo对象</span></span><br><span class="line">        <span class="comment">//实际项目中，这里可以根据实际情况做缓存，如果不做，Shiro自己也是有时间间隔机制，2分钟内不会重复执行该方法</span></span><br><span class="line">        ManagerInfo managerInfo = managerInfoService.findByUsername(username);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (managerInfo == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//交给AuthenticatingRealm使用CredentialsMatcher进行密码匹配，如果觉得人家的不好可以自定义实现</span></span><br><span class="line">        SimpleAuthenticationInfo authenticationInfo = <span class="keyword">new</span> SimpleAuthenticationInfo(</span><br><span class="line">                managerInfo, <span class="comment">//用户</span></span><br><span class="line">                managerInfo.getPassword(), <span class="comment">//密码</span></span><br><span class="line">                ByteSource.Util.bytes(managerInfo.getCredentialsSalt()),<span class="comment">//salt=username+salt</span></span><br><span class="line">                getName()  <span class="comment">//realm name</span></span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="comment">//明文: 若存在，将此用户存放到登录认证info中，无需自己做密码对比，Shiro会为我们进行密码对比校验</span></span><br><span class="line"><span class="comment">//        SimpleAuthenticationInfo authenticationInfo = new SimpleAuthenticationInfo(</span></span><br><span class="line"><span class="comment">//                managerInfo, //用户名</span></span><br><span class="line"><span class="comment">//                managerInfo.getPassword(), //密码</span></span><br><span class="line"><span class="comment">//                getName()  //realm name</span></span><br><span class="line"><span class="comment">//        );</span></span><br><span class="line">        <span class="keyword">return</span> authenticationInfo;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 此方法调用hasRole,hasPermission的时候才会进行回调.</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * 权限信息.(授权):</span></span><br><span class="line"><span class="comment">     * 1、如果用户正常退出，缓存自动清空；</span></span><br><span class="line"><span class="comment">     * 2、如果用户非正常退出，缓存自动清空；</span></span><br><span class="line"><span class="comment">     * 3、如果我们修改了用户的权限，而用户不退出系统，修改的权限无法立即生效。</span></span><br><span class="line"><span class="comment">     * （需要手动编程进行实现；放在service进行调用）</span></span><br><span class="line"><span class="comment">     * 在权限修改后调用realm中的方法，realm已经由spring管理，所以从spring中获取realm实例，调用clearCached方法；</span></span><br><span class="line"><span class="comment">     * :Authorization 是授权访问控制，用于对用户进行的操作授权，证明该用户是否允许进行当前操作，如访问某个链接，某个资源文件等。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> principals</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> AuthorizationInfo <span class="title">doGetAuthorizationInfo</span><span class="params">(PrincipalCollection principals)</span> </span>&#123;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * 当没有使用缓存的时候，不断刷新页面的话，这个代码会不断执行，</span></span><br><span class="line"><span class="comment">         * 当其实没有必要每次都重新设置权限信息，所以我们需要放到缓存中进行管理；</span></span><br><span class="line"><span class="comment">         * 当放到缓存中时，这样的话，doGetAuthorizationInfo就只会执行一次了，</span></span><br><span class="line"><span class="comment">         * 缓存过期之后会再次执行。</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        _logger.info(<span class="string">"权限配置--&gt;MyShiroRealm.doGetAuthorizationInfo()"</span>);</span><br><span class="line">        SimpleAuthorizationInfo authorizationInfo = <span class="keyword">new</span> SimpleAuthorizationInfo();</span><br><span class="line">        ManagerInfo managerInfo = (ManagerInfo) principals.getPrimaryPrincipal();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//设置相应角色的权限信息</span></span><br><span class="line">        <span class="keyword">for</span> (SysRole role : managerInfo.getRoles()) &#123;</span><br><span class="line">            <span class="comment">//设置角色</span></span><br><span class="line">            authorizationInfo.addRole(role.getRole());</span><br><span class="line">            <span class="keyword">for</span> (Permission p : role.getPermissions()) &#123;</span><br><span class="line">                <span class="comment">//设置权限</span></span><br><span class="line">                authorizationInfo.addStringPermission(p.getPermission());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> authorizationInfo;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 设置认证加密方式</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCredentialsMatcher</span><span class="params">(CredentialsMatcher credentialsMatcher)</span> </span>&#123;</span><br><span class="line">        HashedCredentialsMatcher md5CredentialsMatcher = <span class="keyword">new</span> HashedCredentialsMatcher();</span><br><span class="line">        md5CredentialsMatcher.setHashAlgorithmName(ShiroKit.HASH_ALGORITHM_NAME);</span><br><span class="line">        md5CredentialsMatcher.setHashIterations(ShiroKit.HASH_ITERATIONS);</span><br><span class="line">        <span class="keyword">super</span>.setCredentialsMatcher(md5CredentialsMatcher);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>自定义异常处理类<code>MyExceptionResolver.java</code> :</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyExceptionResolver</span> <span class="keyword">implements</span> <span class="title">HandlerExceptionResolver</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ModelAndView <span class="title">resolveException</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//如果是shiro无权操作，因为shiro 在操作auno等一部分不进行转发至无权限url</span></span><br><span class="line">        <span class="keyword">if</span> (ex <span class="keyword">instanceof</span> UnauthorizedException) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> ModelAndView(<span class="string">"error/shiro_403"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="接口控制"><a href="#接口控制" class="headerlink" title="接口控制"></a>接口控制</h2><p>配置好了Shiro后就可以通过注解方式来限制某些接口调用需要相应的角色或权限了：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(value = <span class="string">"/index"</span>)</span><br><span class="line"><span class="meta">@RequiresRoles</span>(<span class="string">"admin"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">index</span><span class="params">(HttpServletRequest request, Model model)</span> </span>&#123;</span><br><span class="line">    _logger.info(<span class="string">"进入项目管理首页..."</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其他的注解请参考官网的 <a href="https://shiro.apache.org/java-annotations-list.html" target="_blank" rel="noopener">Shiro注解</a></p>
<h2 id="Thymeleaf的shiro标签"><a href="#Thymeleaf的shiro标签" class="headerlink" title="Thymeleaf的shiro标签"></a>Thymeleaf的shiro标签</h2><p>可以在Thymeleaf模板中使用shiro的权限标签来控制某些菜单或按钮是否显示。</p>
<p>maven中添加依赖，这个前面已经有了：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- thymeleaf模板中shiro标签--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.theborakompanioni<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>thymeleaf-extras-shiro<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在ShiroConfig中添加一个Bean配置：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span>(name = <span class="string">"shiroDialect"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> ShiroDialect <span class="title">shiroDialect</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ShiroDialect();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在html页面添加如下内容：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns</span>=<span class="string">"http://www.w3.org/1999/xhtml"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">xmlns:th</span>=<span class="string">"http://www.thymeleaf.org"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">xmlns:shiro</span>=<span class="string">"http://www.pollix.at/thymeleaf/shiro"</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>添加完后在html页面调用如下：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 认证通过或已记住的用户。 --&gt;</span>    </span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">shiro:user</span>=<span class="string">""</span>&gt;</span>    </span><br><span class="line">   Welcome back John! Not John? Click <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"login.html"</span>&gt;</span>here<span class="tag">&lt;/<span class="name">a</span>&gt;</span> to login.    </span><br><span class="line"><span class="tag">&lt;/<span class="name">p</span>&gt;</span>    </span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">shiro:notAuthenticated</span>=<span class="string">""</span>&gt;</span>  </span><br><span class="line">    未身份验证（包括记住我）  </span><br><span class="line"><span class="tag">&lt;/<span class="name">p</span>&gt;</span>   </span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">shiro:guest</span>=<span class="string">""</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">"white-space:pre;"</span>&gt;</span> <span class="tag">&lt;/<span class="name">span</span>&gt;</span>Please <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"login.html"</span>&gt;</span>login5555<span class="tag">&lt;/<span class="name">a</span>&gt;</span> <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>第二种：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">shiro:guest</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">a</span>&gt;</span> <span class="tag">&lt;<span class="name">a</span>&gt;</span>注册<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">shiro:guest</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">shiro:user</span>&gt;</span></span><br><span class="line">    欢迎<span class="tag">&lt;<span class="name">shiro:principal</span> <span class="attr">property</span>=<span class="string">"name"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">shiro:user</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="权限数据库设计"><a href="#权限数据库设计" class="headerlink" title="权限数据库设计"></a>权限数据库设计</h2><p>一般来讲都会讲用户的角色和权限保存到数据库，这里设计一种最通用的模型， 使用RBAC（Role-Based Access Control，基于角色的访问控制）模型设计用户，角色和权限间的关系。简单地说， 一个用户拥有若干角色，每一个角色拥有若干权限。这样，就构造成“用户-角色-权限”的授权模型。</p>
<p>在这种模型中，用户与角色之间，角色与权限之间，一般者是多对多的关系。如下图所示：</p>
<p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591541990-bc1d0b1ed83368bfa27f6c485ca517c4.png" alt=""></p>
<p>根据这个模型，设计数据库表，并插入一些测试数据，具体可参考源码中的<code>schema.sql</code>，后面我将<code>t_user</code>表名字改成<code>t_manager</code></p>
<p>然后我们通过MyBatis实现<code>ManagerInfoService</code>，</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 后台用户管理</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ManagerInfoService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> ManagerInfoDao managerInfoDao;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ManagerInfo <span class="title">findByUsername</span><span class="params">(String username)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> managerInfoDao.findByUsername(username);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后对应的<code>ManagerInfoDao.xml</code>如下：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"ManagerInfoMap"</span> <span class="attr">type</span>=<span class="string">"managerInfo"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"id"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"username"</span> <span class="attr">column</span>=<span class="string">"username"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"name"</span> <span class="attr">column</span>=<span class="string">"name"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"password"</span> <span class="attr">column</span>=<span class="string">"password"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"salt"</span> <span class="attr">column</span>=<span class="string">"salt"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"state"</span> <span class="attr">column</span>=<span class="string">"state"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">"roles"</span> <span class="attr">ofType</span>=<span class="string">"sysRole"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"role_id"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"role"</span> <span class="attr">column</span>=<span class="string">"role_role"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">"permissions"</span> <span class="attr">ofType</span>=<span class="string">"permission"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"perm_id"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"permission"</span> <span class="attr">column</span>=<span class="string">"perm_permission"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findByUsername"</span> <span class="attr">resultMap</span>=<span class="string">"ManagerInfoMap"</span>&gt;</span></span><br><span class="line">    SELECT DISTINCT</span><br><span class="line">        A.id AS id,</span><br><span class="line">        A.username AS username,</span><br><span class="line">        A.name AS name,</span><br><span class="line">        A.password AS password,</span><br><span class="line">        A.salt AS salt,</span><br><span class="line">        A.state AS state,</span><br><span class="line">        C.id AS role_id,</span><br><span class="line">        C.role AS role_role,</span><br><span class="line">        E.id AS perm_id,</span><br><span class="line">        E.permission AS perm_permission</span><br><span class="line">    FROM t_manager A</span><br><span class="line">        LEFT JOIN t_manager_role B ON A.id=B.manager_id</span><br><span class="line">        LEFT JOIN t_role C ON B.role_id=C.id</span><br><span class="line">        LEFT JOIN t_role_permission D ON C.id=D.role_id</span><br><span class="line">        LEFT JOIN t_permission E ON D.permission_Id=E.id</span><br><span class="line">    WHERE username=#&#123;username&#125;</span><br><span class="line">    LIMIT 1</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>ManagerInfo.java</code>如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ManagerInfo</span> <span class="keyword">extends</span> <span class="title">Manager</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 一个管理员具有多个角色</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;SysRole&gt; roles;<span class="comment">// 一个用户具有多个角色</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最后来几张效果图：</p>
<p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591541990-0b74c30725735c0706d12bb24fb38477.png" alt=""></p>
<p>admin角色登录之后：</p>
<h2 id="GitHub源码"><a href="#GitHub源码" class="headerlink" title="GitHub源码"></a>GitHub源码</h2><p><a href="https://github.com/yidao620c/SpringBootBucket/tree/master/springboot-shiro" target="_blank" rel="noopener">springboot-shiro</a>   —已测试</p>
<h2 id="来源"><a href="#来源" class="headerlink" title="来源"></a>来源</h2><p><a href="https://www.xncoding.com/" target="_blank" rel="noopener">https://www.xncoding.com/</a></p>
]]></content>
      <categories>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>springboot</tag>
        <tag>shiro</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBoot系列 - 集成SocketIO实时通信</title>
    <url>/2020/06/08/SpringBoot%E7%B3%BB%E5%88%97-%E9%9B%86%E6%88%90SocketIO%E5%AE%9E%E6%97%B6%E9%80%9A%E4%BF%A1/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="SpringBoot系列-集成SocketIO实时通信"><a href="#SpringBoot系列-集成SocketIO实时通信" class="headerlink" title="SpringBoot系列 - 集成SocketIO实时通信"></a>SpringBoot系列 - 集成SocketIO实时通信</h1><p>上一篇讲解了基于STOMP协议实现的WebSocket方案，本篇我讲一下Socket.IO的实现方案。</p>
<p>Socket.IO 主要使用WebSocket协议。但是如果需要的话，Socket.io可以回退到几种其它方法， 例如Adobe Flash Sockets、JSONP拉取、或是传统的AJAX拉取，并且提供完全相同的接口。 尽管它可以被用作WebSocket的包装库，它还是提供了许多其它功能，比如广播至多个套接字，存储与不同客户有关的数据，和异步IO操作。</p>
<p>更多请参考 Socket.IO 官网：<a href="https://socket.io/" target="_blank" rel="noopener">https://socket.io/</a></p>
<h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>基于 socket.io 来说，采用 node 实现更加合适，本文使用两个后端的Java开源框架实现。</p>
<ul>
<li>服务端使用 <a href="https://github.com/mrniko/netty-socketio" target="_blank" rel="noopener">netty-socketio</a></li>
<li>客户端使用 <a href="https://github.com/socketio/socket.io-client-java" target="_blank" rel="noopener">socket.io-client-java</a></li>
</ul>
<p>业务需求是将之前通过轮询方式调动RESTFul API改成使用WebSocket长连接方式，实现要服务器实时的推送消息，另外还要实时监控POS机的在线状态等。</p>
<h2 id="引入依赖"><a href="#引入依赖" class="headerlink" title="引入依赖"></a>引入依赖</h2><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- netty-socketio--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.corundumstudio.socketio<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>netty-socketio<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.13<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.netty<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>netty-resolver<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.1.15.Final<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.netty<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>netty-transport<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.1.15.Final<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.socket<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>socket.io-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="服务器代码"><a href="#服务器代码" class="headerlink" title="服务器代码"></a>服务器代码</h2><p>先来服务端程序爽一把，话不多说，先上代码：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NamespaceSocketServer</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger logger = LoggerFactory.getLogger(NamespaceSocketServer<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * 创建Socket，并设置监听端口</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        Configuration config = <span class="keyword">new</span> Configuration();</span><br><span class="line">        <span class="comment">//设置主机名</span></span><br><span class="line">        config.setHostname(<span class="string">"localhost"</span>);</span><br><span class="line">        <span class="comment">//设置监听端口</span></span><br><span class="line">        config.setPort(<span class="number">9092</span>);</span><br><span class="line">        <span class="comment">// 协议升级超时时间（毫秒），默认10秒。HTTP握手升级为ws协议超时时间</span></span><br><span class="line">        config.setUpgradeTimeout(<span class="number">10000</span>);</span><br><span class="line">        <span class="comment">// Ping消息超时时间（毫秒），默认60秒，这个时间间隔内没有接收到心跳消息就会发送超时事件</span></span><br><span class="line">        config.setPingTimeout(<span class="number">180000</span>);</span><br><span class="line">        <span class="comment">// Ping消息间隔（毫秒），默认25秒。客户端向服务器发送一条心跳消息间隔</span></span><br><span class="line">        config.setPingInterval(<span class="number">60000</span>);</span><br><span class="line">        <span class="comment">// 连接认证，这里使用token更合适</span></span><br><span class="line">        config.setAuthorizationListener(<span class="keyword">new</span> AuthorizationListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isAuthorized</span><span class="params">(HandshakeData data)</span> </span>&#123;</span><br><span class="line">                <span class="comment">// String token = data.getSingleUrlParam("token");</span></span><br><span class="line">                <span class="comment">// String username = JWTUtil.getSocketUsername(token);</span></span><br><span class="line">                <span class="comment">// return JWTUtil.verifySocket(token, "secret");</span></span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> SocketIOServer server = <span class="keyword">new</span> SocketIOServer(config);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * 添加连接监听事件，监听是否与客户端连接到服务器</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        server.addConnectListener(<span class="keyword">new</span> ConnectListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onConnect</span><span class="params">(SocketIOClient client)</span> </span>&#123;</span><br><span class="line">                <span class="comment">// 判断是否有客户端连接</span></span><br><span class="line">                <span class="keyword">if</span> (client != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    logger.info(<span class="string">"连接成功。clientId="</span> + client.getSessionId().toString());</span><br><span class="line">                    client.joinRoom(client.getHandshakeData().getSingleUrlParam(<span class="string">"appid"</span>));</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    logger.error(<span class="string">"并没有人连接上。。。"</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * 添加监听事件，监听客户端的事件</span></span><br><span class="line"><span class="comment">         * 1.第一个参数eventName需要与客户端的事件要一致</span></span><br><span class="line"><span class="comment">         * 2.第二个参数eventClase是传输的数据类型</span></span><br><span class="line"><span class="comment">         * 3.第三个参数listener是用于接收客户端传的数据，数据类型需要与eventClass一致</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        server.addEventListener(<span class="string">"login"</span>, LoginRequest<span class="class">.<span class="keyword">class</span>, <span class="title">new</span> <span class="title">DataListener</span>&lt;<span class="title">LoginRequest</span>&gt;() </span>&#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onData</span><span class="params">(SocketIOClient client, LoginRequest data, AckRequest ackRequest)</span> </span>&#123;</span><br><span class="line">                logger.info(<span class="string">"接收到客户端login消息：code = "</span> + data.getCode() + <span class="string">",body = "</span> + data.getBody());</span><br><span class="line">                <span class="comment">// check is ack requested by client, but it's not required check</span></span><br><span class="line">                <span class="keyword">if</span> (ackRequest.isAckRequested()) &#123;</span><br><span class="line">                    <span class="comment">// send ack response with data to client</span></span><br><span class="line">                    ackRequest.sendAckData(<span class="string">"已成功收到客户端登录请求"</span>, <span class="string">"yeah"</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// 向客户端发送消息</span></span><br><span class="line">                List&lt;String&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">                list.add(<span class="string">"登录成功，sessionId="</span> + client.getSessionId());</span><br><span class="line">                <span class="comment">// 第一个参数必须与eventName一致，第二个参数data必须与eventClass一致</span></span><br><span class="line">                String room = client.getHandshakeData().getSingleUrlParam(<span class="string">"appid"</span>);</span><br><span class="line">                server.getRoomOperations(room).sendEvent(<span class="string">"login"</span>, list.toString());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">//启动服务</span></span><br><span class="line">        server.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Android客户端"><a href="#Android客户端" class="headerlink" title="Android客户端"></a>Android客户端</h2><p>老规矩，先上代码爽爽</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SocketClient</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Socket socket;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger logger = LoggerFactory.getLogger(SocketClient<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> URISyntaxException </span>&#123;</span><br><span class="line">        IO.Options options = <span class="keyword">new</span> IO.Options();</span><br><span class="line">        options.transports = <span class="keyword">new</span> String[]&#123;<span class="string">"websocket"</span>&#125;;</span><br><span class="line">        options.reconnectionAttempts = <span class="number">2</span>;     <span class="comment">// 重连尝试次数</span></span><br><span class="line">        options.reconnectionDelay = <span class="number">1000</span>;     <span class="comment">// 失败重连的时间间隔(ms)</span></span><br><span class="line">        options.timeout = <span class="number">20000</span>;              <span class="comment">// 连接超时时间(ms)</span></span><br><span class="line">        options.forceNew = <span class="keyword">true</span>;</span><br><span class="line">        options.query = <span class="string">"username=test1&amp;password=test1&amp;appid=com.xncoding.apay2"</span>;</span><br><span class="line">        socket = IO.socket(<span class="string">"http://localhost:9092/"</span>, options);</span><br><span class="line">        socket.on(Socket.EVENT_CONNECT, <span class="keyword">new</span> Emitter.Listener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">call</span><span class="params">(Object... args)</span> </span>&#123;</span><br><span class="line">                <span class="comment">// 客户端一旦连接成功，开始发起登录请求</span></span><br><span class="line">                LoginRequest message = <span class="keyword">new</span> LoginRequest(<span class="number">12</span>, <span class="string">"这是客户端消息体"</span>);</span><br><span class="line">                socket.emit(<span class="string">"login"</span>, JsonConverter.objectToJSONObject(message), (Ack) args1 -&gt; &#123;</span><br><span class="line">                    logger.info(<span class="string">"回执消息="</span> + Arrays.stream(args1).map(Object::toString).collect(Collectors.joining(<span class="string">","</span>)));</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).on(<span class="string">"login"</span>, <span class="keyword">new</span> Emitter.Listener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">call</span><span class="params">(Object... args)</span> </span>&#123;</span><br><span class="line">                logger.info(<span class="string">"接受到服务器房间广播的登录消息："</span> + Arrays.toString(args));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).on(Socket.EVENT_CONNECT_ERROR, <span class="keyword">new</span> Emitter.Listener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">call</span><span class="params">(Object... args)</span> </span>&#123;</span><br><span class="line">                logger.info(<span class="string">"Socket.EVENT_CONNECT_ERROR"</span>);</span><br><span class="line">                socket.disconnect();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).on(Socket.EVENT_CONNECT_TIMEOUT, <span class="keyword">new</span> Emitter.Listener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">call</span><span class="params">(Object... args)</span> </span>&#123;</span><br><span class="line">                logger.info(<span class="string">"Socket.EVENT_CONNECT_TIMEOUT"</span>);</span><br><span class="line">                socket.disconnect();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).on(Socket.EVENT_PING, <span class="keyword">new</span> Emitter.Listener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">call</span><span class="params">(Object... args)</span> </span>&#123;</span><br><span class="line">                logger.info(<span class="string">"Socket.EVENT_PING"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).on(Socket.EVENT_PONG, <span class="keyword">new</span> Emitter.Listener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">call</span><span class="params">(Object... args)</span> </span>&#123;</span><br><span class="line">                logger.info(<span class="string">"Socket.EVENT_PONG"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).on(Socket.EVENT_MESSAGE, <span class="keyword">new</span> Emitter.Listener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">call</span><span class="params">(Object... args)</span> </span>&#123;</span><br><span class="line">                logger.info(<span class="string">"-----------接受到消息啦--------"</span> + Arrays.toString(args));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).on(Socket.EVENT_DISCONNECT, <span class="keyword">new</span> Emitter.Listener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">call</span><span class="params">(Object... args)</span> </span>&#123;</span><br><span class="line">                logger.info(<span class="string">"客户端断开连接啦。。。"</span>);</span><br><span class="line">                socket.disconnect();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        socket.connect();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="关于心跳机制"><a href="#关于心跳机制" class="headerlink" title="关于心跳机制"></a>关于心跳机制</h2><p>根据 <a href="https://github.com/socketio/engine.io#methods-1" target="_blank" rel="noopener">Socket.IO文档</a> 解释， 客户端会定期发送心跳包，并触发一个ping事件和一个pong事件，如下：</p>
<ul>
<li><code>ping</code> Fired when a ping packet is written out to the server.</li>
<li><code>pong</code> Fired when a pong is received from the server. Parameters:<ul>
<li><code>Number</code> number of ms elapsed since <code>ping</code> packet (i.e.: latency)</li>
</ul>
</li>
</ul>
<p>这里最重要的两个服务器参数如下：</p>
<ol>
<li>pingTimeout (Number): how many ms without a pong packet to consider the connection closed (60000)</li>
<li>pingInterval (Number): how many ms before sending a new ping packet (25000).</li>
</ol>
<p>也就是说握手协议的时候，客户端从服务器拿到这两个参数，一个是ping消息的发送间隔时间，一个是从服务器返回pong消息的超时时间， 客户端会在超时后断开连接。心跳包发送方向是客户端向服务器端发送，以维持在线状态。</p>
<h2 id="关于断线和超时"><a href="#关于断线和超时" class="headerlink" title="关于断线和超时"></a>关于断线和超时</h2><p>关闭浏览器、直接关闭客户端程序、kill进程、主动执行disconnect方法都会导致立刻产生断线事件。 而客户端把网络断开，服务器端在 <code>pingTimeout</code> ms后产生断线事件、客户端在 <code>pingTimeout</code> ms后也产生断线事件。</p>
<p>实际上，超时后会产生一个断线事件，叫”disconnect”。客户端和服务器端都可以对这个事件作出应答，释放连接。</p>
<p>客户端代码：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">.on(Socket.EVENT_DISCONNECT, <span class="keyword">new</span> Emitter.Listener() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">call</span><span class="params">(Object... args)</span> </span>&#123;</span><br><span class="line">        logger.info(<span class="string">"客户端断开连接啦。。。"</span>);</span><br><span class="line">        socket.disconnect();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>连上服务器后，断开网络。超过了心跳超时时间后，产生断线事件。如果客户端不主动断开连接的话，会自动重连， 这时候发现连接不上，又产生连接错误事件，然后重试2次，都失败后自动断开连接了。</p>
<p>下面是客户端日志：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">SocketClient - 回执消息&#x3D;服务器已成功收到客户端登录请求,yeah</span><br><span class="line">SocketClient - Socket.EVENT_PING</span><br><span class="line">SocketClient - Socket.EVENT_PONG</span><br><span class="line">SocketClient - 客户端断开连接啦。。。</span><br><span class="line">SocketClient - Socket.EVENT_CONNECT_ERROR</span><br></pre></td></tr></table></figure>

<p>服务器端代码：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">server.addDisconnectListener(<span class="keyword">new</span> DisconnectListener() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onDisconnect</span><span class="params">(SocketIOClient client)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"服务器收到断线通知... sessionId="</span> + client.getSessionId());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>服务器逻辑是，如果在心跳超时后，就直接断开这个连接，并且产生一个断开连接事件。</p>
<p>服务器通过netty处理心跳包ping/pong的日志如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">WebSocket08FrameDecoder - Decoding WebSocket Frame opCode&#x3D;1</span><br><span class="line">WebSocket08FrameDecoder - Decoding WebSocket Frame length&#x3D;1</span><br><span class="line">WebSocket08FrameEncoder - Encoding WebSocket Frame opCode&#x3D;1 length&#x3D;1</span><br></pre></td></tr></table></figure>

<h2 id="浏览器客户端演示"><a href="#浏览器客户端演示" class="headerlink" title="浏览器客户端演示"></a>浏览器客户端演示</h2><p>对于<code>netty-socketio</code>有一个demo工程，里面通过一个网页的聊天小程序演示了各种使用方法。</p>
<p>demo地址：<a href="https://github.com/mrniko/netty-socketio-demo" target="_blank" rel="noopener">netty-socketio-demo</a></p>
<h2 id="SpringBoot集成"><a href="#SpringBoot集成" class="headerlink" title="SpringBoot集成"></a>SpringBoot集成</h2><p>最后重点讲一下如何在SpringBoot中集成。</p>
<h3 id="修改配置"><a href="#修改配置" class="headerlink" title="修改配置"></a>修改配置</h3><p>首先maven依赖之前已经讲过了，先修改下<code>application.yml</code>配置文件来配置下几个参数，比如主机、端口、心跳时间等等。</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment">###################  自定义项目配置 ###################</span></span><br><span class="line"><span class="attr">xncoding:</span></span><br><span class="line">  <span class="attr">socket-hostname:</span> <span class="string">localhost</span></span><br><span class="line">  <span class="attr">socket-port:</span> <span class="number">9096</span></span><br></pre></td></tr></table></figure>

<h3 id="添加Bean配置"><a href="#添加Bean配置" class="headerlink" title="添加Bean配置"></a>添加Bean配置</h3><p>然后增加一个SocketServer的Bean配置：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NettySocketConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> MyProperties myProperties;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> ApiService apiService;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> ManagerInfoService managerInfoService;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger logger = LoggerFactory.getLogger(NettySocketConfig<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> SocketIOServer <span class="title">socketIOServer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * 创建Socket，并设置监听端口</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        com.corundumstudio.socketio.Configuration config = <span class="keyword">new</span> com.corundumstudio.socketio.Configuration();</span><br><span class="line">        <span class="comment">// 设置主机名，默认是0.0.0.0</span></span><br><span class="line">        <span class="comment">// config.setHostname("localhost");</span></span><br><span class="line">        <span class="comment">// 设置监听端口</span></span><br><span class="line">        config.setPort(<span class="number">9096</span>);</span><br><span class="line">        <span class="comment">// 协议升级超时时间（毫秒），默认10000。HTTP握手升级为ws协议超时时间</span></span><br><span class="line">        config.setUpgradeTimeout(<span class="number">10000</span>);</span><br><span class="line">        <span class="comment">// Ping消息间隔（毫秒），默认25000。客户端向服务器发送一条心跳消息间隔</span></span><br><span class="line">        config.setPingInterval(<span class="number">60000</span>);</span><br><span class="line">        <span class="comment">// Ping消息超时时间（毫秒），默认60000，这个时间间隔内没有接收到心跳消息就会发送超时事件</span></span><br><span class="line">        config.setPingTimeout(<span class="number">180000</span>);</span><br><span class="line">        <span class="comment">// 这个版本0.9.0不能处理好namespace和query参数的问题。所以为了做认证必须使用全局默认命名空间</span></span><br><span class="line">        config.setAuthorizationListener(<span class="keyword">new</span> AuthorizationListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isAuthorized</span><span class="params">(HandshakeData data)</span> </span>&#123;</span><br><span class="line">                <span class="comment">// 可以使用如下代码获取用户密码信息</span></span><br><span class="line">                String username = data.getSingleUrlParam(<span class="string">"username"</span>);</span><br><span class="line">                String password = data.getSingleUrlParam(<span class="string">"password"</span>);</span><br><span class="line">                logger.info(<span class="string">"连接参数：username="</span> + username + <span class="string">",password="</span> + password);</span><br><span class="line">                ManagerInfo managerInfo = managerInfoService.findByUsername(username);</span><br><span class="line">                <span class="comment">// MD5盐</span></span><br><span class="line">                String salt = managerInfo.getSalt();</span><br><span class="line">                String encodedPassword = ShiroKit.md5(password, username + salt);</span><br><span class="line">                <span class="comment">// 如果认证不通过会返回一个Socket.EVENT_CONNECT_ERROR事件</span></span><br><span class="line">                <span class="keyword">return</span> encodedPassword.equals(managerInfo.getPassword());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> SocketIOServer server = <span class="keyword">new</span> SocketIOServer(config);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> server;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> SpringAnnotationScanner <span class="title">springAnnotationScanner</span><span class="params">(SocketIOServer socketServer)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> SpringAnnotationScanner(socketServer);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意，我在<code>AuthorizationListener</code>里面通过调用service做了用户名和密码的认证。通过注解方式可以注入service， 执行相应的连接授权动作。</p>
<p>后面还有个<code>SpringAnnotationScanner</code>的定义不能忘记。</p>
<h3 id="添加消息结构类"><a href="#添加消息结构类" class="headerlink" title="添加消息结构类"></a>添加消息结构类</h3><p>预先定义好客户端和服务器端直接传递的消息类型，使用简单的JavaBean即可，比如</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReportParam</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * IMEI码</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String imei;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 位置</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String location;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getImei</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> imei;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setImei</span><span class="params">(String imei)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.imei = imei;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getLocation</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> location;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLocation</span><span class="params">(String location)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.location = location;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="添加消息处理类"><a href="#添加消息处理类" class="headerlink" title="添加消息处理类"></a>添加消息处理类</h3><p>这里才是最核心的接口处理类，所有接口处理逻辑都应该写在这里面，我只举了一个例子，就是POS上传位置接口：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 消息事件处理器</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> XiongNeng</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2018/1/19</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MessageEventHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> SocketIOServer server;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ApiService apiService;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger logger = LoggerFactory.getLogger(MessageEventHandler<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MessageEventHandler</span><span class="params">(SocketIOServer server, ApiService apiService)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.server = server;</span><br><span class="line">        <span class="keyword">this</span>.apiService = apiService;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//添加connect事件，当客户端发起连接时调用</span></span><br><span class="line">    <span class="meta">@OnConnect</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onConnect</span><span class="params">(SocketIOClient client)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (client != <span class="keyword">null</span>) &#123;</span><br><span class="line">            String imei = client.getHandshakeData().getSingleUrlParam(<span class="string">"imei"</span>);</span><br><span class="line">            String applicationId = client.getHandshakeData().getSingleUrlParam(<span class="string">"appid"</span>);</span><br><span class="line">            logger.info(<span class="string">"连接成功, applicationId="</span> + applicationId + <span class="string">", imei="</span> + imei +</span><br><span class="line">                    <span class="string">", sessionId="</span> + client.getSessionId().toString() );</span><br><span class="line">            client.joinRoom(applicationId);</span><br><span class="line">            <span class="comment">// 更新POS监控状态为在线</span></span><br><span class="line">            ReportParam param = <span class="keyword">new</span> ReportParam();</span><br><span class="line">            param.setImei(imei);</span><br><span class="line">            apiService.updateJustState(param, client.getSessionId().toString(), <span class="number">1</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            logger.error(<span class="string">"客户端为空"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//添加@OnDisconnect事件，客户端断开连接时调用，刷新客户端信息</span></span><br><span class="line">    <span class="meta">@OnDisconnect</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onDisconnect</span><span class="params">(SocketIOClient client)</span> </span>&#123;</span><br><span class="line">        String imei = client.getHandshakeData().getSingleUrlParam(<span class="string">"imei"</span>);</span><br><span class="line">        logger.info(<span class="string">"客户端断开连接, imei="</span> + imei + <span class="string">", sessionId="</span> + client.getSessionId().toString());</span><br><span class="line">        <span class="comment">// 更新POS监控状态为离线</span></span><br><span class="line">        ReportParam param = <span class="keyword">new</span> ReportParam();</span><br><span class="line">        param.setImei(imei);</span><br><span class="line">        apiService.updateJustState(param, <span class="string">""</span>, <span class="number">2</span>);</span><br><span class="line">        client.disconnect();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 消息接收入口</span></span><br><span class="line">    <span class="meta">@OnEvent</span>(value = Socket.EVENT_MESSAGE)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onEvent</span><span class="params">(SocketIOClient client, AckRequest ackRequest, Object data)</span> </span>&#123;</span><br><span class="line">        logger.info(<span class="string">"接收到客户端消息"</span>);</span><br><span class="line">        <span class="keyword">if</span> (ackRequest.isAckRequested()) &#123;</span><br><span class="line">            <span class="comment">// send ack response with data to client</span></span><br><span class="line">            ackRequest.sendAckData(<span class="string">"服务器回答Socket.EVENT_MESSAGE"</span>, <span class="string">"好的"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 广播消息接收入口</span></span><br><span class="line">    <span class="meta">@OnEvent</span>(value = <span class="string">"broadcast"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onBroadcast</span><span class="params">(SocketIOClient client, AckRequest ackRequest, Object data)</span> </span>&#123;</span><br><span class="line">        logger.info(<span class="string">"接收到广播消息"</span>);</span><br><span class="line">        <span class="comment">// 房间广播消息</span></span><br><span class="line">        String room = client.getHandshakeData().getSingleUrlParam(<span class="string">"appid"</span>);</span><br><span class="line">        server.getRoomOperations(room).sendEvent(<span class="string">"broadcast"</span>, <span class="string">"广播啦啦啦啦"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 报告地址接口</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> client 客户端</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> ackRequest 回执消息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> param 报告地址参数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@OnEvent</span>(value = <span class="string">"doReport"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onDoReport</span><span class="params">(SocketIOClient client, AckRequest ackRequest, ReportParam param)</span> </span>&#123;</span><br><span class="line">        logger.info(<span class="string">"报告地址接口 start...."</span>);</span><br><span class="line">        BaseResponse result = postReport(param);</span><br><span class="line">        ackRequest.sendAckData(result);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*----------------------------------------下面是私有方法-------------------------------------*/</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> BaseResponse <span class="title">postReport</span><span class="params">(ReportParam param)</span> </span>&#123;</span><br><span class="line">        BaseResponse result = <span class="keyword">new</span> BaseResponse();</span><br><span class="line">        <span class="keyword">int</span> r = apiService.report(param);</span><br><span class="line">        <span class="keyword">if</span> (r &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            result.setSuccess(<span class="keyword">true</span>);</span><br><span class="line">            result.setMsg(<span class="string">"报告地址成功"</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            result.setSuccess(<span class="keyword">false</span>);</span><br><span class="line">            result.setMsg(<span class="string">"该POS机还没有入网，报告地址失败。"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="添加ServerRunner"><a href="#添加ServerRunner" class="headerlink" title="添加ServerRunner"></a>添加ServerRunner</h2><p>还有一个步骤就是添加启动器，在SpringBoot启动之后立马执行：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * SpringBoot启动之后执行</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> XiongNeng</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2017/7/15</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Order</span>(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ServerRunner</span> <span class="keyword">implements</span> <span class="title">CommandLineRunner</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> SocketIOServer server;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger logger = LoggerFactory.getLogger(ServerRunner<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ServerRunner</span><span class="params">(SocketIOServer server)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.server = server;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">(String... args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        logger.info(<span class="string">"ServerRunner 开始启动啦..."</span>);</span><br><span class="line">        server.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="nginx反向代理"><a href="#nginx反向代理" class="headerlink" title="nginx反向代理"></a>nginx反向代理</h2><p>要实现通过域名并走标准80或443端口的话，最好使用nginx做反向代理，跟正常的http反向代理基本一致， 不过websocket需要增加一个upgrade的配置。</p>
<p>下面我以一个实际使用例子来说明如何配置nginx的https访问websocket，并且开启301自动http跳转https。</p>
<p>首先要有一个域名，比如<code>test.enzhico.net</code>，然后申请letsencrypt的免费证书，这个过程我不讲了，另外的博客文章里面有。</p>
<p>配置如下:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">map $http_upgrade $connection_upgrade &#123;</span><br><span class="line">    default upgrade;</span><br><span class="line">    &#39;&#39; close;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">      server_name test.enzhico.net;</span><br><span class="line">      location &#x2F; &#123;</span><br><span class="line">          proxy_pass http:&#x2F;&#x2F;localhost:9096;</span><br><span class="line">          proxy_read_timeout 300s;</span><br><span class="line">          proxy_set_header Host $host;</span><br><span class="line">          proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">          proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">          proxy_http_version 1.1;</span><br><span class="line">          proxy_set_header Upgrade $http_upgrade;</span><br><span class="line">          proxy_set_header Connection $connection_upgrade;</span><br><span class="line">      &#125;</span><br><span class="line">      #root &#x2F;opt&#x2F;www&#x2F;test.enzhico.net;</span><br><span class="line">      #index index.html index.htm;</span><br><span class="line">      error_page 404 &#x2F;404.html;</span><br><span class="line">          location &#x3D; &#x2F;40x.html &#123;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      error_page 500 502 503 504 &#x2F;50x.html;</span><br><span class="line">          location &#x3D; &#x2F;50x.html &#123;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">    listen 443 ssl; # managed by Certbot</span><br><span class="line">    ssl_certificate &#x2F;etc&#x2F;letsencrypt&#x2F;live&#x2F;test.enzhico.net&#x2F;fullchain.pem; # managed by Certbot</span><br><span class="line">    ssl_certificate_key &#x2F;etc&#x2F;letsencrypt&#x2F;live&#x2F;test.enzhico.net&#x2F;privkey.pem; # managed by Certbot</span><br><span class="line">    include &#x2F;etc&#x2F;letsencrypt&#x2F;options-ssl-nginx.conf; # managed by Certbot</span><br><span class="line">    ssl_dhparam &#x2F;etc&#x2F;letsencrypt&#x2F;ssl-dhparams.pem; # managed by Certbot</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name test.enzhico.net;</span><br><span class="line">    return 301 https:&#x2F;&#x2F;$host$request_uri; # managed by Certbot</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意这其中和普通HTTP代理的关键不同是：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">proxy_set_header Upgrade $http_upgrade;</span><br><span class="line">proxy_set_header Connection $connection_upgrade;</span><br></pre></td></tr></table></figure>

<h2 id="GitHub源码"><a href="#GitHub源码" class="headerlink" title="GitHub源码"></a>GitHub源码</h2><p><a href="https://github.com/yidao620c/SpringBootBucket/tree/master/springboot-socketio" target="_blank" rel="noopener">springboot-socketio</a>   —已测试</p>
<h2 id="来源"><a href="#来源" class="headerlink" title="来源"></a>来源</h2><p><a href="https://www.xncoding.com/" target="_blank" rel="noopener">https://www.xncoding.com/</a></p>
]]></content>
      <categories>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>springboot</tag>
        <tag>socketio</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBoot系列 - 集成Swagger2</title>
    <url>/2020/06/08/SpringBoot%E7%B3%BB%E5%88%97-%E9%9B%86%E6%88%90Swagger2/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="SpringBoot系列-集成Swagger2"><a href="#SpringBoot系列-集成Swagger2" class="headerlink" title="SpringBoot系列 - 集成Swagger2"></a>SpringBoot系列 - 集成Swagger2</h1><p>Swagger是一个简单但功能强大的API表达工具。它具有地球上最大的API工具生态系统，数以千计的开发人员， 使用几乎所有的现代编程语言，都在支持和使用Swagger。使用Swagger生成API，我们可以得到交互式文档， 自动生成代码的SDK以及API的发现特性等。</p>
<p>Swagger2可以利用注解快速、自动地生成接口文档页面，方便调用方查阅！</p>
<p>这一篇讲解如何在Spring Boot中集成Swagger2.</p>
<p>先来张效果图：</p>
<p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591542244-f05b9a86b70114e6c9277b9344178fe7.png" alt=""></p>
<p>可以看到Swagger-Ui是以controller分类,点击一个controller可以看到其中的具体接口,再点击接口就可以看到接口的信息了,如图:</p>
<p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591542244-41508f39b62d4a628087c57076f22038.png" alt=""></p>
<p>我们可以看到该接口的请求方式,返回数据信息和需要传递的参数.而且以上数据是自动生成的,即使代码有一些修改, Swagger文档也会自动同步修改.非常的方便。</p>
<h2 id="构建RESTful-API"><a href="#构建RESTful-API" class="headerlink" title="构建RESTful API"></a>构建RESTful API</h2><p>在使用Swagger2前我们需要有一个RESTful API的项目，Spring Boot创建RESTful API项目非常的方便和快速。</p>
<p>Spring Boot构建RESTful API极为简单，实际就是Spring MVC。</p>
<p>比如我的机具管理API如下，提供了3个接口：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/traffic"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TrafficController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OutTrafficService ts;</span><br><span class="line">    <span class="keyword">private</span> Logger logger = LoggerFactory.getLogger(<span class="keyword">this</span>.getClass());</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 判断该账户是否存在于交警6合1系统</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> req</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(value = <span class="string">"/checkAccount"</span>, method = RequestMethod.POST)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResponseEntity&lt;AccountResponse&gt; <span class="title">checkTrafficAccount</span><span class="params">(@RequestBody TrafficAccountReq req)</span> </span>&#123;</span><br><span class="line">        logger.info(<span class="string">"检查用户账号接口 start..."</span>);</span><br><span class="line">        AccountResponse result = ts.checkTrafficAccount(req);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ResponseEntity&lt;&gt;(result, HttpStatus.OK);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据业务流水号获取机动车缴款信息</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> req</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(value = <span class="string">"/jdcPayInfo"</span>, method = RequestMethod.POST)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResponseEntity&lt;JDCPayInfoResponse&gt; <span class="title">getJDCPayInfo</span><span class="params">(@RequestBody TrafficPayJDCReq req)</span> </span>&#123;</span><br><span class="line">        logger.info(<span class="string">"获取机动车缴款信息接口 start..."</span>);</span><br><span class="line">        JDCPayInfoResponse result = ts.getJDCPayinfo(req);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ResponseEntity&lt;&gt;(result, HttpStatus.OK);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据身份证获取缴款信息</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> req</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(value = <span class="string">"/jsrPayInfo"</span>, method = RequestMethod.POST)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResponseEntity&lt;JSZPayInfoResponse&gt; <span class="title">getJSZPayinfo</span><span class="params">(@RequestBody TrafficPayJSZReq req)</span> </span>&#123;</span><br><span class="line">        logger.info(<span class="string">"获取驾驶证缴款信息接口 start..."</span>);</span><br><span class="line">        JSZPayInfoResponse result = ts.getJSZPayinfo(req);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ResponseEntity&lt;&gt;(result, HttpStatus.OK);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取整个管理部门信息</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(value = <span class="string">"/departmentInfo"</span>, method = RequestMethod.GET)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResponseEntity&lt;DepartmentInfoResponse&gt; <span class="title">getDepartmentinfo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        logger.info(<span class="string">"获取整个管理部门信息 start..."</span>);</span><br><span class="line">        DepartmentInfoResponse result = ts.getDepartmentinfo();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ResponseEntity&lt;&gt;(result, HttpStatus.OK);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="添加Swagger2依赖"><a href="#添加Swagger2依赖" class="headerlink" title="添加Swagger2依赖"></a>添加Swagger2依赖</h2><p>maven依赖：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- swagger2 集成--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.8.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger-ui<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.8.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>我自己也定制过一个ui，github地址：<a href="https://github.com/yidao620c/springfox-swagger-ui" target="_blank" rel="noopener">https://github.com/yidao620c/springfox-swagger-ui</a></p>
<h2 id="创建Swagger2的Java配置类"><a href="#创建Swagger2的Java配置类" class="headerlink" title="创建Swagger2的Java配置类"></a>创建Swagger2的Java配置类</h2><p>通过<code>@Configuration</code>注解，表明它是一个配置类，<code>@EnableSwagger2</code> 注解开启swagger2。 <code>apiInfo()</code> 方法配置一些基本的信息。<code>createRestApi()</code> 方法指定扫描的包会生成文档， 默认是显示所有接口,可以用<code>@ApiIgnore</code>注解标识该接口不显示。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableSwagger</span>2</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Swagger2Config</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Docket <span class="title">createRestApi</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Docket(DocumentationType.SWAGGER_2)</span><br><span class="line">                .produces(Sets.newHashSet(<span class="string">"application/json"</span>))</span><br><span class="line">                .consumes(Sets.newHashSet(<span class="string">"application/json"</span>))</span><br><span class="line">                .protocols(Sets.newHashSet(<span class="string">"http"</span>, <span class="string">"https"</span>))</span><br><span class="line">                .apiInfo(apiInfo())</span><br><span class="line">                .forCodeGeneration(<span class="keyword">true</span>)</span><br><span class="line">                .useDefaultResponseMessages(<span class="keyword">false</span>)</span><br><span class="line">                .select()</span><br><span class="line">                <span class="comment">// 指定controller存放的目录路径</span></span><br><span class="line">                .apis(RequestHandlerSelectors.basePackage(<span class="string">"com.xncoding.modules.traffic.controller"</span>))</span><br><span class="line"><span class="comment">//                .paths(PathSelectors.ant("/api/v1/*"))</span></span><br><span class="line">                .paths(PathSelectors.any())</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> ApiInfo <span class="title">apiInfo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ApiInfoBuilder()</span><br><span class="line">                <span class="comment">// 文档标题</span></span><br><span class="line">                .title(<span class="string">"XX系统API服务"</span>)</span><br><span class="line">                <span class="comment">// 文档描述</span></span><br><span class="line">                .description(<span class="string">"XX系统API接口文档简要描述"</span>)</span><br><span class="line">                <span class="comment">// .termsOfServiceUrl("https://github.com/yidao620c")</span></span><br><span class="line">                .version(<span class="string">"v1"</span>)</span><br><span class="line">                .license(<span class="string">"MIT 协议"</span>)</span><br><span class="line">                .licenseUrl(<span class="string">"http://www.opensource.org/licenses/MIT"</span>)</span><br><span class="line">                .contact(<span class="keyword">new</span> Contact(<span class="string">"熊能"</span>, <span class="string">"https://github.com/yidao620c"</span>, <span class="string">"yidao620@gmail.com"</span>))</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="添加Swagger2注解"><a href="#添加Swagger2注解" class="headerlink" title="添加Swagger2注解"></a>添加Swagger2注解</h2><p>通过在接口上面添加注解方式可配置丰富接口的信息，先看一个例子：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Api</span>(value = <span class="string">"交警业务接口类"</span>, tags = <span class="string">"交警6合1业务接口"</span>, description = <span class="string">"主要任务和交警的专网通信"</span>)</span><br><span class="line"><span class="meta">@ApiResponses</span>(value = &#123;</span><br><span class="line">        <span class="meta">@ApiResponse</span>(code = <span class="number">200</span>, message = <span class="string">"请求正常完成"</span>),</span><br><span class="line">        <span class="meta">@ApiResponse</span>(code = <span class="number">400</span>, message = <span class="string">"请求中有语法问题，或不能满足请求"</span>),</span><br><span class="line"><span class="comment">//        @ApiResponse(code = 401, message = "未授权客户机访问数据"),</span></span><br><span class="line"><span class="comment">//        @ApiResponse(code = 403, message = "服务器接受请求，但是拒绝处理"),</span></span><br><span class="line"><span class="comment">//        @ApiResponse(code = 404, message = "服务器找不到给定的资源，文档不存在"),</span></span><br><span class="line">        <span class="meta">@ApiResponse</span>(code = <span class="number">500</span>, message = <span class="string">"服务器出现异常"</span>)&#125;</span><br><span class="line">)</span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/traffic"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TrafficController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OutTrafficService ts;</span><br><span class="line">    <span class="keyword">private</span> Logger logger = LoggerFactory.getLogger(<span class="keyword">this</span>.getClass());</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 判断该账户是否存在于交警6合1系统</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> req</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ApiOperation</span>(value = <span class="string">"检查用户账号接口"</span>, notes = <span class="string">"检查该用户是否在6合1系统中存在"</span>, produces = <span class="string">"application/json"</span>)</span><br><span class="line">    <span class="meta">@RequestMapping</span>(value = <span class="string">"/checkAccount"</span>, method = RequestMethod.POST)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResponseEntity&lt;AccountResponse&gt; <span class="title">checkTrafficAccount</span><span class="params">(@RequestBody TrafficAccountReq req)</span> </span>&#123;</span><br><span class="line">        logger.info(<span class="string">"检查用户账号接口 start..."</span>);</span><br><span class="line">        AccountResponse result = ts.checkTrafficAccount(req);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ResponseEntity&lt;&gt;(result, HttpStatus.OK);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Swagger2提供了一些注解来丰富接口的信息,常用的有:</p>
<p>说明：</p>
<ul>
<li>@Api：用在类上，说明该类的作用</li>
<li>@ApiOperation：用在方法上，说明方法的作用</li>
<li>@ApiImplicitParams：用在方法上包含一组参数说明</li>
<li>@ApiImplicitParam：用在@ApiImplicitParams注解中，指定一个请求参数的各个方面<ul>
<li>paramType：参数放在哪个地方<ul>
<li>header–&gt;请求参数的获取：@RequestHeader</li>
<li>query–&gt;请求参数的获取：@RequestParam</li>
<li>path（用于restful接口）–&gt;请求参数的获取：@PathVariable</li>
<li>body（不常用）</li>
<li>form（不常用）</li>
</ul>
</li>
<li>name：参数名</li>
<li>dataType：参数类型</li>
<li>required：参数是否必须传</li>
<li>value：参数的意思</li>
<li>defaultValue：参数的默认值</li>
</ul>
</li>
<li>@ApiResponses：用于表示一组响应</li>
<li>@ApiResponse：用在@ApiResponses中，一般用于表达一个错误的响应信息<ul>
<li>code：数字，例如400</li>
<li>message：信息，例如”请求参数没填好”</li>
<li>response：抛出异常的类</li>
</ul>
</li>
<li>@ApiModel：描述一个Model的信息（这种一般用在post创建的时候，使用@RequestBody这样的场景，请求参数无法使用@ApiImplicitParam注解进行描述的时候）</li>
<li>@ApiModelProperty：描述一个model的属性</li>
</ul>
<p>以上这些就是最常用的几个注解了。</p>
<p>具体其他的注解，查看：</p>
<p><a href="https://github.com/swagger-api/swagger-core/wiki/Annotations#apimodel" target="_blank" rel="noopener">https://github.com/swagger-api/swagger-core/wiki/Annotations#apimodel</a></p>
<p>更多请参考<a href="http://docs.swagger.io/swagger-core/apidocs/com/wordnik/swagger/annotations/package-summary.html" target="_blank" rel="noopener">Swagger注解文档</a></p>
<h2 id="与Shiro集成配置"><a href="#与Shiro集成配置" class="headerlink" title="与Shiro集成配置"></a>与Shiro集成配置</h2><p>注意如果Spring Boot使用过Shiro或Spring Security框架，需要将相应的URL访问权限放开，以Shiro为例，添加匿名访问过滤器：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">filterChainDefinitionMap.put(<span class="string">"/api/v1/**"</span>, <span class="string">"anon"</span>); <span class="comment">//API接口</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// swagger接口文档</span></span><br><span class="line">filterChainDefinitionMap.put(<span class="string">"/v2/api-docs"</span>, <span class="string">"anon"</span>);</span><br><span class="line">filterChainDefinitionMap.put(<span class="string">"/webjars/**"</span>, <span class="string">"anon"</span>);</span><br><span class="line">filterChainDefinitionMap.put(<span class="string">"/swagger-resources/**"</span>, <span class="string">"anon"</span>);</span><br><span class="line">filterChainDefinitionMap.put(<span class="string">"/swagger-ui.html"</span>, <span class="string">"anon"</span>);</span><br></pre></td></tr></table></figure>

<h2 id="访问SwaggerUI"><a href="#访问SwaggerUI" class="headerlink" title="访问SwaggerUI"></a>访问SwaggerUI</h2><p>访问<code>http://localhost:8080/swagger-ui.html</code>页面查看API文档</p>
<p>如果使用的是<code>swagger-bootstrap-ui</code>，请访问<code>http://localhost:8080/doc.html</code></p>
<h2 id="生成PDF文档"><a href="#生成PDF文档" class="headerlink" title="生成PDF文档"></a>生成PDF文档</h2><p>参考我的另一篇文章 <a href="https://www.xncoding.com/2017/06/09/web/swagger.html" target="_blank" rel="noopener">使用Swagger生成RESTful API文档</a></p>
<p>这里我通过SpringBoot + Swagger2方式来生成AsciiDoc，然后剩下的步骤和上面博客一样。</p>
<h3 id="maven依赖"><a href="#maven依赖" class="headerlink" title="maven依赖"></a>maven依赖</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.pegdown<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pegdown<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.6.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.github.swagger2markup<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>swagger2markup<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>另外修改下surefire插件，增加2个系统属性，也就是swagger.json和adoc文件生成的位置：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-surefire-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.20<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">systemPropertyVariables</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">swaggerOutputDir</span>&gt;</span>$&#123;project.basedir&#125;/src/main/resources/swagger<span class="tag">&lt;/<span class="name">swaggerOutputDir</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">asciiDocOutputDir</span>&gt;</span>$&#123;project.basedir&#125;/src/main/resources/swagger/swagger<span class="tag">&lt;/<span class="name">asciiDocOutputDir</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">systemPropertyVariables</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">skip</span>&gt;</span>true<span class="tag">&lt;/<span class="name">skip</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="编写单元测试方法"><a href="#编写单元测试方法" class="headerlink" title="编写单元测试方法"></a>编写单元测试方法</h3><p>原理是通过SpringBoot的MockMvc启动后访问<code>/v2/api-docs</code>，这个是Swagger的接口数据，然后保存为<code>swagger.json</code>，</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@AutoConfigureMockMvc</span></span><br><span class="line"><span class="meta">@RunWith</span>(SpringRunner<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">@<span class="title">SpringBootTest</span>(<span class="title">classes</span> </span>= Application<span class="class">.<span class="keyword">class</span>, <span class="title">webEnvironment</span> </span>= SpringBootTest.WebEnvironment.RANDOM_PORT)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Swagger2MarkupTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MockMvc mockMvc;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger LOG = LoggerFactory.getLogger(Swagger2MarkupTest<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">createSpringFoxSwaggerJson</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"><span class="comment">//        String outputDir = System.getProperty("swaggerOutputDir"); // mvn test</span></span><br><span class="line">        MvcResult mvcResult = <span class="keyword">this</span>.mockMvc.perform(get(<span class="string">"/v2/api-docs"</span>)</span><br><span class="line">                .accept(MediaType.APPLICATION_JSON))</span><br><span class="line">                .andExpect(status().isOk())</span><br><span class="line">                .andReturn();</span><br><span class="line">        MockHttpServletResponse response = mvcResult.getResponse();</span><br><span class="line">        String swaggerJson = response.getContentAsString();</span><br><span class="line"><span class="comment">//        Files.createDirectories(Paths.get(outputDir));</span></span><br><span class="line"><span class="comment">//        try (BufferedWriter writer = Files.newBufferedWriter(Paths.get(outputDir, "swagger.json"), StandardCharsets.UTF_8))&#123;</span></span><br><span class="line"><span class="comment">//            writer.write(swaggerJson);</span></span><br><span class="line"><span class="comment">//        &#125;</span></span><br><span class="line">        LOG.info(<span class="string">"--------------------swaggerJson create --------------------"</span>);</span><br><span class="line">        convertAsciidoc(swaggerJson);</span><br><span class="line">        LOG.info(<span class="string">"--------------------swagon.json to asciiDoc finished --------------------"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将swagger.yaml或swagger.json转换成漂亮的 AsciiDoc</span></span><br><span class="line"><span class="comment">     * 访问：http://localhost:9095/v2/api-docs</span></span><br><span class="line"><span class="comment">     * 将页面结果保存为src/main/resources/swagger.json</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">convertAsciidoc</span><span class="params">(String swaggerStr)</span> </span>&#123;</span><br><span class="line"><span class="comment">//        Path localSwaggerFile = Paths.get(System.getProperty("swaggerOutputDir"), "swagger.json");</span></span><br><span class="line">        Path outputFile = Paths.get(System.getProperty(<span class="string">"asciiDocOutputDir"</span>));</span><br><span class="line">        Swagger2MarkupConfig config = <span class="keyword">new</span> Swagger2MarkupConfigBuilder()</span><br><span class="line">                .withMarkupLanguage(MarkupLanguage.ASCIIDOC)</span><br><span class="line">                .withOutputLanguage(Language.ZH)</span><br><span class="line">                .withPathsGroupedBy(GroupBy.TAGS)</span><br><span class="line">                .withGeneratedExamples()</span><br><span class="line">                .withoutInlineSchema()</span><br><span class="line">                .build();</span><br><span class="line">        Swagger2MarkupConverter converter = Swagger2MarkupConverter.from(swaggerStr)</span><br><span class="line">                .withConfig(config)</span><br><span class="line">                .build();</span><br><span class="line">        converter.toFile(outputFile);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>执行之后会在<code>resources/swagger/</code>下面生成<code>swagger.adoc</code>，在<code>swagger.adoc</code>的顶部加入：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">:toclevels: 3</span><br><span class="line">:numbered:</span><br></pre></td></tr></table></figure>

<p>注意有个空行分割，目的是左边导航菜单是3级，并且自动加序号。为了美化显示，根据你的需要调整表格宽度，比如</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cols&#x3D;&quot;.^2,.^3,.^9,.^4,.^2&quot;</span><br></pre></td></tr></table></figure>

<p>替换成：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cols&#x3D;&quot;.^2,.^3,.^6,.^4,.^5&quot;</span><br></pre></td></tr></table></figure>

<p>然后在/resources目录下面执行：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">asciidoctor-pdf -r asciidoctor-pdf-cjk-kai_gen_gothic -a pdf-style&#x3D;KaiGenGothicCN swagger&#x2F;swagger.adoc</span><br></pre></td></tr></table></figure>

<p>更详细的安装字体和asciidoctor-pdf命令的方法，请参考上面的博客，将adoc文件转换成好看的PDF。</p>
<p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591542244-ec16d046fa94cf95570171c2a25f0f61.png" alt=""></p>
<h2 id="GitHub源码"><a href="#GitHub源码" class="headerlink" title="GitHub源码"></a>GitHub源码</h2><p><a href="https://github.com/yidao620c/SpringBootBucket/tree/master/springboot-swagger2" target="_blank" rel="noopener">springboot-swagger2</a>   —已测试</p>
<h2 id="来源"><a href="#来源" class="headerlink" title="来源"></a>来源</h2><p><a href="https://www.xncoding.com/" target="_blank" rel="noopener">https://www.xncoding.com/</a></p>
]]></content>
      <categories>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>springboot</tag>
        <tag>swagger2</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBoot系列 - 集成Thymeleaf构建Web应用</title>
    <url>/2020/06/08/SpringBoot%E7%B3%BB%E5%88%97-%E9%9B%86%E6%88%90Thymeleaf%E6%9E%84%E5%BB%BAWeb%E5%BA%94%E7%94%A8/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="SpringBoot系列-集成Thymeleaf构建Web应用"><a href="#SpringBoot系列-集成Thymeleaf构建Web应用" class="headerlink" title="SpringBoot系列 - 集成Thymeleaf构建Web应用"></a>SpringBoot系列 - 集成Thymeleaf构建Web应用</h1><p>Thymeleaf 是一个跟 Velocity、FreeMarker 类似的模板引擎，它可以完全替代 JSP 。相较与其他的模板引擎，它有如下三个极吸引人的特点：</p>
<ol>
<li>Thymeleaf 在有网络和无网络的环境下皆可运行，即它可以让美工在浏览器查看页面的静态效果，也可以让程序员在服务器查看带数据的动态页面效果。</li>
<li>Thymeleaf 开箱即用的特性。它提供标准和spring标准两种方言，可以直接套用模板实现JSTL、 OGNL表达式效果，避免每天套模板、该jstl、改标签的困扰。</li>
<li>Thymeleaf 提供spring标准方言和一个与 SpringMVC 完美集成的可选模块，可以快速的实现表单绑定、属性编辑器、国际化等功能。</li>
</ol>
<p>目前最新版本是Thymeleaf 3，官网地址：<a href="http://www.thymeleaf.org/" target="_blank" rel="noopener">http://www.thymeleaf.org</a></p>
<p>本篇将介绍如何在SpringBoot中集成Thymeleaf构建Web应用。</p>
<h2 id="maven依赖"><a href="#maven依赖" class="headerlink" title="maven依赖"></a>maven依赖</h2><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">project.reporting.outputEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.reporting.outputEncoding</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">thymeleaf.version</span>&gt;</span>3.0.7.RELEASE<span class="tag">&lt;/<span class="name">thymeleaf.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">thymeleaf-layout-dialect.version</span>&gt;</span>2.2.2<span class="tag">&lt;/<span class="name">thymeleaf-layout-dialect.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jetty<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="资源目录"><a href="#资源目录" class="headerlink" title="资源目录"></a>资源目录</h2><p>Spring Boot默认提供静态资源目录位置需置于classpath下，目录名需符合如下规则：</p>
<ol>
<li>/static</li>
<li>/public</li>
<li>/resources</li>
<li>/META-INF/resources</li>
</ol>
<p>举例：我们可以在<code>src/main/resources/</code>目录下创建static，在该位置放置一个图片文件<code>pic.jpg</code>。 启动程序后，尝试访问<code>http://localhost:8080/pic.jpg</code>。如能显示图片，配置成功。</p>
<p>SpringBoot的默认模板路径为：<code>src/main/resources/templates</code></p>
<h2 id="添加页面"><a href="#添加页面" class="headerlink" title="添加页面"></a>添加页面</h2><p>这里我在<code>src/main/resources/templates</code>下面添加一个<code>index.html</code>首页，同时引用到一些css、js文件，看看Thymeleaf 3的语法：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns</span>=<span class="string">"http://www.w3.org/1999/xhtml"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">xmlns:th</span>=<span class="string">"http://www.thymeleaf.org"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"renderer"</span> <span class="attr">content</span>=<span class="string">"webkit"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"shortcut icon"</span> <span class="attr">th:href</span>=<span class="string">"@&#123;/favicon.ico&#125;"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">th:href</span>=<span class="string">"@&#123;/static/css/bootstrap.min.css&#125;"</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">th:href</span>=<span class="string">"@&#123;/static/css/font-awesome.min.css&#125;"</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">class</span>=<span class="string">"fixed-sidebar full-height-layout gray-bg"</span> <span class="attr">style</span>=<span class="string">"overflow:hidden"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"wrapper"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span> <span class="attr">th:text</span>=<span class="string">"$&#123;msg&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">th:src</span>=<span class="string">"@&#123;/static/js/jquery.min.js&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">th:src</span>=<span class="string">"@&#123;/static/js/bootstrap.min.js&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>页面中几个地方说明一下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;html xmlns&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;1999&#x2F;xhtml&quot;</span><br><span class="line">      xmlns:th&#x3D;&quot;http:&#x2F;&#x2F;www.thymeleaf.org&quot;&gt;</span><br></pre></td></tr></table></figure>

<p>加上这个命名空间后就能在页面中使用Thymeleaf自己的标签了，以<code>th:</code>开头。</p>
<p>连接语法 <code>th:href=&quot;@{/static/css/bootstrap.min.css}&quot;</code></p>
<p>访问Model中的数据语法 <code>th:text=&quot;${msg}&quot;</code></p>
<p>这里我在页面里显示的是一个键为<code>msg</code>的消息，需要后台传递过来。</p>
<p>Thymeleaf 3的详细语法规则请参考 <a href="http://www.thymeleaf.org/doc/tutorials/3.0/usingthymeleaf.html" target="_blank" rel="noopener">官网教程</a></p>
<h2 id="编写Controller"><a href="#编写Controller" class="headerlink" title="编写Controller"></a>编写Controller</h2><p>接下来编写控制器类，将URL <code>/</code> 和 <code>/index</code> 都返回index.html页面：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IndexController</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger _logger = LoggerFactory.getLogger(IndexController<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 主页</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> model</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(&#123;<span class="string">"/"</span>, <span class="string">"/index"</span>&#125;)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">index</span><span class="params">(Model model)</span> </span>&#123;</span><br><span class="line">        model.addAttribute(<span class="string">"msg"</span>, <span class="string">"welcome you!"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"index"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里，我再model里面添加了一个属性，key=<code>msg</code>，值为<code>welcome you!</code>。</p>
<p>接下来启动应用后，打开首页看看效果如何。消息正确显示，成功！。</p>
<h2 id="GitHub源码"><a href="#GitHub源码" class="headerlink" title="GitHub源码"></a>GitHub源码</h2><p>已测试</p>
<h2 id="来源"><a href="#来源" class="headerlink" title="来源"></a>来源</h2><p><a href="https://www.xncoding.com/" target="_blank" rel="noopener">https://www.xncoding.com/</a></p>
]]></content>
      <categories>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>springboot</tag>
        <tag>thymeleaf</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBoot系列 - 集成WebSocket实时通信</title>
    <url>/2020/06/08/SpringBoot%E7%B3%BB%E5%88%97-%E9%9B%86%E6%88%90WebSocket%E5%AE%9E%E6%97%B6%E9%80%9A%E4%BF%A1/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="SpringBoot系列-集成WebSocket实时通信"><a href="#SpringBoot系列-集成WebSocket实时通信" class="headerlink" title="SpringBoot系列 - 集成WebSocket实时通信"></a>SpringBoot系列 - 集成WebSocket实时通信</h1><p>WebSocket是 HTML5 开始提供的一种浏览器与服务器间进行全双工通讯的网络技术。 WebSocket 通信协议于2011年被IETF定为标准RFC 6455，WebSocketAPI 被W3C定为标准。 在WebSocket API 中，浏览器和服务器只需要要做一个握手的动作，然后，浏览器和服务器之间就形成了一条快速通道。 两者之间就直接可以数据互相传送。</p>
<p>注意特点：</p>
<ul>
<li>为浏览器和服务端提供了双工异步通信的功能，即服务器可以主动向客户端推送信息，客户端也可以主动向服务器发送信息，是真正的双向平等对话，属于服务器推送技术的一种。</li>
<li>建立在 TCP 协议之上，服务器端的实现比较容易。</li>
<li>与 HTTP 协议有着良好的兼容性。默认端口也是80和443，并且握手阶段采用 HTTP 协议，因此握手时不容易屏蔽，能通过各种 HTTP 代理服务器。</li>
<li>数据格式比较轻量，性能开销小，通信高效。</li>
<li>可以发送文本，也可以发送二进制数据。</li>
<li>没有同源限制，客户端可以与任意服务器通信。</li>
<li>协议标识符是ws（如果加密，则为wss），服务器网址就是 URL。</li>
</ul>
<p>有多种方式实现WebSocket协议，比如SpringBoot官方推荐的基于STOMP实现，实现起来非常简单，还有通过Socket.IO来实现。 这里我讲一下基于STOMP的实现方案。</p>
<h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>STOMP：即<code>Simple Text Orientated Messaging Protocol</code>，它是一个简单的文本消息传输协议，属于 WebSocket 的子协议， 提供了一个可互操作的连接格式，允许STOMP客户端与任意STOMP消息代理（Broker）进行交互。STOMP协议由于设计简单， 易于开发客户端，因此在多种语言和多种平台上得到广泛地应用。</p>
<h2 id="引入依赖"><a href="#引入依赖" class="headerlink" title="引入依赖"></a>引入依赖</h2><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-websocket<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jetty<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>个人喜好用jetty取代tomcat，所以才这样写。你可以只需要引入<code>spring-boot-starter-websocket</code>即可。</p>
<h2 id="配置类"><a href="#配置类" class="headerlink" title="配置类"></a>配置类</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableWebSocketMessageBroker</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebSocketConfig</span> <span class="keyword">extends</span> <span class="title">AbstractWebSocketMessageBrokerConfigurer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">registerStompEndpoints</span><span class="params">(StompEndpointRegistry stompEndpointRegistry)</span> </span>&#123;</span><br><span class="line">        stompEndpointRegistry.addEndpoint(<span class="string">"/simple"</span>)</span><br><span class="line">                .setAllowedOrigins(<span class="string">"*"</span>) <span class="comment">//解决跨域问题</span></span><br><span class="line">                .withSockJS();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configureMessageBroker</span><span class="params">(MessageBrokerRegistry registry)</span> </span>&#123;</span><br><span class="line">        registry.enableSimpleBroker(<span class="string">"/topic"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>关于这个类说明如下：</p>
<ol>
<li>@EnableWebSocketMessageBroker注解表示开启使用STOMP协议来传输基于代理的消息，Broker就是代理的意思。</li>
<li>registerStompEndpoints方法表示注册STOMP协议的节点，并指定映射的URL</li>
<li>addEndpoint(“/simple”).withSockJS(); 用来注册STOMP协议节点，同时指定使用SockJS</li>
<li>configureMessageBroker方法用来配置消息代理，由于我们是实现推送功能，这里的消息代理是/topic</li>
</ol>
<h2 id="请求消息类"><a href="#请求消息类" class="headerlink" title="请求消息类"></a>请求消息类</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RequestMessage</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="响应消息类"><a href="#响应消息类" class="headerlink" title="响应消息类"></a>响应消息类</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ResponseMessage</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String responseMessage;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ResponseMessage</span><span class="params">(String responseMessage)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.responseMessage = responseMessage;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getResponseMessage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> responseMessage;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="SpringMVC控制器"><a href="#SpringMVC控制器" class="headerlink" title="SpringMVC控制器"></a>SpringMVC控制器</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WsController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> SimpMessagingTemplate messagingTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">WsController</span><span class="params">(SimpMessagingTemplate messagingTemplate)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.messagingTemplate = messagingTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@MessageMapping</span>(<span class="string">"/welcome"</span>)</span><br><span class="line">    <span class="meta">@SendTo</span>(<span class="string">"/topic/say"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResponseMessage <span class="title">say</span><span class="params">(RequestMessage message)</span> </span>&#123;</span><br><span class="line">        System.out.println(message.getName());</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ResponseMessage(<span class="string">"welcome,"</span> + message.getName() + <span class="string">" !"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 定时推送消息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Scheduled</span>(fixedRate = <span class="number">1000</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">callback</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 发现消息</span></span><br><span class="line">        DateFormat df = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-MM-dd HH:mm:ss"</span>);</span><br><span class="line">        messagingTemplate.convertAndSend(<span class="string">"/topic/callback"</span>, <span class="string">"定时推送消息时间: "</span> + df.format(<span class="keyword">new</span> Date()));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>say方法上添加的@MessageMapping注解和我们之前使用的@RequestMapping类似。@SendTo注解表示当服务器有消息需要推送的时候， 会对订阅了@SendTo中路径的浏览器发送消息。</p>
<p>除此之外，我还定义了一个定时推送消息方法，这个方法每隔1秒会主动给订阅了主题<code>/topic/callback</code>的客户端推送消息。</p>
<p>到此为止服务器端就编写完成，可以看到服务器的编写非常简单。</p>
<h2 id="客户端"><a href="#客户端" class="headerlink" title="客户端"></a>客户端</h2><p>这里我使用浏览器的js来测试，先添加三个js文件：</p>
<ol>
<li>STOMP协议的客户端脚本stomp.js</li>
<li>SockJS的客户端脚本sock.js</li>
<li>页面dom操作脚本jQuery</li>
</ol>
<p>可在我的github项目源码里面找到这三个js文件。</p>
<p>下面是演示的页面：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>广播式WebSocket<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"js/sockjs.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"js/stomp.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"js/jquery-3.1.1.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">onload</span>=<span class="string">"disconnect()"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">noscript</span>&gt;</span><span class="tag">&lt;<span class="name">h2</span> <span class="attr">style</span>=<span class="string">"color: #e80b0a;"</span>&gt;</span>Sorry，浏览器不支持WebSocket<span class="tag">&lt;/<span class="name">h2</span>&gt;</span><span class="tag">&lt;/<span class="name">noscript</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"connect"</span> <span class="attr">onclick</span>=<span class="string">"connect();"</span>&gt;</span>连接<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"disconnect"</span> <span class="attr">disabled</span>=<span class="string">"disabled"</span> <span class="attr">onclick</span>=<span class="string">"disconnect();"</span>&gt;</span>断开连接<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"conversationDiv"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span>&gt;</span>输入你的名字<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">id</span>=<span class="string">"name"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"sendName"</span> <span class="attr">onclick</span>=<span class="string">"sendName();"</span>&gt;</span>发送<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">"response"</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">"callback"</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span></span><br><span class="line"><span class="actionscript">    <span class="keyword">var</span> stompClient = <span class="literal">null</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">    <span class="function"><span class="keyword">function</span> <span class="title">setConnected</span><span class="params">(connected)</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">document</span>.getElementById(<span class="string">"connect"</span>).disabled = connected;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">document</span>.getElementById(<span class="string">"disconnect"</span>).disabled = !connected;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">document</span>.getElementById(<span class="string">"conversationDiv"</span>).style.visibility = connected ? <span class="string">'visible'</span> : <span class="string">'hidden'</span>;</span></span><br><span class="line"><span class="javascript">        $(<span class="string">"#response"</span>).html();</span></span><br><span class="line"><span class="javascript">        $(<span class="string">"#callback"</span>).html();</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="actionscript">    <span class="function"><span class="keyword">function</span> <span class="title">connect</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">var</span> socket = <span class="keyword">new</span> SockJS(<span class="string">'http://localhost:8092/simple'</span>);</span></span><br><span class="line">        stompClient = Stomp.over(socket);</span><br><span class="line"><span class="actionscript">        stompClient.connect(&#123;&#125;, <span class="function"><span class="keyword">function</span> <span class="params">(frame)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">            setConnected(<span class="literal">true</span>);</span></span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="string">'Connected:'</span> + frame);</span></span><br><span class="line"><span class="actionscript">            stompClient.subscribe(<span class="string">'/topic/say'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(response)</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">                showResponse(<span class="built_in">JSON</span>.parse(response.body).responseMessage);</span></span><br><span class="line">            &#125;);</span><br><span class="line"><span class="actionscript">            <span class="comment">// 另外再注册一下定时任务接受</span></span></span><br><span class="line"><span class="actionscript">            stompClient.subscribe(<span class="string">'/topic/callback'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(response)</span> </span>&#123;</span></span><br><span class="line">                showCallback(response.body);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="actionscript">    <span class="function"><span class="keyword">function</span> <span class="title">disconnect</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">if</span> (stompClient != <span class="literal">null</span>) &#123;</span></span><br><span class="line">            stompClient.disconnect();</span><br><span class="line">        &#125;</span><br><span class="line"><span class="actionscript">        setConnected(<span class="literal">false</span>);</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(<span class="string">'Disconnected'</span>);</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="actionscript">    <span class="function"><span class="keyword">function</span> <span class="title">sendName</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> name = $(<span class="string">'#name'</span>).val();</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(<span class="string">'name:'</span> + name);</span></span><br><span class="line"><span class="javascript">        stompClient.send(<span class="string">"/welcome"</span>, &#123;&#125;, <span class="built_in">JSON</span>.stringify(&#123;<span class="string">'name'</span>: name&#125;));</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="actionscript">    <span class="function"><span class="keyword">function</span> <span class="title">showResponse</span><span class="params">(message)</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">        $(<span class="string">"#response"</span>).html(message);</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="actionscript">    <span class="function"><span class="keyword">function</span> <span class="title">showCallback</span><span class="params">(message)</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">        $(<span class="string">"#callback"</span>).html(message);</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>页面上面点击”连接”按钮后，开始连接到<code>/simple</code>节点。输入名字后点击发送，将向<code>/welcome</code>的url发送消息。</p>
<p>同时订阅了两个主题：<code>/topic/say</code> 和 <code>/topic/callback</code>，会接收到服务器的say方法的返回，以及定时推送消息。</p>
<p>演示效果：</p>
<p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591543223-6e221e2b415531b8575eadb10c0538b6.png" alt=""></p>
<p>每隔一秒页面都会刷新显示当前时间。同时控制台也会打印定时推送过来的消息。</p>
<h2 id="Android客户端"><a href="#Android客户端" class="headerlink" title="Android客户端"></a>Android客户端</h2><p>对于想要使用Android客户端进行WebSocket通信的， 可参考 <a href="https://github.com/NaikSoftware/StompProtocolAndroid" target="_blank" rel="noopener">StompProtocolAndroid</a></p>
<h2 id="GitHub源码"><a href="#GitHub源码" class="headerlink" title="GitHub源码"></a>GitHub源码</h2><p><a href="https://github.com/yidao620c/SpringBootBucket/tree/master/springboot-websocket" target="_blank" rel="noopener">springboot-websocket</a>   —已测试</p>
<h2 id="来源"><a href="#来源" class="headerlink" title="来源"></a>来源</h2><p><a href="https://www.xncoding.com/" target="_blank" rel="noopener">https://www.xncoding.com/</a></p>
]]></content>
      <categories>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>springboot</tag>
        <tag>websocket</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringBoot系列 - 集成JWT实现接口权限认证</title>
    <url>/2020/06/08/SpringBoot%E7%B3%BB%E5%88%97-%E9%9B%86%E6%88%90JWT%E5%AE%9E%E7%8E%B0%E6%8E%A5%E5%8F%A3%E6%9D%83%E9%99%90%E8%AE%A4%E8%AF%81/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="SpringBoot系列-集成JWT实现接口权限认证"><a href="#SpringBoot系列-集成JWT实现接口权限认证" class="headerlink" title="SpringBoot系列 - 集成JWT实现接口权限认证"></a>SpringBoot系列 - 集成JWT实现接口权限认证</h1><p>一般来讲，对于RESTful API都会有认证(Authentication)和授权(Authorization)过程，保证API的安全性。</p>
<p>Authentication指的是确定这个用户的身份，Authorization是确定该用户拥有什么操作权限。</p>
<p>认证方式一般有三种</p>
<p><em>Basic Authentication</em></p>
<p>这种方式是直接将用户名和密码放到Header中，使用<code>Authorization: Basic Zm9vOmJhcg==</code>，使用最简单但是最不安全。</p>
<p><em>TOKEN认证</em></p>
<p>这种方式也是再HTTP头中，使用<code>Authorization: Bearer &lt;token&gt;</code>，使用最广泛的TOKEN是JWT，通过签名过的TOKEN。</p>
<p><em>OAuth2.0</em></p>
<p>这种方式安全等级最高，但是也是最复杂的。如果不是大型API平台或者需要给第三方APP使用的，没必要整这么复杂。</p>
<p>一般项目中的RESTful API使用JWT来做认证就足够了。</p>
<p>关于JWT的介绍请参考我的另一篇文章：<a href="https://www.xncoding.com/2017/06/22/security/jwt.html" target="_blank" rel="noopener">https://www.xncoding.com/2017/06/22/security/jwt.html</a></p>
<h2 id="SpringBoot集成JWT"><a href="#SpringBoot集成JWT" class="headerlink" title="SpringBoot集成JWT"></a>SpringBoot集成JWT</h2><p>简要的说明下我们为什么要用JWT，因为我们要实现完全的前后端分离，所以不可能使用session，cookie的方式进行鉴权， 所以JWT就被派上了用场，可以通过一个加密密钥来进行前后端的鉴权。</p>
<p>程序逻辑:</p>
<ol>
<li>我们POST用户名与密码到/login进行登入，如果成功返回一个加密token，失败的话直接返回401错误。</li>
<li>之后用户访问每一个需要权限的网址请求必须在header中添加Authorization字段，例如Authorization: token，token为密钥。</li>
<li>后台会进行token的校验，如果不通过直接返回401。</li>
</ol>
<p>这里我讲一下如何在SpringBoot中使用JWT来做接口权限认证，安全框架依旧使用Shiro，JWT的实现使用 <a href="https://github.com/jwtk/jjwt" target="_blank" rel="noopener">jjwt</a></p>
<h3 id="添加Maven依赖"><a href="#添加Maven依赖" class="headerlink" title="添加Maven依赖"></a>添加Maven依赖</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jetty<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.auth0<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>java-jwt<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- shiro 权限控制 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.shiro<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>shiro-spring<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- shiro ehcache (shiro缓存)--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.shiro<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>shiro-ehcache<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="创建用户Service"><a href="#创建用户Service" class="headerlink" title="创建用户Service"></a>创建用户Service</h3><p>这个在shiro一节讲过如果创建角色权限表，添加用户Service来执行查找用户操作，这里就不多讲具体实现了，只列出关键代码：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 通过名称查找用户</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> username</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ManagerInfo <span class="title">findByUsername</span><span class="params">(String username)</span> </span>&#123;</span><br><span class="line">    ManagerInfo managerInfo = managerInfoDao.findByUsername(username);</span><br><span class="line">    <span class="keyword">if</span> (managerInfo == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> UnknownAccountException();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> managerInfo;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>用户信息类：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ManagerInfo</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 主键ID</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 账号</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 密码</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * md5密码盐</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String salt;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 一个管理员具有多个角色</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;SysRole&gt; roles;</span><br></pre></td></tr></table></figure>

<h3 id="JWT工具类"><a href="#JWT工具类" class="headerlink" title="JWT工具类"></a>JWT工具类</h3><p>我们写一个简单的JWT加密，校验工具，并且使用用户自己的密码充当加密密钥， 这样保证了token 即使被他人截获也无法破解。并且我们在token中附带了username信息，并且设置密钥5分钟就会过期。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JWTUtil</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger log = LoggerFactory.getLogger(JWTUtil<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 过期时间5分钟</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> EXPIRE_TIME = <span class="number">5</span> * <span class="number">60</span> * <span class="number">1000</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 生成签名,5min后过期</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username 用户名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> secret   用户的密码</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 加密的token</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">sign</span><span class="params">(String username, String secret)</span> </span>&#123;</span><br><span class="line">        Date date = <span class="keyword">new</span> Date(System.currentTimeMillis() + EXPIRE_TIME);</span><br><span class="line">        Algorithm algorithm = Algorithm.HMAC256(secret);</span><br><span class="line">        <span class="comment">// 附带username信息</span></span><br><span class="line">        <span class="keyword">return</span> JWT.create()</span><br><span class="line">                .withClaim(<span class="string">"username"</span>, username)</span><br><span class="line">                .withExpiresAt(date)</span><br><span class="line">                .sign(algorithm);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 校验token是否正确</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> token  密钥</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> secret 用户的密码</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 是否正确</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">verify</span><span class="params">(String token, String username, String secret)</span> </span>&#123;</span><br><span class="line">        Algorithm algorithm = Algorithm.HMAC256(secret);</span><br><span class="line">        JWTVerifier verifier = JWT.require(algorithm)</span><br><span class="line">                .withClaim(<span class="string">"username"</span>, username)</span><br><span class="line">                .build();</span><br><span class="line">        DecodedJWT jwt = verifier.verify(token);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获得token中的信息无需secret解密也能获得</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> token中包含的用户名</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getUsername</span><span class="params">(String token)</span> </span>&#123;</span><br><span class="line">        DecodedJWT jwt = JWT.decode(token);</span><br><span class="line">        <span class="keyword">return</span> jwt.getClaim(<span class="string">"username"</span>).asString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="编写登录接口"><a href="#编写登录接口" class="headerlink" title="编写登录接口"></a>编写登录接口</h3><p>为了让用户登录的时候获取到正确的JWT Token，需要实现登录接口，这里我编写一个<code>LoginController.java</code>：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 登录接口类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> ManagerInfoService managerInfoService;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger _logger = LoggerFactory.getLogger(LoginController<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping</span>(<span class="string">"/login"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> BaseResponse&lt;String&gt; <span class="title">login</span><span class="params">(@RequestHeader(name=<span class="string">"Content-Type"</span>, defaultValue = <span class="string">"application/json"</span>)</span> String contentType,</span></span><br><span class="line"><span class="function">                                      @RequestBody LoginParam loginParam) </span>&#123;</span><br><span class="line">        _logger.info(<span class="string">"用户请求登录获取Token"</span>);</span><br><span class="line">        String username = loginParam.getUsername();</span><br><span class="line">        String password = loginParam.getPassword();</span><br><span class="line">        ManagerInfo user = managerInfoService.findByUsername(username);</span><br><span class="line">        <span class="comment">//随机数盐</span></span><br><span class="line">        String salt = user.getSalt();</span><br><span class="line">        <span class="comment">//原密码加密（通过username + salt作为盐）</span></span><br><span class="line">        String encodedPassword = ShiroKit.md5(password, username + salt);</span><br><span class="line">        <span class="keyword">if</span> (user.getPassword().equals(encodedPassword)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> BaseResponse&lt;&gt;(<span class="keyword">true</span>, <span class="string">"Login success"</span>, JWTUtil.sign(username, encodedPassword));</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> UnauthorizedException();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意上面登录的时候，我会从数据库中把这个用户取出来，密码加盐算MD5值比较，通过之后再用密码作为密钥来签名生成JWT。</p>
<h3 id="编写RESTful接口"><a href="#编写RESTful接口" class="headerlink" title="编写RESTful接口"></a>编写RESTful接口</h3><p>先编写一个通用的接口返回类：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * API接口的基础返回类</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> XiongNeng</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2018/1/7</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseResponse</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 是否成功</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> success;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 说明</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String msg;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 返回数据</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> T data;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BaseResponse</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BaseResponse</span><span class="params">(<span class="keyword">boolean</span> success, String msg, T data)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.success = success;</span><br><span class="line">        <span class="keyword">this</span>.msg = msg;</span><br><span class="line">        <span class="keyword">this</span>.data = data;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>通过SpringMVC实现RESTful接口，这里我只写一个示例方法：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 机具管理API接口类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(value = <span class="string">"/api/v1"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PublicController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger _logger = LoggerFactory.getLogger(PublicController<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 入网绑定查询接口</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 是否入网</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping</span>(value = <span class="string">"/join"</span>, method = RequestMethod.GET)</span><br><span class="line">    <span class="meta">@RequiresAuthentication</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> BaseResponse <span class="title">join</span><span class="params">(@RequestParam(<span class="string">"imei"</span>)</span> String imei) </span>&#123;</span><br><span class="line">        _logger.info(<span class="string">"入网查询接口 start... imei="</span> + imei);</span><br><span class="line">        BaseResponse result = <span class="keyword">new</span> BaseResponse();</span><br><span class="line">        result.setSuccess(<span class="keyword">true</span>);</span><br><span class="line">        result.setMsg(<span class="string">"已入网并绑定了网点"</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="自定义异常"><a href="#自定义异常" class="headerlink" title="自定义异常"></a>自定义异常</h3><p>为了实现我自己能够手动抛出异常，我自己写了一个<code>UnauthorizedException.java</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UnauthorizedException</span> <span class="keyword">extends</span> <span class="title">RuntimeException</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">UnauthorizedException</span><span class="params">(String msg)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(msg);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">UnauthorizedException</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="处理框架异常"><a href="#处理框架异常" class="headerlink" title="处理框架异常"></a>处理框架异常</h3><p>之前说过restful要统一返回的格式，所以我们也要全局处理Spring Boot的抛出异常。利用@RestControllerAdvice能很好的实现。 注意这个统一异常处理器只对认证过的用户调用接口中的异常有作用，对AuthenticationException没有用</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExceptionController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 捕捉shiro的异常</span></span><br><span class="line">    <span class="meta">@ResponseStatus</span>(HttpStatus.UNAUTHORIZED)</span><br><span class="line">    <span class="meta">@ExceptionHandler</span>(ShiroException<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">BaseResponse</span> <span class="title">handle401</span>(<span class="title">ShiroException</span> <span class="title">e</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> BaseResponse(<span class="keyword">false</span>, <span class="string">"shiro的异常"</span>, <span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 捕捉UnauthorizedException</span></span><br><span class="line">    <span class="meta">@ResponseStatus</span>(HttpStatus.UNAUTHORIZED)</span><br><span class="line">    <span class="meta">@ExceptionHandler</span>(UnauthorizedException<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">BaseResponse</span> <span class="title">handle401</span>() </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> BaseResponse(<span class="keyword">false</span>, <span class="string">"UnauthorizedException"</span>, <span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 捕捉其他所有异常</span></span><br><span class="line">    <span class="meta">@ExceptionHandler</span>(Exception<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">    @<span class="title">ResponseStatus</span>(<span class="title">HttpStatus</span>.<span class="title">BAD_REQUEST</span>)</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">BaseResponse</span> <span class="title">globalException</span>(<span class="title">HttpServletRequest</span> <span class="title">request</span>, <span class="title">Throwable</span> <span class="title">ex</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> BaseResponse(<span class="keyword">false</span>, <span class="string">"其他异常"</span>, <span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> HttpStatus <span class="title">getStatus</span><span class="params">(HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">        Integer statusCode = (Integer) request.getAttribute(<span class="string">"javax.servlet.error.status_code"</span>);</span><br><span class="line">        <span class="keyword">if</span> (statusCode == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> HttpStatus.INTERNAL_SERVER_ERROR;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> HttpStatus.valueOf(statusCode);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="配置Shiro"><a href="#配置Shiro" class="headerlink" title="配置Shiro"></a>配置Shiro</h3><p>大家可以先看下官方的 <a href="http://shiro.apache.org/spring.html" target="_blank" rel="noopener">Spring-Shiro</a> 整合教程，有个初步的了解。 不过既然我们用了SpringBoot，那我们肯定要争取零配置文件。</p>
<p><em>实现JWTToken</em></p>
<p>JWTToken差不多就是Shiro用户名密码的载体。因为我们是前后端分离，服务器无需保存用户状态，所以不需要RememberMe这类功能， 我们简单的实现下AuthenticationToken接口即可。因为token自己已经包含了用户名等信息，所以这里我就弄了一个字段。 如果你喜欢钻研，可以看看官方的UsernamePasswordToken是如何实现的。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JWTToken</span> <span class="keyword">implements</span> <span class="title">AuthenticationToken</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 密钥</span></span><br><span class="line">    <span class="keyword">private</span> String token;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">JWTToken</span><span class="params">(String token)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.token = token;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">getPrincipal</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> token;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">getCredentials</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> token;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><em>实现Realm</em></p>
<p>realm的用于处理用户是否合法的这一块，需要我们自己实现。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Description  : 身份校验核心类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyShiroRealm</span> <span class="keyword">extends</span> <span class="title">AuthorizingRealm</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger _logger = LoggerFactory.getLogger(MyShiroRealm<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    ManagerInfoService managerInfoService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * JWT签名密钥，这里没用。我使用的是用户的MD5密码作为签名密钥</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String SECRET = <span class="string">"9281e268b77b7c439a20b46fd1483b9a"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 必须重写此方法，不然Shiro会报错</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">supports</span><span class="params">(AuthenticationToken token)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> token <span class="keyword">instanceof</span> JWTToken;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 认证信息(身份验证)</span></span><br><span class="line"><span class="comment">     * Authentication 是用来验证用户身份</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> auth</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> AuthenticationException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> AuthenticationInfo <span class="title">doGetAuthenticationInfo</span><span class="params">(AuthenticationToken auth)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> AuthenticationException </span>&#123;</span><br><span class="line">        _logger.info(<span class="string">"MyShiroRealm.doGetAuthenticationInfo()"</span>);</span><br><span class="line"></span><br><span class="line">        String token = (String) auth.getCredentials();</span><br><span class="line">        <span class="comment">// 解密获得username，用于和数据库进行对比</span></span><br><span class="line">        String username = JWTUtil.getUsername(token);</span><br><span class="line">        <span class="keyword">if</span> (username == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> AuthenticationException(<span class="string">"token invalid"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//通过username从数据库中查找 ManagerInfo对象</span></span><br><span class="line">        <span class="comment">//实际项目中，这里可以根据实际情况做缓存，如果不做，Shiro自己也是有时间间隔机制，2分钟内不会重复执行该方法</span></span><br><span class="line">        ManagerInfo managerInfo = managerInfoService.findByUsername(username);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (managerInfo == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> AuthenticationException(<span class="string">"User didn't existed!"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!JWTUtil.verify(token, username, managerInfo.getPassword())) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> AuthenticationException(<span class="string">"Username or password error"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> SimpleAuthenticationInfo(token, token, <span class="string">"my_realm"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 此方法调用hasRole,hasPermission的时候才会进行回调.</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * 权限信息.(授权):</span></span><br><span class="line"><span class="comment">     * 1、如果用户正常退出，缓存自动清空；</span></span><br><span class="line"><span class="comment">     * 2、如果用户非正常退出，缓存自动清空；</span></span><br><span class="line"><span class="comment">     * 3、如果我们修改了用户的权限，而用户不退出系统，修改的权限无法立即生效。</span></span><br><span class="line"><span class="comment">     * （需要手动编程进行实现；放在service进行调用）</span></span><br><span class="line"><span class="comment">     * 在权限修改后调用realm中的方法，realm已经由spring管理，所以从spring中获取realm实例，调用clearCached方法；</span></span><br><span class="line"><span class="comment">     * :Authorization 是授权访问控制，用于对用户进行的操作授权，证明该用户是否允许进行当前操作，如访问某个链接，某个资源文件等。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> principals</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> AuthorizationInfo <span class="title">doGetAuthorizationInfo</span><span class="params">(PrincipalCollection principals)</span> </span>&#123;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * 当没有使用缓存的时候，不断刷新页面的话，这个代码会不断执行，</span></span><br><span class="line"><span class="comment">         * 当其实没有必要每次都重新设置权限信息，所以我们需要放到缓存中进行管理；</span></span><br><span class="line"><span class="comment">         * 当放到缓存中时，这样的话，doGetAuthorizationInfo就只会执行一次了，</span></span><br><span class="line"><span class="comment">         * 缓存过期之后会再次执行。</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        _logger.info(<span class="string">"权限配置--&gt;MyShiroRealm.doGetAuthorizationInfo()"</span>);</span><br><span class="line">        String username = JWTUtil.getUsername(principals.toString());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 下面的可以使用缓存提升速度</span></span><br><span class="line">        ManagerInfo managerInfo = managerInfoService.findByUsername(username);</span><br><span class="line"></span><br><span class="line">        SimpleAuthorizationInfo authorizationInfo = <span class="keyword">new</span> SimpleAuthorizationInfo();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//设置相应角色的权限信息</span></span><br><span class="line">        <span class="keyword">for</span> (SysRole role : managerInfo.getRoles()) &#123;</span><br><span class="line">            <span class="comment">//设置角色</span></span><br><span class="line">            authorizationInfo.addRole(role.getRole());</span><br><span class="line">            <span class="keyword">for</span> (Permission p : role.getPermissions()) &#123;</span><br><span class="line">                <span class="comment">//设置权限</span></span><br><span class="line">                authorizationInfo.addStringPermission(p.getPermission());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> authorizationInfo;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在<code>doGetAuthenticationInfo</code>中用户可以自定义抛出很多异常，详情见文档。</p>
<p><em>重写Filter</em></p>
<p>所有的请求都会先经过Filter，所以我们继承官方的<code>BasicHttpAuthenticationFilter</code>，并且重写鉴权的方法， 另外通过重写preHandle，实现跨越访问。</p>
<p>代码的执行流程<code>preHandle-&gt;isAccessAllowed-&gt;isLoginAttempt-&gt;executeLogin</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JWTFilter</span> <span class="keyword">extends</span> <span class="title">BasicHttpAuthenticationFilter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Logger LOGGER = LoggerFactory.getLogger(<span class="keyword">this</span>.getClass());</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 判断用户是否想要登入。</span></span><br><span class="line"><span class="comment">     * 检测header里面是否包含Authorization字段即可</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">isLoginAttempt</span><span class="params">(ServletRequest request, ServletResponse response)</span> </span>&#123;</span><br><span class="line">        HttpServletRequest req = (HttpServletRequest) request;</span><br><span class="line">        String authorization = req.getHeader(<span class="string">"Authorization"</span>);</span><br><span class="line">        <span class="keyword">return</span> authorization != <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">executeLogin</span><span class="params">(ServletRequest request, ServletResponse response)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        HttpServletRequest httpServletRequest = (HttpServletRequest) request;</span><br><span class="line">        String authorization = httpServletRequest.getHeader(<span class="string">"Authorization"</span>);</span><br><span class="line">        JWTToken token = <span class="keyword">new</span> JWTToken(authorization);</span><br><span class="line">        <span class="comment">// 提交给realm进行登入，如果错误他会抛出异常并被捕获</span></span><br><span class="line">        getSubject(request, response).login(token);</span><br><span class="line">        <span class="comment">// 如果没有抛出异常则代表登入成功，返回true</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 这里我们详细说明下为什么最终返回的都是true，即允许访问</span></span><br><span class="line"><span class="comment">     * 例如我们提供一个地址 GET /article</span></span><br><span class="line"><span class="comment">     * 登入用户和游客看到的内容是不同的</span></span><br><span class="line"><span class="comment">     * 如果在这里返回了false，请求会被直接拦截，用户看不到任何东西</span></span><br><span class="line"><span class="comment">     * 所以我们在这里返回true，Controller中可以通过 subject.isAuthenticated() 来判断用户是否登入</span></span><br><span class="line"><span class="comment">     * 如果有些资源只有登入用户才能访问，我们只需要在方法上面加上 <span class="doctag">@RequiresAuthentication</span> 注解即可</span></span><br><span class="line"><span class="comment">     * 但是这样做有一个缺点，就是不能够对GET,POST等请求进行分别过滤鉴权(因为我们重写了官方的方法)，但实际上对应用影响不大</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">isAccessAllowed</span><span class="params">(ServletRequest request, ServletResponse response, Object mappedValue)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (isLoginAttempt(request, response)) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                executeLogin(request, response);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                response401(request, response);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 对跨域提供支持</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(ServletRequest request, ServletResponse response)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        HttpServletRequest httpServletRequest = (HttpServletRequest) request;</span><br><span class="line">        HttpServletResponse httpServletResponse = (HttpServletResponse) response;</span><br><span class="line">        httpServletResponse.setHeader(<span class="string">"Access-control-Allow-Origin"</span>, httpServletRequest.getHeader(<span class="string">"Origin"</span>));</span><br><span class="line">        httpServletResponse.setHeader(<span class="string">"Access-Control-Allow-Methods"</span>, <span class="string">"GET,POST,OPTIONS,PUT,DELETE"</span>);</span><br><span class="line">        httpServletResponse.setHeader(<span class="string">"Access-Control-Allow-Headers"</span>, httpServletRequest.getHeader(<span class="string">"Access-Control-Request-Headers"</span>));</span><br><span class="line">        <span class="comment">// 跨域时会首先发送一个option请求，这里我们给option请求直接返回正常状态</span></span><br><span class="line">        <span class="keyword">if</span> (httpServletRequest.getMethod().equals(RequestMethod.OPTIONS.name())) &#123;</span><br><span class="line">            httpServletResponse.setStatus(HttpStatus.OK.value());</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.preHandle(request, response);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将非法请求跳转到 /401</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">response401</span><span class="params">(ServletRequest req, ServletResponse resp)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            HttpServletResponse httpServletResponse = (HttpServletResponse) resp;</span><br><span class="line">            httpServletResponse.sendRedirect(<span class="string">"/401"</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            LOGGER.error(e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><em>编写ShiroConfig配置类</em></p>
<p>这里我还增加了EhCache缓存管理支持，不需要每次都调用数据库做授权。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@Order</span>(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShiroConfig</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ShiroFilterFactoryBean 处理拦截资源文件问题。</span></span><br><span class="line"><span class="comment">     * 注意：单独一个ShiroFilterFactoryBean配置是或报错的，以为在</span></span><br><span class="line"><span class="comment">     * 初始化ShiroFilterFactoryBean的时候需要注入：SecurityManager Filter Chain定义说明</span></span><br><span class="line"><span class="comment">     * 1、一个URL可以配置多个Filter，使用逗号分隔</span></span><br><span class="line"><span class="comment">     * 2、当设置多个过滤器时，全部验证通过，才视为通过</span></span><br><span class="line"><span class="comment">     * 3、部分过滤器可指定参数，如perms，roles</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ShiroFilterFactoryBean <span class="title">shirFilter</span><span class="params">(SecurityManager securityManager)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        ShiroFilterFactoryBean shiroFilterFactoryBean = <span class="keyword">new</span> ShiroFilterFactoryBean();</span><br><span class="line">        <span class="comment">// 必须设置 SecurityManager</span></span><br><span class="line">        shiroFilterFactoryBean.setSecurityManager(securityManager);</span><br><span class="line">        <span class="comment">//验证码过滤器</span></span><br><span class="line">        Map&lt;String, Filter&gt; filtersMap = shiroFilterFactoryBean.getFilters();</span><br><span class="line">        filtersMap.put(<span class="string">"jwt"</span>, <span class="keyword">new</span> JWTFilter());</span><br><span class="line">        shiroFilterFactoryBean.setFilters(filtersMap);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 拦截器</span></span><br><span class="line">        Map&lt;String, String&gt; filterChainDefinitionMap = <span class="keyword">new</span> LinkedHashMap&lt;String, String&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 其他的</span></span><br><span class="line">        filterChainDefinitionMap.put(<span class="string">"/**"</span>, <span class="string">"jwt"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 访问401和404页面不通过我们的Filter</span></span><br><span class="line">        filterChainDefinitionMap.put(<span class="string">"/401"</span>, <span class="string">"anon"</span>);</span><br><span class="line">        filterChainDefinitionMap.put(<span class="string">"/404"</span>, <span class="string">"anon"</span>);</span><br><span class="line"></span><br><span class="line">        shiroFilterFactoryBean.setFilterChainDefinitionMap(filterChainDefinitionMap);</span><br><span class="line">        <span class="keyword">return</span> shiroFilterFactoryBean;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> SecurityManager <span class="title">securityManager</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        DefaultWebSecurityManager securityManager = <span class="keyword">new</span> DefaultWebSecurityManager();</span><br><span class="line">        <span class="comment">// 设置realm.</span></span><br><span class="line">        securityManager.setRealm(myShiroRealm());</span><br><span class="line">        <span class="comment">//注入缓存管理器</span></span><br><span class="line">        securityManager.setCacheManager(ehCacheManager());</span><br><span class="line">        <span class="comment">// 关闭shiro自带的session</span></span><br><span class="line">        DefaultSubjectDAO subjectDAO = <span class="keyword">new</span> DefaultSubjectDAO();</span><br><span class="line">        DefaultSessionStorageEvaluator defaultSessionStorageEvaluator = <span class="keyword">new</span> DefaultSessionStorageEvaluator();</span><br><span class="line">        defaultSessionStorageEvaluator.setSessionStorageEnabled(<span class="keyword">false</span>);</span><br><span class="line">        subjectDAO.setSessionStorageEvaluator(defaultSessionStorageEvaluator);</span><br><span class="line">        securityManager.setSubjectDAO(subjectDAO);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> securityManager;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 身份认证realm; (这个需要自己写，账号密码校验；权限等)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> MyShiroRealm <span class="title">myShiroRealm</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        MyShiroRealm myShiroRealm = <span class="keyword">new</span> MyShiroRealm();</span><br><span class="line">        <span class="keyword">return</span> myShiroRealm;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 开启shiro aop注解支持. 使用代理方式; 所以需要开启代码支持;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> securityManager 安全管理器</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 授权Advisor</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> AuthorizationAttributeSourceAdvisor <span class="title">authorizationAttributeSourceAdvisor</span><span class="params">(SecurityManager securityManager)</span> </span>&#123;</span><br><span class="line">        AuthorizationAttributeSourceAdvisor authorizationAttributeSourceAdvisor = <span class="keyword">new</span> AuthorizationAttributeSourceAdvisor();</span><br><span class="line">        authorizationAttributeSourceAdvisor.setSecurityManager(securityManager);</span><br><span class="line">        <span class="keyword">return</span> authorizationAttributeSourceAdvisor;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * shiro缓存管理器;</span></span><br><span class="line"><span class="comment">     * 需要注入对应的其它的实体类中：</span></span><br><span class="line"><span class="comment">     * 1、安全管理器：securityManager</span></span><br><span class="line"><span class="comment">     * 可见securityManager是整个shiro的核心；</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> EhCacheManager <span class="title">ehCacheManager</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        EhCacheManager cacheManager = <span class="keyword">new</span> EhCacheManager();</span><br><span class="line">        cacheManager.setCacheManagerConfigFile(<span class="string">"classpath:ehcache.xml"</span>);</span><br><span class="line">        <span class="keyword">return</span> cacheManager;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>里面URL规则自己参考文档 <a href="http://shiro.apache.org/web.html" target="_blank" rel="noopener">http://shiro.apache.org/web.html</a> ，这个在shiro那篇说的很清楚了。</p>
<h2 id="运行验证"><a href="#运行验证" class="headerlink" title="运行验证"></a>运行验证</h2><p>最后是将代码跑起来验证这一切是否正常。</p>
<p>启动SpringBoot后，先通过POST请求登录拿到token</p>
<p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591542467-9b00d88be51aa31ba69f11f360ef7d00.png" alt=""></p>
<p>然后在调用入网接口的时候在header中带上这个token认证：</p>
<p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591542467-d594da55382048c1e13d4a8a4aa252d3.png" alt=""></p>
<p>如果token认证不正确会报异常：</p>
<p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591542467-84999364ce6e55b32523c292879f6792.png" alt=""></p>
<p>如果使用普通用户登录，认证正确但是授权访问接口失败，会返回如下的未授权结果：</p>
<p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="assets/1591542467-8332d765b7055a9b7fc75e1b6127d18c.png" alt=""></p>
<h2 id="GitHub源码"><a href="#GitHub源码" class="headerlink" title="GitHub源码"></a>GitHub源码</h2><p><a href="https://github.com/yidao620c/SpringBootBucket/tree/master/springboot-jwt" target="_blank" rel="noopener">springboot-jwt</a>   —已测试</p>
<h2 id="来源"><a href="#来源" class="headerlink" title="来源"></a>来源</h2><p><a href="https://www.xncoding.com/" target="_blank" rel="noopener">https://www.xncoding.com/</a></p>
]]></content>
      <categories>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>springboot</tag>
        <tag>jwt</tag>
      </tags>
  </entry>
  <entry>
    <title>Zookeeper</title>
    <url>/2020/03/27/Zookeeper/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="Zookeeper-安装"><a href="#Zookeeper-安装" class="headerlink" title="Zookeeper 安装"></a>Zookeeper 安装</h1><h2 id="1-1Zookeeper"><a href="#1-1Zookeeper" class="headerlink" title="1.1Zookeeper"></a>1.1Zookeeper</h2><h3 id="1-1-1Zookeeper介绍"><a href="#1-1-1Zookeeper介绍" class="headerlink" title="1.1.1Zookeeper介绍"></a>1.1.1Zookeeper介绍</h3><p>ZooKeeper是一个分布式的，开放源码的分布式应用程序协调服务，是Google的Chubby一个开源的实现，是Hadoop和Hbase的重要组件。它是一个为分布式应用提供一致性服务的软件，提供的功能包括：配置维护、域名服务、分布式同步、组服务等。<br>ZooKeeper的目标就是封装好复杂易出错的关键服务，将简单易用的接口和性能高效、功能稳定的系统提供给用户。<br>ZooKeeper包含一个简单的原语集,提供Java和C的接口。<br>ZooKeeper代码版本中，提供了分布式独享锁、选举、队列的接口，代码在zookeeper-3.4.3\src\recipes。其中分布锁和队列有Java和C两个版本，选举只有Java版本。<br>总结:Zookeeper负责服务的协调调度.当客户端发起请求时,返回正确的服务器地址.</p>
<h3 id="1-1-2Zookeeper下载"><a href="#1-1-2Zookeeper下载" class="headerlink" title="1.1.2Zookeeper下载"></a>1.1.2Zookeeper下载</h3><p>网址: <a href="http://zookeeper.apache.org/releases.html" target="_blank" rel="noopener">http://zookeeper.apache.org/releases.html</a>.<br>如图-2所示</p>
<hr>
<h2 id=""><a href="#" class="headerlink" title=""></a><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://www.zhangpeng.fun/upload/2019/12/image-8216270faedd430d85ed24fe29898f31.png" alt="image.png"></h2><p>图-2<br>下载路径,点击download.<br>如图-3所示</p>
<hr>
<h2 id="-1"><a href="#-1" class="headerlink" title=""></a><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://www.zhangpeng.fun/upload/2019/12/image-eedd0e510d7943ee829628375061624f.png" alt="image.png"></h2><p>图-3<br>下载Zookeeper地址.<br><a href="http://mirrors.hust.edu.cn/apache/zookeeper/" target="_blank" rel="noopener">http://mirrors.hust.edu.cn/apache/zookeeper/</a><br>如图-4所示</p>
<hr>
<h2 id="-2"><a href="#-2" class="headerlink" title=""></a><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://www.zhangpeng.fun/upload/2019/12/image-41f07c949eaf4d71b10d3d1df73fa693.png" alt="image.png"></h2><p>图-4</p>
<h2 id="1-2Zookeeper安装"><a href="#1-2Zookeeper安装" class="headerlink" title="1.2Zookeeper安装"></a>1.2Zookeeper安装</h2><h3 id="1-2-1安装JDK"><a href="#1-2-1安装JDK" class="headerlink" title="1.2.1安装JDK"></a>1.2.1安装JDK</h3><p>将JDK1.8文件上传到Linux操作系统中/src/usr/local/java/文件下.<br>如图-5所示</p>
<hr>
<h2 id="-3"><a href="#-3" class="headerlink" title=""></a><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://www.zhangpeng.fun/upload/2019/12/image-7074267a86504a7bb7d608e53530c7b6.png" alt="image.png"></h2><p>图-5<br>1.解压文件<br>tar -xvf jdk-8u51-linux-x64.tar.gz<br>2.配置环境变量<br>编辑环境变量配置文件<br>vim /etc/profile<br>如图-6所示</p>
<hr>
<h2 id="-4"><a href="#-4" class="headerlink" title=""></a><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://www.zhangpeng.fun/upload/2019/12/image-860af512cce74a00983685715f187959.png" alt="image.png"></h2><p>图-6<br>使JDK生效,之后检查jdk安装是否成功<br>source /etc/profile<br>如图 -7所示</p>
<hr>
<h2 id="-5"><a href="#-5" class="headerlink" title=""></a><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://www.zhangpeng.fun/upload/2019/12/image-781c797140fe4380881e91619d8fcf5c.png" alt="image.png"></h2><p>图-7</p>
<h3 id="1-2-2上传安装文件"><a href="#1-2-2上传安装文件" class="headerlink" title="1.2.2上传安装文件"></a>1.2.2上传安装文件</h3><p>说明:上传zookeeper安装文件.之后解压.<br>如图-8所示</p>
<hr>
<h2 id="-6"><a href="#-6" class="headerlink" title=""></a><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://www.zhangpeng.fun/upload/2019/12/image-971e330e1d7341ea872052081c42fc9b.png" alt="image.png"></h2><p>图-8<br>解压目录:<br>tar -xvf zookeeper-3.4.8.tar.gz</p>
<h3 id="1-2-3修改配置文件"><a href="#1-2-3修改配置文件" class="headerlink" title="1.2.3修改配置文件"></a>1.2.3修改配置文件</h3><p>在zk根目录下创建文件夹data/log<br>mkdir data log<br>如图-9所示</p>
<hr>
<h2 id="-7"><a href="#-7" class="headerlink" title=""></a><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://www.zhangpeng.fun/upload/2019/12/image-a57e315772904f6fa0e053f88211be4f.png" alt="image.png"></h2><p>图-9<br>复制配置文件并且修改名称<br>cp zoo_sample.cfg zoo.cfg<br>如图-10所示</p>
<hr>
<h2 id="-8"><a href="#-8" class="headerlink" title=""></a><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://www.zhangpeng.fun/upload/2019/12/image-9185194983bf4296b3331ee19c6b55a2.png" alt="image.png"></h2><p>图-10</p>
<h3 id="1-2-4启动zk"><a href="#1-2-4启动zk" class="headerlink" title="1.2.4启动zk"></a>1.2.4启动zk</h3><p>zk启动关闭命令如下.<br>sh zkServer.sh start     或者  ./zkServer.sh start<br>sh zkServer.sh stop<br>sh zkServer.sh status<br>如图-11所示</p>
<hr>
<h2 id="-9"><a href="#-9" class="headerlink" title=""></a><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://www.zhangpeng.fun/upload/2019/12/image-47e0942ad88443fab74a7328a65bdbb0.png" alt="image.png"></h2><p>图-11</p>
<h2 id="1-3Zookeeper集群安装"><a href="#1-3Zookeeper集群安装" class="headerlink" title="1.3Zookeeper集群安装"></a>1.3Zookeeper集群安装</h2><h3 id="1-3-1准备文件夹"><a href="#1-3-1准备文件夹" class="headerlink" title="1.3.1准备文件夹"></a>1.3.1准备文件夹</h3><p>在zookeeper根目录中创建新的文件夹zkCluster.<br>如图-12所示</p>
<hr>
<h2 id="-10"><a href="#-10" class="headerlink" title=""></a><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://www.zhangpeng.fun/upload/2019/12/image-6f229215118a4742b272dcd82284412a.png" alt="image.png"></h2><p>图-12<br>如图-13所示</p>
<h2 id="创建zk1-zk2-zk3文件夹"><a href="#创建zk1-zk2-zk3文件夹" class="headerlink" title="创建zk1/zk2/zk3文件夹."></a>创建zk1/zk2/zk3文件夹.</h2><h2 id="-11"><a href="#-11" class="headerlink" title=""></a><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://www.zhangpeng.fun/upload/2019/12/image-a231d6cf8f624ea6afe754f027cc4026.png" alt="image.png"></h2><p>图-13<br>在每个文件夹里创建data/log文件夹.<br>mkdir {zk1,zk2,zk3}/{data,log}<br>如图-14所示</p>
<hr>
<h2 id="-12"><a href="#-12" class="headerlink" title=""></a><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://www.zhangpeng.fun/upload/2019/12/image-22fca11a61de4db5944f17c7ceca09f7.png" alt="image.png"></h2><p>图-14</p>
<h3 id="1-3-2添加myid文件"><a href="#1-3-2添加myid文件" class="headerlink" title="1.3.2添加myid文件"></a>1.3.2添加myid文件</h3><p>分别在zk1/zk2/zk3中的data文件夹中创建新的文件myid.其中的内容依次为1/2/3,与zk节点号对应.<br>如图-15所示</p>
<hr>
<h2 id="-13"><a href="#-13" class="headerlink" title=""></a><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://www.zhangpeng.fun/upload/2019/12/image-6efe08a4dac84be38670a491f08851a1.png" alt="image.png"></h2><p>图-15<br>编辑myid文件,定义编号.<br>图-16所示</p>
<hr>
<h2 id="-14"><a href="#-14" class="headerlink" title=""></a><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://www.zhangpeng.fun/upload/2019/12/image-cba24531f3b04988ba41302de0e8e8da.png" alt="image.png"></h2><p>图-16</p>
<h3 id="1-3-3编辑配置文件"><a href="#1-3-3编辑配置文件" class="headerlink" title="1.3.3编辑配置文件"></a>1.3.3编辑配置文件</h3><p>将zoo_sample.cfg 复制为zoo1.cfg之后修改配置文件.<br>如图-17所示</p>
<hr>
<h2 id="-15"><a href="#-15" class="headerlink" title=""></a><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://www.zhangpeng.fun/upload/2019/12/image-f060179ff53d4e2a8c73a3304f50aa42.png" alt="image.png"></h2><p>图-17</p>
<h3 id="1-3-4修改zoo1-cfg"><a href="#1-3-4修改zoo1-cfg" class="headerlink" title="1.3.4修改zoo1.cfg"></a>1.3.4修改zoo1.cfg</h3><p>如图-18所示</p>
<hr>
<h2 id="-16"><a href="#-16" class="headerlink" title=""></a><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://www.zhangpeng.fun/upload/2019/12/image-7ec28ae2215a4f45a49c784263cb5023.png" alt="image.png"></h2><p>图-18<br>配置完成后将zoo1.cfg复制2份.之后需要修改对应的文件夹目录.和不同的端口即可.</p>
<h3 id="1-3-5ZK集群测试"><a href="#1-3-5ZK集群测试" class="headerlink" title="1.3.5ZK集群测试"></a>1.3.5ZK集群测试</h3><p>通过下面的命令启动zk集群.<br>sh zkServer.sh start   zoo1.cfg<br>sh zkServer.sh stop    zoo1.cfg<br>sh zkServer.sh status  zoo1.cfg<br>检查主从关系,从机情况说明.<br>如图-19所示</p>
<hr>
<h2 id="-17"><a href="#-17" class="headerlink" title=""></a><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://www.zhangpeng.fun/upload/2019/12/image-de4854b240504612b6dce11f46ed2645.png" alt="image.png"></h2><p>图-19<br>检查主从关系,主机情况说明.<br>如图-20所示</p>
<hr>
<h2 id="-18"><a href="#-18" class="headerlink" title=""></a><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://www.zhangpeng.fun/upload/2019/12/image-748f94c832c343c08ac3cdeff31ea15f.png" alt="image.png"></h2><p>图-20</p>
<h3 id="1-3-6关于zookeeper集群说明"><a href="#1-3-6关于zookeeper集群说明" class="headerlink" title="1.3.6关于zookeeper集群说明"></a>1.3.6关于zookeeper集群说明</h3><p>Zookeeper集群中leader负责监控集群状态,follower主要负责客户端链接获取服务列表信息.同时参与投票.</p>
]]></content>
      <categories>
        <category>后端</category>
      </categories>
      <tags>
        <tag>java</tag>
        <tag>zookeeper</tag>
      </tags>
  </entry>
  <entry>
    <title>SpringCloud、RabbitMQ、Solr、Docker、Kubernetes</title>
    <url>/2020/03/29/SpringCloud%E3%80%81RabbitMQ%E3%80%81Solr%E3%80%81Docker%E3%80%81Kubernetes/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="SpringCloud、RabbitMQ、Solr、Docker、Kubernetes"><a href="#SpringCloud、RabbitMQ、Solr、Docker、Kubernetes" class="headerlink" title="SpringCloud、RabbitMQ、Solr、Docker、Kubernetes"></a>SpringCloud、RabbitMQ、Solr、Docker、Kubernetes</h1><p><a href="https://blog.csdn.net/weixin_38305440/article/details/102775484" target="_blank" rel="noopener" title="Spring Cloud入门操作手册(Greenwich)">Spring Cloud入门操作手册(Greenwich)</a></p>
<p><a href="https://blog.csdn.net/weixin_38305440/article/details/102810522" target="_blank" rel="noopener" title="RabbitMQ">RabbitMQ</a></p>
<p><a href="https://blog.csdn.net/weixin_38305440/article/details/102810509" target="_blank" rel="noopener" title="Lucene Solr 811">Lucene Solr 811</a></p>
<p><a href="https://blog.csdn.net/weixin_38305440/article/details/102810532" target="_blank" rel="noopener" title="Docker">Docker</a></p>
<p><a href="https://blog.csdn.net/weixin_38305440/article/details/102810541" target="_blank" rel="noopener" title="Docker案例">Docker案例</a></p>
<p><a href="https://blog.csdn.net/weixin_38305440/article/details/102810548" target="_blank" rel="noopener" title="Kubernetes">Kubernetes</a></p>
<p>老师的笔记，收藏备用。2019-12-05 10:20:47 星期四 &euro;</p>
]]></content>
      <categories>
        <category>后端</category>
      </categories>
      <tags>
        <tag>springCloud</tag>
        <tag>rabbitMQ</tag>
        <tag>solr</tag>
        <tag>docker</tag>
        <tag>kubernetes</tag>
      </tags>
  </entry>
  <entry>
    <title>github仓库-CS-Notes</title>
    <url>/2020/04/11/github%E4%BB%93%E5%BA%93-CS-Notes/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><table>
<thead>
<tr>
<th align="center">&nbsp;算法&nbsp;</th>
<th align="center">操作系统</th>
<th align="center">&nbsp;网络&nbsp;</th>
<th align="center">面向对象</th>
<th align="center">&nbsp;&nbsp;数据库&nbsp;&nbsp;</th>
<th align="center">&nbsp;&nbsp;&nbsp;Java&nbsp;&nbsp;&nbsp;</th>
<th align="center">系统设计</th>
<th align="center">&nbsp;&nbsp;&nbsp;工具&nbsp;&nbsp;&nbsp;</th>
<th align="center">编码实践</th>
<th align="center">&nbsp;&nbsp;&nbsp;后记&nbsp;&nbsp;&nbsp;</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><a href="#pencil2-算法">:pencil2:</a></td>
<td align="center"><a href="#computer-操作系统">:computer:</a></td>
<td align="center"><a href="#cloud-网络">:cloud:</a></td>
<td align="center"><a href="#art-面向对象">:art:</a></td>
<td align="center"><a href="#floppy_disk-数据库">:floppy_disk:</a></td>
<td align="center"><a href="#coffee-java">:coffee:</a></td>
<td align="center"><a href="#bulb-系统设计">:bulb:</a></td>
<td align="center"><a href="#wrench-工具">:wrench:</a></td>
<td align="center"><a href="#watermelon-编码实践">:watermelon:</a></td>
<td align="center"><a href="#memo-后记">:memo:</a></td>
</tr>
</tbody></table>
<br>

<div align="center">
    <img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/githubio/LogoMakr_0zpEzN.png" width="200px">
</div>



<br>

<h2 id="pencil2-算法"><a href="#pencil2-算法" class="headerlink" title=":pencil2: 算法"></a>:pencil2: 算法</h2><ul>
<li><a href="https://github.com/CyC2018/CS-Notes/blob/master/notes/剑指%20Offer%20题解%20-%20目录.md" target="_blank" rel="noopener">剑指 Offer 题解</a></li>
<li><a href="https://github.com/CyC2018/CS-Notes/blob/master/notes/Leetcode%20题解%20-%20目录.md" target="_blank" rel="noopener">Leetcode 题解</a></li>
<li><a href="https://github.com/CyC2018/CS-Notes/blob/master/notes/算法%20-%20目录.md" target="_blank" rel="noopener">算法</a></li>
<li><a href="https://www.nowcoder.com/contestRoom?from=cyc_github" target="_blank" rel="noopener">笔试面试题库</a></li>
</ul>
<h2 id="computer-操作系统"><a href="#computer-操作系统" class="headerlink" title=":computer: 操作系统"></a>:computer: 操作系统</h2><ul>
<li><a href="https://github.com/CyC2018/CS-Notes/blob/master/notes/计算机操作系统%20-%20目录.md" target="_blank" rel="noopener">计算机操作系统</a></li>
<li><a href="https://github.com/CyC2018/CS-Notes/blob/master/notes/Linux.md" target="_blank" rel="noopener">Linux</a></li>
</ul>
<h2 id="cloud-网络"><a href="#cloud-网络" class="headerlink" title=":cloud: 网络"></a>:cloud: 网络</h2><ul>
<li><a href="https://github.com/CyC2018/CS-Notes/blob/master/notes/计算机网络%20-%20目录.md" target="_blank" rel="noopener">计算机网络</a></li>
<li><a href="https://github.com/CyC2018/CS-Notes/blob/master/notes/HTTP.md" target="_blank" rel="noopener">HTTP</a></li>
<li><a href="https://github.com/CyC2018/CS-Notes/blob/master/notes/Socket.md" target="_blank" rel="noopener">Socket</a></li>
</ul>
<h2 id="art-面向对象"><a href="#art-面向对象" class="headerlink" title=":art: 面向对象"></a>:art: 面向对象</h2><ul>
<li><a href="https://github.com/CyC2018/CS-Notes/blob/master/notes/设计模式%20-%20目录.md" target="_blank" rel="noopener">设计模式</a></li>
<li><a href="https://github.com/CyC2018/CS-Notes/blob/master/notes/面向对象思想.md" target="_blank" rel="noopener">面向对象思想</a></li>
</ul>
<h2 id="floppy-disk-数据库"><a href="#floppy-disk-数据库" class="headerlink" title=":floppy_disk: 数据库"></a>:floppy_disk: 数据库</h2><ul>
<li><a href="https://github.com/CyC2018/CS-Notes/blob/master/notes/数据库系统原理.md" target="_blank" rel="noopener">数据库系统原理</a></li>
<li><a href="https://github.com/CyC2018/CS-Notes/blob/master/notes/SQL.md" target="_blank" rel="noopener">SQL</a></li>
<li><a href="https://github.com/CyC2018/CS-Notes/blob/master/notes/Leetcode-Database%20题解.md" target="_blank" rel="noopener">Leetcode-Database 题解</a></li>
<li><a href="https://github.com/CyC2018/CS-Notes/blob/master/notes/MySQL.md" target="_blank" rel="noopener">MySQL</a></li>
<li><a href="https://github.com/CyC2018/CS-Notes/blob/master/notes/Redis.md" target="_blank" rel="noopener">Redis</a></li>
</ul>
<h2 id="coffee-Java"><a href="#coffee-Java" class="headerlink" title=":coffee: Java"></a>:coffee: Java</h2><ul>
<li><a href="https://github.com/CyC2018/CS-Notes/blob/master/notes/Java%20基础.md" target="_blank" rel="noopener">Java 基础</a></li>
<li><a href="https://github.com/CyC2018/CS-Notes/blob/master/notes/Java%20容器.md" target="_blank" rel="noopener">Java 容器</a></li>
<li><a href="https://github.com/CyC2018/CS-Notes/blob/master/notes/Java%20并发.md" target="_blank" rel="noopener">Java 并发</a></li>
<li><a href="https://github.com/CyC2018/CS-Notes/blob/master/notes/Java%20虚拟机.md" target="_blank" rel="noopener">Java 虚拟机</a></li>
<li><a href="https://github.com/CyC2018/CS-Notes/blob/master/notes/Java%20IO.md" target="_blank" rel="noopener">Java I/O</a></li>
</ul>
<h2 id="bulb-系统设计"><a href="#bulb-系统设计" class="headerlink" title=":bulb: 系统设计"></a>:bulb: 系统设计</h2><ul>
<li><a href="https://github.com/CyC2018/CS-Notes/blob/master/notes/系统设计基础.md" target="_blank" rel="noopener">系统设计基础</a></li>
<li><a href="https://github.com/CyC2018/CS-Notes/blob/master/notes/分布式.md" target="_blank" rel="noopener">分布式</a></li>
<li><a href="https://github.com/CyC2018/CS-Notes/blob/master/notes/集群.md" target="_blank" rel="noopener">集群</a></li>
<li><a href="https://github.com/CyC2018/CS-Notes/blob/master/notes/攻击技术.md" target="_blank" rel="noopener">攻击技术</a></li>
<li><a href="https://github.com/CyC2018/CS-Notes/blob/master/notes/缓存.md" target="_blank" rel="noopener">缓存</a></li>
<li><a href="https://github.com/CyC2018/CS-Notes/blob/master/notes/消息队列.md" target="_blank" rel="noopener">消息队列</a></li>
</ul>
<h2 id="wrench-工具"><a href="#wrench-工具" class="headerlink" title=":wrench: 工具"></a>:wrench: 工具</h2><ul>
<li><a href="https://github.com/CyC2018/CS-Notes/blob/master/notes/Git.md" target="_blank" rel="noopener">Git</a></li>
<li><a href="https://github.com/CyC2018/CS-Notes/blob/master/notes/Docker.md" target="_blank" rel="noopener">Docker</a></li>
<li><a href="https://github.com/CyC2018/CS-Notes/blob/master/notes/构建工具.md" target="_blank" rel="noopener">构建工具</a></li>
<li><a href="https://github.com/CyC2018/CS-Notes/blob/master/notes/正则表达式.md" target="_blank" rel="noopener">正则表达式</a></li>
</ul>
<h2 id="watermelon-编码实践"><a href="#watermelon-编码实践" class="headerlink" title=":watermelon: 编码实践"></a>:watermelon: 编码实践</h2><ul>
<li><a href="https://github.com/CyC2018/CS-Notes/blob/master/notes/代码可读性.md" target="_blank" rel="noopener">代码可读性</a></li>
<li><a href="https://github.com/CyC2018/CS-Notes/blob/master/notes/代码风格规范.md" target="_blank" rel="noopener">代码风格规范</a></li>
</ul>
]]></content>
      <categories>
        <category>面试题</category>
      </categories>
      <tags>
        <tag>github</tag>
      </tags>
  </entry>
  <entry>
    <title>Sql语句</title>
    <url>/2020/04/05/Sql%E8%AF%AD%E5%8F%A5/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><hr>
<p>一、创建建数据库、创建建数据表、查看数据库、查看数据表</p>
<hr>
<p>– 01.查看mysql服务器中所有数据库</p>
<pre><code>show databases;</code></pre><p>– 02.进入某一数据库（进入数据库后，才能操作库中的表和表记录）</p>
<pre><code>use test;</code></pre><p>– 查看已进入的库</p>
<pre><code>select database();</code></pre><p>– 03.查看当前数据库中的所有表</p>
<pre><code>show tables;</code></pre><p>– 04.删除mydb1库</p>
<pre><code>-- 语法：drop database 库名;
drop database  mydb1;
-- 思考：当删除的表不存在时，如何避免错误产生?
drop database if exists mydb1;</code></pre><p>– 05.重新创建mydb1库，指定编码为utf8</p>
<pre><code>-- 语法：create database 库名 charset 编码;
create database mydb1 charset utf8;

-- 如果不存在则创建mydb1;
create database mydb1 if not exists charset utf8; </code></pre><p>– 06.查看建库时的语句（并验证数据库库使用的编码）</p>
<pre><code>-- 语法：show create database 库名;
show create database mydb1;</code></pre><p>– 07.进入mydb1库，删除stu学生表(如果存在)</p>
<pre><code>-- 语法：drop table 表名;
use mydb1
drop table stu;
drop table if exists stu;</code></pre><p>– 08.创建stu学生表（编号[数值类型]、姓名、性别、出生年月、考试成绩[浮点型]）</p>
<pre><code>/* 建表的语法：
create table 表名(
    列名 数据类型,
    列名 数据类型,
    ...
); */</code></pre><hr>
<pre><code>create table if not exists stu(
    id int primary key auto_increment,
    name varchar(20),
    genger varchar(10),
    birthday date,
    score double
);</code></pre><p>– 09.查看stu学生表结构</p>
<pre><code>show create table stu;
desc stu;</code></pre><hr>
<p>二、新增、修改、删除表记录 <strong><strong>**</strong></strong></p>
<hr>
<p>– 10.往学生表(stu)中插入记录(数据)</p>
<pre><code>-- 插入记录：insert into 表名(列1，列2，列3...) values(值1，值2，值3...);
insert into stu(id,name,genger,birthday,score)     values(null,&apos;赵伟成&apos;,&apos;女&apos;,&apos;2018-3-9&apos;,33);

insert into stu values(null,&apos;赵伟成&apos;,&apos;女&apos;,&apos;2018-3-9&apos;,33);
insert into stu values(null,&apos;张三&apos;,&apos;男&apos;,&apos;2018-3-9&apos;,11);
insert into stu values(null,&apos;卫程&apos;,&apos;女&apos;,&apos;2022-1-11&apos;,55);
/* 提示：
 设置编码：set names gbk;
 查看MySQL数据库使用的编码：show variables like &apos;char%&apos;;
 mysql --default-character-set=gbk -uroot -proot */</code></pre><p>– 11.查询stu表所有学生的信息</p>
<pre><code>select * from stu;
select id,name from stu;</code></pre><p>– 12.修改stu表中所有学生的成绩，加10分特长分</p>
<pre><code>-- 修改语法: update 表名 set 列=值,列=值,列=值...;
update stu set score=score+10;</code></pre><p>– 13.修改stu表中王海涛的成绩，将成绩改为88分。\c取消当前语句的执行</p>
<pre><code>update stu set score=88
where name = &apos;卫程&apos;;

/* 提示：where子句用于对记录进行筛选过滤，
   保留符合条件的记录，将不符合条件的记录剔除。*/</code></pre><p>– 14.删除stu表中所有的记录</p>
<pre><code>-- 删除记录语法: delete from 表名 [where条件] 
delete from stu;

-- 仅删除符合条件的
delete from stu where id= 1;</code></pre><hr>
<p>三、基础查询、where子句查询</p>
<hr>
<p>– 准备数据： 以下练习将使用db10库中的表及表记录，请先进入db10数据库!!!<br>– 准备数据： 以下练习将使用db10库中的表及表记录，请先进入db10数据库!!!</p>
<p>– <strong>****</strong> 基础查询 <strong>****</strong><br>– 15.查询emp表中的所有员工，显示姓名，薪资，奖金</p>
<pre><code>use db10;
select name,sal,bonus  
from emp;</code></pre><p>– 16.查询emp表中的所有员工，显示所有列</p>
<pre><code>select * from emp;
/* 使用 *（星号）的缺点：把不必要的列也查询出来了，而且效率不如直接指定列名 */</code></pre><p>– 17.查询emp表中的所有部门和职位</p>
<pre><code>select dept,job 
from emp;

/* 思考：如果查询的结果中，存在大量重复的记录，如何剔除重复记录，只保留一条？ */

-- distinct 用于剔除重复的记录
select distinct dept,job from emp;</code></pre><p>– <strong>****</strong> WHERE子句查询 <strong>****</strong><br>– 18.查询emp表中薪资大于3000的所有员工，显示员工姓名、薪资</p>
<pre><code>select name,sal from emp
where sal&gt;3000;</code></pre><p>– 19.查询emp表中总薪资(薪资+奖金)大于3500的所有员工，显示员工姓名、总薪资</p>
<pre><code>select name,sal+ifnull(bonus,0) from emp
where sal+ifnull(bonus,0)&gt;3500;
-- ifnull(列, 值)函数: 判断指定的列是否包含null值, 如果有null值, 用第二个值替换null值</code></pre><p>select name,sal+ifnull(bonus,0) from emp</p>
<pre><code>where sal+ifnull(bonus,0)&gt;3500;
-- 注意查看上面查询结果中的表头，如何将表头中的 sal+bonus 修改为 &quot;总薪资&quot;，as可省略</code></pre><p>select name  姓名,sal+ifnull(bonus,0) as 总薪资 from emp</p>
<pre><code>where sal+ifnull(bonus,0)&gt;3500;

-- 试一试：where中能使用定义好的别名吗?
不能</code></pre><p>– 20.查询emp表中薪资在3000和4500之间的员工，显示员工姓名和薪资</p>
<pre><code>select name,sal from emp
where sal&gt;=3000&amp;&amp;sal&lt;=4500;
-- 提示: between...and... 在...之间
select name,sal from emp
where sal between 3200 and 4500;</code></pre><p>– 21.查询emp表中薪资为 1400、1600、1800的员工，显示员工姓名和薪资<br>select name,sal</p>
<pre><code>from emp
where sal=1400 or sal=1600 or sal=1800;
-- 或者
select name,sal
from emp
where sal in(1400,1600,1800);</code></pre><p>– 22.查询薪资不为1400、1600、1800的员工</p>
<pre><code>select name,sal
from emp
where not (sal=1400 or sal=1600 or sal=1800);
-- 或者
select name,sal
from emp
where sal!=1400 and sal!=1600 and sal!=1800;
-- 或者
select name,sal
from emp
where sal not in(1400,1600,1800);</code></pre><p>– 23.查询emp表中薪资大于4000和薪资小于2000的员工，显示员工姓名、薪资。</p>
<pre><code>select name,sal
from emp
where sal&gt;4000 or sal&lt;2000;</code></pre><p>– 24.查询emp表中薪资大于3000并且奖金小于600的员工，显示员工姓名、薪资、奖金。</p>
<pre><code>select name,sal,bonus
from emp
where sal&gt;3000 and bonus&lt;600;
-- 处理null值
select name,sal,bonus
from emp
where sal&gt;3000 and ifnull(bonus,0)&lt;600;
-- 处理null值</code></pre><p>– 25.查询没有部门的员工（即部门列为null值）</p>
<pre><code>select * from emp
where dept is null;
-- 思考：如何查询有部门的员工（即部门列不为null值）
select * from emp
where dept is not null;
-- 思考：如何查询有部门的员工（即部门列不为null值）</code></pre><p>– <strong>****</strong> Like模糊查询 <strong>****</strong><br>– 26.查询emp表中姓名中以”刘”开头的员工，显示员工姓名。</p>
<pre><code>select name from emp
where name like&apos;刘%&apos;;

/* like进行模糊查询，&quot;%&quot; 表示通配，表示0或多个字符。
&quot;_&quot;表示一个任意的字符 */
select name from emp
where name like&apos;刘_&apos;;</code></pre><p>– 27.查询emp表中姓名中包含”涛”员工，显示员工姓名。\</p>
<pre><code>select name from emp
where name like&apos;%涛%&apos;;</code></pre><p>– 28.查询emp表中姓名以”刘”开头并且姓名为2个字的员工，显示员工姓名。</p>
<pre><code>select name from emp
where name like&apos;刘_&apos;;</code></pre><hr>
<p>– 三、分组查询、聚合函数、排序查询</p>
<hr>
<p>– 29.对emp表按照部门对员工进行分组，查看分组后效果</p>
<pre><code>/* 分组的语法: 
select 查询的列 from 表名 group by 列名
根据指定的列进行分组 */
select * from emp 
group by dept;</code></pre><p>– 30.对emp表按照职位进行分组, 并统计每个职位的人数, 显示职位和对应人数</p>
<pre><code>select count(id) 人数,job 职位 
from emp 
group by job;</code></pre><p>– 31.对emp表按照部门进行分组, 求每个部门的最高薪资(不包含奖金)，显示部门名称和最高薪资 max() min(),</p>
<pre><code>select dept 部门,max(sal) 最高薪资
from emp
group by dept;</code></pre><p>– 32.统计emp表中薪资大于3000的员工个数（- count(column)统计某列的行数）</p>
<pre><code>select count(*) from emp
where sal&gt;3000;</code></pre><p>– 33.统计emp表中所有员工的薪资总和(不包含奖金)（- sum(column)对某列的值求和）</p>
<pre><code>select sum(sal) from emp ;</code></pre><p>– 34.统计emp表员工的平均薪资(不包含奖金)（- avg(column)对某列的值求平均值）</p>
<pre><code>select avg(sal) from emp ;</code></pre><p>– 35.查询emp表中所有在1993和1995年之间出生的员工，显示姓名、出生日期。</p>
<pre><code>select name,birthday 
from emp
where birthday between &apos;1993-01-01&apos; and &apos;1995-12-31&apos;;

-- 或者 year(),month(),day(),
select name,birthday 
from emp
where year(birthday) between 1993 and 1995;</code></pre><p>– 36.查询本月过生日的所有员工</p>
<pre><code>select * from emp
where month(curdate())= month(birthday);
/* 
curdate() 获取当前日期 年月日
select curdate();
curtime() 获取当前时间 时分秒
select curtime();
sysdate() 获取当前日期+时间 年月日 时分秒 
select sysdate();
select now();
*/</code></pre><hr>
<p>– <strong><strong><strong>****</strong></strong></strong> 排序查询 <strong><strong><strong>***</strong></strong></strong></p>
<hr>
<pre><code>/* order by 排序的列 asc 升序(从低到高)
order by 排序的列 desc 降序(从高到低)
默认就是升序，所以asc可以省略不写 */</code></pre><p>– 37.对emp表中所有员工的薪资进行升序(从低到高)排序，显示员工姓名、薪资。</p>
<pre><code>select name,sal from emp
order by sal;</code></pre><p>– 38.对emp表中所有员工奖金进行降序(从高到低)排序，显示员工姓名、奖金。</p>
<pre><code>select name,bonus from emp
order by bonus desc;</code></pre><hr>
<p>– <strong><strong><strong>****</strong></strong></strong> 分页查询 <strong><strong><strong>***</strong></strong></strong></p>
<hr>
<pre><code>/* 在mysql中，通过limit进行分页查询：
limit (页码-1)*每页显示记录数, 每页显示记录数 */</code></pre><p>– 39.查询emp表中的所有记录，分页显示：每页显示3条记录，返回第 1 页。</p>
<pre><code>select * from emp
limit 0,3;
select * from emp
limit 6,3;</code></pre><p>– 40.查询emp表中的所有记录，分页显示：每页显示3条记录，返回第 2 页。</p>
<pre><code>select * from emp
limit 3,3;

select * from emp
limit 9,3;</code></pre><hr>
<p>– 三、外键</p>
<hr>
<p>– 准备数据： 以下练习将使用db20库中的表及表记录，请先进入db20数据库!!!<br>– 准备数据： 以下练习将使用db20库中的表及表记录，请先进入db20数据库!!!<br>– 41.尝试删除dept表中的某一个部门</p>
<pre><code>/* 上面的部门删除成功后，员工表里的某些员工就没有了对应的部门,
这种我们称之为数据的完整性被破坏了,
为了避免这种情况，可以在删除之前，查看将要删除的部门下是否还有员工存在，如果有就不要删除;
或者，让数据库帮我们去维护这样的对应关系，也就是当将要被删除的部门下如果还有员工，
就阻止删除操作，让数据库帮我们维护这样的对应关系，就需要指定外键。*/</code></pre><p>– 42.重新创建db20中的dept和emp表，在创建时，指定emp表中的dept_id列为外键，即这一列要严格参考dept表中的id列, 再次尝试删除dept表中的某一个部门，查看是否能删除成功</p>
<hr>
<p>– 四、关联查询、外连接查询</p>
<hr>
<p>– 准备数据： 以下练习将使用db30库中的表及表记录，请先进入db30数据库!!!<br>– 准备数据： 以下练习将使用db30库中的表及表记录，请先进入db30数据库!!!</p>
<p>– 43.查询部门和部门对应的员工信息</p>
<pre><code>select * from emp,dept
where dept.id = emp.dept_id;
--
select * from dept inner join emp
on dept.id = emp.dept_id;</code></pre><p>– 44.查询所有部门和部门下的员工，如果部门下没有员工，员工显示为null</p>
<pre><code>select * from dept left join emp
on dept.id = emp.dept_id;</code></pre><p>– 45.查询部门和所有员工，如果员工没有所属部门，部门显示为null</p>
<pre><code>select * from dept right join emp
on dept.id = emp.dept_id;</code></pre><hr>
<p>– 五、子查询、多表查询</p>
<hr>
<p>– 准备数据：以下练习将使用db40库中的表及表记录，请先进入db40数据库!!!<br>– 准备数据：以下练习将使用db40库中的表及表记录，请先进入db40数据库!!!</p>
<p>– 46.列出薪资比’王海涛’薪资高的所有员工，显示姓名、薪资</p>
<pre><code>select name,sal from emp
where sal&gt;(
select sal from emp
where name= &apos;王海涛&apos;
);</code></pre><p>– 47.列出与’刘沛霞’从事相同职位的所有员工，显示姓名、职位。</p>
<pre><code>select name,job from emp
where job = (
select job from emp
where name = &apos;刘沛霞&apos;
);</code></pre><p>– 48.列出薪资比’大数据部’部门(已知部门编号为30)所有员工薪资都高的员工信息，显示员工姓名、薪资和部门名称。</p>
<pre><code>select emp.name,sal,dept.name 
from emp,dept
where emp.dept_id = dept.id and sal&gt;(
    select max(sal) from emp,dept
    where dept_id = 30 and emp.dept_id = dept.id
);

select emp.name,sal,dept.name 
from emp left join dept
on emp.dept_id = dept.id and 
where sal&gt;(
    select max(sal) from emp
    where dept_id = 30 
);</code></pre><p>– 49.列出在’培优部’任职的员工，假定不知道’培优部’的部门编号， 显示部门名称，员工名称。</p>
<pre><code>-- 关联查询两张表
-- 求出在培优部的员工
select dept.name,emp.name 
from emp,dept
where emp.dept_id = dept.id and 
   dept.name = &apos;培优部&apos;;</code></pre><p>– 50.(自查询)列出所有员工及其直接上级，显示员工姓名、上级编号，上级姓名</p>
<pre><code>select e1.name,e2.topid,e2.name 
from emp as e1,emp e2
where e1.topid = e2.id;</code></pre><p>– 51.列出最低薪资大于1500的各种职位，显示职位和该职位最低薪资</p>
<pre><code>select job, min(sal)
from emp
group by job
having min(sal)&gt;1500;</code></pre><p>– 52.列出在每个部门就职的员工数量、平均工资。显示部门编号、员工数量，平均薪资。</p>
<pre><code>select dept_id,count(*),avg(sal)
from emp
group by dept_id;</code></pre><p>– 53.查出至少有一个员工的部门。显示部门编号、部门名称、部门位置、部门人数。</p>
<pre><code>-- 关联查询两张表(dept, emp)
-- 替换要显示的列和统计部门人数
select dept.id,dept.name,dept.loc,count(*)
from emp,dept
where emp.dept_id = dept.id 
group by dept.name;</code></pre><p>– 54.列出受雇日期早于直接上级的所有员工的编号、姓名、部门名称。</p>
<pre><code>/* 
列: e1.id, e1.name, d.name
表:    emp e1: 员工表
    emp e2: 上级表
    dept d: 部门表
关联条件: e1.topid=e2.id
        e1.dept_id=d.id
        e1.hdate&lt;e2.hdate  */
select e1.id, e1.name, d.name
from emp e1,emp e2,dept d
where e1.topid=e2.id and e1.dept_id=d.id
    and e1.hdate&lt;e2.hdate;</code></pre><p>– 55.列出每个部门薪资最高的员工信息，显示部门编号、员工姓名、薪资</p>
<pre><code>-- 查询emp表中所有员工的部门编号、姓名、薪资
-- 查询emp表中每个部门的最高薪资，显示部门编号、最高薪资
-- 第二次查询的结果作为一张临时表和第一次查询进行关联查询

select emp.dept_id, t1.ms,emp.name
from emp,(
    select dept_id, max(sal) ms 
    from emp 
    group by dept_id) t1
where emp.dept_id = t1.dept_id and t1.ms=emp.sal;</code></pre><p>======================================<br>补充1、笛卡尔积查询：</p>
<pre><code>笛卡尔积查询：如果同时查询两张表，左边表有m条数据，右边表有n条数据，那么笛卡尔积查询是结果就是 m*n 条记录。这就是笛卡尔积查询。例如： 
select * from dept,emp;
上面的查询中包含大量错误的数据, 一般不使用这种查询。

如果只想保留正确的记录，可以通过where条件进行筛选，将符合条件的保留下来，不符合条件的自然就会被剔除，例如：
select * from dept,emp
where dept.id=emp.dept_id;</code></pre><p>补充2、左外连接和右外连接查询：</p>
<pre><code>(1) 左外连接查询：是将左边表中所有数据都查询出来, 如果在右边表中没有对应的记录, 右边表显示为null即可。
(2) 右外连接查询：是将右边表中所有数据都查询出来, 如果在左边表中没有对应的记录, 左边表显示为null即可。</code></pre><p>补充3、where和having都用于筛选过滤，但是： </p>
<pre><code>(1) where用于在分组之前进行筛选, having用于在分组之后进行筛选
(2) 并且where中不能使用列别名, having中可以使用别名
(3) where子句中不能使用列别名(可以使用表别名), 因为where子句比select先执行!!</code></pre><p>补充4、SQL语句的书写顺序和执行顺序:<br>  SQL语句的书写顺序：</p>
<pre><code>select...
from...
where...
group by...
order by...
...</code></pre><p>  SQL语句的执行顺序：</p>
<pre><code>from... -- 确定要查询的是哪张表 (定义表别名)
where... -- 从整张表的数据中进行筛选过滤
select... -- 确定要显示哪些列 (定义列别名)
group by... -- 根据指定的列进行分组
order by... -- 根据指定的列进行排序
...</code></pre><p>======================================</p>
]]></content>
      <categories>
        <category>数据库</category>
      </categories>
      <tags>
        <tag>sql</tag>
      </tags>
  </entry>
  <entry>
    <title>github仓库--JavaGuide</title>
    <url>/2020/04/12/github%E4%BB%93%E5%BA%93--JavaGuide/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>传送门—–<a href="https://github.com/zhangpengpeng69/JavaGuide" target="_blank" rel="noopener">java基础知识</a></p>
<h2 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h2><ul>
<li><a href="#java">Java</a><ul>
<li><a href="#基础">基础</a></li>
<li><a href="#容器">容器</a></li>
<li><a href="#并发">并发</a></li>
<li><a href="#jvm">JVM</a></li>
<li><a href="#io">I/O</a></li>
<li><a href="#java-8">Java 8</a></li>
<li><a href="#编程规范">编程规范</a></li>
</ul>
</li>
<li><a href="#网络">网络</a></li>
<li><a href="#操作系统">操作系统</a><ul>
<li><a href="#linux相关">Linux相关</a></li>
</ul>
</li>
<li><a href="#数据结构与算法">数据结构与算法</a><ul>
<li><a href="#数据结构">数据结构</a></li>
<li><a href="#算法">算法</a></li>
</ul>
</li>
<li><a href="#数据库">数据库</a><ul>
<li><a href="#mysql">MySQL</a></li>
<li><a href="#redis">Redis</a></li>
</ul>
</li>
<li><a href="#系统设计">系统设计</a><ul>
<li><a href="#设计模式">设计模式(工厂模式、单例模式 … )</a></li>
<li><a href="#常用框架">常用框架(Spring、Zookeeper … )</a></li>
<li><a href="#数据通信">数据通信(消息队列、Dubbo … )</a></li>
<li><a href="#网站架构">网站架构</a></li>
</ul>
</li>
<li><a href="#面试指南">面试指南</a><ul>
<li><a href="#备战面试">备战面试</a></li>
<li><a href="#常见面试题总结">常见面试题总结</a></li>
<li><a href="#面经">面经</a></li>
</ul>
</li>
<li><a href="#工具">工具</a><ul>
<li><a href="#git">Git</a></li>
<li><a href="#Docker">Docker</a></li>
</ul>
</li>
<li><a href="#资源">资源</a><ul>
<li><a href="#书单">书单</a></li>
<li><a href="#Github榜单">Github榜单</a></li>
</ul>
</li>
<li><a href="#待办">待办</a></li>
<li><a href="#说明">说明</a></li>
</ul>
<h2 id="Java"><a href="#Java" class="headerlink" title="Java"></a>Java</h2><h3 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h3><ul>
<li><a href="docs/java/Java基础知识.md">Java 基础知识回顾</a></li>
<li><a href="docs/java/Java疑难点.md">Java 基础知识疑难点/易错点</a></li>
<li><a href="docs/java/Java程序设计题.md">一些重要的Java程序设计题</a></li>
<li><a href="docs/java/J2EE基础知识.md">J2EE 基础知识回顾</a></li>
</ul>
<h3 id="容器"><a href="#容器" class="headerlink" title="容器"></a>容器</h3><ul>
<li><a href="docs/java/collection/Java集合框架常见面试题.md">Java容器常见面试题/知识点总结</a></li>
<li><a href="docs/java/collection/ArrayList.md">ArrayList 源码学习</a>  </li>
<li><a href="docs/java/collection/LinkedList.md">LinkedList 源码学习</a>   </li>
<li><a href="docs/java/collection/HashMap.md">HashMap(JDK1.8)源码学习</a>  </li>
</ul>
<h3 id="并发"><a href="#并发" class="headerlink" title="并发"></a>并发</h3><ul>
<li><a href="docs/java/Multithread/JavaConcurrencyBasicsCommonInterviewQuestionsSummary.md">Java 并发基础常见面试题总结</a></li>
<li><a href="docs/java/Multithread/JavaConcurrencyAdvancedCommonInterviewQuestions.md">Java 并发进阶常见面试题总结</a></li>
<li><a href="docs/java/Multithread/并发容器总结.md">并发容器总结</a></li>
<li><a href="docs/essential-content-for-interview/面试必备之乐观锁与悲观锁.md">乐观锁与悲观锁</a></li>
<li><a href="docs/java/Multithread/Atomic.md">JUC 中的 Atomic 原子类总结</a></li>
<li><a href="docs/java/Multithread/AQS.md">AQS 原理以及 AQS 同步组件总结</a></li>
</ul>
<h3 id="JVM"><a href="#JVM" class="headerlink" title="JVM"></a>JVM</h3><ul>
<li><a href="docs/java/jvm/Java内存区域.md">一 Java内存区域</a></li>
<li><a href="docs/java/jvm/JVM垃圾回收.md">二 JVM垃圾回收</a></li>
<li><a href="docs/java/jvm/JDK监控和故障处理工具总结.md">三 JDK 监控和故障处理工具</a></li>
<li><a href="docs/java/jvm/类文件结构.md">四 类文件结构</a></li>
<li><a href="docs/java/jvm/类加载过程.md">五 类加载过程</a></li>
<li><a href="docs/java/jvm/类加载器.md">六 类加载器</a></li>
</ul>
<h3 id="I-O"><a href="#I-O" class="headerlink" title="I/O"></a>I/O</h3><ul>
<li><a href="docs/java/BIO-NIO-AIO.md">BIO,NIO,AIO 总结 </a></li>
<li><a href="docs/java/Java%20IO与NIO.md">Java IO 与 NIO系列文章</a></li>
</ul>
<h3 id="Java-8"><a href="#Java-8" class="headerlink" title="Java 8"></a>Java 8</h3><ul>
<li><a href="docs/java/What's%20New%20in%20JDK8/Java8Tutorial.md">Java 8 新特性总结</a></li>
<li><a href="docs/java/What's%20New%20in%20JDK8/Java8教程推荐.md">Java 8 学习资源推荐</a></li>
<li><a href="docs/java/What's%20New%20in%20JDK8/Java8foreach指南.md">Java8 forEach 指南</a></li>
</ul>
<h3 id="编程规范"><a href="#编程规范" class="headerlink" title="编程规范"></a>编程规范</h3><ul>
<li><a href="docs/java/Java编程规范.md">Java 编程规范</a></li>
</ul>
<h2 id="网络"><a href="#网络" class="headerlink" title="网络"></a>网络</h2><ul>
<li><a href="docs/network/计算机网络.md">计算机网络常见面试题</a></li>
<li><a href="docs/network/干货：计算机网络知识总结.md">计算机网络基础知识总结</a></li>
<li><a href="docs/network/HTTPS中的TLS.md">HTTPS中的TLS</a></li>
</ul>
<h2 id="操作系统"><a href="#操作系统" class="headerlink" title="操作系统"></a>操作系统</h2><h3 id="Linux相关"><a href="#Linux相关" class="headerlink" title="Linux相关"></a>Linux相关</h3><ul>
<li><a href="docs/operating-system/后端程序员必备的Linux基础知识.md">后端程序员必备的 Linux 基础知识</a>  </li>
<li><a href="docs/operating-system/Shell.md">Shell 编程入门</a> </li>
</ul>
<h2 id="数据结构与算法"><a href="#数据结构与算法" class="headerlink" title="数据结构与算法"></a>数据结构与算法</h2><h3 id="数据结构"><a href="#数据结构" class="headerlink" title="数据结构"></a>数据结构</h3><ul>
<li><a href="docs/dataStructures-algorithms/数据结构.md">数据结构知识学习与面试</a></li>
</ul>
<h3 id="算法"><a href="#算法" class="headerlink" title="算法"></a>算法</h3><ul>
<li><a href="docs/dataStructures-algorithms/算法学习资源推荐.md">算法学习资源推荐</a>  </li>
<li><a href="docs/dataStructures-algorithms/几道常见的子符串算法题.md">几道常见的字符串算法题总结 </a></li>
<li><a href="docs/dataStructures-algorithms/几道常见的链表算法题.md">几道常见的链表算法题总结 </a>   </li>
<li><a href="docs/dataStructures-algorithms/剑指offer部分编程题.md">剑指offer部分编程题</a></li>
<li><a href="docs/dataStructures-algorithms/公司真题.md">公司真题</a></li>
<li><a href="docs/dataStructures-algorithms/Backtracking-NQueens.md">回溯算法经典案例之N皇后问题</a></li>
</ul>
<h2 id="数据库"><a href="#数据库" class="headerlink" title="数据库"></a>数据库</h2><h3 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h3><ul>
<li><a href="docs/database/MySQL.md">MySQL 学习与面试</a></li>
<li><a href="docs/database/一千行MySQL命令.md">一千行MySQL学习笔记</a></li>
<li><a href="docs/database/MySQL高性能优化规范建议.md">MySQL高性能优化规范建议</a></li>
<li><a href="docs/database/MySQL%20Index.md">数据库索引总结</a></li>
<li><a href="docs/database/事务隔离级别(图文详解).md">事务隔离级别(图文详解)</a></li>
<li><a href="docs/database/一条sql语句在mysql中如何执行的.md">一条SQL语句在MySQL中如何执行的</a></li>
</ul>
<h3 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h3><ul>
<li><a href="docs/database/Redis/Redis.md">Redis 总结</a></li>
<li><a href="docs/database/Redis/Redlock分布式锁.md">Redlock分布式锁</a></li>
<li><a href="docs/database/Redis/如何做可靠的分布式锁，Redlock真的可行么.md">如何做可靠的分布式锁，Redlock真的可行么</a></li>
</ul>
<h2 id="系统设计"><a href="#系统设计" class="headerlink" title="系统设计"></a>系统设计</h2><h3 id="设计模式"><a href="#设计模式" class="headerlink" title="设计模式"></a>设计模式</h3><ul>
<li><a href="docs/system-design/设计模式.md">设计模式系列文章</a></li>
</ul>
<h3 id="常用框架"><a href="#常用框架" class="headerlink" title="常用框架"></a>常用框架</h3><h4 id="Spring"><a href="#Spring" class="headerlink" title="Spring"></a>Spring</h4><ul>
<li><a href="docs/system-design/framework/spring/Spring.md">Spring 学习与面试</a></li>
<li><a href="docs/system-design/framework/spring/SpringInterviewQuestions.md">Spring 常见问题总结</a></li>
<li><a href="docs/system-design/framework/spring/SpringBean.md">Spring中bean的作用域与生命周期</a></li>
<li><a href="docs/system-design/framework/spring/SpringMVC-Principle.md">SpringMVC 工作原理详解</a></li>
<li><a href="docs/system-design/framework/spring/Spring-Design-Patterns.md">Spring中都用到了那些设计模式?</a></li>
<li><a href="https://github.com/Snailclimb/springboot-guide" target="_blank" rel="noopener">SpringBoot 使用指南</a></li>
<li><a href="https://github.com/Snailclimb/spring-security-jwt-guide" target="_blank" rel="noopener">Spring Security with JWT</a></li>
</ul>
<h4 id="ZooKeeper"><a href="#ZooKeeper" class="headerlink" title="ZooKeeper"></a>ZooKeeper</h4><ul>
<li><a href="docs/system-design/framework/ZooKeeper.md">ZooKeeper 相关概念总结</a></li>
<li><a href="docs/system-design/framework/ZooKeeper数据模型和常见命令.md">ZooKeeper 数据模型和常见命令</a></li>
</ul>
<h3 id="数据通信"><a href="#数据通信" class="headerlink" title="数据通信"></a>数据通信</h3><ul>
<li><a href="docs/system-design/data-communication/summary.md">数据通信(RESTful、RPC、消息队列)相关知识点总结</a></li>
<li><a href="docs/system-design/data-communication/dubbo.md">Dubbo 总结：关于 Dubbo 的重要知识点</a></li>
<li><a href="docs/system-design/data-communication/message-queue.md">消息队列总结</a></li>
<li><a href="docs/system-design/data-communication/rabbitmq.md">RabbitMQ 入门</a></li>
<li><a href="docs/system-design/data-communication/RocketMQ-Questions.md">RocketMQ的几个简单问题与答案</a></li>
<li><a href="docs/system-design/data-communication/Kafka系统设计开篇-面试看这篇就够了.md">Kafka系统设计开篇-面试看这篇就够了</a></li>
</ul>
<h3 id="网站架构"><a href="#网站架构" class="headerlink" title="网站架构"></a>网站架构</h3><ul>
<li><a href="docs/system-design/website-architecture/分布式.md">一文读懂分布式应该学什么</a></li>
<li><a href="docs/system-design/website-architecture/8%20张图读懂大型网站技术架构.md">8 张图读懂大型网站技术架构</a></li>
<li><a href="docs/system-design/website-architecture/【面试精选】关于大型网站系统架构你不得不懂的10个问题.md">【面试精选】关于大型网站系统架构你不得不懂的10个问题</a></li>
</ul>
<h2 id="面试指南"><a href="#面试指南" class="headerlink" title="面试指南"></a>面试指南</h2><h3 id="备战面试"><a href="#备战面试" class="headerlink" title="备战面试"></a>备战面试</h3><ul>
<li><a href="docs/essential-content-for-interview/PreparingForInterview/程序员的简历之道.md">【备战面试1】程序员的简历就该这样写</a></li>
<li><a href="docs/essential-content-for-interview/PreparingForInterview/interviewPrepare.md">【备战面试2】初出茅庐的程序员该如何准备面试？</a></li>
<li><a href="docs/essential-content-for-interview/PreparingForInterview/JavaProgrammerNeedKnow.md">【备战面试3】7个大部分程序员在面试前很关心的问题</a></li>
<li><a href="docs/essential-content-for-interview/PreparingForInterview/JavaInterviewLibrary.md">【备战面试4】Github上开源的Java面试/学习相关的仓库推荐</a></li>
<li><a href="docs/essential-content-for-interview/PreparingForInterview/如果面试官问你“你有什么问题问我吗？”时，你该如何回答.md">【备战面试5】如果面试官问你“你有什么问题问我吗？”时，你该如何回答</a></li>
<li><a href="docs/essential-content-for-interview/PreparingForInterview/美团面试常见问题总结.md">【备战面试6】美团面试常见问题总结（附详解答案）</a></li>
</ul>
<h3 id="常见面试题总结"><a href="#常见面试题总结" class="headerlink" title="常见面试题总结"></a>常见面试题总结</h3><ul>
<li><a href="docs/essential-content-for-interview/MostCommonJavaInterviewQuestions/第一周（2018-8-7）.md">第一周（2018-8-7）</a> (为什么 Java 中只有值传递、==与equals、 hashCode与equals)</li>
<li><a href="docs/essential-content-for-interview/MostCommonJavaInterviewQuestions/第二周(2018-8-13).md">第二周（2018-8-13）</a>(String和StringBuffer、StringBuilder的区别是什么？String为什么是不可变的？、什么是反射机制？反射机制的应用场景有哪些？……)</li>
<li><a href="docs/java/collection/Java集合框架常见面试题.md">第三周（2018-08-22）</a> （Arraylist 与 LinkedList 异同、ArrayList 与 Vector 区别、HashMap的底层实现、HashMap 和 Hashtable 的区别、HashMap 的长度为什么是2的幂次方、HashSet 和 HashMap 区别、ConcurrentHashMap 和 Hashtable 的区别、ConcurrentHashMap线程安全的具体实现方式/底层具体实现、集合框架底层数据结构总结）</li>
<li><a href="docs/essential-content-for-interview/MostCommonJavaInterviewQuestions/第四周(2018-8-30).md">第四周(2018-8-30).md</a> （主要内容是几道面试常问的多线程基础题。）</li>
</ul>
<h3 id="面经"><a href="#面经" class="headerlink" title="面经"></a>面经</h3><ul>
<li><a href="docs/essential-content-for-interview/BATJrealInterviewExperience/5面阿里,终获offer.md">5面阿里,终获offer(2018年秋招)</a></li>
<li><a href="docs/essential-content-for-interview/BATJrealInterviewExperience/蚂蚁金服实习生面经总结(已拿口头offer).md">蚂蚁金服2019实习生面经总结(已拿口头offer)</a></li>
<li><a href="docs/essential-content-for-interview/BATJrealInterviewExperience/2019alipay-pinduoduo-toutiao.md">2019年蚂蚁金服、头条、拼多多的面试总结</a></li>
</ul>
<h2 id="工具"><a href="#工具" class="headerlink" title="工具"></a>工具</h2><h3 id="Git"><a href="#Git" class="headerlink" title="Git"></a>Git</h3><ul>
<li><a href="docs/tools/Git.md">Git入门</a></li>
</ul>
<h3 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h3><ul>
<li><a href="docs/tools/Docker.md">Docker 入门</a></li>
<li><a href="docs/tools/Docker-Image.md">一文搞懂 Docker 镜像的常用操作！</a></li>
</ul>
<h2 id="资源"><a href="#资源" class="headerlink" title="资源"></a>资源</h2><h3 id="书单"><a href="#书单" class="headerlink" title="书单"></a>书单</h3><ul>
<li><a href="docs/data/java-recommended-books.md">Java程序员必备书单</a></li>
</ul>
<h3 id="实战项目推荐"><a href="#实战项目推荐" class="headerlink" title="实战项目推荐"></a>实战项目推荐</h3><ul>
<li><a href="https://github.com/YunaiV/onemall" target="_blank" rel="noopener">onemall</a> : mall 商城，基于微服务的思想，构建在 B2C 电商场景下的项目实战。核心技术栈，是 Spring Boot + Dubbo 。未来，会重构成 Spring Cloud Alibaba 。</li>
</ul>
<h3 id="Github-历史榜单"><a href="#Github-历史榜单" class="headerlink" title="Github 历史榜单"></a>Github 历史榜单</h3><ul>
<li><a href="docs/github-trending/JavaGithubTrending.md">Java 项目月榜单</a></li>
</ul>
<hr>
<h2 id="待办"><a href="#待办" class="headerlink" title="待办"></a>待办</h2><ul>
<li><input disabled="" type="checkbox"> Java 多线程类别知识重构(—正在进行中—)</li>
<li><input disabled="" type="checkbox"> Netty 总结(—正在进行中—)</li>
<li><input disabled="" type="checkbox"> 数据结构总结重构(—正在进行中—)</li>
</ul>
<h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2>]]></content>
      <categories>
        <category>面试题</category>
      </categories>
      <tags>
        <tag>github</tag>
      </tags>
  </entry>
  <entry>
    <title>github部署静态网页</title>
    <url>/2020/04/21/github%E9%83%A8%E7%BD%B2%E9%9D%99%E6%80%81%E7%BD%91%E9%A1%B5/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>用github部署静态网页其实很简单还不用动服务器，记录一次静态网页的部署。</p>
<h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>在网站设计中，纯粹HTML（标准通用标记语言下的一个应用）格式的网页通常被称为“静态网页”，静态网页是标准的HTML文件，它的文件扩展名是.htm、.html，可以包含文本、图像、声音、FLASH动画、客户端脚本和ActiveX控件及JAVA小程序等。静态网页是网站建设的基础，早期的网站一般都是由静态网页制作的。静态网页是相对于动态网页而言，是指没有后台数据库、不含程序和不可交互的网页。静态网页相对更新起来比较麻烦，适用于一般更新较少的展示型网站。容易误解的是静态页面都是htm这类页面，实际上静态也不是完全静态，他也可以出现各种动态的效果，如GIF格式的动画、FLASH、滚动字幕等。</p>
<h2 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h2><blockquote>
<p>前提：<br>了解html、css、js等前端知识。(可以自己编写或修改页面)<br>会使用github（代码仓库）<br>了解git基本语法（上传代码到github）</p>
</blockquote>
<ol>
<li><p>从网上下载了一份简历模板（当然也可以自己编写）。<br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://www.zhangpeng.fun/upload/2020/04/image-87a51cc72224409698800143465ac714.png" alt="image.png"></p>
</li>
<li><p>github新建仓库<br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://www.zhangpeng.fun/upload/2020/04/image-0b38993db9f343a799bf38973188206c.png" alt="image.png"></p>
</li>
<li><p>用git上传<br>git init<br>git add .<br>git commit -m ‘jianli’<br>git push 地址 master<br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://www.zhangpeng.fun/upload/2020/04/image-44721c1cfb274534b2a0e94a9ba7d5b4.png" alt="image.png"></p>
</li>
<li><p>进入仓库，找到settings-GitHub Pages-none<br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://www.zhangpeng.fun/upload/2020/04/image-6e81bf0c5a1f486fa22d689fed5225bf.png" alt="image.png"><br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://www.zhangpeng.fun/upload/2020/04/image-ea1492ed6bf84126a4666449bcd9bbaa.png" alt="image.png"></p>
</li>
<li><p>点击后找到网址<br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://www.zhangpeng.fun/upload/2020/04/image-44e2afd932b0435d8bcb998b11fbff20.png" alt="image.png"></p>
</li>
<li><p>访问<br>记得加上自己的文件路径<br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://www.zhangpeng.fun/upload/2020/04/image-dbef78dac157480d9836e5d0d3d78b6f.png" alt="image.png"></p>
</li>
<li><p>成功哈哈。</p>
<h2 id="域名绑定"><a href="#域名绑定" class="headerlink" title="域名绑定"></a>域名绑定</h2><blockquote>
<p>前提：<br>有阿里云账号（我用的阿里云）<br>拥有一个自己的域名且已备案</p>
</blockquote>
</li>
</ol>
<p>1.打开cmd窗口ping自己的github仓库网址如 例如：ping zhangpengpeng69.github.io<br>得到 ip地址<br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://www.zhangpeng.fun/upload/2020/04/image-953c4f242ef941a4af0174fe388d6910.png" alt="image.png"></p>
<p>2.阿里云域名解析<br>将自己的域名指向刚刚的ip<br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://www.zhangpeng.fun/upload/2020/04/image-0d54e92a0f2a4f4a93141b2c3e8df433.png" alt="image.png"></p>
<p>3.仓库新建文件CNAME<br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://www.zhangpeng.fun/upload/2020/04/image-bc2369b7a69d4dc68e8d8f87165635dd.png" alt="image.png"></p>
<p>4.写入域名保存<br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://www.zhangpeng.fun/upload/2020/04/image-2840890a9d5744728cb053f9f07e76e3.png" alt="image.png"></p>
<p>或者：在此处添加域名，会自动生成一个CNAME文件<br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://www.zhangpeng.fun/upload/2020/04/image-a22c0299269f4531b9aacd8704228d65.png" alt="image.png"></p>
<p>5.访问即可<br><a href="http://www.zhangpeng.plus/jianli1/index.html" target="_blank" rel="noopener">http://www.zhangpeng.plus/jianli1/index.html</a><br>我又修改了下我的仓库目录结构，所以多了个jianli1<br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://www.zhangpeng.fun/upload/2020/04/image-80faf2a1580848369856bd0593d4adae.png" alt="image.png"><br>成功！</p>
]]></content>
      <categories>
        <category>分享</category>
      </categories>
      <tags>
        <tag>github</tag>
      </tags>
  </entry>
  <entry>
    <title>hexo+github部署自己的静态博客</title>
    <url>/2020/05/01/hexo+github%E9%83%A8%E7%BD%B2%E8%87%AA%E5%B7%B1%E7%9A%84%E9%9D%99%E6%80%81%E5%8D%9A%E5%AE%A2/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><blockquote>
<p>作为程序员拥有一个属于自己的个人技术博客，是很有好处的，经常写写文章，面试时亮出博客地址也会让面试官对你的好感度倍增。我已经有halo博客了，为什么来搞这个呢？完全是好奇而已。hexo+github部署自己的静态博客最大的好处是自己不用花钱去买服务器了。</p>
</blockquote>
<h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>官网：<a href="https://hexo.io/zh-cn/" target="_blank" rel="noopener">https://hexo.io/zh-cn/</a><br>官方文档：<a href="https://hexo.io/zh-cn/docs/" target="_blank" rel="noopener">https://hexo.io/zh-cn/docs/</a><br>主题:<a href="https://hexo.io/themes/" target="_blank" rel="noopener">https://hexo.io/themes/</a><br>hexo：Hexo 是一个快速、简洁且高效的博客框架。Hexo 使用 Markdown（或其他渲染引擎）解析文章，在几秒内，即可利用靓丽的主题生成静态网页。</p>
<blockquote>
<p>超快速度<br>Node.js 所带来的超快生成速度，让上百个页面在几秒内瞬间完成渲染</p>
</blockquote>
<blockquote>
<p>支持 Markdown<br>Hexo 支持 GitHub Flavored Markdown 的所有功能，甚至可以整合 Octopress 的大多数插件。</p>
</blockquote>
<blockquote>
<p>一键部署<br>只需一条指令即可部署到 GitHub Pages, Heroku 或其他平台。</p>
</blockquote>
<blockquote>
<p>插件和可扩展性<br>强大的 API 带来无限的可能，与数种模板引擎（EJS，Pug，Nunjucks）和工具（Babel，PostCSS，Less/Sass）轻易集成</p>
</blockquote>
<h2 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h2><blockquote>
<p>前提<br>已安装Node.js (Node.js 版本需不低于 8.10，建议使用 Node.js 10.0 及以上版本)（node -v）（npm -v）<br>已安装Git（$ git –version）</p>
</blockquote>
<p><strong>安装：</strong></p>
<ol>
<li>新建文件夹（例如hexoblog）</li>
<li>右键：git bush here</li>
<li>切换阿里的npm镜像：$ npm install -g cnpm –registry=<a href="https://registry.npm.taobao.org" target="_blank" rel="noopener">https://registry.npm.taobao.org</a></li>
<li>$ cnpm install hexo-cli -g</li>
<li>$ npm install hexo  </li>
<li>$ hexo init hexo（以hexo文件夹名为例）</li>
<li>$ cd hexo</li>
<li>$ cnpm install</li>
<li>$ hexo server</li>
<li>访问： <a href="http://localhost:4000" target="_blank" rel="noopener">http://localhost:4000</a></li>
</ol>
<p><strong>部署到github：</strong></p>
<ol>
<li>github 创建仓库 XXX.github.io<br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://www.zhangpeng.fun/upload/2020/04/image-92580a30751440a8af455c74aaaf70ea.png" alt="image.png"></li>
<li>配置_config.yml文件<br>修改_config.yml文件，添加你创建的GitHub仓库地址（以我的为例）<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">deploy:</span><br><span class="line">  type: git</span><br><span class="line">  repo: https:&#x2F;&#x2F;github.com&#x2F;zpengit&#x2F;zpengit.github.io</span><br><span class="line">  # example, https:&#x2F;&#x2F;github.com&#x2F;hexojs&#x2F;hexojs.github.io</span><br><span class="line">  branch: master</span><br></pre></td></tr></table></figure>


</li>
</ol>
<ol start="3">
<li><p>hexo-deployer-git.</p>
</li>
<li><p>hexo clean &amp;&amp; hexo deploy 。</p>
</li>
<li><p>查看 zpengit.github.io 上的网页是否部署成功。(我这是更换了主题的样子)<br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://www.zhangpeng.fun/upload/2020/04/image-df81cef6c54a48adb7dd09255e1834f4.png" alt="image.png"></p>
</li>
</ol>
<p><strong>修改主题</strong><br>主题网址：<a href="https://hexo.io/themes/" target="_blank" rel="noopener">https://hexo.io/themes/</a><br>我以主题<a href="https://github.com/iissnan/hexo-theme-next为例" target="_blank" rel="noopener">https://github.com/iissnan/hexo-theme-next为例</a></p>
<ol>
<li>mkdir themes/next</li>
<li>下载git clone <a href="https://github.com/iissnan/hexo-theme-next" target="_blank" rel="noopener">https://github.com/iissnan/hexo-theme-next</a> themes/next</li>
<li>配置_config.yml<br>修改_config.yml文件中的theme属性<br>theme: next</li>
<li>打包上传看看效果：<br>hexo clean<br>hexo generate<br>hexo deploy</li>
<li>访问<a href="https://zpengit.github.io/">https://zpengit.github.io/</a><br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://www.zhangpeng.fun/upload/2020/05/image-694d6fea956e4edaac4b4c783ffcc8ca.png" alt="image.png"></li>
</ol>
<p><strong>配置域名</strong></p>
<ol>
<li>将域名指向GitHub的服务器地址</li>
<li>进入存放博客的GitHub仓库，点击settings，设置Custom domain，输入域名xxx.xx。<br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://www.zhangpeng.fun/upload/2020/05/image-5fb60de8ce2547f8918bae6d0904e59f.png" alt="image.png"></li>
<li>然后在本地博客文件source中创建一个名为CNAME文件，不要后缀。写上你的域名。</li>
<li>最后重新编译上传文件，访问：xxx.xx即可。<br>hexo clean<br>hexo generate<br>hexo deploy</li>
</ol>
]]></content>
      <categories>
        <category>分享</category>
      </categories>
      <tags>
        <tag>github</tag>
        <tag>hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>Hello World</title>
    <url>/2020/04/30/hello-world/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/one-command-deployment.html" target="_blank" rel="noopener">Deployment</a></p>
]]></content>
  </entry>
  <entry>
    <title>idea安装与破解</title>
    <url>/2020/05/03/idea%E5%AE%89%E8%A3%85%E4%B8%8E%E7%A0%B4%E8%A7%A3/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>之前一直使用eclipse，决定不用了，以后用idea。。</p>
<blockquote>
<p>IDEA 全称 IntelliJ IDEA，是java编程语言开发的集成环境。IntelliJ在业界被公认为最好的java开发工具，尤其在智能代码助手、代码自动提示、重构、JavaEE支持、各类版本工具(git、svn等)、JUnit、CVS整合、代码分析、 创新的GUI设计等方面的功能可以说是超常的。IDEA是JetBrains公司的产品，这家公司总部位于捷克共和国的首都布拉格，开发人员以严谨著称的东欧程序员为主。它的旗舰版本还支持HTML，CSS，PHP，MySQL，Python等。免费版只支持Java等少数语言。</p>
</blockquote>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>1.下载<br>官网：<a href="https://www.jetbrains.com/" target="_blank" rel="noopener">https://www.jetbrains.com/</a><br>下载：<a href="https://www.jetbrains.com/idea/download/#section=windows" target="_blank" rel="noopener">https://www.jetbrains.com/idea/download/#section=windows</a><br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://www.zhangpeng.fun/upload/2020/05/Snipaste_2020-05-03_21-11-53-c17a04424522428ba82a33f534456267.jpg" alt="Snipaste_2020-05-03_21-11-53"><br>开源版和旗舰版的区别<br>开源版（Community）完全免费，旗舰版（Ultimate）需要收费，但是注册账号后可以试用30天<br>两者的安装包是不同的，同一台机器可以同时安装开源版和旗舰版<br>旗舰版比开源版多了很多功能，例如支持HTML/CSS/JavaScript/TypeScript的代码智能提醒、提供常用框架（Spring，Play，Grails）的实用插件、提供数据库工具、自动检查代码重复等。<br>旗舰版的收费目前是订阅模式收费策略，支持按年订阅或者按月订阅。</p>
<p>2.安装<br>无特殊，选择安装位置安装就好<br>我的安装路径：D:\software2\idea\IntelliJ IDEA 2019.3.3<br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://www.zhangpeng.fun/upload/2020/05/Snipaste_2020-05-03_21-06-24-cc857dd4e3504ba3b3a2b02ca1b12fa2.jpg" alt="Snipaste_2020-05-03_21-06-24"></p>
<p>##破解<br>1.先适用30天进入idea，新建个项目<br>2.网上下载破解补丁jetbrains-agent.jar<br>3.放在idea安装目录的bin目录下<br>D:\software2\idea\IntelliJ IDEA 2019.3.3\bin<br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://www.zhangpeng.fun/upload/2020/05/image-ee5d202b11444d1aa1275172e2fb6078.png" alt="image.png"><br>4.idea-help-Edit Custom VM Options<br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://www.zhangpeng.fun/upload/2020/05/image-ce0570929d094c028d9cf3f6a762d69b.png" alt="image.png"></p>
<p>5.末尾加上一行（填写自己的路径）：<br>-javaagent:D:\software2\idea\IntelliJ IDEA 2019.3.3\bin\jetbrains-agent.jar<br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://www.zhangpeng.fun/upload/2020/05/image-cf055a5139dd4717ad62be3dd816da20.png" alt="image.png"></p>
<p>6.关掉ieda重启</p>
<p>7.填入激活码，激活<br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://www.zhangpeng.fun/upload/2020/05/image-082ae1ce53dd463c98a8a0dfe7c4bce1.png" alt="image.png"></p>
<p>8.本文不包含任何资源，请自行百度。</p>
]]></content>
      <categories>
        <category>工具</category>
      </categories>
      <tags>
        <tag>idea</tag>
      </tags>
  </entry>
  <entry>
    <title>java-jdk安装与配置idea配置jdk</title>
    <url>/2020/05/05/java-jdk%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AEidea%E9%85%8D%E7%BD%AEjdk/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>·</p>
<h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>1.介绍<br>简单来讲，JDK是Java语言的软件开发工具包，我们使用JDK所提供的开发工具完成对java程序的开发；JRE是运行Java程序锁必须的环境，使用JRE运行开发好的java应用程序。</p>
<p>　　· JDK(Java Development Kit　　Java开发工具包)：JDK是提供给Java开发人员使用的，其中包含了java的开发工具，也包括JRE。所以安装了JDK,就不用再单独安装JRE了。</p>
<p>　　· JRE(Java Runtime Environment　　Java运行环境)：包括Java虚拟机（JVM：Java Virtual Machine）和Java程序所需的核心类库等，如果想要运行一个开发好的Java程序，计算机中只需要安全JRE即可。</p>
<h2 id="下载安装"><a href="#下载安装" class="headerlink" title="下载安装"></a>下载安装</h2><p>1.下载<br>地址：<a href="https://www.oracle.com/java/technologies/javase-downloads.html" target="_blank" rel="noopener">https://www.oracle.com/java/technologies/javase-downloads.html</a><br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://www.zhangpeng.fun/upload/2020/05/Snipaste_2020-05-03_21-23-03-da6d277afc054e23bd03c9abea8b7787.png" alt="Snipaste_2020-05-03_21-23-03"><br>2.安装<br>傻瓜式安装</p>
<h2 id="环境变量配置"><a href="#环境变量配置" class="headerlink" title="环境变量配置"></a>环境变量配置</h2><p>4.环境变量配置<br>为了方便java程序的开发，我们需要配置一下环境变量。右击此电脑&gt;属性&gt;高级系统设置&gt;环境变量&gt;单击[新建(W)]添加以下环境变量<br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://www.zhangpeng.fun/upload/2020/05/Snipaste_2020-05-03_21-32-17-17f4088ae5bc4ee886779780704d189b.png" alt="Snipaste_2020-05-03_21-32-17"><br>（1）配置JAVA_HOME</p>
<p>　　新建JAVA_HOME</p>
<p>　　变量名        JAVA_HOME</p>
<p>　　变量值        D:\java\jdk  你的jdk的安装地址<br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://www.zhangpeng.fun/upload/2020/05/Snipaste_2020-05-03_21-35-04-b7c8c86db6a4414da21d04e2d3783aee.png" alt="Snipaste_2020-05-03_21-35-04"></p>
<p>（2）配置CLASSPATH</p>
<p>　　新建CLASSPATH</p>
<p>　　变量名   CLASSPATH</p>
<p>　　变量值   .;%JAVA_HOME%\lib\dt.jar;%JAVA_HOME%\lib\tools.jar<br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://www.zhangpeng.fun/upload/2020/05/Snipaste_2020-05-03_21-36-07-f17b9d4cca084d3789b2f22cc2523c4e.png" alt="Snipaste_2020-05-03_21-36-07"></p>
<p>（3）配置PATH （追加）</p>
<p>　　在PATH变量最后面添加两条变量值                            </p>
<p>　　变量名  Path</p>
<p>　　变量值  %JAVA_HOME%\bin</p>
<p>　　变量值  %JAVA_HOME%\jre\bin<br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://www.zhangpeng.fun/upload/2020/05/Snipaste_2020-05-03_21-38-42-1cf01d3024f34f0195ab9751aaaf2456.png" alt="Snipaste_2020-05-03_21-38-42"></p>
<p>5.检查是否安装成功<br>windows+r调出cmd窗口输入java -version<br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://www.zhangpeng.fun/upload/2020/05/Snipaste_2020-05-03_21-41-02-be1a133d83bb488d8c2305934b487d23.png" alt="Snipaste_2020-05-03_21-41-02"></p>
<h2 id="idea配置"><a href="#idea配置" class="headerlink" title="idea配置"></a>idea配置</h2><p>File-Project Structure-SDKs<br>D:\java\jdk<br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://www.zhangpeng.fun/upload/2020/05/Snipaste_2020-05-03_21-58-10-126adb5c93e24a9ba5e40fec57ad4870.png" alt="Snipaste_2020-05-03_21-58-10"></p>
]]></content>
      <categories>
        <category>工具</category>
      </categories>
      <tags>
        <tag>idea</tag>
        <tag>jdk</tag>
      </tags>
  </entry>
  <entry>
    <title>java基础面试题</title>
    <url>/2020/04/06/java%E5%9F%BA%E7%A1%80%E9%9D%A2%E8%AF%95%E9%A2%98/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="java基础面试题"><a href="#java基础面试题" class="headerlink" title="java基础面试题"></a>java基础面试题</h1><h2 id="1、面向对象都有哪些特性以及你对这些特性的理解-？"><a href="#1、面向对象都有哪些特性以及你对这些特性的理解-？" class="headerlink" title="1、面向对象都有哪些特性以及你对这些特性的理解 ？"></a>1、面向对象都有哪些特性以及你对这些特性的理解 ？</h2><p>答：面向对象的三大特征：1.继承  2.封装 3.多态性<br/><br>  （1）继承：就是保留父类的属性，开扩新的东西。通过子类可以实现继承，子类继承父类的所有状态和行为，同时添加自身的状态和行为。<br/><br>  （2）封装：就是类的私有化。将代码及处理数据绑定在一起的一种编程机制，该机制保证程序和数据不受外部干扰。<br/><br>  （3）多态：是允许将父对象设置成为和一个和多个它的子对象相等的技术。包括重载和重写。重载为编译时多态，重写是运行时多态。<br/></p>
<h2 id="2、什么是自动装箱和拆箱？"><a href="#2、什么是自动装箱和拆箱？" class="headerlink" title="2、什么是自动装箱和拆箱？"></a>2、什么是自动装箱和拆箱？</h2><p>  答：自动装箱就是Java自动将原始类型值转换成对应的对象，比如将int的变量转换成Integer对象，这个过程叫做装箱，反之将Integer对象转换成int类型值，这个过程叫做拆箱。因为这里的装箱和拆箱是自动进行的非人为转换，所以就称作为自动装箱和拆箱。<br/><br>  原始类型byte,short,char,int,long,float,double和boolean对应的封装类为Byte,Short,Character,Integer,Long,Float,Double,Boolean。自动装箱和拆箱从Java 1.5开始引入，目的是将原始类型值转自动地转换成对应的对象。自动装箱与拆箱的机制可以让我们在Java的变量赋值或者是方法调用等情况下使用原始类型或者对象类型更加简单直接。<br/></p>
<h2 id="3、什么是-java-序列化，如何实现-java-序列化？"><a href="#3、什么是-java-序列化，如何实现-java-序列化？" class="headerlink" title="3、什么是 java 序列化，如何实现 java 序列化？"></a>3、什么是 java 序列化，如何实现 java 序列化？</h2><p>  答：序列化就是一种用来处理对象流的机制，所谓对象流也就是将对象的内容进行流化。可以对流化后的对象进行读写操作，也可将流化后的对象传输于网络之间。序列化是为了解决在对对象流进行读写操作时所引发的问题。<br/><br>  序 列 化 的 实 现 ： 将 需 要 被 序 列 化 的 类 实 现 Serializable 接 口 ， 该 接 口 没 有 需 要 实 现 的 方 法 ，implements Serializable 只是为了标注该对象是可被序列化的，然后使用一个输出流(如： FileOutputStream)来构造一个 ObjectOutputStream(对象流)对象，接着，使用 ObjectOutputStream 对象的 writeObject(Object obj)方法就可以将参数为 obj 的对象写出(即保存其状态)，要恢复的话则用输入流。<br/></p>
<h2 id="4、char-型变量中能不能存储一个中文汉字，为什么？"><a href="#4、char-型变量中能不能存储一个中文汉字，为什么？" class="headerlink" title="4、char 型变量中能不能存储一个中文汉字，为什么？"></a>4、char 型变量中能不能存储一个中文汉字，为什么？</h2><p>  答：char 类型可以存储一个中文汉字，因为 Java 中使用的编码是 Unicode（不选择任何特定的编码，直接使用字符在字符集中的编号，这是统一的唯一方法），一个 char 类型占 2 个字节（16 比特），所以放一个中文是没问题的。</p>
<h2 id="5、List-和-Map、-Set-的区别？"><a href="#5、List-和-Map、-Set-的区别？" class="headerlink" title="5、List 和 Map、 Set 的区别？"></a>5、List 和 Map、 Set 的区别？</h2><p>  答：List 和 Set 是存储单列数据的集合， Map 是存储键和值这样的双列数据的集合； List 中存储的数据是有顺序，并且允许重复； Map 中存储的数据是没有顺序的，其键是不能重复的，它的值是可以有重复的， Set 中存储的数据是无序的，且不允许有重复，但元素在集合中的位置由元素的 hashcode 决定，位置是固定的（Set 集合根据 hashcode 来进行数据的存储，所以位置是固定的，但是位置不是用户可以控制的，所以对于用户来说 set 中的元素还是无序的） 。</p>
<h2 id="6、HashMap-和-HashTable-有什么区别"><a href="#6、HashMap-和-HashTable-有什么区别" class="headerlink" title="6、HashMap 和 HashTable 有什么区别?"></a>6、HashMap 和 HashTable 有什么区别?</h2><p>  HashMap 是线程不安全的,HashMap 是一个接口,是 Map 的一个子接口,是将键映射到值得对象,不允许键值重复允许空键和空值;由于非线程安全,HashMap 的效率要较 HashTable 的效率高一些.HashTable 是线程安全的一个集合,不允许 null 值作为一个 key 值或者 Value 值;HashTable 是 sychronize,多个线程访问时不需要自己为它的方法实现同步,而 HashMap 在被多个线程访问的时候需要自己为它的方法实现同步。</p>
<h2 id="7、谈谈-JVM-的内存结构和内存分配？"><a href="#7、谈谈-JVM-的内存结构和内存分配？" class="headerlink" title="7、谈谈 JVM 的内存结构和内存分配？"></a>7、谈谈 JVM 的内存结构和内存分配？</h2><p>a)Java 内存模型 <br/><br>    Java 虚拟机将其管辖的内存大致分三个逻辑部分：方法区(Method Area)、 Java 栈和 Java 堆。<br/><br>  1、方法区是静态分配的，编译器将变量绑定在某个存储位置上，而且这些绑定不会在运行时改变。常数池，源代码中的命名常量、 String 常量和 static 变量保存在方法区。<br/><br>  2、 Java Stack 是一个逻辑概念，特点是后进先出。一个栈的空间可能是连续的，也可能是不连续的。最典型的 Stack 应用是方法的调用， Java 虚拟机每调用一次方法就创建一个方法帧（frame），退出该方法则对应的 方法帧被弹出(pop)。栈中存储的数据也是运行时确定的。<br/><br>  3、 Java 堆分配(heap allocation)意味着以随意的顺序，在运行时进行存储空间分配和收回的内存管理模型。堆中存储的数据常常是大小、数量和生命期在编译时无法确定的。 Java 对象的内存总是在 heap 中分配。<br/><br>    b) java 内存分配<br/><br>  1、基础数据类型直接在栈空间分配;<br/><br>  2、方法的形式参数，直接在栈空间分配，当方法调用完成后从栈空间回收;<br/><br>  3、引用数据类型，需要用 new 来创建，既在栈空间分配一个地址空间，又在堆空间分配对象的类变量;<br/><br>  4、方法的引用参数，在栈空间分配一个地址空间，并指向堆空间的对象区，当方法调用完后从栈空间回收;<br/><br>  5、局部变量 new 出来时，在栈空间和堆空间中分配空间，当局部变量生命周期结束后，栈空间立刻被回收，堆空间区域等待 GC 回收;<br/><br>  6、方法调用时传入的实际参数，先在栈空间分配，在方法调用完成后从栈空间释放;<br/><br>  7、字符串常量在 DATA 区域分配 ， this 在堆空间分配;<br/><br>  8、数组既在栈空间分配数组名称， 又在堆空间分配数组实际的大小。<br/></p>
<h2 id="8、wait-与sleep-的区别"><a href="#8、wait-与sleep-的区别" class="headerlink" title="8、wait()与sleep()的区别"></a>8、wait()与sleep()的区别</h2><p>a)sleep()来自Thread类，和wait()来自Object类.调用sleep()方法的过程中，线程不会释放对象锁。而 调用 wait 方法线程会释放对象锁。<br/><br>  b)sleep()睡眠后不出让系统资源，wait让其他线程可以占用CPU。<br/><br>  c)sleep(milliseconds)需要指定一个睡眠时间，时间一到会自动唤醒.而wait()需要配合notify()或者notifyAll()使用。<br/></p>
<h2 id="9、说说你对-Java-中反射的理解-？"><a href="#9、说说你对-Java-中反射的理解-？" class="headerlink" title="9、说说你对 Java 中反射的理解 ？"></a>9、说说你对 Java 中反射的理解 ？</h2><p>JAVA反射机制是在运行状态中，对于任意一个类，都能够知道这个类的所有属性和方法；对于任意一个对象，都能够调用它的任意一个方法；这种动态获取的信息以及动态调用对象的方法的功能称为java语言的反射机制。</p>
<h2 id="10、写出常见的5个RuntimeException"><a href="#10、写出常见的5个RuntimeException" class="headerlink" title="10、写出常见的5个RuntimeException"></a>10、写出常见的5个RuntimeException</h2><p>     (1)java.lang.NullPointerException空指针异常，出现原因：调用了未经初始化的对性爱那个或者不存在的对象。<br/><br>       (2)ClassNoFoundException 指定类找不到，出现原因：类的名称和路径加载错误，通常是试图通过字符串来加载某个类时可能引发异常。<br/><br>       (3)NumberFormatException字符串转换为数字异常，出现原因：字符串数据中包含非数字型字符。<br/><br>       (4)IndexOutOfBoundsException数组下标越界异常<br/><br>       (5)IllegalArgumentException 方法传递参数错误<br/><br>       (6)ClassCastException数据类型转换异常<br/><br>       (7)NoClassDefFoundExcetion 未找到类定义错误<br/><br>       (8)SQLException SQL异常<br/><br>       (9)InstantiationException实例化异常<br/><br>       (10)NoSuchMethodExceptioin 方法不存在异常<br/></p>
]]></content>
      <categories>
        <category>面试题</category>
      </categories>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>vuepress+github部署自己的静态博客</title>
    <url>/2020/05/08/vuepress+github%E9%83%A8%E7%BD%B2%E8%87%AA%E5%B7%B1%E7%9A%84%E9%9D%99%E6%80%81%E5%8D%9A%E5%AE%A2/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>没错，我又弄了一个静态博客，哈哈,我也不知道为什么，当作学习了吧!</p>
<h2 id="Vue-js"><a href="#Vue-js" class="headerlink" title="Vue.js"></a>Vue.js</h2><p>还要从昨天想要学习vue开始，</p>
<blockquote>
<p>Vue.js是一套构建用户界面的渐进式框架。与其他重量级框架不同的是，Vue 采用自底向上增量开发的设计。Vue 的核心库只关注视图层，并且非常容易学习，非常容易与其它库或已有项目整合。另一方面，Vue 完全有能力驱动采用单文件组件和Vue生态系统支持的库开发的复杂单页应用。</p>
</blockquote>
<p>官网：<a href="https://cn.vuejs.org/" target="_blank" rel="noopener">https://cn.vuejs.org/</a><br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://www.zhangpeng.fun/upload/2020/05/image-92a23e88c1ec4966ae0a2769ec2f03ac.png" alt="image.png"></p>
<p>vue没学倒是挺喜欢官网的界面的，想着是怎么做的，就找到了vuepress。</p>
<h2 id="VuePress"><a href="#VuePress" class="headerlink" title="VuePress"></a>VuePress</h2><p>官网：<a href="https://www.vuepress.cn/" target="_blank" rel="noopener">https://www.vuepress.cn/</a><br>简洁至上<br>以 Markdown 为中心的项目结构，以最少的配置帮助你专注于写作。<br>Vue 驱动<br>享受 Vue + webpack 的开发体验，可以在 Markdown 中使用 Vue 组件，又可以使用 Vue 来开发自定义主题。<br>高性能<br>VuePress 会为每个页面预渲染生成静态的 HTML，同时，每个页面被加载的时候，将作为 SPA 运行。<br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://www.zhangpeng.fun/upload/2020/05/image-3694e7a68e494d70b127c4f8966eda35.png" alt="image.png"><br>其实就是用来写Markdown的<br><a href="http://www.zhangpeng.plus/vuepress/" target="_blank" rel="noopener">http://www.zhangpeng.plus/vuepress/</a></p>
<h2 id="vuepress搭博客"><a href="#vuepress搭博客" class="headerlink" title="vuepress搭博客"></a>vuepress搭博客</h2><p>但是我找了个模板就开始搞博客哈哈</p>
<blockquote>
<p>请确保你的 Node.js 版本 &gt;= 8。<br>vuepress</p>
</blockquote>
<ol>
<li><p>全局安装</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># 安装</span><br><span class="line">yarn global add vuepress # 或者：npm install -g vuepress</span><br><span class="line"></span><br><span class="line"># 创建项目目录</span><br><span class="line">mkdir vuepress-starter &amp;&amp; cd vuepress-starter</span><br><span class="line"></span><br><span class="line"># 新建一个 markdown 文件</span><br><span class="line">echo &#39;# Hello VuePress!&#39; &gt; README.md</span><br><span class="line"></span><br><span class="line"># 开始写作</span><br><span class="line">vuepress dev .</span><br><span class="line"></span><br><span class="line"># 构建静态文件</span><br><span class="line">vuepress build .</span><br></pre></td></tr></table></figure>
</li>
<li><p>现有项目</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># 将 VuePress 作为一个本地依赖安装</span><br><span class="line">yarn add -D vuepress # 或者：npm install -D vuepress</span><br><span class="line"></span><br><span class="line"># 新建一个 docs 文件夹</span><br><span class="line">mkdir docs</span><br><span class="line"></span><br><span class="line"># 新建一个 markdown 文件</span><br><span class="line">echo &#39;# Hello VuePress!&#39; &gt; docs&#x2F;README.md</span><br><span class="line"></span><br><span class="line"># 开始写作</span><br><span class="line">npx vuepress dev docs</span><br></pre></td></tr></table></figure></li>
<li><p>详细教程：<a href="https://www.vuepress.cn/" target="_blank" rel="noopener">https://www.vuepress.cn/</a></p>
</li>
</ol>
<h2 id="部署github"><a href="#部署github" class="headerlink" title="部署github"></a>部署github</h2><ol>
<li>部署github，创建一个如下的 deploy.sh 文件<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;env sh</span><br><span class="line"></span><br><span class="line"># 确保脚本抛出遇到的错误</span><br><span class="line">set -e</span><br><span class="line"></span><br><span class="line"># 生成静态文件</span><br><span class="line">npm run docs:build</span><br><span class="line"></span><br><span class="line"># 进入生成的文件夹</span><br><span class="line">cd docs&#x2F;.vuepress&#x2F;dist</span><br><span class="line"></span><br><span class="line"># 如果是发布到自定义域名</span><br><span class="line"># echo &#39;www.example.com&#39; &gt; CNAME</span><br><span class="line"></span><br><span class="line">git init</span><br><span class="line">git add -A</span><br><span class="line">git commit -m &#39;deploy&#39;</span><br><span class="line"></span><br><span class="line"># 如果发布到 https:&#x2F;&#x2F;&lt;USERNAME&gt;.github.io</span><br><span class="line"># git push -f git@github.com:&lt;USERNAME&gt;&#x2F;&lt;USERNAME&gt;.github.io.git master</span><br><span class="line"></span><br><span class="line"># 如果发布到 https:&#x2F;&#x2F;&lt;USERNAME&gt;.github.io&#x2F;&lt;REPO&gt;</span><br><span class="line"># git push -f git@github.com:&lt;USERNAME&gt;&#x2F;&lt;REPO&gt;.git master:gh-pages</span><br><span class="line"></span><br><span class="line">cd -</span><br></pre></td></tr></table></figure></li>
<li>小问题</li>
</ol>
<blockquote>
<p>在 docs/.vuepress/config.js 中设置正确的 base。<br>如果你打算发布到 https://&lt;USERNAME.github.io/，则可以省略这一步，因为 base 默认即是 “/“。<br>如果你打算发布到 https://&lt;USERNAME.github.io/&lt;REPO/（也就是说你的仓库在 <a href="https://github.com/" target="_blank" rel="noopener">https://github.com/</a>&lt;USERNAME/&lt;REPO），则将 base 设置为 “/&lt;REPO/“。</p>
</blockquote>
<ol start="3">
<li>每个账号可以有几个github pages</li>
</ol>
<p>解决了我一个难题，之前我甚至注册了个新的邮箱去放我的hexo博客</p>
<blockquote>
<p>个人主页必须要和用户的GitHub帐号同名，所以每个用户有且只能有一个repo作为个人主页，且必须是<username>/<username>.github.io的形式；而项目主页的命名则没有这种限制，且数量有任意多个。</p>
</blockquote>
<blockquote>
<p>不考虑绑定的自定义域名的前提下，个人主页的GitHub二级域名为&lt;username.github.io;项目主页的GitHub二级域名为&lt;username.github.io/&lt;projectname,没有&lt;projectname.&lt;username.github.io这种方式</p>
</blockquote>
<blockquote>
<p>个人主页的展示内容以master分支里的文件为准；而项目主页的展示内容以gh-pages分支内的文件为准</p>
</blockquote>
<p><a href="https://help.github.com/en/github/working-with-github-pages/about-github-pages" target="_blank" rel="noopener">https://help.github.com/en/github/working-with-github-pages/about-github-pages</a></p>
<h2 id="结果展示"><a href="#结果展示" class="headerlink" title="结果展示"></a>结果展示</h2><p>文档：<a href="http://www.zhangpeng.plus/vuepress/" target="_blank" rel="noopener">http://www.zhangpeng.plus/vuepress/</a><br>博客：<a href="https://zhangpengpeng69.github.io/vuepressblog/" target="_blank" rel="noopener">https://zhangpengpeng69.github.io/vuepressblog/</a></p>
]]></content>
      <categories>
        <category>前端</category>
      </categories>
      <tags>
        <tag>java</tag>
        <tag>github</tag>
        <tag>vue</tag>
        <tag>vuepress</tag>
      </tags>
  </entry>
  <entry>
    <title>lombok插件</title>
    <url>/2020/04/09/lombok%E6%8F%92%E4%BB%B6/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="lombok插件-简化代码"><a href="#lombok插件-简化代码" class="headerlink" title="lombok插件 简化代码"></a>lombok插件 简化代码</h2><p><a href="https://projectlombok.org/" target="_blank" rel="noopener">lombok</a><br>&emsp;&emsp;Project Lombok<br>&emsp;&emsp;Project Lombok is a java library that automatically plugs into your editor and build tools, spicing up your java.<br>Never write another getter or equals method again, with one annotation your class has a fully featured builder, Automate your logging variables, and much more.<br>&emsp;&emsp;Lombok项目是一个Java库，它会自动插入编辑器和构建工具中，Lombok提供了一组有用的注释，用来消除Java类中的大量样板代码。仅五个字符(@Data)就可以替换数百行代码从而产生干净，简洁且易于维护的Java类。<br>&emsp;&emsp;Lombok通过增加一些“处理程序”，可以让java变得简洁、快速。<br>&emsp;&emsp;Lombok能以简单的注解形式来简化java代码，提高开发人员的开发效率。例如开发中经常需要写的javabean，都需要花时间去添加相应的getter/setter，也许还要去写构造器、equals等方法，而且需要维护，当属性多时会出现大量的getter/setter方法，这些显得很冗长也没有太多技术含量，一旦修改属性，就容易出现忘记修改对应方法的失误。</p>
<p>&emsp;&emsp;Lombok能通过注解的方式，在编译时自动为属性生成构造器、getter/setter、equals、hashcode、toString方法。出现的神奇就是在源码中没有getter和setter方法，但是在编译生成的字节码文件中有getter和setter方法。这样就省去了手动重建这些代码的麻烦，使代码看起来更简洁些。</p>
<h3 id="1-引入jar包"><a href="#1-引入jar包" class="headerlink" title="1.引入jar包"></a>1.引入jar包</h3><p>引入插件lombok 自动的set/get/构造方法插件  </p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;lombok&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<h3 id="2-找到lombokjar包文件位置-以java方式运行"><a href="#2-找到lombokjar包文件位置-以java方式运行" class="headerlink" title="2.找到lombokjar包文件位置 以java方式运行"></a>2.找到lombokjar包文件位置 以java方式运行</h3><p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://www.zhangpeng.fun/upload/2020/3/image-2bd1b12e0041491ab1c25d89b3ceab8d.png" alt="image.png"></p>
<h3 id="3-命令"><a href="#3-命令" class="headerlink" title="3.命令:"></a>3.命令:</h3><p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://www.zhangpeng.fun/upload/2020/3/image-25ea6cb0fe704751bf0efd0e5f425ac5.png" alt="image.png"><br>之后点击install/update即可<br>在eclipse安装的根目录下会生成lombok.jar包文件,表示插件安装成功.<br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://www.zhangpeng.fun/upload/2020/3/image-0be5f4eabff74481a5fa694174e65640.png" alt="image.png"></p>
<h3 id="4-配置"><a href="#4-配置" class="headerlink" title="4.配置"></a>4.配置</h3><p>在文件安装的根目录找到SpringToolSuite4.ini中<br>手动在ini文件中最后一行添加<br>-vmargs -javaagent:lombok.jar</p>
<p>安装完成后重启Eclipse即可</p>
<h3 id="5-常用注解"><a href="#5-常用注解" class="headerlink" title="5.常用注解"></a>5.常用注解</h3><p> Lombok主要常用的注解有：@Data,@getter,@setter,@NoArgsConstructor,@AllArgsConstructor,@ToString,@EqualsAndHashCode,@Slf4j,@Log4j。我们一个一个来看：</p>
<p>@Data注解：在JavaBean或类JavaBean中使用，这个注解包含范围最广，它包含getter、setter、NoArgsConstructor注解，即当使用当前注解时，会自动生成包含的所有方法；</p>
<p>@getter注解：在JavaBean或类JavaBean中使用，使用此注解会生成对应的getter方法；</p>
<p>@setter注解：在JavaBean或类JavaBean中使用，使用此注解会生成对应的setter方法；</p>
<p>@NoArgsConstructor注解：在JavaBean或类JavaBean中使用，使用此注解会生成对应的无参构造方法；</p>
<p>@AllArgsConstructor注解：在JavaBean或类JavaBean中使用，使用此注解会生成对应的有参构造方法；</p>
<p>@ToString注解：在JavaBean或类JavaBean中使用，使用此注解会自动重写对应的toStirng方法；</p>
<p>@EqualsAndHashCode注解：在JavaBean或类JavaBean中使用，使用此注解会自动重写对应的equals方法和hashCode方法；</p>
<p>@Slf4j：在需要打印日志的类中使用，当项目中使用了slf4j打印日志框架时使用该注解，会简化日志的打印流程，只需调用info方法即可；</p>
<p>@Log4j：在需要打印日志的类中使用，当项目中使用了log4j打印日志框架时使用该注解，会简化日志的打印流程，只需调用info方法即可；</p>
<p>在使用以上注解需要处理参数时，处理方法如下（以@ToString注解为例，其他注解同@ToString注解）：</p>
<p>@ToString(exclude=”column”)</p>
<p>意义：排除column列所对应的元素，即在生成toString方法时不包含column参数；</p>
<p>@ToString(exclude={“column1”,”column2”})</p>
<p>意义：排除多个column列所对应的元素，其中间用英文状态下的逗号进行分割，即在生成toString方法时不包含多个column参数；</p>
<p>@ToString(of=”column”)</p>
<p>意义：只生成包含column列所对应的元素的参数的toString方法，即在生成toString方法时只包含column参数；；</p>
<p>@ToString(of={“column1”,”column2”})<br>意义：只生成包含多个column列所对应的元素的参数的toString方法，其中间用英文状态下的逗号进行分割，即在生成toString方法时只包含多个column参数；<br>@Accessors(chain=true)<br>链式加载</p>
<h3 id="可能问题"><a href="#可能问题" class="headerlink" title="可能问题"></a>可能问题</h3><p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://www.zhangpeng.fun/upload/2020/3/image-e3803a1ea7cd48f79d857b2a00fbe985.png" alt="image.png"><br>sts安装lombok后重启时，如报以上错误，是没有找到jdk的安装路径<br>解决：<br>    在SpringToolSuite4.ini中加入如下代码：<br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://www.zhangpeng.fun/upload/2020/3/image-7000f78eee3a4955ba436dcf5597926a.png" alt="image.png">    </p>
]]></content>
      <categories>
        <category>工具</category>
      </categories>
      <tags>
        <tag>插件</tag>
        <tag>lombok</tag>
      </tags>
  </entry>
  <entry>
    <title>maven安装与配置idea配置maven</title>
    <url>/2020/05/03/maven%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AEidea%E9%85%8D%E7%BD%AEmaven/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="maven介绍"><a href="#maven介绍" class="headerlink" title="maven介绍"></a>maven介绍</h2><p>Apache Maven是一个软件项目管理和理解工具。基于项目对象模型（POM）的概念，Maven可以从中央信息管理项目的构建，报告和文档。<br>Maven是一个项目管理和整合的工具。Maven为开发者提供了一套完整的构建生命周期框架。开发团队基本不用花多少时间就能自动完成工程的基础构建配置，因为Maven使用了一个标准的目录结构和一个默认的构建生命周期。在创建报告、检查、构建和测试自动配置时，Maven可以让开发者的工作变得更简单。<br>官网：<a href="https://maven.apache.org/" target="_blank" rel="noopener">https://maven.apache.org/</a></p>
<h2 id="下载与安装"><a href="#下载与安装" class="headerlink" title="下载与安装"></a>下载与安装</h2><p>1.下载：<a href="https://maven.apache.org/download.cgi" target="_blank" rel="noopener">https://maven.apache.org/download.cgi</a><br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://www.zhangpeng.fun/upload/2020/05/Snipaste_2020-05-03_22-08-30-e054caf2efd14a5bbd157f7678a25a87.png" alt="Snipaste_2020-05-03_22-08-30"><br>2.安装<br>next<br>我的路径：D:\java\maven\apache-maven-3.6.2</p>
<h2 id="环境变量配置"><a href="#环境变量配置" class="headerlink" title="环境变量配置"></a>环境变量配置</h2><p>1.右击此电脑&gt;属性&gt;高级系统设置&gt;环境变量&gt;单击[新建(W)]添加以下环境变量<br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://www.zhangpeng.fun/upload/2020/05/Snipaste_2020-05-03_21-32-17-17f4088ae5bc4ee886779780704d189b.png" alt="Snipaste_2020-05-03_21-32-17"><br>2.新建环境变量<br>M2_HOME<br>D:\java\maven\apache-maven-3.6.2<br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://www.zhangpeng.fun/upload/2020/05/Snipaste_2020-05-03_22-13-28-1e1f407b86134790b3734495ec5d7777.png" alt="Snipaste_2020-05-03_22-13-28"><br>3.更新 PATH 变量，添加 Maven bin 文件夹到 PATH 的最后<br>Path<br>D:\java\maven\apache-maven-3.6.2\bin<br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://www.zhangpeng.fun/upload/2020/05/Snipaste_2020-05-03_22-14-36-7b23a71b9d4c4893a54520da2392990c.png" alt="Snipaste_2020-05-03_22-14-36"></p>
<h2 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h2><p>windows+r调出cmd窗口输入  mvn -v<br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://www.zhangpeng.fun/upload/2020/05/image-8dfa789d6490436fb27485bb5c582eac.png" alt="image.png"><br>成功</p>
<h2 id="settings文件修改"><a href="#settings文件修改" class="headerlink" title="settings文件修改"></a>settings文件修改</h2><p>（1）本地仓库（可选）<br>Default: ${user.home}/.m2/repository<br><localRepository>D:\java\repository\rep1</localRepository><br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://www.zhangpeng.fun/upload/2020/05/Snipaste_2020-05-03_22-26-19-d83c003d3b7f4991ae296213c83ec4dd.png" alt="Snipaste_2020-05-03_22-26-19"><br>（2）配置阿里云镜像仓库</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;mirror&gt;</span><br><span class="line">            &lt;id&gt;alimaven-central&lt;&#x2F;id&gt;</span><br><span class="line">            &lt;mirrorOf&gt;central&lt;&#x2F;mirrorOf&gt;</span><br><span class="line">            &lt;name&gt;aliyun maven&lt;&#x2F;name&gt;</span><br><span class="line">            &lt;url&gt;http:&#x2F;&#x2F;maven.aliyun.com&#x2F;nexus&#x2F;content&#x2F;repositories&#x2F;central&#x2F;&lt;&#x2F;url&gt;</span><br><span class="line">        &lt;&#x2F;mirror&gt;</span><br><span class="line">        </span><br><span class="line">  &lt;&#x2F;mirrors&gt;</span><br></pre></td></tr></table></figure>
<p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://www.zhangpeng.fun/upload/2020/05/Snipaste_2020-05-03_22-27-44-77c6ea7ac3a04d64a611e7dd1c373cf6.png" alt="Snipaste_2020-05-03_22-27-44"><br>（3）配置jdk版本</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;profile&gt;</span><br><span class="line">            &lt;id&gt;jdk18&lt;&#x2F;id&gt;</span><br><span class="line">            &lt;activation&gt;</span><br><span class="line">                &lt;jdk&gt;1.8&lt;&#x2F;jdk&gt;</span><br><span class="line">                &lt;activeByDefault&gt;true&lt;&#x2F;activeByDefault&gt;</span><br><span class="line">            &lt;&#x2F;activation&gt;</span><br><span class="line">            &lt;properties&gt;</span><br><span class="line">                &lt;maven.compiler.source&gt;1.8&lt;&#x2F;maven.compiler.source&gt;</span><br><span class="line">                &lt;maven.compiler.target&gt;1.8&lt;&#x2F;maven.compiler.target&gt;</span><br><span class="line">                &lt;maven.compiler.compilerVersion&gt;1.8&lt;&#x2F;maven.compiler.compilerVersion&gt;</span><br><span class="line">            &lt;&#x2F;properties&gt;</span><br><span class="line">        &lt;&#x2F;profile&gt;</span><br></pre></td></tr></table></figure>
<p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://www.zhangpeng.fun/upload/2020/05/Snipaste_2020-05-03_22-27-53-ad6d6ea2d6c047d29dfeee9837523a27.png" alt="Snipaste_2020-05-03_22-27-53"></p>
<h2 id="idea配置maven"><a href="#idea配置maven" class="headerlink" title="idea配置maven"></a>idea配置maven</h2><p>File-settings-Build，Excution，Deployment-BuildTools-Maven<br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://www.zhangpeng.fun/upload/2020/05/Snipaste_2020-05-03_22-22-29-0f8e492bb6fb41aa80faeb535f21c6f2.png" alt="Snipaste_2020-05-03_22-22-29"></p>
]]></content>
      <categories>
        <category>工具</category>
      </categories>
      <tags>
        <tag>maven</tag>
        <tag>idea</tag>
      </tags>
  </entry>
  <entry>
    <title>wlop画的画真的超级好看呀</title>
    <url>/2020/04/18/wlop%E7%94%BB%E7%9A%84%E7%94%BB%E7%9C%9F%E7%9A%84%E8%B6%85%E7%BA%A7%E5%A5%BD%E7%9C%8B%E5%91%80/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="WLOP"><a href="#WLOP" class="headerlink" title="WLOP"></a>WLOP</h2><p>&emsp;&emsp;个人非常的喜欢收集各种类型的图片，没事的时候拿出来看看，感觉非常的舒心。对于wlop这个人不怎么了解，但是他的画是真的好看呀！<br/><br>&emsp;&emsp;抽出时间用pr做了一个视频，放到了B站上。</p>
<iframe id="spkj" src="https://player.bilibili.com/player.html?aid=455247425&bvid=BV1i5411t7oY&cid=175655266&page=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true" width=100%> </iframe>
<script type="text/javascript">  
document.getElementById("spkj").style.height=document.getElementById("spkj").scrollWidth*0.76+"px";
</script>


<iframe id="spkjj" src="https://player.bilibili.com/player.html?aid=967734713&bvid=BV1Up4y1C7gQ&cid=175813580&page=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true" width=100%> </iframe>
<script type="text/javascript">  
document.getElementById("spkjj").style.height=document.getElementById("spkj").scrollWidth*0.76+"px";
</script>




<h2 id="artstation"><a href="#artstation" class="headerlink" title="artstation"></a>artstation</h2><p>&emsp;&emsp;最早是在artstation（<a href="https://www.artstation.com/" target="_blank" rel="noopener">https://www.artstation.com/</a>）上看到的他的画，非常喜欢，便收集来做壁纸了，哈哈。这个网站需要翻墙才能进去，里面的大神非常的多，虽然我不是从事这个行业，但是非常的喜欢。<br/><br>有这种的<br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://www.zhangpeng.fun/upload/2020/04/jwhs_W2kQP3%201567733352j-won-han-234231221222-8480818490c74f6f991b84a53ed487f1.jpg" alt="jwhs_W2kQP3 1567733352j-won-han-234231221222"><br/><br>这种的<br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://www.zhangpeng.fun/upload/2020/04/tohad_qAgNm2%201585776214sylvain-sarrailh-yoshiexotic-1343f59c8ff64ca298d2fa1c2b433e48.jpg" alt="tohad_qAgNm2 1585776214sylvain-sarrailh-yoshiexotic"><br/><br>或者是这种的<br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://www.zhangpeng.fun/upload/2020/04/syy1983_bambxd%201555770386sui-yangyang-dragon3-40cc726b2ba44e2f8c9b62c225ec4fa6.jpg" alt="syy1983_bambxd 1555770386sui-yangyang-dragon3"><br/><br>各种各样的，真的是佩服这些人的想象力！</p>
<h2 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h2><p>artstation这么多图片，想下载怎么办，答案,豆皮图片下载器，批量下载哈哈。<br>首先打开想要下载的某个人的主页，复制地址<br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://www.zhangpeng.fun/upload/2020/04/Snipaste_2020-04-12_01-01-05-701fed33e1a8439ba544ecab0b7a1c04.jpg" alt="Snipaste_20200412_010105.jpg"><br>打开豆皮图片下载器，填入地址，选择输出文件夹。开始下载。<br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://www.zhangpeng.fun/upload/2020/04/image-7df1fd173d194de7b12ff5f887f47310.png" alt="image.png"><br>这样这个人的所有作品都会下载下来了。</p>
]]></content>
      <categories>
        <category>分享</category>
      </categories>
      <tags>
        <tag>wlop</tag>
        <tag>图片</tag>
      </tags>
  </entry>
  <entry>
    <title>入门three.js</title>
    <url>/2020/04/20/%E5%85%A5%E9%97%A8three.js/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>突然感觉three.js挺有意思的，简单入门了一下three.js，但是并没有打算深入学习。</p>
<h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>&emsp;&emsp;three.js是JavaScript编写的WebGL第三方库。提供了非常多的3D显示功能。<br>&emsp;&emsp;Three.js 是一款运行在浏览器中的 3D 引擎，你可以用它创建各种三维场景，包括了摄影机、光影、材质等各种对象。你可以在它的主页上看到许多精彩的演示。不过，这款引擎还处在比较不成熟的开发阶段，其不够丰富的 API 以及匮乏的文档增加了初学者的学习难度（尤其是文档的匮乏）three.js的代码托管在github上面。<br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://www.zhangpeng.fun/upload/2020/04/image-1481693e51244af7af24d3ec2ace6dfb.png" alt="image.png"><br>官网：<a href="https://threejs.org/" target="_blank" rel="noopener">https://threejs.org/</a></p>
<p>Github：<a href="https://github.com/mrdoob/three.js/" target="_blank" rel="noopener">https://github.com/mrdoob/three.js/</a></p>
<p>目录结构：<br>Build目录：包含两个文件，three.js 和three.min.js 。这是three.js最终被引用的文件。一个已经压缩，一个没有压缩的js文件。</p>
<p>Docs目录：这里是three.js的帮助文档，里面是各个函数的api，可惜并没有详细的解释。试图用这些文档来学会three.js是不可能的。</p>
<p>Editor目录：一个类似3D-max的简单编辑程序，它能创建一些三维物体。</p>
<p>Examples目录：一些很有趣的例子demo，可惜没有文档介绍。对图像学理解不深入的同学，学习成本非常高。</p>
<p>Src目录：源代码目录，里面是所有源代码。</p>
<p>Test目录：一些测试代码，基本没用。</p>
<p>Utils目录：存放一些脚本，python文件的工具目录。例如将3D-Max格式的模型转换为three.js特有的json模型。</p>
<p>.gitignore文件：git工具的过滤规则文件，没有用。</p>
<p>CONTRIBUTING.md文件：一个怎么报bug，怎么获得帮助的说明文档。</p>
<p>LICENSE文件：版权信息。</p>
<p>README.md文件：介绍three.js的一个文件，里面还包含了各个版本的更新内容列表。</p>
<h2 id="入门程序"><a href="#入门程序" class="headerlink" title="入门程序"></a>入门程序</h2><ol>
<li><p>下载three.js</p>
</li>
<li><p>导入three.js</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;script src&#x3D;&quot;js&#x2F;three.js&quot;&gt;&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>三大组件<br>在Three.js中，要渲染物体到网页中，我们需要3个组建：场景（scene）、相机（camera）和渲染器（renderer）。有了这三样东西，才能将物体渲染到网页中去。<br>创建这三要素的代码如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">var scene &#x3D; new THREE.Scene();	&#x2F;&#x2F; 场景</span><br><span class="line">var camera &#x3D; new THREE.PerspectiveCamera(75, window.innerWidth&#x2F;window.innerHeight, 0.1, 1000);&#x2F;&#x2F; 透视相机</span><br><span class="line">var renderer &#x3D; new THREE.WebGLRenderer();	&#x2F;&#x2F; 渲染器</span><br><span class="line">renderer.setSize(window.innerWidth, window.innerHeight);	&#x2F;&#x2F; 设置渲染器的大小为窗口的内宽度，也就是内容区的宽度</span><br><span class="line">document.body.appendChild(renderer.domElement);</span><br></pre></td></tr></table></figure>


</li>
</ol>
<p>在Threejs中场景就只有一种，用THREE.Scene来表示，要构件一个场景也很简单，只要new一个对象就可以了，代码如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">var scene &#x3D; new THREE.Scene();</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>相机<br>另一个组建是相机，相机决定了场景中那个角度的景色会显示出来。相机就像人的眼睛一样，人站在不同位置，抬头或者低头都能够看到不同的景色。</li>
</ol>
<p>场景只有一种，但是相机却又很多种。和现实中一样，不同的相机确定了呈相的各个方面。比如有的相机适合人像，有的相机适合风景，专业的摄影师根据实际用途不一样，选择不同的相机。对程序员来说，只要设置不同的相机参数，就能够让相机产生不一样的效果。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">var camera &#x3D; new THREE.PerspectiveCamera(75, window.innerWidth&#x2F;window.innerHeight, 0.1, 1000);</span><br></pre></td></tr></table></figure>
<p>5.渲染器<br>最后一步就是设置渲染器，渲染器决定了渲染的结果应该画在页面的什么元素上面，并且以怎样的方式来绘制。这里我们定义了一个WebRenderer渲染器，代码如下所示：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">var renderer &#x3D; new THREE.WebGLRenderer();</span><br><span class="line">renderer.setSize(window.innerWidth, window.innerHeight);</span><br><span class="line">document.body.appendChild(renderer.domElement);</span><br></pre></td></tr></table></figure>

<p>6.渲染<br>渲染应该使用渲染器，结合相机和场景来得到结果画面。实现这个功能的函数是</p>
<p>renderer.render(scene, camera);</p>
<p>渲染函数的原型如下：</p>
<p>render( scene, camera, renderTarget, forceClear )</p>
<p>各个参数的意义是：</p>
<p>scene：前面定义的场景</p>
<p>camera：前面定义的相机</p>
<p>renderTarget：渲染的目标，默认是渲染到前面定义的render变量中</p>
<p>forceClear：每次绘制之前都将画布的内容给清除，即使自动清除标志autoClear为false，也会清除。</p>
<p>7.完整代码</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;&lt;&#x2F;title&gt;</span><br><span class="line">    &lt;style&gt;canvas &#123; width: 100%; height: 100% &#125;&lt;&#x2F;style&gt;</span><br><span class="line">    &lt;script src&#x3D;&quot;js&#x2F;three.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;script&gt;</span><br><span class="line">        var scene &#x3D; new THREE.Scene();</span><br><span class="line">        </span><br><span class="line">        var camera &#x3D; new THREE.PerspectiveCamera(75, window.innerWidth&#x2F;window.innerHeight, 0.1, 1000);</span><br><span class="line">        </span><br><span class="line">        var renderer &#x3D; new THREE.WebGLRenderer();</span><br><span class="line">        </span><br><span class="line">        renderer.setSize(window.innerWidth, window.innerHeight);</span><br><span class="line">        </span><br><span class="line">        document.body.appendChild(renderer.domElement);</span><br><span class="line">        var geometry &#x3D; new THREE.CubeGeometry(1,1,1);</span><br><span class="line">        var material &#x3D; new THREE.MeshBasicMaterial(&#123;color: 0x00ff00&#125;);</span><br><span class="line">        var cube &#x3D; new THREE.Mesh(geometry, material); scene.add(cube);</span><br><span class="line">        camera.position.z &#x3D; 5;</span><br><span class="line">        function render() &#123;</span><br><span class="line">            requestAnimationFrame(render);</span><br><span class="line">            cube.rotation.x +&#x3D; 0.1;</span><br><span class="line">            cube.rotation.y +&#x3D; 0.1;</span><br><span class="line">            renderer.render(scene, camera);</span><br><span class="line">        &#125;</span><br><span class="line">        render();</span><br><span class="line">    &lt;&#x2F;script&gt;</span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>
<h2 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h2><p>官网全部示例：<a href="https://threejs.org/examples/#webgl_animation_cloth" target="_blank" rel="noopener">https://threejs.org/examples/#webgl_animation_cloth</a></p>
]]></content>
      <categories>
        <category>前端</category>
      </categories>
      <tags>
        <tag>three.js</tag>
      </tags>
  </entry>
  <entry>
    <title>关于我</title>
    <url>/2020/05/01/%E5%85%B3%E4%BA%8E%E6%88%91/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h3 id="1-订阅："><a href="#1-订阅：" class="headerlink" title="1.订阅："></a>1.订阅：</h3><p>网站：<a href="https://www.zhangpeng.fun/" target="_blank" rel="noopener">https://www.zhangpeng.fun/</a></p>
<p>公众号：爱敲代码的鹏</p>
<p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://www.zhangpeng.fun/upload/2020/04/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88-81e85115b3a2458fae718b858a0680da.png" alt="扫码_搜索联合传播样式-标准色版"></p>
<p>小程序：爱敲代码的我</p>
<p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://www.zhangpeng.fun/upload/2020/04/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88-1eba896f22fd4b409edd064695228758.png" alt="扫码_搜索联合传播样式-标准色版"></p>
<p>app（安卓.苹果）：</p>
<p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://www.zhangpeng.fun/upload/2020/04/app-e8bc0b4c209c4ecfa5fb6c8d70ab9b45.png" alt="app"></p>
<p>抖音：</p>
<p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://www.zhangpeng.fun/upload/2020/04/%E6%8A%96%E9%9F%B33-ee272066c20242c2b559967f64173e93.jpg" alt="抖音3"></p>
<p>B站：<a href="https://space.bilibili.com/106097751" target="_blank" rel="noopener">https://space.bilibili.com/106097751</a><br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://www.zhangpeng.fun/upload/2020/04/bzhan-71bc0f420d554893bdd69ae0fadf6ecc.png" alt="bzhan"></p>
<h3 id="2-关于："><a href="#2-关于：" class="headerlink" title="2.关于："></a>2.关于：</h3><p>刚刚毕业的计算机专业的大学生，Java开发程序员一枚。<br/></p>
<p>邮箱：<a href="mailto:zpeng_it@163.com">zpeng_it@163.com</a><br/></p>
<p>微信：</p>
<p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://www.zhangpeng.fun/upload/2020/04/image-d0b96c5b99304fda9bc3fb49ed8b33d2.png" alt="image.png"><br/><br>Github：<a href="https://github.com/zhangpengpeng69" target="_blank" rel="noopener">https://github.com/zhangpengpeng69</a><br/><br>博客：<a href="https://www.zhangpeng.fun/" target="_blank" rel="noopener">https://www.zhangpeng.fun/</a><br/><br>Github博客：<a href="https://github.com/zhangpengpeng69/ZPeng-s-Blog" target="_blank" rel="noopener">https://github.com/zhangpengpeng69/ZPeng-s-Blog</a><br/></p>
<h3 id="3-本博客："><a href="#3-本博客：" class="headerlink" title="3.本博客："></a>3.本博客：</h3><p>Halo：<a href="https://github.com/halo-dev/halo" target="_blank" rel="noopener">https://github.com/halo-dev/halo</a>  –是一款现代化的个人独立博客系统<br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://www.zhangpeng.fun/upload/2020/04/image-6500355f16f0478cb6659923e204170d.png" alt="image.png"><br>社区：<a href="https://bbs.halo.run/" target="_blank" rel="noopener">https://bbs.halo.run/</a><br/><br>官网：<a href="https://halo.run/" target="_blank" rel="noopener">https://halo.run/</a></p>
<h3 id="4-留言："><a href="#4-留言：" class="headerlink" title="4.留言："></a>4.留言：</h3><p>在下方留言加友链&gt;&gt;&gt;&gt;&gt;&gt;</p>
]]></content>
      <categories>
        <category>myblog</category>
      </categories>
      <tags>
        <tag>me</tag>
      </tags>
  </entry>
  <entry>
    <title>关于本站</title>
    <url>/2020/05/01/%E5%85%B3%E4%BA%8E%E6%9C%AC%E7%AB%99/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="关于本站"><a href="#关于本站" class="headerlink" title="关于本站"></a>关于本站</h1><blockquote>
<p>1.本网站2019年12月上线;<br/><br> 2 访问网址: <a href="https://www.zhangpeng.fun/" target="_blank" rel="noopener">https://www.zhangpeng.fun/</a><br/><br> 3.本站为个人博客网站,由本人个人维护,仅为学习所用;<br/><br> 4.网站源码并不是完全由本人开发,取自github开源项目;<br/><br> 5.本站所有文章并非全部个人原创,由本人整理发布,如有错误，请谅解;<br/><br> 6.博客中转载文章会写明来源，如果有异议，请及时联系我处理;<br/><br> 6.本网站部署在阿里云服务器,配置不高,有时加载会慢一些;<br/><br> 7.希望多多评论呦!<br/></p>
</blockquote>
<h3 id="感谢"><a href="#感谢" class="headerlink" title="感谢:"></a>感谢:</h3><p><a href="https://github.com/halo-dev/halo" target="_blank" rel="noopener">https://github.com/halo-dev/halo</a></p>
<p><a href="http://www.tedu.cn/" target="_blank" rel="noopener">http://www.tedu.cn/</a></p>
]]></content>
      <categories>
        <category>myblog</category>
      </categories>
      <tags>
        <tag>me</tag>
      </tags>
  </entry>
  <entry>
    <title>喜欢收集图片的小伙伴点进来（artstation+pixiv）</title>
    <url>/2020/04/19/%E5%96%9C%E6%AC%A2%E6%94%B6%E9%9B%86%E5%9B%BE%E7%89%87%E7%9A%84%E5%B0%8F%E4%BC%99%E4%BC%B4%E7%82%B9%E8%BF%9B%E6%9D%A5%EF%BC%88artstation+pixiv%EF%BC%89/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>本文介绍电脑vpn的配置，以及artstation和pixiv两个网站图片的批量下载方法。</p>
<h2 id="一、介绍"><a href="#一、介绍" class="headerlink" title="一、介绍"></a>一、介绍</h2><blockquote>
<p><strong>1.artstation</strong> &nbsp;(<a href="https://www.artstation.com/" target="_blank" rel="noopener">https://www.artstation.com/</a>)</p>
</blockquote>
<p>ArtStation是综合CG视觉艺术网站，集游戏、电影、媒体和娱乐等行业的主流艺术作品展示平台。为用户展示图片、视频、模型等CG设计作品。又名A站。<br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://www.zhangpeng.fun/upload/2020/04/A%E7%AB%99%E9%A6%96%E9%A1%B5-ffef61d3b55d41b3a42f189dae333ccd.jpg" alt="A站首页"><br>这里有很多厉害的人物<br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://www.zhangpeng.fun/upload/2020/04/A%E7%AB%99%E4%BA%BA%E7%89%A9%E9%A1%B5-a4432d30ec724fa7b269acd6f67c1f8b.jpg" alt="A站人物页"></p>
<blockquote>
<p><strong>2.pixiv</strong>&nbsp;(<a href="https://www.pixiv.net/" target="_blank" rel="noopener">https://www.pixiv.net/</a>)</p>
</blockquote>
<p>Pixiv，是一个主要由日本艺术家所组成的虚拟社群，主体为由pixiv股份制有限公司所运营的为插画艺术特化的社交网络服务网站。新兴的日本同人画、插画作品分享站点。采用了web2.0的方式，每个参与者都有自己的主页并可以对作品评价打分。又名P站。<br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://www.zhangpeng.fun/upload/2020/04/P%E7%AB%99%E9%A6%96%E9%A1%B5-d9c797907a4043e2a4eb28e84942b1d2.jpg" alt="P站首页"><br>这里也有很多的厉害的人物啦<br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://www.zhangpeng.fun/upload/2020/04/P%E7%AB%99%E4%BA%BA%E7%89%A9%E9%A1%B5-9fd95bc7c09141b38c6ca9faced68e7c.jpg" alt="P站人物页"></p>
<h2 id="二、翻墙"><a href="#二、翻墙" class="headerlink" title="二、翻墙"></a>二、翻墙</h2><p>有的小伙伴可能已经发现了，网站进不去，需要翻墙怎么办？</p>
<blockquote>
<p>1.自己搭建，购买vps（谷歌云、搬瓦工等）+安装V2Ray+客户端配置，这种方法较复杂，我也不是用的这种方法，所以这里就不多介绍了。有时间自己买个vps玩一下，再写一篇详细的教程。</p>
</blockquote>
<blockquote>
<p>2.插件</p>
</blockquote>
<p>1）谷歌商店插件<br>首先安装Google Helper谷歌上网助手<br>可以让你访问 Google、Gmail 等，装了它你就可以自由的使用 Chrome 应用商店了。<br>插件地址：<a href="http://googlehelper.net/" target="_blank" rel="noopener">http://googlehelper.net/</a><br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://www.zhangpeng.fun/upload/2020/04/image-aa5e4a92747040f49df8fe0ffc25f288.png" alt="image"><br>然后谷歌商店里搜索vpn插件<br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://www.zhangpeng.fun/upload/2020/04/%E8%B0%B7%E6%AD%8C%E5%95%86%E5%BA%97-e484f97436304d69ae29695b9aaaff77.png" alt="谷歌商店"></p>
<p>几款vpn插件推荐：Astar VPN；1clickVPN；Free VPN；uVPN；VeeVPN。<br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://www.zhangpeng.fun/upload/2020/04/vpn%E6%8E%A8%E8%8D%90-2bf36976c02d4fd0b9dbe14de3b4c22f.png" alt="vpn推荐"><br>哪个速度快，那就需要大家自己慢慢尝试了，尝试换换不同的插件，或者不同的节点。vpn插件同时只能开一个才有效果呦。<br>当然，有了vpn后，我们就不仅仅可以上这两个网站了，可以访问youtube、facebook等。<br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://www.zhangpeng.fun/upload/2020/04/youtobe%E9%A6%96%E9%A1%B5-fee29d383eac4fbf8ea2c3cb025592bb.jpg" alt="youtobe首页"><br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://www.zhangpeng.fun/upload/2020/04/facebook-5078df600eae4b67b8a48513449825c9.jpg" alt="facebook"></p>
<h2 id="三、图片下载"><a href="#三、图片下载" class="headerlink" title="三、图片下载"></a>三、图片下载</h2><p>应该有很多喜欢收集图片的小伙伴，如果我想下载A站和P站的图片，总不能一个一个点进去下载吧。下面介绍这两个网站批量下载图片的方法。</p>
<blockquote>
<p><strong>1.artstation</strong></p>
</blockquote>
<p>1）下载豆皮图片下载器<br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://www.zhangpeng.fun/upload/2020/04/%E8%B1%86%E7%9A%AE%E4%B8%8B%E8%BD%BD%E5%99%A8-5c32c82d8a5c45bc981b574d5c75b6e4.png" alt="豆皮下载器"></p>
<p>2）复制artstation上某位作家的地址<br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://www.zhangpeng.fun/upload/2020/04/A%E7%AB%99a-1f1eba64b83f4b06bc99f3ae1b7c774f.jpg" alt="A站a"></p>
<p>3）复制到豆皮下载器开始下载<br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://www.zhangpeng.fun/upload/2020/04/%E8%B1%86%E7%9A%AE-9d78aeadced84b36aeb70d10482af8fd.jpg" alt="豆皮"></p>
<blockquote>
<p><strong>2.pixiv</strong></p>
</blockquote>
<p>谷歌应用商店搜索pixiv批量下载插件<br>1）推荐：<a href="https://chrome.google.com/webstore/detail/powerful-pixiv-downloader/dkndmhgdcmjdmkdonmbgjpijejdcilfh" target="_blank" rel="noopener">Powerful Pixiv Downloader</a><br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://www.zhangpeng.fun/upload/2020/04/pdownloder-9008b652a6224d93a7b922360f172993.png" alt="pdownloder"></p>
<p>1）插件安装后会发现p站画家页面会多出来一个图标点击。<br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://www.zhangpeng.fun/upload/2020/04/p%E7%AB%99%E4%B8%8B%E8%BD%BD1-e7efada15cae4a35bbd5f5a7f845f686.jpg" alt="p站下载1"></p>
<p>2）第一种方法：直接配置-抓取-下载（浏览器下载）<br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://www.zhangpeng.fun/upload/2020/04/P%E7%AB%99%E4%B8%8B%E8%BD%BD3-9db5c38530664bd7bfff89ce33c67b65.jpg" alt="P站下载3"></p>
<p>3）第二种方法：复制url到第三方下载（我用的是idm）<br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://www.zhangpeng.fun/upload/2020/04/%E5%A4%8D%E5%88%B6url-2f3657f38045494280048b6ecc6d75ba.jpg" alt="复制url"><br>任务-剪贴板添加-选择文件-选择位置-确定<br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://www.zhangpeng.fun/upload/2020/04/p%E7%AB%99%E4%B8%8B%E8%BD%BDidm-31506abb01db485aabf4af049c8e4803.jpg" alt="p站下载idm"></p>
<p>这样图片就会批量下载好了，怎么样，是不是很简单。<br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://www.zhangpeng.fun/upload/2020/04/%E6%96%87%E4%BB%B6%E5%A4%B9-452ea4b79b8441a98e9fb20aceb9efbe.png" alt="文件夹"><br>小伙伴们赶快行动起来吧！</p>
]]></content>
      <categories>
        <category>分享</category>
      </categories>
      <tags>
        <tag>pixiv</tag>
        <tag>artstation</tag>
      </tags>
  </entry>
  <entry>
    <title>分布式锁</title>
    <url>/2020/04/04/%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="分布式锁"><a href="#分布式锁" class="headerlink" title="分布式锁"></a>分布式锁</h1><h2 id="1-什么是分布式锁？"><a href="#1-什么是分布式锁？" class="headerlink" title="1.什么是分布式锁？"></a>1.什么是分布式锁？</h2><p>&emsp;&emsp;分布式锁是控制分布式系统之间同步访问共享资源的一种方式。在分布式系统中，常常需要协调他们的动作。如果不同的系统或是同一个系统的不同主机之间共享了一个或一组资源，那么访问这些资源的时候，往往需要互斥来防止彼此干扰来保证一致性，在这种情况下，便需要使用到分布式锁。<br/><br>&emsp;&emsp;在分布式系统中，常常需要协调他们的动作。如果不同的系统或是同一个系统的不同主机之间共享了一个或一组资源，那么访问这些资源的时候，往往需要互斥来防止彼此干扰来保证一致性，这个时候，便需要使用到分布式锁。</p>
<h2 id="2-为什么要使用分布式锁"><a href="#2-为什么要使用分布式锁" class="headerlink" title="2.为什么要使用分布式锁"></a>2.为什么要使用分布式锁</h2><p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://www.zhangpeng.fun/upload/20191210_18202437.png" alt=""></p>
<ul>
<li>成员变量 A 存在 JVM1、JVM2、JVM3 三个 JVM 内存中<br/></li>
<li>成员变量 A 同时都会在 JVM 分配一块内存，三个请求发过来同时对这个变量操作，显然结果是不对的<br/></li>
<li>不是同时发过来，三个请求分别操作三个不同 JVM 内存区域的数据，变量 A 之间不存在共享，也不具有可见性，处理的结果也是不对的<br/><br>注：该成员变量 A 是一个有状态的对象<br/><br>&emsp;&emsp;如果我们业务中确实存在这个场景的话，我们就需要一种方法解决这个问题，这就是分布式锁要解决的问题<br/></li>
</ul>
<p>分布式锁的具体实现方案有如下三种：</p>
<ol>
<li>基于数据库实现；</li>
<li>基于缓存（Redis等）实现；</li>
<li>基于Zookeeper实现；</li>
</ol>
<h2 id="3-基于数据库实现"><a href="#3-基于数据库实现" class="headerlink" title="3.基于数据库实现"></a>3.基于数据库实现</h2><ul>
<li><p>锁设计:数据库中的表有主键,主键不能重复,如果插入一个重复的主键.,则数据库必然报错.</p>
</li>
<li><p>数据库加锁: 向主键添加一个固定值 1;</p>
</li>
<li><p>数据库解锁: 从表中删除主键固定值1;</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jt.lock;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.Condition;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.Lock;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Qualifier;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.jt.mapper.MysqlMapper;</span><br><span class="line"><span class="meta">@Service</span>(<span class="string">"mysqlLock"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MysqlLock</span> <span class="keyword">implements</span> <span class="title">Lock</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> MysqlMapper mapper;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//表示尝试加锁</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">tryLock</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			mapper.insert();  <span class="comment">//向数据库中插入记录 定值</span></span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;	 <span class="comment">//加锁失败</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">true</span>;		 <span class="comment">//加锁成功!!!</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//表示加锁机制</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">lock</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(tryLock()) &#123;</span><br><span class="line">			<span class="comment">//表示加锁成功</span></span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			Thread.sleep(<span class="number">100</span>);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">			<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		lock();</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">unlock</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		</span><br><span class="line">		mapper.delete();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">lockInterruptibly</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">tryLock</span><span class="params">(<span class="keyword">long</span> time, TimeUnit unit)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Condition <span class="title">newCondition</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.Lock;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.ReentrantLock;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Qualifier;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringRunner;</span><br><span class="line"></span><br><span class="line"><span class="comment">//模拟窗口卖票业务</span></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="meta">@RunWith</span>(SpringRunner<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">MysqlLockTest</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> num = <span class="number">100</span>;</span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="meta">@Qualifier</span>(<span class="string">"mysqlLock"</span>)</span><br><span class="line">	<span class="keyword">private</span> Lock lock;</span><br><span class="line"></span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">window</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">		<span class="comment">//定义线程卖票操作</span></span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">			<span class="keyword">while</span>(<span class="keyword">true</span>) &#123;</span><br><span class="line">				<span class="keyword">try</span> &#123;</span><br><span class="line">					lock.lock();</span><br><span class="line">					<span class="keyword">if</span>(num&gt;<span class="number">0</span>) &#123;</span><br><span class="line">						System.out.println(Thread.currentThread().getName()+<span class="string">"卖出第"</span>+(<span class="number">101</span>-num)+<span class="string">"张票"</span>);</span><br><span class="line">						num--;</span><br><span class="line">						Thread.sleep(<span class="number">100</span>);</span><br><span class="line">					&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">						<span class="keyword">break</span>;<span class="comment">//跳出循环</span></span><br><span class="line">					&#125;</span><br><span class="line">					</span><br><span class="line">				&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">					e.printStackTrace();</span><br><span class="line">				&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">					lock.unlock();</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test01</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		Runnable window = <span class="keyword">new</span> window();</span><br><span class="line">		Thread thread1 = <span class="keyword">new</span> Thread(window, <span class="string">"窗口A"</span>);</span><br><span class="line">		Thread thread2 = <span class="keyword">new</span> Thread(window, <span class="string">"窗口B"</span>);</span><br><span class="line">		Thread thread3 = <span class="keyword">new</span> Thread(window, <span class="string">"窗口C"</span>);</span><br><span class="line">		thread1.start();</span><br><span class="line">		thread2.start();</span><br><span class="line">		thread3.start();</span><br><span class="line">		<span class="keyword">for</span>(;;); <span class="comment">//防止线程提前结束</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="4-基于redis实现"><a href="#4-基于redis实现" class="headerlink" title="4.基于redis实现"></a>4.基于redis实现</h2><p>Redis锁的设计理念:</p>
<p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://www.zhangpeng.fun/upload/20191210_18290981.png" alt=""></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jt.lock;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.UUID;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.Condition;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.Lock;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.StringUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.jt.mapper.MysqlMapper;</span><br><span class="line"><span class="keyword">import</span> com.jt.stream.LuaStream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.JedisCluster;</span><br><span class="line"><span class="meta">@Component</span>(<span class="string">"redisLock"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisLock</span> <span class="keyword">implements</span> <span class="title">Lock</span></span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> JedisCluster jedisCluster;</span><br><span class="line">	<span class="keyword">private</span> ThreadLocal&lt;String&gt; thread = <span class="keyword">new</span> ThreadLocal&lt;&gt;();</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String key = <span class="string">"JT_LOCK"</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//表示尝试加锁</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">tryLock</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			String value = UUID.randomUUID().toString();</span><br><span class="line">			String result = jedisCluster.set(key, value, <span class="string">"NX"</span>, <span class="string">"PX"</span>, <span class="number">800</span>);</span><br><span class="line">			<span class="keyword">if</span>(result.equalsIgnoreCase(<span class="string">"ok"</span>)) &#123;</span><br><span class="line">				thread.set(value);</span><br><span class="line">				<span class="keyword">return</span> <span class="keyword">true</span>;	<span class="comment">//加锁成功!!!</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;		<span class="comment">//加锁失败</span></span><br><span class="line">		&#125;	</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">false</span>;			<span class="comment">//加锁失败</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//表示加锁机制</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">lock</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(tryLock()) &#123;</span><br><span class="line">			<span class="comment">//表示加锁成功</span></span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			Thread.sleep(<span class="number">10</span>);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		lock();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">unlock</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		String	uuid = thread.get();</span><br><span class="line">		<span class="comment">//所以使用lua脚本实现.保证数据的原子性操作</span></span><br><span class="line">		String script = LuaStream.getLuaFileString();</span><br><span class="line">		jedisCluster.eval(script, Arrays.asList(key), Arrays.asList(uuid));</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">lockInterruptibly</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">tryLock</span><span class="params">(<span class="keyword">long</span> time, TimeUnit unit)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Condition <span class="title">newCondition</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>lua脚本</p>
<pre><code>if redis.call(&quot;get&quot;,KEYS[1]) == ARGV[1] then
    return redis.call(&quot;del&quot;,KEYS[1])
else
    return 0
end</code></pre><p>测试类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.Lock;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.ReentrantLock;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Qualifier;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringRunner;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.jt.thread.ThreadPool;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.JedisCluster;</span><br><span class="line"></span><br><span class="line"><span class="comment">//模拟窗口卖票业务</span></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="meta">@RunWith</span>(SpringRunner<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">RedislLockTest</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> num = <span class="number">5000</span>; <span class="comment">//模拟5000张火车票</span></span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="meta">@Qualifier</span>(<span class="string">"redisLock"</span>)</span><br><span class="line">	<span class="keyword">private</span> Lock lock;</span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> JedisCluster jedisCluster;</span><br><span class="line"></span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">window</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">		<span class="comment">//定义线程卖票操作</span></span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">			<span class="keyword">while</span>(<span class="keyword">true</span>) &#123;</span><br><span class="line">				lock.lock(); <span class="comment">//加锁</span></span><br><span class="line">					<span class="keyword">if</span>(num&gt;<span class="number">0</span>) &#123;</span><br><span class="line">						System.out.println(Thread.currentThread().getName()+<span class="string">"售出第"</span>+(<span class="number">5001</span>-num)+<span class="string">"张票"</span>);</span><br><span class="line">						String ticket = jedisCluster.hget(<span class="string">"windows"</span>,Thread.currentThread().getName());</span><br><span class="line">						jedisCluster.hset(<span class="string">"windows"</span>,Thread.currentThread().getName(), ticket+<span class="string">","</span>+(<span class="number">5001</span>-num));</span><br><span class="line">						num--;</span><br><span class="line">					&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">						<span class="keyword">break</span>;<span class="comment">//跳出循环</span></span><br><span class="line">					&#125;</span><br><span class="line">				lock.unlock(); <span class="comment">//解锁</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test01</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		Runnable window = <span class="keyword">new</span> window();</span><br><span class="line">		<span class="comment">//定义线程池 初始化10个线程</span></span><br><span class="line">		List&lt;Thread&gt; pools = ThreadPool.initPool(window,<span class="number">6</span>);</span><br><span class="line">		<span class="keyword">for</span> (Thread thread : pools) &#123;</span><br><span class="line">			thread.start();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">for</span>(;;); <span class="comment">//防止线程提前结束</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="5-其他锁例子"><a href="#5-其他锁例子" class="headerlink" title="5.其他锁例子"></a>5.其他锁例子</h2><p>lock</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.Lock;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.ReentrantLock;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="comment">//模拟窗口卖票业务</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LockTest</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> num = <span class="number">100</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//定义lock锁</span></span><br><span class="line">	<span class="keyword">private</span> Lock lock = <span class="keyword">new</span> ReentrantLock();</span><br><span class="line">	</span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">Windows</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line">		<span class="comment">//定义线程卖票操作</span></span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">			<span class="keyword">while</span>(<span class="keyword">true</span>) &#123;</span><br><span class="line">				lock.lock();	<span class="comment">//为线程加锁</span></span><br><span class="line">				<span class="keyword">if</span>(num&gt;<span class="number">0</span>) &#123;</span><br><span class="line">					System.out.println(<span class="string">"恭喜"</span>+Thread.currentThread().getName()+<span class="string">"售出得第"</span>+(<span class="number">101</span>-num)+<span class="string">"张票"</span>);</span><br><span class="line">					num--;</span><br><span class="line">					<span class="keyword">try</span> &#123;</span><br><span class="line">						Thread.sleep(<span class="number">50</span>);</span><br><span class="line">					&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">						e.printStackTrace();</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">					<span class="keyword">break</span>;<span class="comment">//跳出循环</span></span><br><span class="line">				&#125;</span><br><span class="line">				lock.unlock();	<span class="comment">//为线程减锁</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test01</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		Runnable runnable = <span class="keyword">new</span> Windows();</span><br><span class="line">		Thread thread1 = <span class="keyword">new</span> Thread(runnable, <span class="string">"窗口A"</span>);</span><br><span class="line">		Thread thread2 = <span class="keyword">new</span> Thread(runnable, <span class="string">"窗口B"</span>);</span><br><span class="line">		Thread thread3 = <span class="keyword">new</span> Thread(runnable, <span class="string">"窗口C"</span>);</span><br><span class="line">		thread1.start();</span><br><span class="line">		thread2.start();</span><br><span class="line">		thread3.start();</span><br><span class="line">		<span class="keyword">for</span>(;;); <span class="comment">//防止线程提前结束</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>synchronized</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="comment">//模拟窗口卖票业务</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SyncTest</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> num = <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">Windows</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line">		<span class="comment">//定义线程卖票操作</span></span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">			<span class="keyword">while</span>(<span class="keyword">true</span>) &#123;</span><br><span class="line">				<span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123;</span><br><span class="line">					<span class="keyword">if</span>(num&gt;<span class="number">0</span>) &#123;</span><br><span class="line">						System.out.println(<span class="string">"恭喜"</span>+Thread.currentThread().getName()+<span class="string">"售出得第"</span>+(<span class="number">101</span>-num)+<span class="string">"张票"</span>);</span><br><span class="line">						num--;</span><br><span class="line">						<span class="keyword">try</span> &#123;</span><br><span class="line">							Thread.sleep(<span class="number">50</span>);</span><br><span class="line">						&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">							e.printStackTrace();</span><br><span class="line">						&#125;</span><br><span class="line">					&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">						<span class="keyword">break</span>;<span class="comment">//跳出循环</span></span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test01</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		Runnable runnable = <span class="keyword">new</span> Windows();</span><br><span class="line">		Thread thread1 = <span class="keyword">new</span> Thread(runnable, <span class="string">"窗口A"</span>);</span><br><span class="line">		Thread thread2 = <span class="keyword">new</span> Thread(runnable, <span class="string">"窗口B"</span>);</span><br><span class="line">		Thread thread3 = <span class="keyword">new</span> Thread(runnable, <span class="string">"窗口C"</span>);</span><br><span class="line">		thread1.start();</span><br><span class="line">		thread2.start();</span><br><span class="line">		thread3.start();</span><br><span class="line">		<span class="keyword">for</span>(;;); <span class="comment">//防止线程提前结束</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>thread</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="comment">//模拟窗口卖票业务</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TicketTest</span></span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> num = <span class="number">100</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">Windows</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line">		<span class="comment">//定义线程卖票操作</span></span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">			<span class="keyword">while</span>(<span class="keyword">true</span>) &#123;</span><br><span class="line">				<span class="keyword">if</span>(num&gt;<span class="number">0</span>) &#123;</span><br><span class="line">					System.out.println(<span class="string">"恭喜"</span>+Thread.currentThread().getName()+<span class="string">"售出得第"</span>+(<span class="number">101</span>-num)+<span class="string">"张票"</span>);</span><br><span class="line">					num--;</span><br><span class="line">					<span class="keyword">try</span> &#123;</span><br><span class="line">						Thread.sleep(<span class="number">500</span>);</span><br><span class="line">					&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">						e.printStackTrace();</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">					<span class="keyword">break</span>;<span class="comment">//跳出循环</span></span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//模拟三个线程同时售卖100张车票</span></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test01</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		Runnable runnable = <span class="keyword">new</span> Windows();</span><br><span class="line">		Thread thread1 = <span class="keyword">new</span> Thread(runnable, <span class="string">"窗口A"</span>);</span><br><span class="line">		Thread thread2 = <span class="keyword">new</span> Thread(runnable, <span class="string">"窗口B"</span>);</span><br><span class="line">		Thread thread3 = <span class="keyword">new</span> Thread(runnable, <span class="string">"窗口C"</span>);</span><br><span class="line">		thread1.start();</span><br><span class="line">		thread2.start();</span><br><span class="line">		thread3.start();</span><br><span class="line">		<span class="keyword">for</span>(;;); <span class="comment">//防止线程提前结束</span></span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>后端</category>
      </categories>
      <tags>
        <tag>java</tag>
        <tag>分布式</tag>
      </tags>
  </entry>
  <entry>
    <title>命令行录制工具asciinema</title>
    <url>/2020/04/22/%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%BD%95%E5%88%B6%E5%B7%A5%E5%85%B7asciinema/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><blockquote>
<p>Record and share your terminal sessions, the right way.</p>
</blockquote>
<blockquote>
<p><strong>简单录制</strong><br>在终端上记录您的工作。要开始只是运行asciinema rec，完成使用Ctrl-D或输入exit即可</p>
</blockquote>
<blockquote>
<p><strong>复制粘贴</strong><br>每当您看到要在自己的终端中尝试的命令时，只需暂停播放器并复制粘贴所需的内容即可。毕竟只是文本！</p>
</blockquote>
<blockquote>
<p><strong>嵌入</strong><br>轻松地在博客文章，项目文档页面或会议演讲幻灯片中嵌入asciicast播放器。</p>
</blockquote>
<p>官网例子：</p>
<script id="asciicast-239367" src="https://asciinema.org/a/239367.js" async></script>


<p>官网：<a href="https://asciinema.org/" target="_blank" rel="noopener">https://asciinema.org/</a><br>官方教程：<a href="https://asciinema.org/docs/how-it-works" target="_blank" rel="noopener">https://asciinema.org/docs/how-it-works</a></p>
<h2 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h2><blockquote>
<p>前提：<br>1.了解服务器相关知识<br>2.注册网站账号</p>
</blockquote>
<p>1.在linux上安装asciinema<br>我的服务器系统为centos7，下面以这个为例，不同系统请参考官方详细安装文档。<br>#安装epel发行包<br>yum -y install epel-release<br>yum -y install asciinema</p>
<p>#用命令测试版本<br>asciinema –version</p>
<p>#安装expect命令 用于交互<br>yum -y install expect<br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://www.zhangpeng.fun/upload/2020/04/image-037157144b674b64bf12dffbcb3ea4cd.png" alt="image.png"><br>2. 录制</p>
<p>执行录制<br>asciinema rec test   （test为文件名，可自定义）</p>
<p>这里我先胡乱输入一些东西。<br>ctrl+d退出录屏，回车则上传录制内容到网站，ctrl+c可以保存到本地（后续也可以通过asciinema upload来上传）</p>
<p>执行播放<br>asciinema play test</p>
<p>上传asciinema upload test<br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://www.zhangpeng.fun/upload/2020/04/image-f80895e02e3942c4bcd74576ebef35a1.png" alt="image.png"></p>
<ol start="3">
<li><p>打开网址或者进入网站就会发现已经有这个东西了<br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://www.zhangpeng.fun/upload/2020/04/image-73db2980e9b24cab91abc27e3e428269.png" alt="image.png"></p>
</li>
<li><p>使用方法<br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://www.zhangpeng.fun/upload/2020/04/image-4e9cc7e47d24405781f2f85c3e6774cf.png" alt="image.png"></p>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Link</span><br><span class="line">https:&#x2F;&#x2F;asciinema.org&#x2F;a&#x2F;E9zOTdPU5eb1CoC9F8EXQdIVj</span><br><span class="line"></span><br><span class="line">Append ?t&#x3D;30 to start the playback at 30s, ?t&#x3D;3:20 to start the playback at 3m 20s.</span><br><span class="line"></span><br><span class="line">Embed image link</span><br><span class="line">Use snippets below to display a screenshot linking to this recording.</span><br><span class="line">Useful in places where scripts are not allowed (e.g. in a project&#39;s README file).</span><br><span class="line"></span><br><span class="line">HTML:</span><br><span class="line">&lt;a href&#x3D;&quot;https:&#x2F;&#x2F;asciinema.org&#x2F;a&#x2F;E9zOTdPU5eb1CoC9F8EXQdIVj&quot; target&#x3D;&quot;_blank&quot;&gt;&lt;img src&#x3D;&quot;https:&#x2F;&#x2F;asciinema.org&#x2F;a&#x2F;E9zOTdPU5eb1CoC9F8EXQdIVj.svg&quot; &#x2F;&gt;&lt;&#x2F;a&gt;</span><br><span class="line"></span><br><span class="line">Markdown:</span><br><span class="line">[![asciicast](https:&#x2F;&#x2F;asciinema.org&#x2F;a&#x2F;E9zOTdPU5eb1CoC9F8EXQdIVj.svg)](https:&#x2F;&#x2F;asciinema.org&#x2F;a&#x2F;E9zOTdPU5eb1CoC9F8EXQdIVj)</span><br><span class="line"></span><br><span class="line">Embed the player</span><br><span class="line">If you&#39;re embedding on your own page or on a site which permits script tags, you can use the full player widget:</span><br><span class="line"></span><br><span class="line">&lt;script id&#x3D;&quot;asciicast-E9zOTdPU5eb1CoC9F8EXQdIVj&quot; src&#x3D;&quot;https:&#x2F;&#x2F;asciinema.org&#x2F;a&#x2F;E9zOTdPU5eb1CoC9F8EXQdIVj.js&quot; async&gt;&lt;&#x2F;script&gt;</span><br><span class="line"></span><br><span class="line">Paste the above script tag where you want the player to be displayed on your page.</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>效果<script id="asciicast-E9zOTdPU5eb1CoC9F8EXQdIVj" src="https://asciinema.org/a/E9zOTdPU5eb1CoC9F8EXQdIVj.js" async></script>

</li>
</ol>
<p>6.结束</p>
]]></content>
      <categories>
        <category>工具</category>
      </categories>
      <tags>
        <tag>asciinema</tag>
      </tags>
  </entry>
  <entry>
    <title>内排序</title>
    <url>/2020/04/02/%E5%86%85%E6%8E%92%E5%BA%8F/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="内排序"><a href="#内排序" class="headerlink" title="内排序"></a>内排序</h1><p>　　排序使程序开发中一种常见的操作。将一组杂乱无章的数据按一定的规则将其排列好。使数据得以快速检索到，这就是排序的目的。<br>对于一个排序算法，一般可以从下面三个方面去衡量算法的优劣：</p>
<p>1) 时间复杂度：主要缝隙关键字的比较次数和移动字数；<br>2) 空间复杂度：缝隙排序算法中需要多少辅助内存；<br>3) 稳定性：当两个关键字相同，如果排序完成后两者的顺序保持不变，则是该排序算法是稳定。<br>　排序算法大致可以分为内部算法和外部算法。如果整个排序过程不需要借助于外部储存器（磁盘），所有的操作都在内存中完成，则称之为内部算法。如果参与排序树数据元素非常多，数据量非常大，则计算机必须借助外部储存器（如磁盘），这种排序称为外部排序。</p>
<h2 id="内部排序的分类"><a href="#内部排序的分类" class="headerlink" title="内部排序的分类"></a>内部排序的分类</h2><p>一般我们所说排序指的就是内部排序，常见的内部排序又可以分为6大类。</p>
<p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://182.92.171.224/upload/20191125_12321758.png" alt=""></p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> sort;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义一个数据包装类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DataWrap</span> <span class="keyword">implements</span> <span class="title">Comparable</span>&lt;<span class="title">DataWrap</span>&gt;</span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> data;</span><br><span class="line">    String flag;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DataWrap</span><span class="params">(<span class="keyword">int</span> data, String flag)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.data = data;</span><br><span class="line">        <span class="keyword">this</span>.flag = flag;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> data + flag;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 根据data实例变量来决定两个DataWrap的大小</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(DataWrap dw)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.data &gt; dw.data ? <span class="number">1</span></span><br><span class="line">            : (<span class="keyword">this</span>.data == dw.data ? <span class="number">0</span> : -<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="1-1-选择排序"><a href="#1-1-选择排序" class="headerlink" title="1.1 选择排序"></a>1.1 选择排序</h2><p>选择排序方法有两种，直接选择排序和堆排序。直接选择排序简单直观，但是性能较差；堆排序较为高效，但是实现起来较为复杂。</p>
<h3 id="1-1-1-直接选择排序"><a href="#1-1-1-直接选择排序" class="headerlink" title="1.1.1 直接选择排序"></a>1.1.1 直接选择排序</h3><p>直接选择排序思想：程序遍历n个数，然后比较出最大的一个与最后一个数进行交换，最大值确定好了；接下来遍历n-1，找个这n-1个数中的最大值并且交换位置，直至n=0位置。<br>该排序方法的数据交换次数是，但是比较次数较多。总的时间效率是。空间效率是，并且算法不稳定。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> sort;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SelectSort</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">selectSort</span><span class="params">(DataWrap[] data)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"开始排序"</span>);</span><br><span class="line">        <span class="keyword">int</span> arrayLength = data.length;</span><br><span class="line">        <span class="comment">// 依次进行n-1趟比较, 第i趟比较将第i大的值选出放在i位置上。</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; arrayLength - <span class="number">1</span> ; i++ )</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// minIndex永远保留本趟比较中最小值的索引</span></span><br><span class="line">            <span class="keyword">int</span> minIndex = i ;</span><br><span class="line">            <span class="comment">// 第i个数据只需和它后面的数据比较</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = i + <span class="number">1</span> ; j &lt; arrayLength ; j++ )</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// 如果第minIndex位置的数据 &gt; j位置的数据</span></span><br><span class="line">                <span class="keyword">if</span> (data[minIndex].compareTo(data[j]) &gt; <span class="number">0</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">// 将j的值赋给minIndex</span></span><br><span class="line">                    minIndex = j;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 每趟比较最多交换一次</span></span><br><span class="line">            <span class="keyword">if</span> (minIndex != i)</span><br><span class="line">            &#123;</span><br><span class="line">                DataWrap tmp = data[i];</span><br><span class="line">                data[i] = data[minIndex];</span><br><span class="line">                data[minIndex] = tmp;</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(java.util.Arrays.toString(data));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        DataWrap[] data = &#123;</span><br><span class="line">            <span class="keyword">new</span> DataWrap(<span class="number">21</span> , <span class="string">""</span>),</span><br><span class="line">            <span class="keyword">new</span> DataWrap(<span class="number">30</span> , <span class="string">""</span>),</span><br><span class="line">            <span class="keyword">new</span> DataWrap(<span class="number">49</span> , <span class="string">""</span>),</span><br><span class="line">            <span class="keyword">new</span> DataWrap(<span class="number">30</span> , <span class="string">"*"</span>),</span><br><span class="line">            <span class="keyword">new</span> DataWrap(<span class="number">16</span> , <span class="string">""</span>),</span><br><span class="line">            <span class="keyword">new</span> DataWrap(<span class="number">9</span> , <span class="string">""</span>)</span><br><span class="line">        &#125;;</span><br><span class="line">        System.out.println(<span class="string">"排序之前：\n"</span></span><br><span class="line">            + java.util.Arrays.toString(data));</span><br><span class="line">        selectSort(data);</span><br><span class="line">        System.out.println(<span class="string">"排序之后：\n"</span></span><br><span class="line">            + java.util.Arrays.toString(data));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-1-2-堆排序"><a href="#1-1-2-堆排序" class="headerlink" title="1.1.2 堆排序"></a>1.1.2 堆排序</h3><p>堆排序的思路：将数据建立成最大（小）堆，将根节点与最后一个节点交换；重复上面的过程。<br>1）堆树是一颗完全二叉树；<br>2）堆树中某个节点的值总是不大于或不小于其孩子节点的值；<br>3）堆树中每个节点的子树都是堆树。<br>当父节点的键值总是大于或等于任何一个子节点的键值时为最大堆。 当父节点的键值总是小于或等于任何一个子节点的键值时为最小堆。如下图所示，左边为最大堆，右边为最小堆。<br>引用：<a href="https://www.cnblogs.com/zf-blog/p/9010977.html" target="_blank" rel="noopener">https://www.cnblogs.com/zf-blog/p/9010977.html</a><br>堆排序是选择算法的改进，可以减少选择排序中的比较次数，进而减少排序时间。对于堆排序来说，有n个数据，需要进行n-1次建堆，每次建堆本身耗时为,所以其时间效率为，堆排序是不稳定的。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> sort;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HeapSort</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">heapSort</span><span class="params">(DataWrap[] data)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"开始排序"</span>);</span><br><span class="line">        <span class="keyword">int</span> arrayLength=data.length;</span><br><span class="line">        <span class="comment">//循环建堆</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;arrayLength-<span class="number">1</span>;i++) &#123;</span><br><span class="line">            <span class="comment">//建堆</span></span><br><span class="line">            buildMaxdHeap(data,arrayLength-<span class="number">1</span>-i);</span><br><span class="line">            <span class="comment">//交换堆与最后一个的数据</span></span><br><span class="line">            swap(data,<span class="number">0</span>,arrayLength-<span class="number">1</span>-i);</span><br><span class="line">            System.out.println(java.util.Arrays.toString(data));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">swap</span><span class="params">(DataWrap[] data, <span class="keyword">int</span> i, <span class="keyword">int</span> j)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">        DataWrap tmp=data[i];</span><br><span class="line">        data[i]=data[j];</span><br><span class="line">        data[j]=tmp;</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">buildMaxdHeap</span><span class="params">(DataWrap[] data, <span class="keyword">int</span> lastIndex)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//从lastIndex出节点(最后一个)的父节点开始</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=(lastIndex-<span class="number">1</span>)/<span class="number">2</span>;i&gt;+<span class="number">0</span>;i--) &#123;</span><br><span class="line">            <span class="comment">//k保存当前正在判断的点</span></span><br><span class="line">            <span class="keyword">int</span> k=i;</span><br><span class="line">            <span class="comment">//如果当前K节点的子节点存在</span></span><br><span class="line">            <span class="keyword">while</span>(k*<span class="number">2</span>+<span class="number">1</span>&lt;=lastIndex) &#123;</span><br><span class="line">                <span class="comment">//k节点的左子节点的索引</span></span><br><span class="line">                <span class="keyword">int</span> biggerIndex=<span class="number">2</span>*k+<span class="number">1</span>;</span><br><span class="line">                <span class="comment">//判断是否存在右子节点</span></span><br><span class="line">                <span class="keyword">if</span>(biggerIndex&lt;lastIndex) &#123;</span><br><span class="line">                    biggerIndex++;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>((data[k].compareTo(data[biggerIndex])&lt;<span class="number">0</span>)) &#123;</span><br><span class="line">                    swap(data,k,biggerIndex);</span><br><span class="line">                    k=biggerIndex;</span><br><span class="line">                &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        DataWrap[] data = &#123;</span><br><span class="line">            <span class="keyword">new</span> DataWrap(<span class="number">21</span> , <span class="string">""</span>),</span><br><span class="line">            <span class="keyword">new</span> DataWrap(<span class="number">30</span> , <span class="string">""</span>),</span><br><span class="line">            <span class="keyword">new</span> DataWrap(<span class="number">49</span> , <span class="string">""</span>),</span><br><span class="line">            <span class="keyword">new</span> DataWrap(<span class="number">30</span> , <span class="string">"*"</span>),</span><br><span class="line">            <span class="keyword">new</span> DataWrap(<span class="number">21</span> , <span class="string">"*"</span>),</span><br><span class="line">            <span class="keyword">new</span> DataWrap(<span class="number">16</span> , <span class="string">""</span>),</span><br><span class="line">            <span class="keyword">new</span> DataWrap(<span class="number">9</span> , <span class="string">""</span>)</span><br><span class="line">        &#125;;</span><br><span class="line">        System.out.println(<span class="string">"排序之前：\n"</span></span><br><span class="line">            + java.util.Arrays.toString(data));</span><br><span class="line">        heapSort(data);</span><br><span class="line">        System.out.println(<span class="string">"排序之后：\n"</span></span><br><span class="line">            + java.util.Arrays.toString(data));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="1-2-交换排序"><a href="#1-2-交换排序" class="headerlink" title="1.2 交换排序"></a>1.2 交换排序</h2><p>交换排序的主体操作是对数组中的数据不断的进行交换操作。交换排序主要有冒泡排序和快速排序。</p>
<h3 id="1-2-1-冒泡排序"><a href="#1-2-1-冒泡排序" class="headerlink" title="1.2.1  冒泡排序"></a>1.2.1  冒泡排序</h3><p>冒泡排序思路：类似于鱼吐泡泡，一个接着一个，如果靠近鱼的泡泡比远离鱼的泡泡大，则两个泡泡就会交换。一次执行，就成了一串有序的泡泡。<br>时间效率：；空间效率：；算法是有序的；</p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> sort;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BubbleSort</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">bubbleSort</span><span class="params">(DataWrap[] data)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"开始排序"</span>);</span><br><span class="line">        <span class="keyword">int</span> arrayLength=data.length;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;arrayLength-<span class="number">1</span>;i++) &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;arrayLength-<span class="number">1</span>-i;j++) &#123;</span><br><span class="line">                <span class="keyword">if</span>(data[j].compareTo(data[j+<span class="number">1</span>])&gt;<span class="number">0</span>) &#123;</span><br><span class="line">                    DataWrap tmp=data[j+<span class="number">1</span>];</span><br><span class="line">                    data[j+<span class="number">1</span>]=data[j];</span><br><span class="line">                    data[j]=tmp;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            System.out.println(java.util.Arrays.toString(data));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        DataWrap[] data = &#123; <span class="keyword">new</span> DataWrap(<span class="number">9</span>, <span class="string">""</span>), <span class="keyword">new</span> DataWrap(<span class="number">16</span>, <span class="string">""</span>), <span class="keyword">new</span> DataWrap(<span class="number">21</span>, <span class="string">"*"</span>), <span class="keyword">new</span> DataWrap(<span class="number">23</span>, <span class="string">""</span>),</span><br><span class="line">                <span class="keyword">new</span> DataWrap(<span class="number">30</span>, <span class="string">""</span>), <span class="keyword">new</span> DataWrap(<span class="number">49</span>, <span class="string">""</span>), <span class="keyword">new</span> DataWrap(<span class="number">21</span>, <span class="string">""</span>), <span class="keyword">new</span> DataWrap(<span class="number">30</span>, <span class="string">"*"</span>) &#125;;</span><br><span class="line">        System.out.println(<span class="string">"排序之前：\n"</span> + java.util.Arrays.toString(data));</span><br><span class="line">        bubbleSort(data);</span><br><span class="line">        System.out.println(<span class="string">"排序之后：\n"</span> + java.util.Arrays.toString(data));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="1-2-2-快速排序"><a href="#1-2-2-快速排序" class="headerlink" title="1.2.2 快速排序"></a>1.2.2 快速排序</h3><p>快速排序的思路：如列队一样，先选择一个士兵为基准，比该士兵高则站在其后面，比该士兵矮则站在其前面，这样大致将队伍分为了两个子列。然后在这两个子进行递归。<br>空间效率：，算法并不稳定。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> sort;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">QuickSort</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">// 将指定数组的i和j索引处的元素交换</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">swap</span><span class="params">(DataWrap[] data, <span class="keyword">int</span> i, <span class="keyword">int</span> j)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        DataWrap tmp;</span><br><span class="line">        tmp = data[i];</span><br><span class="line">        data[i] = data[j];</span><br><span class="line">        data[j] = tmp;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 对data数组中从start～end索引范围的子序列进行处理</span></span><br><span class="line">    <span class="comment">// 使之满足所有小于分界值的放在左边，所有大于分界值的放在右边</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">subSort</span><span class="params">(DataWrap[] data</span></span></span><br><span class="line"><span class="function"><span class="params">        , <span class="keyword">int</span> start , <span class="keyword">int</span> end)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// 需要排序</span></span><br><span class="line">        <span class="keyword">if</span> (start &lt; end)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 以第一个元素作为分界值</span></span><br><span class="line">            DataWrap base = data[start];</span><br><span class="line">            <span class="comment">// i从左边搜索，搜索大于分界值的元素的索引</span></span><br><span class="line">            <span class="keyword">int</span> i = start;</span><br><span class="line">            <span class="comment">// j从右边开始搜索，搜索小于分界值的元素的索引</span></span><br><span class="line">            <span class="keyword">int</span> j = end + <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">while</span>(<span class="keyword">true</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// 找到大于分界值的元素的索引，或i已经到了end处</span></span><br><span class="line">                <span class="keyword">while</span>(i &lt; end &amp;&amp; data[++i].compareTo(base) &lt;= <span class="number">0</span>);</span><br><span class="line">                <span class="comment">// 找到小于分界值的元素的索引，或j已经到了start处</span></span><br><span class="line">                <span class="keyword">while</span>(j &gt; start &amp;&amp; data[--j].compareTo(base) &gt;= <span class="number">0</span>);</span><br><span class="line">                <span class="keyword">if</span> (i &lt; j)</span><br><span class="line">                &#123;</span><br><span class="line">                    swap(data , i , j);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            swap(data , start , j);</span><br><span class="line">            <span class="comment">// 递归左子序列</span></span><br><span class="line">            subSort(data , start , j - <span class="number">1</span>);</span><br><span class="line">            <span class="comment">// 递归右边子序列</span></span><br><span class="line">            subSort(data , j + <span class="number">1</span>, end);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">quickSort</span><span class="params">(DataWrap[] data)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        subSort(data , <span class="number">0</span> , data.length - <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        DataWrap[] data = &#123;</span><br><span class="line">            <span class="keyword">new</span> DataWrap(<span class="number">9</span> , <span class="string">""</span>),</span><br><span class="line">            <span class="keyword">new</span> DataWrap(-<span class="number">16</span> , <span class="string">""</span>),</span><br><span class="line">            <span class="keyword">new</span> DataWrap(<span class="number">21</span> , <span class="string">"*"</span>),</span><br><span class="line">            <span class="keyword">new</span> DataWrap(<span class="number">23</span> , <span class="string">""</span>),</span><br><span class="line">            <span class="keyword">new</span> DataWrap(-<span class="number">30</span> , <span class="string">""</span>),</span><br><span class="line">            <span class="keyword">new</span> DataWrap(-<span class="number">49</span> , <span class="string">""</span>),</span><br><span class="line">            <span class="keyword">new</span> DataWrap(<span class="number">21</span> , <span class="string">""</span>),</span><br><span class="line">            <span class="keyword">new</span> DataWrap(<span class="number">30</span> , <span class="string">"*"</span>),</span><br><span class="line">            <span class="keyword">new</span> DataWrap(<span class="number">13</span> , <span class="string">"*"</span>)</span><br><span class="line">        &#125;;</span><br><span class="line">        System.out.println(<span class="string">"排序之前：\n"</span></span><br><span class="line">            + java.util.Arrays.toString(data));</span><br><span class="line">        quickSort(data);</span><br><span class="line">        System.out.println(<span class="string">"排序之后：\n"</span></span><br><span class="line">            + java.util.Arrays.toString(data));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="1-3-插入排序"><a href="#1-3-插入排序" class="headerlink" title="1.3 插入排序"></a>1.3 插入排序</h2><p>插入排序主要分为直接插入排序、Shell排序和折半排序。</p>
<h3 id="1-3-1-直接插入排序"><a href="#1-3-1-直接插入排序" class="headerlink" title="1.3.1 直接插入排序"></a>1.3.1 直接插入排序</h3><p>直接插入排序思路：类似于把一堆杂乱的且大小不一的碗按从大到小（从小到大不符合实际）排序。我可以先拿出一个碗，然后在拿出碗与之比较；这两个碗排好序后，再拿出一个碗进行比较，插在其合适的顺序上，以此方式直至最后一个碗位置。<br>最坏情况的时间复杂度：；空间复杂度：；该算法是稳定的。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> sort;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">insertSort</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span>  <span class="title">insertSort</span><span class="params">(DataWrap[] data)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"开始排序"</span>);</span><br><span class="line">        <span class="keyword">int</span> arrayLenght=data.length;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;arrayLenght;i++) &#123;</span><br><span class="line">            DataWrap tmp=data[i];</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span>(data[i].compareTo(data[i-<span class="number">1</span>])&lt;<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="keyword">int</span> j=i-<span class="number">1</span>;</span><br><span class="line">                <span class="keyword">for</span>(;j&gt;=<span class="number">0</span>&amp;&amp;data[j].compareTo(tmp)&gt;<span class="number">0</span>;j--) &#123;</span><br><span class="line">                    data[j+<span class="number">1</span>]=data[j];</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                data[j+<span class="number">1</span>]=tmp;</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(java.util.Arrays.toString(data));</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        DataWrap[] data = &#123;</span><br><span class="line">            <span class="keyword">new</span> DataWrap(<span class="number">9</span> , <span class="string">""</span>),</span><br><span class="line">            <span class="keyword">new</span> DataWrap(-<span class="number">16</span> , <span class="string">""</span>),</span><br><span class="line">            <span class="keyword">new</span> DataWrap(<span class="number">21</span> , <span class="string">"*"</span>),</span><br><span class="line">            <span class="keyword">new</span> DataWrap(<span class="number">23</span> , <span class="string">""</span>),</span><br><span class="line">            <span class="keyword">new</span> DataWrap(-<span class="number">30</span> , <span class="string">""</span>),</span><br><span class="line">            <span class="keyword">new</span> DataWrap(-<span class="number">49</span> , <span class="string">""</span>),</span><br><span class="line">            <span class="keyword">new</span> DataWrap(<span class="number">21</span> , <span class="string">""</span>),</span><br><span class="line">            <span class="keyword">new</span> DataWrap(<span class="number">30</span> , <span class="string">"*"</span>),</span><br><span class="line">            <span class="keyword">new</span> DataWrap(<span class="number">13</span> , <span class="string">"*"</span>)</span><br><span class="line">        &#125;;</span><br><span class="line">        System.out.println(<span class="string">"排序之前：\n"</span></span><br><span class="line">            + java.util.Arrays.toString(data));</span><br><span class="line">        insertSort(data);</span><br><span class="line">        System.out.println(<span class="string">"排序之后：\n"</span></span><br><span class="line">            + java.util.Arrays.toString(data));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-3-2-折半插入排序"><a href="#1-3-2-折半插入排序" class="headerlink" title="1.3.2 折半插入排序"></a>1.3.2 折半插入排序</h3><p>思路：与二分法有点相似。因为之前的数据是排好序的，因此为了减少比较次数，可以选择之前数据的中点与要插入的数据进行比较。我们拿到一个碗，把它插在已经排好的碗中时，可以先看中间的碗，如果中间的碗比插入的碗大，在进行二分即可。<br>算法可能不稳定；</p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> sort;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BinaryInsertSort</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">binaryInsertSort</span><span class="params">(DataWrap[] data)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"开始排序：\n"</span>);</span><br><span class="line">        <span class="keyword">int</span> arrayLength = data.length;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span> ; i &lt; arrayLength ; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 当整体后移时，保证data[i]的值不会丢失</span></span><br><span class="line">            DataWrap tmp = data[i];</span><br><span class="line">            <span class="keyword">int</span> low = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">int</span> high = i - <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">while</span>(low &lt;= high)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// 找出low、high中间的索引</span></span><br><span class="line">                <span class="keyword">int</span> mid = (low + high) / <span class="number">2</span>;</span><br><span class="line">                <span class="comment">// 如果tmp值大于low、high中间元素的值</span></span><br><span class="line">                <span class="keyword">if</span>(tmp.compareTo(data[mid]) &gt; <span class="number">0</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">// 限制在索引大于mid的那一半中搜索</span></span><br><span class="line">                    low = mid + <span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">// 限制在索引小于mid的那一半中搜索</span></span><br><span class="line">                    high = mid - <span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 将low到i处的所有元素向后整体移一位</span></span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j = i ; j &gt; low ; j--)</span><br><span class="line">            &#123;</span><br><span class="line">                data[j] = data[j - <span class="number">1</span>];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 最后将tmp的值插入合适位置</span></span><br><span class="line">            data[low] = tmp;</span><br><span class="line">            System.out.println(java.util.Arrays.toString(data));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        DataWrap[] data = &#123;</span><br><span class="line">            <span class="keyword">new</span> DataWrap(<span class="number">9</span> , <span class="string">""</span>),</span><br><span class="line">            <span class="keyword">new</span> DataWrap(-<span class="number">16</span> , <span class="string">""</span>),</span><br><span class="line">            <span class="keyword">new</span> DataWrap(<span class="number">21</span> , <span class="string">"*"</span>),</span><br><span class="line">            <span class="keyword">new</span> DataWrap(<span class="number">23</span> , <span class="string">""</span>),</span><br><span class="line">            <span class="keyword">new</span> DataWrap(-<span class="number">30</span> , <span class="string">""</span>),</span><br><span class="line">            <span class="keyword">new</span> DataWrap(-<span class="number">49</span> , <span class="string">""</span>),</span><br><span class="line">            <span class="keyword">new</span> DataWrap(<span class="number">21</span> , <span class="string">""</span>),</span><br><span class="line">            <span class="keyword">new</span> DataWrap(<span class="number">30</span> , <span class="string">"*"</span>),</span><br><span class="line">            <span class="keyword">new</span> DataWrap(<span class="number">30</span> , <span class="string">""</span>)</span><br><span class="line">        &#125;;</span><br><span class="line">        System.out.println(<span class="string">"排序之前：\n"</span></span><br><span class="line">            + java.util.Arrays.toString(data));</span><br><span class="line">        binaryInsertSort(data);</span><br><span class="line">        System.out.println(<span class="string">"排序之后：\n"</span></span><br><span class="line">            + java.util.Arrays.toString(data));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-3-3-希尔排序"><a href="#1-3-3-希尔排序" class="headerlink" title="1.3.3 希尔排序"></a>1.3.3 希尔排序</h3><p>Shell排序方法思路:以一个较为合适的步长h，让数据中相差为h的步数进行排序；让后将步长改为h/2,在进行排序；递归下去，直至h=1。（当h=1是，可以认为此时的希尔排序算法就是直接插入排序算法）。对于直接插入算法来说，如果原始数据大部分是有序的，数据的移动操作就会较少。利用希尔排序算法就是把原始数据做到基本有序，有效的减少数据移动的操作。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShellSort</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">shellSort</span><span class="params">(DataWrap[] data)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"开始排序："</span>);</span><br><span class="line">        <span class="keyword">int</span> arrayLength = data.length;</span><br><span class="line">        <span class="comment">// h变量保存可变增量</span></span><br><span class="line">        <span class="keyword">int</span> h = <span class="number">1</span>;</span><br><span class="line">        <span class="comment">// 按h * 3 + 1得到增量序列的最大值</span></span><br><span class="line">        <span class="keyword">while</span>(h &lt;= arrayLength / <span class="number">3</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            h = h * <span class="number">3</span> + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span>(h &gt; <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            System.out.println(<span class="string">"===h的值:"</span> + h + <span class="string">"==="</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = h ; i &lt; arrayLength ; i++ )</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// 当整体后移时，保证data[i]的值不会丢失</span></span><br><span class="line">                DataWrap tmp = data[i];</span><br><span class="line">                <span class="comment">// i索引处的值已经比前面所有值都大，表明已经有序，无需插入</span></span><br><span class="line">                <span class="comment">// （i-1索引之前的数据已经有序的，i-1索引处元素的值就是最大值）</span></span><br><span class="line">                <span class="keyword">if</span> (data[i].compareTo(data[i - h]) &lt; <span class="number">0</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">int</span> j = i - h;</span><br><span class="line">                    <span class="comment">// 整体后移h格</span></span><br><span class="line">                    <span class="keyword">for</span> ( ; j &gt;= <span class="number">0</span> &amp;&amp; data[j].compareTo(tmp) &gt; <span class="number">0</span> ; j-=h)</span><br><span class="line">                    &#123;</span><br><span class="line">                        data[j + h] = data[j];</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">// 最后将tmp的值插入合适位置</span></span><br><span class="line">                    data[j + h] = tmp;</span><br><span class="line">                &#125;</span><br><span class="line">                System.out.println(java.util.Arrays.toString(data));</span><br><span class="line">            &#125;</span><br><span class="line">            h = (h - <span class="number">1</span>) / <span class="number">3</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        DataWrap[] data = &#123;</span><br><span class="line">            <span class="keyword">new</span> DataWrap(<span class="number">9</span> , <span class="string">""</span>),</span><br><span class="line">            <span class="keyword">new</span> DataWrap(-<span class="number">16</span> , <span class="string">""</span>),</span><br><span class="line">            <span class="keyword">new</span> DataWrap(<span class="number">21</span> , <span class="string">"*"</span>),</span><br><span class="line">            <span class="keyword">new</span> DataWrap(<span class="number">23</span> , <span class="string">""</span>),</span><br><span class="line">            <span class="keyword">new</span> DataWrap(-<span class="number">30</span> , <span class="string">""</span>),</span><br><span class="line">            <span class="keyword">new</span> DataWrap(-<span class="number">49</span> , <span class="string">""</span>),</span><br><span class="line">            <span class="keyword">new</span> DataWrap(<span class="number">21</span> , <span class="string">""</span>),</span><br><span class="line">            <span class="keyword">new</span> DataWrap(<span class="number">30</span> , <span class="string">"*"</span>),</span><br><span class="line">            <span class="keyword">new</span> DataWrap(<span class="number">30</span> , <span class="string">""</span>),</span><br><span class="line">        &#125;;</span><br><span class="line">        System.out.println(<span class="string">"排序之前：\n"</span></span><br><span class="line">            + java.util.Arrays.toString(data));</span><br><span class="line">        shellSort(data);</span><br><span class="line">        System.out.println(<span class="string">"排序之后：\n"</span></span><br><span class="line">            + java.util.Arrays.toString(data));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="1-4-归并排序"><a href="#1-4-归并排序" class="headerlink" title="1.4 归并排序"></a>1.4 归并排序</h2><p>归并排序基本思想：就是将两个有序的序列合成一个新的有序序列。其时间效率为，需要一个与原始序列同样大的辅助序列，因此空间效率较差。算法是稳定的。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DataWrap</span> <span class="keyword">implements</span> <span class="title">Comparable</span>&lt;<span class="title">DataWrap</span>&gt;</span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> data;</span><br><span class="line">    String flag;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DataWrap</span><span class="params">(<span class="keyword">int</span> data, String flag)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.data = data;</span><br><span class="line">        <span class="keyword">this</span>.flag = flag;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> data + flag;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 根据data实例变量来决定两个DataWrap的大小</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(DataWrap dw)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.data &gt; dw.data ? <span class="number">1</span></span><br><span class="line">            : (<span class="keyword">this</span>.data == dw.data ? <span class="number">0</span> : -<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MergeSort</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">// 利用归并排序算法对数组data进行排序</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">mergeSort</span><span class="params">(DataWrap[] data)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// 归并排序</span></span><br><span class="line">        sort(data , <span class="number">0</span> , data.length - <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将索引从left到right范围的数组元素进行归并排序</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> data 待排序的数组</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> left 待排序的数组的第一个元素索引</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> right 待排序的数组的最后一个元素的索引</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">sort</span><span class="params">(DataWrap[] data</span></span></span><br><span class="line"><span class="function"><span class="params">         , <span class="keyword">int</span> left, <span class="keyword">int</span> right)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (left &lt; right)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 找出中间索引</span></span><br><span class="line">            <span class="keyword">int</span> center = (left + right) / <span class="number">2</span>;</span><br><span class="line">            <span class="comment">// 对左边数组进行递归</span></span><br><span class="line">            sort(data, left, center);</span><br><span class="line">            <span class="comment">// 对右边数组进行递归</span></span><br><span class="line">            sort(data, center + <span class="number">1</span>, right);</span><br><span class="line">            <span class="comment">// 合并</span></span><br><span class="line">            merge(data, left, center, right);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将两个数组进行归并，归并前两个数组已经有序，归并后依然有序。</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> data 数组对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> left 左数组的第一个元素的索引</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> center 左数组的最后一个元素的索引，center+1是右数组第一个元素的索引</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> right 右数组的最后一个元素的索引</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">merge</span><span class="params">(DataWrap[] data</span></span></span><br><span class="line"><span class="function"><span class="params">        , <span class="keyword">int</span> left, <span class="keyword">int</span> center, <span class="keyword">int</span> right)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// 定义一个与待排序序列长度相同的临时数组</span></span><br><span class="line">        DataWrap[] tmpArr = <span class="keyword">new</span> DataWrap[data.length];</span><br><span class="line">        <span class="keyword">int</span> mid = center + <span class="number">1</span>;</span><br><span class="line">        <span class="comment">// third记录中间数组的索引</span></span><br><span class="line">        <span class="keyword">int</span> third = left;</span><br><span class="line">        <span class="keyword">int</span> tmp = left;</span><br><span class="line">        <span class="keyword">while</span> (left &lt;= center &amp;&amp; mid &lt;= right)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 从两个数组中取出小的放入中间数组</span></span><br><span class="line">            <span class="keyword">if</span> (data[left].compareTo(data[mid]) &lt;= <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                tmpArr[third++] = data[left++];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                tmpArr[third++] = data[mid++];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 剩余部分依次放入中间数组</span></span><br><span class="line">        <span class="keyword">while</span> (mid &lt;= right)</span><br><span class="line">        &#123;</span><br><span class="line">            tmpArr[third++] = data[mid++];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span> (left &lt;= center)</span><br><span class="line">        &#123;</span><br><span class="line">            tmpArr[third++] = data[left++];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 将中间数组中的内容复制拷回原数组</span></span><br><span class="line">        <span class="comment">// (原left～right范围的内容复制回原数组)</span></span><br><span class="line">        <span class="keyword">while</span> (tmp &lt;= right)</span><br><span class="line">        &#123;</span><br><span class="line">            data[tmp] = tmpArr[tmp++];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        DataWrap[] data = &#123;</span><br><span class="line">            <span class="keyword">new</span> DataWrap(<span class="number">9</span> , <span class="string">""</span>),</span><br><span class="line">            <span class="keyword">new</span> DataWrap(-<span class="number">16</span> , <span class="string">""</span>),</span><br><span class="line">            <span class="keyword">new</span> DataWrap(<span class="number">21</span> , <span class="string">"*"</span>),</span><br><span class="line">            <span class="keyword">new</span> DataWrap(<span class="number">23</span> , <span class="string">""</span>),</span><br><span class="line">            <span class="keyword">new</span> DataWrap(-<span class="number">30</span> , <span class="string">""</span>),</span><br><span class="line">            <span class="keyword">new</span> DataWrap(-<span class="number">49</span> , <span class="string">""</span>),</span><br><span class="line">            <span class="keyword">new</span> DataWrap(<span class="number">21</span> , <span class="string">""</span>),</span><br><span class="line">            <span class="keyword">new</span> DataWrap(<span class="number">30</span> , <span class="string">"*"</span>),</span><br><span class="line">            <span class="keyword">new</span> DataWrap(<span class="number">30</span> , <span class="string">""</span>)</span><br><span class="line">        &#125;;</span><br><span class="line">        System.out.println(<span class="string">"排序之前：\n"</span></span><br><span class="line">            + java.util.Arrays.toString(data));</span><br><span class="line">        mergeSort(data);</span><br><span class="line">        System.out.println(<span class="string">"排序之后：\n"</span></span><br><span class="line">            + java.util.Arrays.toString(data));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a href="https://www.cnblogs.com/tianliang94/p/10458888.html" target="_blank" rel="noopener">https://www.cnblogs.com/tianliang94/p/10458888.html</a></p>
]]></content>
      <categories>
        <category>算法</category>
      </categories>
      <tags>
        <tag>java</tag>
        <tag>排序</tag>
      </tags>
  </entry>
  <entry>
    <title>小工具</title>
    <url>/2020/04/14/%E5%B0%8F%E5%B7%A5%E5%85%B7/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p><a href="https://lovelive.tools/" target="_blank" rel="noopener">https://lovelive.tools/</a></p>
<iframe id="jjj"  src="https://lovelive.tools/" width="100%" height="700px"   frameborder="0"  name="我的博客"     scrolling="auto">   
</iframe>
<script type="text/javascript">  
document.getElementById("jjj").style.height=document.getElementById("spkj").scrollWidth*0.76+"px";
</script>]]></content>
      <categories>
        <category>工具</category>
      </categories>
  </entry>
  <entry>
    <title>我的java学习路线总结</title>
    <url>/2020/05/01/%E6%88%91%E7%9A%84java%E4%B9%8B%E8%B7%AF%E6%80%BB%E7%BB%93/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="我的java学习路线总结"><a href="#我的java学习路线总结" class="headerlink" title="我的java学习路线总结"></a>我的java学习路线总结</h1><h3 id="一、"><a href="#一、" class="headerlink" title="一、"></a>一、</h3><ol>
<li>开发环境+HelloWorld</li>
<li>基础语法：变量+基本类型+运算符+调试</li>
<li>基础语法：异常+流程控制+分支+循环</li>
<li>基础语法：数组+二维数组+枚举+文件</li>
<li>面向对象：封装+类+对象+重载+构造</li>
<li>面向对象：继承+重写+抽象+接口+内部类</li>
<li>面向对象：多态+final+static+内部类</li>
<li>API：字符串+浮点数+日期+日志</li>
<li>API：泛型+数据结构+集合</li>
<li>知识回顾：重点知识+高级应用</li>
<li>高级：多线程+线程安全+售票</li>
<li>高级：线程锁+ThreadLocal+递归+包扫描</li>
<li>高级：注解+反射+手写jUnit</li>
<li>实战：手写Spring框架实现IoC</li>
<li>高级：手写Spring框架实现DI</li>
<li>高级：网络+爬虫Jsoup </li>
<li>高级：爬取京东</li>
<li>高级：JSON+属性文件+XML+NIO</li>
</ol>
<h3 id="二、"><a href="#二、" class="headerlink" title="二、"></a>二、</h3><ol>
<li>mysql</li>
<li>jdbc</li>
<li>html</li>
<li>css</li>
<li>js</li>
<li>jquery</li>
<li>ajax</li>
<li>tomcat</li>
<li>http</li>
<li>severlet</li>
<li>jsp el jstl</li>
<li>maven</li>
<li>cookie session</li>
<li>mybatis</li>
<li>spring</li>
<li>spring mvc</li>
<li>ssm</li>
<li>ssm 整合</li>
</ol>
<h3 id="三、"><a href="#三、" class="headerlink" title="三、"></a>三、</h3><ol>
<li>javase</li>
<li>mybatis</li>
<li>spring</li>
<li>spring mvc</li>
<li>springboot</li>
<li>aop</li>
<li>项目1：后台管理系统</li>
<li>项目2：宠物商城系统</li>
<li>vue bootstrap thymeleaf shiro</li>
</ol>
<h3 id="四、"><a href="#四、" class="headerlink" title="四、"></a>四、</h3><ol>
<li>springboot</li>
<li>easyui</li>
<li>nginx</li>
<li>linux</li>
<li>redis</li>
<li>dubbo</li>
<li>httpclient</li>
<li>zookeeper</li>
<li>quartz</li>
<li>sso</li>
<li>项目3：分布式商城系统</li>
</ol>
<h3 id="五、"><a href="#五、" class="headerlink" title="五、"></a>五、</h3><ul>
<li>springcloud 微服务 大数据 等……</li>
<li>本文仅为大致顺序,不完全区分先后;</li>
<li>不断学习,持续更新中……</li>
</ul>
]]></content>
      <categories>
        <category>myblog</category>
      </categories>
      <tags>
        <tag>java</tag>
        <tag>me</tag>
      </tags>
  </entry>
  <entry>
    <title>愿逝者安息，让全站黑白！</title>
    <url>/2020/04/17/%E6%84%BF%E9%80%9D%E8%80%85%E5%AE%89%E6%81%AF%EF%BC%8C%E8%AE%A9%E5%85%A8%E7%AB%99%E9%BB%91%E7%99%BD%EF%BC%81/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h3 id="愿逝者安息，愿生者奋发，愿祖国昌盛！"><a href="#愿逝者安息，愿生者奋发，愿祖国昌盛！" class="headerlink" title="愿逝者安息，愿生者奋发，愿祖国昌盛！"></a>愿逝者安息，愿生者奋发，愿祖国昌盛！</h3><p>&emsp;&emsp;为表达全国各族人民对抗击新冠肺炎疫情斗争牺牲烈士和逝世同胞的深切哀悼，国务院今天发布公告，决定2020年4月4日举行全国性哀悼活动。在此期间，全国和驻外使领馆下半旗志哀，全国停止公共娱乐活动。4月4日10时起，全国人民默哀3分钟，汽车、火车、舰船鸣笛，防空警报鸣响。<br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://www.zhangpeng.fun/upload/2020/04/5e873b96a3107bb6f533a554-b7dea45003c4466c829c6a40dca52589.jpeg" alt="5e873b96a3107bb6f533a554"></p>
<p>今天是2020年4月4日，全国将举行哀悼活动，为表达敬意与尊重，应将网站设置为灰度。<br>愿逝者安息，愿生者奋发，愿祖国昌盛！</p>
<p>例如：<br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://www.zhangpeng.fun/upload/2020/04/image-1dc913a7557043338ce1d3edad11b5de.png" alt="image.png"></p>
<p>实现：<br>下面三种方式任选一种都可以，只需要放入html的head标签中即可实现。<br>（1）方式一</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;style type&#x3D;&quot;text&#x2F;css&quot;&gt;</span><br><span class="line">html&#123;</span><br><span class="line">     filter:progid:DXImageTransForm.Microsoft.BasicImage(grayscale&#x3D;1);-webkit-filter:saturate(0)</span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;style&gt;</span><br></pre></td></tr></table></figure>
<p>（2）方式二</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;style&gt;</span><br><span class="line">body&gt;*&#123;</span><br><span class="line">    filter: grayscale(100%);</span><br><span class="line">    -webkit-filter: grayscale(100%);</span><br><span class="line">    -moz-filter: grayscale(100%);</span><br><span class="line">    -ms-filter: grayscale(100%);</span><br><span class="line">    -o-filter: grayscale(100%);</span><br><span class="line">    filter: progid:DXImageTransform.Microsoft.BasicImage(grayscale&#x3D;1);</span><br><span class="line">    -webkit-filter: grayscale(1);</span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;style&gt;</span><br></pre></td></tr></table></figure>
<p>（3）方式三</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;style&gt; </span><br><span class="line">html &#123; </span><br><span class="line">      -webkit-filter: grayscale(100%); </span><br><span class="line">      -moz-filter: grayscale(100%); </span><br><span class="line">      -ms-filter: grayscale(100%); </span><br><span class="line">      -o-filter: grayscale(100%); </span><br><span class="line">      filter:progid:DXImageTransform.Microsoft.BasicImage(grayscale&#x3D;1);  </span><br><span class="line">      _filter:none; </span><br><span class="line"> &#125; </span><br><span class="line">&lt;&#x2F;style&gt;</span><br></pre></td></tr></table></figure>
<p>效果：<br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://www.zhangpeng.fun/upload/2020/04/image-bcb9c3c4d39a4e3080235c1451d67765.png" alt="image.png"><br>赶紧行动起来吧！</p>
<p>来源：<a href="https://mp.weixin.qq.com/s/PtPy6WdltNWRiq8X0b-BeA" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/PtPy6WdltNWRiq8X0b-BeA</a></p>
]]></content>
      <categories>
        <category>前端</category>
      </categories>
      <tags>
        <tag>html</tag>
        <tag>css</tag>
      </tags>
  </entry>
  <entry>
    <title>数据结构</title>
    <url>/2020/04/03/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="数据结构"><a href="#数据结构" class="headerlink" title="数据结构"></a>数据结构</h1><p>  数据结构是计算机存储、组织数据的方式。数据结构是指相互之间存在一种或多种特定关系的数据元素的集合。通常情况下，精心选择的数据结构可以带来更高的运行或者存储效率。数据结构往往同高效的检索算法和索引技术有关。</p>
<h2 id="1-1常用的数据结构编辑"><a href="#1-1常用的数据结构编辑" class="headerlink" title="1.1常用的数据结构编辑"></a>1.1常用的数据结构编辑</h2><p>  在计算机科学的发展过程中，数据结构也随之发展。程序设计中常用的数据结构包括如下几个。 [5] </p>
<h3 id="数组-Array"><a href="#数组-Array" class="headerlink" title="数组(Array)"></a>数组(Array)</h3><p>  数组是一种聚合数据类型，它是将具有相同类型的若干变量有序地组织在一起的集合。数组可以说是最基本的数据结构，在各种编程语言中都有对应。一个数组可以分解为多个数组元素，按照数据元素的类型，数组可以分为整型数组、字符型数组、浮点型数组、指针数组和结构数组等。数组还可以有一维、二维以及多维等表现形式。 [5] </p>
<h3 id="栈-Stack"><a href="#栈-Stack" class="headerlink" title="栈( Stack)"></a>栈( Stack)</h3><p>  栈是一种特殊的线性表，它只能在一个表的一个固定端进行数据结点的插入和删除操作。栈按照后进先出的原则来存储数据，也就是说，先插入的数据将被压入栈底，最后插入的数据在栈顶，读出数据时，从栈顶开始逐个读出。栈在汇编语言程序中，经常用于重要数据的现场保护。栈中没有数据时，称为空栈。 [5] </p>
<h3 id="队列-Queue"><a href="#队列-Queue" class="headerlink" title="队列(Queue)"></a>队列(Queue)</h3><p>  队列和栈类似，也是一种特殊的线性表。和栈不同的是，队列只允许在表的一端进行插入操作，而在另一端进行删除操作。一般来说，进行插入操作的一端称为队尾，进行删除操作的一端称为队头。队列中没有元素时，称为空队列。 [5] </p>
<h3 id="链表-Linked-List"><a href="#链表-Linked-List" class="headerlink" title="链表( Linked List)"></a>链表( Linked List)</h3><p>  链表是一种数据元素按照链式存储结构进行存储的数据结构，这种存储结构具有在物理上存在非连续的特点。链表由一系列数据结点构成，每个数据结点包括数据域和指针域两部分。其中，指针域保存了数据结构中下一个元素存放的地址。链表结构中数据元素的逻辑顺序是通过链表中的指针链接次序来实现的。 [5] </p>
<h3 id="树-Tree"><a href="#树-Tree" class="headerlink" title="树( Tree)"></a>树( Tree)</h3><p>  树是典型的非线性结构，它是包括，2个结点的有穷集合K。在树结构中，有且仅有一个根结点，该结点没有前驱结点。在树结构中的其他结点都有且仅有一个前驱结点，而且可以有两个后继结点，m≥0。 [5] </p>
<h3 id="图-Graph"><a href="#图-Graph" class="headerlink" title="图(Graph)"></a>图(Graph)</h3><p>  图是另一种非线性数据结构。在图结构中，数据结点一般称为顶点，而边是顶点的有序偶对。如果两个顶点之间存在一条边，那么就表示这两个顶点具有相邻关系。 [5] </p>
<h3 id="堆-Heap"><a href="#堆-Heap" class="headerlink" title="堆(Heap)"></a>堆(Heap)</h3><p>  堆是一种特殊的树形数据结构，一般讨论的堆都是二叉堆。堆的特点是根结点的值是所有结点中最小的或者最大的，并且根结点的两个子树也是一个堆结构。 [5] </p>
<h3 id="散列表-Hash"><a href="#散列表-Hash" class="headerlink" title="散列表(Hash)"></a>散列表(Hash)</h3><p>  散列表源自于散列函数(Hash function)，其思想是如果在结构中存在关键字和T相等的记录，那么必定在F(T)的存储位置可以找到该记录，这样就可以不用进行比较操作而直接取得所查记录。 [5]</p>
<h2 id="1-2常用算法编辑"><a href="#1-2常用算法编辑" class="headerlink" title="1.2常用算法编辑"></a>1.2常用算法编辑</h2><p>  数据结构研究的内容：就是如何按一定的逻辑结构，把数据组织起来，并选择适当的存储表示方法把逻辑结构组织好的数据存储到计算机的存储器里。研究的目的是为了更有效的处理数据，提高数据运算效率。数据的运算是定义在数据的逻辑结构上，但运算的具体实现要在存储结构上进行。一般有以下几种常用运算：<br><br/><br>(1)检索。检索就是在数据结构里查找满足一定条件的节点。一般是给定一个某字段的值，找具有该字段值的节点。<br><br/><br>(2)插入。往数据结构中增加新的节点。<br><br/><br>(3)删除。把指定的结点从数据结构中去掉。<br><br/><br>(4)更新。改变指定节点的一个或多个字段的值。<br><br/><br>(5)排序。把节点按某种指定的顺序重新排列。例如递增或递减。<br><br/></p>
]]></content>
      <categories>
        <category>算法</category>
      </categories>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>本博客微信小程序正式上线</title>
    <url>/2020/05/01/%E6%9C%AC%E5%8D%9A%E5%AE%A2%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E6%AD%A3%E5%BC%8F%E4%B8%8A%E7%BA%BF/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h2 id="经过一番努力，本博客微信小程序正式上线"><a href="#经过一番努力，本博客微信小程序正式上线" class="headerlink" title="经过一番努力，本博客微信小程序正式上线"></a>经过一番努力，本博客微信小程序正式上线</h2><h3 id="1-微信搜索"><a href="#1-微信搜索" class="headerlink" title="1.微信搜索"></a>1.微信搜索</h3><p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://www.zhangpeng.fun/upload/2020/04/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88-1eba896f22fd4b409edd064695228758.png" alt="扫码_搜索联合传播样式-标准色版"><br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://www.zhangpeng.fun/upload/2020/04/%E6%90%9C%E7%B4%A2%E6%A1%86%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E7%99%BD%E8%89%B2%E7%89%88-170e1e41e25241519090fa8a932779c6.png" alt="搜索框传播样式-白色版"></p>
<h3 id="2-开发过程"><a href="#2-开发过程" class="headerlink" title="2.开发过程"></a>2.开发过程</h3><p>又掉了几根头发。。。。<br><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://www.zhangpeng.fun/upload/2020/03/Snipaste_2020-03-31_13-17-51-0a06443abe794b38b40d76502b774263.png" alt="Snipaste_2020-03-31_13-17-51"></p>
<p>欢迎大家来看看哟！</p>
<h2 id="3-小程序截图"><a href="#3-小程序截图" class="headerlink" title="3.小程序截图"></a>3.小程序截图</h2><p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://www.zhangpeng.fun/upload/2020/03/Snipaste_2020-03-31_13-21-31-6cbf7ded31b1415786f4ab9aa58f7402.png" alt="Snipaste_2020-03-31_13-21-31"></p>
<p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="https://www.zhangpeng.fun/upload/2020/03/Snipaste_2020-03-31_13-21-44-7ab41765a4e04ed2b41391486d119c29.png" alt="Snipaste_2020-03-31_13-21-44"><br>哈哈~</p>
<h2 id="4-个人博客"><a href="#4-个人博客" class="headerlink" title="4.个人博客"></a>4.个人博客</h2><p><a href="https://www.zhangpeng.fun/" target="_blank" rel="noopener">https://www.zhangpeng.fun/</a>  —-我的个人博客<br/><br><a href="mailto:zpeng_it@163.com">zpeng_it@163.com</a>   —- 我的邮箱</p>
<h2 id="5-感谢"><a href="#5-感谢" class="headerlink" title="5.感谢"></a>5.感谢</h2><p><a href="https://github.com/aquanlerou/WeHalo" target="_blank" rel="noopener">WeHalo</a></p>
]]></content>
      <categories>
        <category>myblog</category>
      </categories>
      <tags>
        <tag>小程序</tag>
      </tags>
  </entry>
  <entry>
    <title>爬虫</title>
    <url>/2020/04/01/%E7%88%AC%E8%99%AB/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="爬虫"><a href="#爬虫" class="headerlink" title="爬虫"></a>爬虫</h1><p>简单学习了下爬虫,感觉挺有意思的……<br>网络爬虫（又称为网页蜘蛛，网络机器人，在FOAF社区中间，更经常的称为网页追逐者），是一种按照一定的规则，自动地抓取万维网信息的程序或者脚本。另外一些不常使用的名字还有蚂蚁、自动索引、模拟程序或者蠕虫。</p>
<pre><code class="java"><span class="keyword">package</span> day17.JD2;
<span class="comment">/**</span>
<span class="comment">*  <span class="doctag">@author</span>         zhang peng</span>
<span class="comment">*  <span class="doctag">@email</span>           332156209@qq.com</span>
<span class="comment">*  <span class="doctag">@date</span>             创建时间：2019年8月22日  下午6:12:15</span>
<span class="comment">*  <span class="doctag">@version</span>        1.0</span>
<span class="comment">*  <span class="doctag">@description</span>  -</span>
<span class="comment">*/</span>


<span class="keyword">import</span> java.io.IOException;
<span class="keyword">import</span> java.util.ArrayList;
<span class="keyword">import</span> java.util.List;

<span class="keyword">import</span> org.jsoup.Jsoup;
<span class="keyword">import</span> org.jsoup.nodes.Element;
<span class="keyword">import</span> org.jsoup.select.Elements;
<span class="keyword">import</span> org.junit.Test;

<span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JD</span> </span>{
    <span class="meta">@Test</span>
    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">site</span><span class="params">()</span> <span class="keyword">throws</span> IOException, InterruptedException </span>{
        <span class="keyword">int</span> sum = <span class="number">0</span>;
        <span class="comment">//获取所有的三级分类</span>
        List&lt;String&gt; catUrlList = JD.getCat3();
        <span class="comment">//遍历3级分类</span>
        <span class="keyword">for</span>(String catUrl : catUrlList) {
            <span class="comment">//延时</span>
            Thread.sleep(<span class="number">10</span>);

            <span class="comment">//返回当前分类的总页数</span>
            <span class="keyword">int</span> maxNum = JD.getPageNum(catUrl);
            <span class="comment">//某个分类下所有分页链接</span>
            List&lt;String&gt; pageUrlList = JD.getPageUrlList(catUrl, maxNum);
            <span class="comment">//遍历当前分类下的所有分页链接</span>
            <span class="keyword">for</span>(String pageUrl : pageUrlList) {
                <span class="comment">//当前分页商品链接</span>
                List&lt;String&gt; itemUrlList = JD.getItemUrlList(pageUrl);
                <span class="keyword">for</span>(String itemUrl : itemUrlList) {
                    System.out.println(itemUrl);
                    sum = sum +<span class="number">1</span>;
                    <span class="comment">//获取到当前商品链接，调用方法获取其标题、价格。。。</span>
                    System.out.println(Jsoup.connect(itemUrl).get().select(<span class="string">".sku-name"</span>).get(<span class="number">0</span>).text());
                }
            }
        }
        System.out.println(sum);
    }

    <span class="meta">@Test</span>
    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testCat3</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>{
        List&lt;String&gt; catList = JD.getCat3();
        <span class="keyword">for</span>(String url : catList) {
            System.out.println(url);
        }
        System.out.println(<span class="string">"处理标准三级分类："</span>+catList.size());
    }

    <span class="comment">//返回所有三级分类。京东三级分类：1286，标准有：1190</span>
    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;String&gt; <span class="title">getCat3</span><span class="params">()</span> <span class="keyword">throws</span> IOException</span>{
        <span class="comment">//所有分类都在里面</span>
        String url = <span class="string">"http://www.jd.com/allSort.aspx"</span>;

        <span class="comment">//通过选择器把三级分类过滤出来，集合</span>
        Elements els = Jsoup.connect(url).get()
            .select(<span class="string">"div dl dd a"</span>);

        <span class="comment">//存放爬取所有三级分类链接</span>
        List&lt;String&gt; catList = <span class="keyword">new</span> ArrayList&lt;String&gt;();
        <span class="keyword">for</span>(Element e : els) {
            <span class="comment">//获取到三级分类a标签的链接值</span>
            String catUrl = e.attr(<span class="string">"href"</span>);

            <span class="comment">//排除异常链接</span>
            <span class="keyword">if</span>(catUrl.startsWith(<span class="string">"//list.jd.com/list.html?cat="</span>)) {
                catList.add(<span class="string">"http:"</span>+catUrl);
            }
        }

        <span class="keyword">return</span> catList;
    }

    <span class="meta">@Test</span>
    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pageNum</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>{
        String catUrl = <span class="string">"http://list.jd.com/list.html?cat=1713,3274&amp;jth=i"</span>;
        <span class="keyword">int</span> num = JD.getPageNum(catUrl);
        System.out.println(num);
    }

    <span class="comment">//获取某个分类下总页数，参数就是分类链接</span>
    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">getPageNum</span><span class="params">(String catUrl)</span> <span class="keyword">throws</span> IOException </span>{
        Integer num = Integer.parseInt(
                Jsoup.connect(catUrl).get()
            .select(<span class="string">".fp-text i"</span>).get(<span class="number">0</span>).text()
            );
        <span class="keyword">return</span> num;
    }

    <span class="meta">@Test</span>    <span class="comment">//测试某个分类下的所有的分页链接</span>
    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pageList</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>{
        String catUrl = <span class="string">"https://list.jd.com/list.html?cat=1713,3274"</span>;
        Integer maxNum = JD.getPageNum(catUrl);
        List&lt;String&gt; itemList = JD.getPageUrlList(catUrl, maxNum);
        <span class="keyword">for</span>(String item : itemList) {
            System.out.println(item);
        }
    }

    <span class="comment">//https://list.jd.com/list.html?cat=1713,3274&amp;page=1</span>
    <span class="comment">//https://list.jd.com/list.html?cat=1713,3274&amp;page=2</span>
    <span class="comment">//拼接某个一个分类下的所有的分页链接</span>
    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;String&gt; <span class="title">getPageUrlList</span><span class="params">(String catUrl, Integer maxNum)</span></span>{
        List&lt;String&gt; pageUrlList = <span class="keyword">new</span> ArrayList&lt;String&gt;();

        <span class="comment">//遍历所有页数</span>
        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=maxNum; i++) {
            String pageUrl = catUrl + <span class="string">"&amp;page="</span> + i;
            pageUrlList.add(pageUrl);
        }
        <span class="keyword">return</span> pageUrlList;
    }

    <span class="meta">@Test</span>    <span class="comment">//某个列表页面上所有商品链接地址</span>
    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">itemList</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>{
        String pageUrl = <span class="string">"http://list.jd.com/list.html?cat=1713,3274&amp;page=210"</span>;
        List&lt;String&gt; itemUrlList = JD.getItemUrlList(pageUrl);
        <span class="keyword">for</span>(String itemUrl : itemUrlList) {
            System.out.println(itemUrl);
        }
    }

    <span class="comment">//抓取某个列表页面中所有商品链接的地址，</span>
    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;String&gt; <span class="title">getItemUrlList</span><span class="params">(String pageUrl)</span> <span class="keyword">throws</span> IOException</span>{
        Elements els = Jsoup.connect(pageUrl).get()
            .select(<span class="string">".p-img a"</span>);

        List&lt;String&gt; itemUrlList = <span class="keyword">new</span> ArrayList&lt;String&gt;();
        <span class="comment">//所有a标签，过滤过的</span>
        <span class="keyword">for</span>(Element e : els) {
            <span class="comment">//e是a标签，href属性值</span>
            String itemUrl = e.attr(<span class="string">"href"</span>);
            itemUrlList.add(<span class="string">"http:"</span>+itemUrl); 
        }
        <span class="keyword">return</span> itemUrlList;
    }
}



程序运行一会就会停,因为京东也有反爬虫♥ ♠ ♣ ♥ ◊ ♦ ♠</code></pre>
]]></content>
      <categories>
        <category>后端</category>
      </categories>
      <tags>
        <tag>java</tag>
        <tag>爬虫</tag>
      </tags>
  </entry>
  <entry>
    <title>软件工具推荐</title>
    <url>/2020/04/10/%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7%E6%8E%A8%E8%8D%90/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><p>Windows软件推荐，全面武装你的电脑！提高工作工作学习效率，不一定是最好的，但是都是我用的，用起来非常方便，推荐给大家。</p>
<h3 id="1-安全"><a href="#1-安全" class="headerlink" title="1. 安全"></a>1. 安全</h3><p>   火绒</p>
<h3 id="2-浏览器"><a href="#2-浏览器" class="headerlink" title="2. 浏览器"></a>2. 浏览器</h3><p>   chrome<br>   火狐</p>
<h3 id="3-下载工具"><a href="#3-下载工具" class="headerlink" title="3.下载工具"></a>3.下载工具</h3><p>   迅雷<br>   XDM<br>   IDM</p>
<h3 id="4-网络存储"><a href="#4-网络存储" class="headerlink" title="4.网络存储"></a>4.网络存储</h3><p>   百度网盘<br>   金山文档</p>
<h3 id="5-社交"><a href="#5-社交" class="headerlink" title="5.社交"></a>5.社交</h3><p>   微信<br>   TIM</p>
<h3 id="6-媒体"><a href="#6-媒体" class="headerlink" title="6.媒体"></a>6.媒体</h3><p>   网易云音乐<br>   potplayer</p>
<h3 id="7-写作"><a href="#7-写作" class="headerlink" title="7.写作"></a>7.写作</h3><p>   onenote<br>   Typora<br>   印象笔记</p>
<h3 id="8-办公"><a href="#8-办公" class="headerlink" title="8.办公"></a>8.办公</h3><p>   office<br>   foxmail</p>
<h3 id="9-画图"><a href="#9-画图" class="headerlink" title="9.画图"></a>9.画图</h3><p>   Xmind</p>
<h3 id="10-远程"><a href="#10-远程" class="headerlink" title="10. 远程"></a>10. 远程</h3><p>  向日葵<br>  Timeviver</p>
<h3 id="11-工具"><a href="#11-工具" class="headerlink" title="11.工具"></a>11.工具</h3><p>  everything –文件搜索<br>  sinpaste  –屏幕截图<br>  7zip  –压缩<br>  qttabbar  –文件资源管理<br>  officeboxgong  –办公小工具合集<br>  quicklook  –文件预览<br>  chmeditor –chm帮助文档编写<br>  caesium  –图片批量压缩<br>  geek  –卸载<br>  obs  –录屏<br>  ccleaner  –清理<br>  wox  – 快捷启动+搜索<br>  pandownload  –网盘资源下载<br>  ditto  –剪贴板<br>  mydock  –桌面美化<br>  wallpaper enginer  –壁纸</p>
<h3 id="Java开发常用"><a href="#Java开发常用" class="headerlink" title="Java开发常用"></a>Java开发常用</h3><p>   eclipse<br>   sts<br>   idea<br>   postman<br>   everedit<br>   navicat<br>   filezilla<br>   Xshell<br>   HBuilder<br>   git<br>   switchhosts<br>   mysql<br>   oracle<br>   powerdesigner<br>   MarkdownPad 2<br>   vmware<br>   等。。。。。。</p>
<h3 id="我的桌面"><a href="#我的桌面" class="headerlink" title="我的桌面"></a>我的桌面</h3><p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://www.zhangpeng.fun/upload/2020/3/Snipaste_2020-03-27_02-21-40-fdff0aa862484eef8ae028177afcd42c.png" alt="Snipaste_2020-03-27_02-21-40"></p>
<p>????????</p>
]]></content>
      <categories>
        <category>工具</category>
      </categories>
      <tags>
        <tag>推荐</tag>
      </tags>
  </entry>
  <entry>
    <title>面试题目web</title>
    <url>/2020/04/07/%E9%9D%A2%E8%AF%95%E9%A2%98%E7%9B%AEweb/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="第二阶段面试题"><a href="#第二阶段面试题" class="headerlink" title="第二阶段面试题"></a>第二阶段面试题</h1><h2 id="1-1-描述Servlet调用过程？"><a href="#1-1-描述Servlet调用过程？" class="headerlink" title="1.1.描述Servlet调用过程？"></a>1.1.描述Servlet调用过程？</h2><p>答案：<br/><br>（1）在浏览器输入地址，浏览器先去查找hosts文件，将主机名翻译为ip地址，如果找不到就再去查询dns服务器将主机名翻译成ip地址。<br/><br>（2）浏览器根据ip地址和端口号访问服务器，组织http请求信息发送给服务器。<br/><br>（3）服务器收到请求后首先根据Host请求头判断当前访问的是哪台虚拟主机。<br/><br>（4）服务器根据http请求头中的请求URI判断当前访问的是哪个web应用。<br/><br>（5）服务器根据http请求头中的请求URI判断当前访问的是web应用中的哪个web资源。<br/><br>（6）检查web应用的web.xml文件，如果根据路径找到具体的servlet处理类的全路径名交给该servlet处理,如果找不到就交给缺省servlet处理。<br/><br>（7）这个过程中浏览器只知道自己发出来http请求，不久就收到了http响应，浏览器不知道也不关心服务器内部是如何处理的。浏览器和服务器之间的关系是非常单纯的，只有HTTP协议。<br/><br>（8）解析请求、封装RequestResponse对象、创建Servlet、调用Service方法都是服务器自动进行的，开发人员只需要写好Servlet配置进容器中即可，无需操心具体的底层实现。<br/></p>
<h2 id="1-2-简述Servlet生命周期？"><a href="#1-2-简述Servlet生命周期？" class="headerlink" title="1.2.简述Servlet生命周期？"></a>1.2.简述Servlet生命周期？</h2><p>答案：<br/><br>（1）Servlet第一次被访问到时创建对象，创建出来后立即执行init方法执行初始化的操作。<br/><br>（2）从此以后该对象一直驻留在内存中为后续的对这个Servlet的请求进行服务。<br/><br>（3）直到服务器关闭或web应用移除出容器时，随着web应用的销毁Servlet对象销毁掉，在销毁之前调用destory方法执行善后工作。<br/><br>（4）在存活期间，每次对Servlet 的调用都会导致Service方法的执行。<br/></p>
<h2 id="1-3-什么是http协议？"><a href="#1-3-什么是http协议？" class="headerlink" title="1.3.什么是http协议？"></a>1.3.什么是http协议？</h2><p>答案：<br/></p>
<p>HTTP协议就是一套基于tcp/ip协议的应用层协议 。简单来说，就是一个基于应用层的通信规范，双方要进行通信，大家都要遵守一个规范，这个规范就是HTTP协议。它规定了客户端（通常是浏览器）和服务器之间的通信方式。<br/></p>
<h2 id="1-4-HTTP协议工作原理？"><a href="#1-4-HTTP协议工作原理？" class="headerlink" title="1.4.HTTP协议工作原理？"></a>1.4.HTTP协议工作原理？</h2><p>答案：<br/></p>
<p>HTTP协议基于请求响应模型。<br/><br>一次请求对应一次响应。<br/><br>首先客户端发送一个请求(request)给服务器，服务器在接收到这个请求后将生成一个响应(response)返回给客户端。<br/></p>
<h2 id="1-5-HTTP协议的特点是什么"><a href="#1-5-HTTP协议的特点是什么" class="headerlink" title="1.5.HTTP协议的特点是什么 ?"></a>1.5.HTTP协议的特点是什么 ?</h2><p>答案：<br/></p>
<p>（1）它是一个无状态的协议，服务器端在处理相应请求后不会保留任何客户端的信息，每次请求都是独立的<br/><br>（2）客户端与服务器端的每一次数据交互，都要经过一次请求/响应的过程。<br/><br>（3）服务器端无法识别能够出发客户端请求的方法。<br/><br>（4）一个典型的HTTP请求分为 一个请求行 若干请求头 一个空行 实体内容。<br/></p>
<h2 id="1-6-get和post请求的区别？"><a href="#1-6-get和post请求的区别？" class="headerlink" title="1.6.get和post请求的区别？"></a>1.6.get和post请求的区别？</h2><p>答案：<br/></p>
<p>（1）get请求用来从服务器上获得资源，而post是用来向服务器提交数据；<br/><br>（2）get将表单中数据按照name=value的形式，添加到action 所指向的URL 后面，并且两者使用”?”连接，而各个变量之间使用”&amp;”连接；post是将表单中的数据放在HTTP协议的请求头或消息体中，传递到action所指向URL；<br/><br>（3）get传输的数据要受到URL长度限制（1024字节）；而post可以传输大量的数据， POST数据是没有限制的，上传文件通常要使用post方式；<br/><br>（4）使用get时参数会显示在地址栏上，如果这些数据不是敏感数据，那么可以使用get；对于敏感数据还是应用使用post；<br/><br>（5）get使用MIME类型application/x-www-form-urlencoded的URL编码（也叫百分号编码）文本的格式传递参数，保证被传送的参数由遵循规范的文本组成，例如一个空格的编码是”%20”。<br/><br>（6）Jsp页面中的FORM标签里的method属性为get时调用doGet()，为post时调用doPost()。<br/></p>
<h2 id="1-7-请求乱码产生的原因？"><a href="#1-7-请求乱码产生的原因？" class="headerlink" title="1.7.请求乱码产生的原因？"></a>1.7.请求乱码产生的原因？</h2><p>答案：<br/></p>
<p>浏览器用什么码表来打开表单页面就用什么编码来发送数据。当前我们的注册页面指定了用utf-8来打开。这就决定了浏览器是用utf-8打开的页面，浏览器在提交表单时是用utf-8编码的。而tomcat默认情况下会使用iso8859-1来进行解码。我们知道全世界的码表都兼容iso8859-1，所以英文处理是没有问题的。但是iso8859-1中并没有中文，iso8859-1对于无法处理的字节都使用?替代，所以我们看到的都是？。<br/></p>
<h2 id="1-8-如何来处理get请求产生的乱码"><a href="#1-8-如何来处理get请求产生的乱码" class="headerlink" title="1.8.如何来处理get请求产生的乱码?"></a>1.8.如何来处理get请求产生的乱码?</h2><p>答案：<br/></p>
<p>由于客户端发送时使用的是utf-8编码而服务器用iso8859-1解码造成了乱码，虽然字符已经乱掉了，但底层的字节仍然是正确的，我们只要将乱码字符getBytes(“iso8859-1”)转换为字节，就是正确的字节，再将这些字节new String(bytes，“utf-8”)按照正确的码表编码，就可以转换回正确的字符了。从而解决了乱码。</p>
<h2 id="1-9-Request生命周期"><a href="#1-9-Request生命周期" class="headerlink" title="1.9.Request生命周期"></a>1.9.Request生命周期</h2><p>答案：<br/></p>
<p>request对象的生命周期是针对一个客户端(一个浏览器应用程序)的一次请求，当请求完毕之后，request里边的内容也将被释放，一个请求开始时创建，请求结束后销毁。</p>
<h2 id="1-10-如何处理响应乱码？"><a href="#1-10-如何处理响应乱码？" class="headerlink" title="1.10.如何处理响应乱码？"></a>1.10.如何处理响应乱码？</h2><p>答案：</p>
<p>通过response.setHeader(“Content-Type”, “text/html;charset=utf-8”)方法，通知服务器发送数据时的码表；通过response.setCharacterEncoding(“utf-8”)方法，通知浏览器解析时使用的码表。两码相同就不会有乱码了。<br>response提供了setContentType(“text/html;charset=UTF-8”)快捷方法，在它的底层，会同时做上面两件事，所以可以一行代码解决response产生的乱码问题。</p>
<h2 id="1-11-简述ServletContext生命周期？"><a href="#1-11-简述ServletContext生命周期？" class="headerlink" title="1.11.简述ServletContext生命周期？"></a>1.11.简述ServletContext生命周期？</h2><p>答案：<br/></p>
<p>ServletContext对象代表当前web应用。当服务器启动时，服务器在启动时会依次加载web应用，每一个web应用加载完成后都会创建一个ServletContext对象唯一代表该web应用，这个对象一直存活，直到web应用移除出容器或服务器关闭时，随着应用销毁，ServletContext对象跟着销毁。</p>
<h2 id="1-12-转发与重定向的比较？"><a href="#1-12-转发与重定向的比较？" class="headerlink" title="1.12.转发与重定向的比较？"></a>1.12.转发与重定向的比较？</h2><p>答案：<br/></p>
<p>转发是服务器内部资源跳转,重定向是通过302+Location实现浏览器跳转访问。<br/><br>转发一次请求一次响应,重定向两次请求两次响应。<br/><br>转发地址栏不发生变化,重定向地址栏会发生变化。<br/><br>转发之前和转发之后request是一个,重定向之前和之后不是一个request。<br/></p>
<h2 id="1-13-Session生命周期？"><a href="#1-13-Session生命周期？" class="headerlink" title="1.13.Session生命周期？"></a>1.13.Session生命周期？</h2><p>答案：<br/></p>
<p>当程序第一次调用到request.getSession()代码时,服务器明确的知道了需要用到session了,此时创建session。<br/><br>如果session超过30分钟(可以在web.xml中配置的)没人使用,服务器认为这个session超时了,销毁session。<br/><br>明确的调用session.invalidate(),session立即销毁。<br/><br>服务器被非正常关闭或web应用被移除出容器,此时随着web应用的销毁session销毁.如果是正常关闭,session会被钝化.当下次服务器正常启动时,没有超时的session还会被活化回来。<br/></p>
<h2 id="1-14-session的原理？"><a href="#1-14-session的原理？" class="headerlink" title="1.14.session的原理？"></a>1.14.session的原理？</h2><p>答案：<br/></p>
<p>session的原理：在服务器第一次调用request.getSession()方法的时候，会在内存中创建一个session对象，此对象具有一个独一无二的id值，此id值将会以cookie（JSESSIONID）的形式发送给浏览器，浏览器以后每次访问都会带着此cookie，服务器就利用此cookie区分浏览器找到对应的session空间。</p>
<h2 id="1-15-cookie与session的区别"><a href="#1-15-cookie与session的区别" class="headerlink" title="1.15.cookie与session的区别"></a>1.15.cookie与session的区别</h2><p>答案：<br/></p>
<p>cookie数据存放在客户的浏览器上，session数据放在服务器上<br/><br>cookie不是很安全，别人可以分析存放在本地的COOKIE并进行COOKIE欺骗，考虑到安全应当使用session<br/><br>session会在一定时间内保存在服务器上。当访问增多，会比较占用你服务器的性能，考虑到减轻服务器性能方面，应当使用COOKIE<br/></p>
<h2 id="1-16-JSP和Servlet是什么关系？"><a href="#1-16-JSP和Servlet是什么关系？" class="headerlink" title="1.16.JSP和Servlet是什么关系？"></a>1.16.JSP和Servlet是什么关系？</h2><p>答案：<br/></p>
<p>其实这个问题在上面已经阐述过了，Servlet是一个特殊的Java程序，它运行于服务器的JVM中，能够依靠服务器的支持向浏览器提供显示内容。JSP本质上是Servlet的一种简易形式，JSP会被服务器处理成一个类似于Servlet的Java程序，可以简化页面内容的生成。Servlet和JSP最主要的不同点在于，Servlet的应用逻辑是在Java文件中，并且完全从表示层中的HTML分离开来。而JSP的情况是Java和HTML可以组合成一个扩展名为.jsp的文件。有人说，Servlet就是在Java中写HTML，而JSP就是在HTML中写Java代码，当然这个说法是很片面且不够准确的。JSP侧重于视图，Servlet更侧重于控制逻辑，在MVC架构模式中，JSP JSP有哪些内置对象？作用分别是什么？<br/><br>JSP有9个内置对象：<br/></p>
<ul>
<li>request：封装客户端的请求，其中包含来自GET或POST请求的参数；<br/></li>
<li>response：封装服务器对客户端的响应；<br/></li>
<li>pageContext：通过该对象可以获取其他对象；<br/></li>
<li>session：封装用户会话的对象；<br/></li>
<li>application：封装服务器运行环境的对象；<br/></li>
<li>out：输出服务器响应的输出流对象；<br/></li>
<li>config：Web应用的配置对象；<br/></li>
<li>page：JSP页面本身（相当于Java程序中的this）；<br/></li>
<li>exception：封装页H    面抛出异常的对象。<br/><h2 id="1-17-JSP的九大隐式对象是哪九个"><a href="#1-17-JSP的九大隐式对象是哪九个" class="headerlink" title="1.17.JSP的九大隐式对象是哪九个"></a>1.17.JSP的九大隐式对象是哪九个</h2>答案：<br/><br>1：request: 请求对象 在javax.servlet.ServletRequest  作用域为Request来自客服端的请求，如：FORM表单中填写的信息，常用的方法有getParameter，getParamterName   和getParamterValue通过表用获取请求对象中包含的参数值。<br/><br>2:response表示客服端的响应。<br/><br>3：pageContext对象为页面的上下文对象，代表当请运行页面的一些属性。<br/><br>4：session：对象代码服务器与客服端所建立的会话，比如在写购物，客服轨迹跟踪，<br/><br>session”是建立在cookie的基础之上的。常用方法有getId,getValues等。<br>5：application对象负责提供应用程序在服务端运行时的一些全局信息，方法有getMimeType等。<br/><br>6：out：与response不同，通过out对象发送的内容是浏览器需要的显示内容，还可以直接想客服端编写一个有程序动态生成的HTML的文件。<br/><br>7：page：page里的变量没法从index.jsp传递到test.jsp。只要页面跳转了，就不见了。<br/><br>8： exception：他是一个列外的对象，当页面发生了列外，就会会创建该对象。<br/><br>9：config：是在servlet初始化Servlet的时候，JSP引擎向他传递信息用的，此消息包括Servlet初始化时所需要的参数。<br/><h2 id="1-18-如何防止SQL注入攻击呢？"><a href="#1-18-如何防止SQL注入攻击呢？" class="headerlink" title="1.18.如何防止SQL注入攻击呢？"></a>1.18.如何防止SQL注入攻击呢？</h2>答案：<br/></li>
</ul>
<p>SQL注入：就是通过把SQL命令插入到Web表单递交或输入域名或页面请求的查询字符串，最终达到欺骗服务器执行恶意的SQL命令。具体来说，它是利用现有应用程序，将（恶意）的SQL命令注入到后台数据库引擎执行的能力，它可以通过在Web表单中输入（恶意）SQL语句得到一个存在安全漏洞的网站上的数据库，而不是按照设计者意图去执行SQL语句。<br/><br>防止的方法：<br/><br>（1）永远不要信任用户的输入，要对用户的输入进行校验，可以通过正则表达式，或限制长度，对单引号和双”-“进行转换等。<br/><br>（2）永远不要使用动态拼装SQL，可以使用参数化的SQL或者直接使用存储过程进行数据查询存取。<br/><br>（3）永远不要使用管理员权限的数据库连接，为每个应用使用单独的权限有限的数据库连接。<br/><br>（4）不要把机密信息明文存放，请加密或者hash掉密码和敏感的信息。<br/><br>（5）应用的异常信息应该给出尽可能少的提示，最好使用自定义的错误信息对原始错误信息进行包装，把异常信息存放在独立的表中。<br/></p>
<h2 id="1-19-Mysql数据库优化"><a href="#1-19-Mysql数据库优化" class="headerlink" title="1.19.Mysql数据库优化"></a>1.19.Mysql数据库优化</h2><p>答案：<br/></p>
<p>(1)查询时，能不用* 就不用，尽量写全字段名。<br/><br>(2)索引不是越多越好，每个表控制在6个索引以内。范围where条件的情况下，索引不起作用，比如where value&lt;100 <br/><br>(3)大部分情况连接效率远大于子查询，但是有例外。当你对连接查询的效率都感到不能接受的时候可以试试用子查询，虽然大部分情况下你会更失望，但总有碰到惊喜的时候不是么…<br/><br>(4)多用explain 和 profile分析查询语句<br/><br>(5)有时候可以1条大的SQL可以分成几个小SQL顺序执行，分了吧，速度会快很多。<br/><br>(6)每隔一段时间用alter table table_name engine=innodb;优化表<br/><br>(7)连接时注意:小表 jion 大表的原则<br/><br>(8)学会用explain 和 profile判断是什么原因使你的SQL慢<br/><br>(9)查看慢查询日志，找出执行时间长的SQL进行优化<br/><br>(10)尽量避免使用order by<br/><br>(11)因为where子句后面的条件是执行顺序是从右到左，所以尽量把能过滤掉大部分数据的条件放在最后<br/></p>
<h2 id="1-20-Filter-的作用是什么？"><a href="#1-20-Filter-的作用是什么？" class="headerlink" title="1.20.Filter 的作用是什么？"></a>1.20.Filter 的作用是什么？</h2><p>答案：<br/></p>
<p>init为初始化方法，在Filter对象被创建出来时，Servlet容器会调用该方法对filter进行初始化。<br/><br>destory为销毁的方法，在过滤器对象被销毁之前，服务器会调用这个方法执行善后工作。 <br/><br>doFilter为过滤器中最核心的方法，对访问的请求和响应进行拦截，当过滤器拦截到对资源的访问时，服务器会自动调用该方法执行过滤代码。 我们只需要在这个方法中设计过滤器的逻辑代码即可。<br/></p>
<h2 id="1-21-Filter的生命周期？"><a href="#1-21-Filter的生命周期？" class="headerlink" title="1.21.Filter的生命周期？"></a>1.21.Filter的生命周期？</h2><p>答案：<br/></p>
<p>当服务器启动,web应用加载后,立即创建出这个web应用中的所有过滤器对象,创建出来后立即调用过滤器的init方法执行初始化操作.从此这些过滤器对象驻留在内存中为后续的拦截进行服务.每当拦截到资源时,都会导致dofilter方法执行.最终直到服务器关闭或web应用移除出容器时,随着web应用的销毁,过滤器对象销毁,销毁之前调用destory方法执行善后工作。</p>
<h2 id="1-22-什么是数据库连接池及其工作原理"><a href="#1-22-什么是数据库连接池及其工作原理" class="headerlink" title="1.22.什么是数据库连接池及其工作原理"></a>1.22.什么是数据库连接池及其工作原理</h2><p>答案：<br/><br>对于共享资源，有一个很著名的设计模式：资源池（resource pool）。该模式正是为了解决资源的频繁分配﹑释放所造成的问题。为解决上述问题，可以采用数据库连接池技术。数据库连接池的基本思想就是为数据库连接建立一个“缓冲池”。预先在缓冲池中放入一定数量的连接，当需要建立数据库连接时，只需从“缓冲池”中取出一个，使用完毕之后再放回去。我们可以通过设定连接池最大连接数来防止系统无尽的与数据库连接。更为重要的是我们可以通过连接池的管理机制监视数据库的连接的数量﹑使用情况，为系统开发﹑测试及性能调整提供依据。</p>
<h2 id="1-23-如何自己实现一个数据库连接池"><a href="#1-23-如何自己实现一个数据库连接池" class="headerlink" title="1.23.如何自己实现一个数据库连接池"></a>1.23.如何自己实现一个数据库连接池</h2><p>答案：<br/><br>思路如下：<br/><br>1：利用class实现DataSource接口<br/><br>2：在class的构造器一次性创建指定的链接将链接保存LinkedList中<br/><br>3：实现getConnection从LinkedList返回一个链接<br/><br>4：提供将链接放回方法<br/></p>
<pre><code>Public class MyDataSource inplements DataSource{
   Private LinkedList&lt;Connection&gt; dataSource=new LinkedList&lt;&gt;();
   Public MyDataSource(){
   For( int a=0;a&lt;1000;a++){
    Try{
   DriverManager.registerDriver(new SQLServerDriver());
    Connection con=DriverManager.getConnection(“jdbc:sqlserver://localhost:1443;DatabaseName=liming”,”root”,”liming”
}catch(Exception e){

}

}
Public Connection getConnetion(){
   Final Connection conn=dataSource.removeFirst();
}
Public void releasConnection(Connection conn){
    dataSource.add(conn);
}
}
}</code></pre><h2 id="1-24-http和https的区别？"><a href="#1-24-http和https的区别？" class="headerlink" title="1.24. http和https的区别？"></a>1.24. http和https的区别？</h2><p>答案：<br/><br>HTTP协议传输的数据都是未加密的，也就是明文的，因此使用HTTP协议传输隐私信息非常不安全，为了保证这些隐私数据能加密传输，于是网景公司设计了SSL（Secure Sockets Layer）协议用于对HTTP协议传输的数据进行加密，从而就诞生了HTTPS。简单来说，HTTPS协议是由SSL+HTTP协议构建的可进行加密传输、身份认证的网络协议，要比http协议安全。</p>
<h2 id="1-25-Servlet的单例问题"><a href="#1-25-Servlet的单例问题" class="headerlink" title="1.25.Servlet的单例问题"></a>1.25.Servlet的单例问题</h2><p>答案：<br/><br>Servlet是一个供其他java程序调用的类，它不能独立运行，针对客户端的多次请求，通常状况下，Servlet只会创建一个Servlet实例对象，一旦创建它就会驻留在内存中，为后续的请求提供服务，直至退出web应用为止，也就是当我们关闭了浏览器之后我们的Servlet就终止了。<br/><br>当Servlet第一次访问的时候，就被加载到内存中，以后该实例对各个请求服务，没次情况会调用一次service方法。<br/><br>这样会出现什么问题：因为Servlet是单例的，所以会出现线程安全问题<br/></p>
<h2 id="1-26-””-和-null的区别"><a href="#1-26-””-和-null的区别" class="headerlink" title="1.26.”” 和 null的区别"></a>1.26.”” 和 null的区别</h2><p>答案：<br/><br>如果说str是null，那么内存根本没创建字符串对像，并由str引用。不能调用object的方法。<br/><br>        如果说str是空串，那么确实存在一个由str引用的字符串对像，只不过这个字符串的值是””。长度为0；<br/><br>        在获取请求参数的时候为什么要这样判断呢？<br/></p>
<pre><code>if(null==str || &quot;&quot;.equals(str)){
    return &quot;不合法参数&quot;；
}</code></pre><p>如果我们在表单中什么都不填 接收到的字符串就是null;<br/><br>如果我们在表单中填“”，接受到的字符串是“”，但是存入数据库后，查询出来的就是null；<br/></p>
<h2 id="1-27-Servlet的多线程同步问题"><a href="#1-27-Servlet的多线程同步问题" class="headerlink" title="1.27.Servlet的多线程同步问题"></a>1.27.Servlet的多线程同步问题</h2><p>答案：<br/><br>　　Servlet本身是单实例的，这样当有多个用户同时访问某个Servlet时，会访问该唯一的Servlet实例中的成员变量，如果对成员变量进行写入操作，那就会导致Servlet的多线程问题，即数据不一致。<br/><br>1.解决Servlet多线程同步问题的最好方式：去除实例变量，使用局部变量。<br/><br>不使用成员变量，而使用局部变量，因为局部变量在每个线程中都有各自的实例。所以对Servlet来说，如果要对某个变量做写入操作，一定不要使用成员变量，而要使用局部变量。<br/><br>2.使用同步代码块<br/><br>　　synchronized{}<br/><br>3.Servlet实现javax.serlvet.SingleThreadModel，Servlet2.4中已经废弃了该接口，此时Servlet容器将保证Servlet实例以单线程方式运行，也就是说，同一时刻，只会有一个线程执行Servlet的service()方法。<br/></p>
<h2 id="1-28-request-getParameter-和request-getAttribute-的区别？"><a href="#1-28-request-getParameter-和request-getAttribute-的区别？" class="headerlink" title="1.28.request.getParameter()和request.getAttribute()的区别？"></a>1.28.request.getParameter()和request.getAttribute()的区别？</h2><p>答案：<br/></p>
<p>a、request.getParameter()获取的类型是String；<br/><br/><br>    request.getAttribute()获取的类型是Object<br/><br>b、request.getPrameter()获取的是POST/GET传递的参数值和URL中的参数；<br/><br>     request.getAttribute()获取的是对象容器中的数据值/对象<br/><br>c、request.setAttribute()和request.getAttribute()可以发送、接收对象；<br/><br>    request.getParamter()只能接收字符串，官方不开放request.setParamter()（也就是没有这个方法）<br/><br>    setAttribute()和getAttribute()的传参原理：<br/><br>    setAttribute()是应用服务器把这个对象放在该页面所对应的一块内存中去，当你的页面服务器重定向到另外一个页面时，<br/><br>    应用服务器会把这块内存拷贝到另一个页面所对应的那块内存中。这个就可以通过getAttribute()获取到相应的参数值或者对象。<br/></p>
<h2 id="1-29-JSP中动态include和静态include的区别？"><a href="#1-29-JSP中动态include和静态include的区别？" class="headerlink" title="1.29.JSP中动态include和静态include的区别？"></a>1.29.JSP中动态include和静态include的区别？</h2><p>答案：<br/><br> a、静态include：语法：&lt;%@ include file=”文件名” %&gt;，相当于复制，编辑时将对应的文件包含进来，当内容变化时，不会再一次对其编译，不易维护。<br/><br> b、动态include：语法：&lt;jsp:include page=”文件名”&gt;,能够自动检查被包含文件，当客户端对JSP文件进行请求时，会重新将对应的文件包含进来，进行实时的更新。<br/></p>
<h2 id="1-30-详细描述MVC。"><a href="#1-30-详细描述MVC。" class="headerlink" title="1.30. 详细描述MVC。"></a>1.30. 详细描述MVC。</h2><p>答案：<br/><br>基于java的web应用系统采用MVC设计模型，即用Model（模型）、View（视图）和Controller（控制）分离设计，这是目前web应用服务系统的主流设置方向。<br/><br>      Model：处理业务逻辑的模块。<br/><br>      View：负责页面显示，显示Model的处理结果给用户，主要实现数据到页面的转换过程。<br/><br>      Controller：负责每个请求的分发，把Form数据传递给Model进行处理，处理完成后，把处理结果返回给相应的View显示给用户。<br/></p>
<h2 id="1-31-EL表达式的功能，为什么要用EL表达式？（Expression-Language）"><a href="#1-31-EL表达式的功能，为什么要用EL表达式？（Expression-Language）" class="headerlink" title="1.31.EL表达式的功能，为什么要用EL表达式？（Expression Language）"></a>1.31.EL表达式的功能，为什么要用EL表达式？（Expression Language）</h2><p>答案：<br/><br>功能：<br/><br>a、从四个域对象中取出数据数据显示。<br/><br>b、取出请求参数数据显示。<br/><br>原因：<br/><br>在页面中用jsp脚本和jsp表达式来获取数据显示比较麻烦<br/><br>a、需要判断<br/><br>b、可能需要强转<br/></p>
<h2 id="1-32-如何防止表单重复提交？"><a href="#1-32-如何防止表单重复提交？" class="headerlink" title="1.32.如何防止表单重复提交？"></a>1.32.如何防止表单重复提交？</h2><p>答案：<br/><br>使用session技术：<br/><br>a、在regist.jsp页面中生成一个为一个随机值，将其保存到session中，同时将其保存为表单的隐藏域的值。<br/><br>b、在处理注册的请求时，获取session中的值，获取请求参数的值，比较两者是否相同，如果相同说明不是重复提交，请求通过同时删除session中保存的的值，如果不相同则是重复提交，不能通过。<br/></p>
<h2 id="1-33-什么是web容器？"><a href="#1-33-什么是web容器？" class="headerlink" title="1.33.什么是web容器？"></a>1.33.什么是web容器？</h2><p>答案：<br/><br>给处于其中的应用程序组件（JSP、Servlet）提供一个环境，是JSP、Servlet直接跟容器中的变量交互，不必关注其他系统问题。<br/><br>主要有web服务器来实现。例如：tomcat、weblogic、sphere、JBoss等。该容器提供的接口严格遵守J2EE规范中的web application标准。<br/><br>我们把遵守以上标准的web服务器叫做J2EE的web容器。<br/></p>
<h2 id="1-34-J2EE常用的设计模式？说明工厂模式。"><a href="#1-34-J2EE常用的设计模式？说明工厂模式。" class="headerlink" title="1.34.J2EE常用的设计模式？说明工厂模式。"></a>1.34.J2EE常用的设计模式？说明工厂模式。</h2><p>答案：<br/><br>Java中一共有23中设计模式：<br/><br>Factory（工厂模式）、Builder（建造模式）、Factory Method（工厂方法模式）、ProtoType（原始模型模式）、Singleton（单例模式）、<br>Facade（门面模式）、Adapter（适配器模式）、Bridge（桥梁模式）、Composite（合成模式）、Decorator（装饰模式）、<br>FlyWeight（享元模式）、Proxy（代理模式）、Command（命令模式）、Interpreter（解释器模式）、Visitor（访问者模式）、<br>Iterator（迭代子模式）、Mediator（调停者模式）、Memento（备忘录模式）、Observer（观察者模式）、State（状态模式）、<br>Strategy（策略模式）、Template Method（模板方法模式）、Chain Of Responsibility（责任链模式）、<br/><br>工厂模式：工厂模式是一种经常被使用到的模式，根据工厂模式实现的类可以根据提供的数据生成一组类中某个类的实例，通常一组类中有一个公共的抽象父类并且实现了相同的方法，但是这些方法针对不同的数据进行了不同的操作。首先需要定义一个基类，该类的子类通过不同的方法实现了基类中的方法。然后定义一个工厂类，工厂类可以根据条件生成不同的子类实例。当得到子类的实例后，开发人员可以调用基类中的方法而不必考虑到底返回的是哪一个子类的实例。</p>
<h2 id="1-35-什么是事务？"><a href="#1-35-什么是事务？" class="headerlink" title="1.35.什么是事务？"></a>1.35.什么是事务？</h2><p>答案：<br/>v<br>事务时作为一个逻辑单元执行的一系列操作，一个逻辑工作单元必须有四个属性，称为ACID（原子性、一致性、隔离性和持久性）属性，<br>只有这样才能成为一个事务：<br/><br>原子性：事务必须是原子工作单元，对于其数据修改，要么全都执行，要么全都不执行。<br/><br>一致性：事务在完成时，必须使所有的数据保持一致的状态。在相关数据库中，所有规则都必须应用于事务的修改，以保持所有数据的完整性。事务结束时，所有的内部数据结构（如B树索引或双向链表）都必须是正确的。<br/><br>隔离性：由并发事务所做的修改必须与任何其他并发事务所做的修改隔离。事务查看数据时数据所处的状态，要么是另一并发事务修改它之前<br/><br>的状态，要么是另一并发事务修改它之后的状态，事务不会查看中间状态的数据。这称为可串行性，因为它能够重新装载起始数据，并且重播一系列事务，以使数据结束时的状态与原始事务执行的状态相同。<br/><br>持久性：事务完成后，它对于系统的影响是永久性的。该修改即使出现系统故障也将一直保持。<br/></p>
<h2 id="1-36-数据库有几种隔离级别"><a href="#1-36-数据库有几种隔离级别" class="headerlink" title="1.36.数据库有几种隔离级别?"></a>1.36.数据库有几种隔离级别?</h2><p>答案：<br/><br>1、Serializable (串行化)：可避免脏读、不可重复读、幻读的发生<br/><br>2、Repeatable read (可重复读)：可避免脏读、不可重复读的发生。<br/><br>3、Read committed (读已提交)：可避免脏读的发生。<br/><br>4、Read uncommitted (读未提交)：最低级别，任何情况都无法保证<br/></p>
<h2 id="1-37-简述web-xml的作用"><a href="#1-37-简述web-xml的作用" class="headerlink" title="1.37.简述web.xml的作用"></a>1.37.简述web.xml的作用</h2><p>答案：<br/></p>
<p>属于部署描述符，在整个JAVA中只要是容器都会存在部署描述符，此部署描述符可以控制整个WEB中各个组件的运行状态，也可以配置整个窗口的状态</p>
<h2 id="1-38-sql优化：（索引、范式）"><a href="#1-38-sql优化：（索引、范式）" class="headerlink" title="1.38.sql优化：（索引、范式）"></a>1.38.sql优化：（索引、范式）</h2><p>答案：<br/><br>三范式：<br/><br>   第一范式（确保每列保持原子性）最基本范式。数据库表中所有字段值都是不可分解的原子值，就满足了第一范式。<br/><br>第二范式（确保表中的每列都和主键相关）在第一范式上更近一层。确保数据库表中的每一列都和主键相关，而不能只与主键的某一部分相关，也就是说一个表中只能保存一种数据，不可以吧多种数据保存在一张表中。<br/><br>第三范式：确保每列都和主键列直接相关，不是间接相关。<br/><br>索引：<br/><br>    避免对索引字段进行计算、避免索引在字段上使用not、&lt;&gt;、！=、避免在索引上使用IS NULL和NOT NULL、避免在索引列上出现数据类型转换、避免索引字段使用函数、避免建立索引的列出现空值</p>
<h2 id="1-39-Ajax原理"><a href="#1-39-Ajax原理" class="headerlink" title="1.39.Ajax原理"></a>1.39.Ajax原理</h2><p>答案：<br/></p>
<p>Ajax的工作原理相当于在用户和服务器之间加了—个中间层,使用户操作与服务器响应异步化。并不是所有的用户请求都提交给服务器,像—些数据验证和数据处理等都交给Ajax引擎自己来做, 只有确定需要从服务器读取新数据时再由Ajax引擎代为向服务器提交请求。<br/><br>    Ajax其核心只有JavaScript、XMLHTTPRequest和DOM，在旧的交互方式中,由用户触发一个HTTP请求到服务器,服务器对其进行处理后再返回一个新的HTHL页到客户端, 每当服务器处理客户端提交的请求时,客户都只能空闲等待,并且哪怕只是一次很小的交互、只需从服务器端得到很简单的一个数据,都要返回一个完整的HTML页,而用户每次都要浪费时间和带宽去重新读取整个页面。而使用Ajax后用户从感觉上几乎所有的操作都会很快响应没有页面重载（白屏）的等待。<br/></p>
<h2 id="1-40-JDBC的原理"><a href="#1-40-JDBC的原理" class="headerlink" title="1.40.JDBC的原理"></a>1.40.JDBC的原理</h2><p>答案：<br/></p>
<h2 id="1-41-SQL注入攻击"><a href="#1-41-SQL注入攻击" class="headerlink" title="1.41.SQL注入攻击"></a>1.41.SQL注入攻击</h2><p>答案：<br/><br>SQL注入是一种将SQL代码添加到输入参数中，传递到服务器解析并执行的一种攻击手法。<br/><br>SQL注入攻击是输入参数未经过滤，然后直接拼接到SQL语句当中解析，执行达到预想之外的一种行为，称之为SQL注入攻击。<br/></p>
<h2 id="1-42-如何防止SQL注入攻击"><a href="#1-42-如何防止SQL注入攻击" class="headerlink" title="1.42.如何防止SQL注入攻击"></a>1.42.如何防止SQL注入攻击</h2><p>答案：<br/><br>利用新对象PreparedStatement对象完成，先将SQL骨架发送给数据库服务器，然后再将参数单独发给服务器，并将参数中的关键字当做一个普通字符串来处理，进而起到防止SQL注入的问题</p>
<h2 id="1-43-对连接池的理解"><a href="#1-43-对连接池的理解" class="headerlink" title="1.43.对连接池的理解"></a>1.43.对连接池的理解</h2><p>答案：<br/><br>用来提高程序的效率，创建一个容器，容器中存放已经获取到了的数据库连接对象，对外提供获取连接和还回连接的方法，外界需要时就从容器中获取，用完就还回容器中。</p>
<h2 id="1-44-HTML和xml的区别？"><a href="#1-44-HTML和xml的区别？" class="headerlink" title="1.44.HTML和xml的区别？"></a>1.44.HTML和xml的区别？</h2><p>答案：<br/><br>XML是可扩展标记语言，而HTML超文本标记语言。不同之处：<br/><br>1、语法有所不同。XML语法比较严谨而HTML语法比较松散。<br/><br>2、用途不同。XML主要用于数据格式化存储而HTML主要用于网页的编辑。<br/></p>
<h2 id="1-45-在JS中-和-的区别？"><a href="#1-45-在JS中-和-的区别？" class="headerlink" title="1.45.在JS中==和===的区别？"></a>1.45.在JS中==和===的区别？</h2><p>答案：<br/><br>简单来说： == 代表相同， ===代表严格相同, 为啥这么说呢， <br/><br>这么理解： 当进行双等号比较时候： 先检查两个操作数数据类型，如果相同， 则进行===比较， 如果不同， 则愿意为你进行一次类型转换， 转换成相同类型后再进行比较， 而===比较时， 如果类型不同，直接就是false.</p>
<h2 id="1-46-SQL优化"><a href="#1-46-SQL优化" class="headerlink" title="1.46.SQL优化"></a>1.46.SQL优化</h2><p>答案：<br/><br>1.SELECT子句中避免使用‘*’<br/><br>2.SQL语句用大写的<br/><br>3.用IN来替换OR<br/><br>4.查询语句中不要使用 *<br/><br>5.尽量减少子查询，使用关联查询（left join,right join,inner  join）替代<br/><br>6.减少使用IN或者NOT IN ,使用exists，not exists或者关联查询语句替代<br/><br>7.or 的查询尽量用 union或者union all 代替<br/><br>8.合理的增加冗余的字段（减少表的联接查询）<br/><br>9.增加中间表进行优化（这个主要是在统计报表的场景，<br/></p>
<h2 id="1-47-Tomcat配置-部署优化"><a href="#1-47-Tomcat配置-部署优化" class="headerlink" title="1.47.Tomcat配置,部署优化"></a>1.47.Tomcat配置,部署优化</h2><p>答案：<br/></p>
<ol>
<li>内存优化:Tomcat依赖于JVM,可以配置JVM的内存配置<br/></li>
<li>最大连接数配置(并发能力)<br/><br>通常搭配Nginx提升Tomcat的并发性能<br/></li>
</ol>
<h2 id="1-48-自动刷新-定时刷新"><a href="#1-48-自动刷新-定时刷新" class="headerlink" title="1.48.自动刷新,定时刷新"></a>1.48.自动刷新,定时刷新</h2><p>答案：<br/></p>
<p>自动刷新不仅可以实现一段时间之后自动跳转到另一个页面，还可以实现一段时间之后自动刷新本页面。Servlet中通过HttpServletResponse对象设置Header属性实现自动刷新例如：<br/><br>Response.setHeader(“Refresh”,”1000;URL=<a href="http://localhost:8080/servlet/example.htm&quot;" target="_blank" rel="noopener">http://localhost:8080/servlet/example.htm&quot;</a>);<br/><br>其中1000为时间，单位为毫秒。URL指定就是要跳转的页面（如果设置自己的路径，就会实现没过一秒自动刷新本页面一次）<br/></p>
<h2 id="1-49-BS和CS的区别？"><a href="#1-49-BS和CS的区别？" class="headerlink" title="1.49.BS和CS的区别？"></a>1.49.BS和CS的区别？</h2><p>答案:<br/><br>1.C/S用户固定，并且处于相同区域，要求拥有相同的操作系统。B/S要有操作系统和浏览器就行。与操作系统平台无关。<br/><br>2.C/S客户端的计算机电脑配置要求较高。B/S客户端的计算机电脑配置要求较低。<br/><br>3.C/S每一个客户端都必须安装和配置软件,客户端不必安装，使用浏览器访问，易推广。B/S最大的优点就是可以在任何地方进行操作而不用安装任何专门的软件。<br/><br>4.C/S每一个客户端都要升级程序。可以采用自动升级。BS客户端不必安装及维护。<br/><br>5.C/S一般面向相对固定的用户群，程序更加注重流程，它可以对权限进行多层次校验，提供了更安全的存取模式，对信息安全的控制能力很强。一般高度机密的信息系统采用C/S结构适宜。<br/></p>
<h2 id="1-50-事务有哪些特性"><a href="#1-50-事务有哪些特性" class="headerlink" title="1.50.事务有哪些特性"></a>1.50.事务有哪些特性</h2><p>事务的特性:ACID<br/><br>A - 原子性 Atomic<br/><br>   数据操作的最小单元是事务，而不是SQL语句 <br/><br/><br>C - 一致性 Consistency<br/><br>转账前 a+b = 100<br/><br>转帐后 a+b = 100<br/><br/><br>I - 隔离性 Isolation<br/><br>一个事物进行中时，另一事物不能操作数据<br/><br>D - 持久性 Durancy<br/><br>事务没有提交之前，数据操作只保存在日志文件中<br/><br>提交事务之后，数据持久生效<br/></p>
]]></content>
      <categories>
        <category>面试题</category>
      </categories>
      <tags>
        <tag>web</tag>
      </tags>
  </entry>
  <entry>
    <title>面试题目 项目</title>
    <url>/2020/04/08/%E9%9D%A2%E8%AF%95%E9%A2%98%E7%9B%AE%E9%A1%B9%E7%9B%AE/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="\assets\js\Meting.min.js"></script><h1 id="面试题目-项目"><a href="#面试题目-项目" class="headerlink" title="面试题目 项目"></a>面试题目 项目</h1><h2 id="什么是Redis？"><a href="#什么是Redis？" class="headerlink" title="什么是Redis？"></a>什么是Redis？</h2><p>   Redis是一个key-value存储系统。和Memcached类似，它支持存储的value类型相对更多，包括string(字符串)、list(链表)、set(集合)、zset(sorted set –有序集合)和hash（哈希类型）。这些数据类型都支持push/pop、add/remove及取交集并集和差集及更丰富的操作，而且这些操作都是原子性的。在此基础上，redis支持各种不同方式的排序。与memcached一样，为了保证效率，数据都是缓存在内存中。区别的是redis会周期性的把更新的数据写入磁盘或者把修改操作写入追加的记录文件，并且在此基础上实现了master-slave(主从)同步。<br/><br>   Redis 是一个高性能的key-value数据库。 redis的出现，很大程度补偿了memcached这类key/value存储的不足，在部分场合可以对关系数据库起到很好的补充作用。它提供了Java，C/C++，C#，PHP，JavaScript，Perl，Object-C，Python，Ruby，Erlang等客户端，使用很方便。<br/><br>   Redis支持主从同步。数据可以从主服务器向任意数量的从服务器上同步，从服务器可以是关联其他从服务器的主服务器。这使得Redis可执行单层树复制。存盘可以有意无意的对数据进行写操作。由于完全实现了发布/订阅机制，使得从数据库在任何地方同步树时，可订阅一个频道并接收主服务器完整的消息发布记录。同步对读取操作的可扩展性和数据冗余很有帮助。<br/><br>   可以充当缓存、队列等作用。</p>
<h2 id="2-Redis两种持久化的方式的比较。"><a href="#2-Redis两种持久化的方式的比较。" class="headerlink" title="2 Redis两种持久化的方式的比较。"></a>2 Redis两种持久化的方式的比较。</h2><p>答：Redis的持久化方式有两种，AOF和RDB。<br/><br>   RDB持久化方式能够在指定的时间间隔能对你的数据进行快照存储.<br/><br>   AOF持久化方式记录每次对服务器写的操作,当服务器重启的时候会重新执行这些命令来恢复原始的数据,AOF命令以redis协议追加保存每次写的操作到文件末尾.Redis还能对AOF文件进行后台重写,使得AOF文件的体积不至于过大。<br/><br>两种区别就是，一个是持续的用日志记录写操作，crash（崩溃）后利用日志恢复；一个是平时写操作的时候不触发写，只有手动提交save命令，或者是shutdown关闭命令时，才触发备份操作。<br/><br>选择的标准，就是看系统是愿意牺牲一些性能，换取更高的缓存一致性（aof），还是愿意写操作频繁的时候，不启用备份来换取更高的性能，待手动   运行save的时候，再做备份（rdb）。rdb这个就更有些 最终一致性（eventually consistent）的意思了。<br/></p>
<h2 id="3、说说Redis哈希槽的概念？"><a href="#3、说说Redis哈希槽的概念？" class="headerlink" title="3、说说Redis哈希槽的概念？"></a>3、说说Redis哈希槽的概念？</h2><p>   Redis集群没有使用一致性hash,而是引入了哈希槽的概念，Redis集群有16384个哈希槽，每个key通过CRC16校验后对16384取模来决定放置哪个槽，集群的每个节点负责一部分hash槽。</p>
<h2 id="4、Redis集群最大节点个数是多少？"><a href="#4、Redis集群最大节点个数是多少？" class="headerlink" title="4、Redis集群最大节点个数是多少？"></a>4、Redis集群最大节点个数是多少？</h2><p>16384个</p>
<h2 id="5、Redis中的管道有什么用？"><a href="#5、Redis中的管道有什么用？" class="headerlink" title="5、Redis中的管道有什么用？"></a>5、Redis中的管道有什么用？</h2><p>   一次请求/响应服务器能实现处理新的请求即使旧的请求还未被响应。这样就可以将多个命令发送到服务器，而不用等待回复，最后在一个步骤中读取该答复。<br/><br>   这就是管道（pipelining），是一种几十年来广泛使用的技术。例如许多POP3协议已经实现支持这个功能，大大加快了从服务器下载新邮件的过程。</p>
<h2 id="6、怎么理解Redis事务？"><a href="#6、怎么理解Redis事务？" class="headerlink" title="6、怎么理解Redis事务？"></a>6、怎么理解Redis事务？</h2><p>   事务是一个单独的隔离操作：事务中的所有命令都会序列化、按顺序地执行。事务在执行的过程中，不会被其他客户端发送来的命令请求所打断。<br/><br>   事务是一个原子操作：事务中的命令要么全部被执行，要么全部都不执行。</p>
<h2 id="7、Redis事务相关的命令有哪几个？"><a href="#7、Redis事务相关的命令有哪几个？" class="headerlink" title="7、Redis事务相关的命令有哪几个？"></a>7、Redis事务相关的命令有哪几个？</h2><p>MULTI、EXEC、DISCARD、WATCH</p>
<h2 id="8、Redis如何做内存优化？"><a href="#8、Redis如何做内存优化？" class="headerlink" title="8、Redis如何做内存优化？"></a>8、Redis如何做内存优化？</h2><p>   尽可能使用散列表（hashes），散列表（是说散列表里面存储的数少）使用的内存非常小，所以你应该尽可能的将你的数据模型抽象到一个散列表里面。比如你的web系统中有一个用户对象，不要为这个用户的名称，姓氏，邮箱，密码设置单独的key,而是应该把这个用户的所有信息存储到一张散列表里面.</p>
<h2 id="9-什么是RPC？"><a href="#9-什么是RPC？" class="headerlink" title="9 什么是RPC？"></a>9 什么是RPC？</h2><p>   答案：RPC（Remote Procedure Call）—远程过程调用，它是一种通过网络从远程计算机程序上请求服务，而不需要了解底层网络技术的协议。RPC协议假定某些传输协议的存在，如TCP或UDP，为通信程序之间携带信息数据。在OSI网络通信模型中，RPC跨越了传输层和应用层。RPC使得开发包括网络分布式多程序在内的应用程序更加容易。</p>
<h2 id="10-HttpClient与JSONP区别？"><a href="#10-HttpClient与JSONP区别？" class="headerlink" title="10 HttpClient与JSONP区别？"></a>10 HttpClient与JSONP区别？</h2><p>1发送请求的位置不同.<br/><br>   JSONP:浏览器解析js发出的请求<br/><br>   HttpClient:是业务层java模拟发出Http请求<br/><br>2返回值的格式不同<br/><br>   JSONP:返回数据时必须要有回调函数.<br/><br>   HttpClient:直接返回JSON数据即可.<br/><br>3代码的层级不同<br/><br>   JSONP:代码层级一般3层<br/><br/><br>   HttpClient:一般5层.<br/></p>
<p><img src= data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs= data-src="http://182.92.171.224/upload/20191124_15010765.png" alt=""></p>
<h2 id="11-什么是nginx？"><a href="#11-什么是nginx？" class="headerlink" title="11 什么是nginx？"></a>11 什么是nginx？</h2><p>   答：Nginx (engine x) 是一个高性能的HTTP和反向代理服务。<br/><br>   反向代理方式是指以代理服务器来接收Interrnet上的连接请求，然后将请求转发给内部网络上的服务器；并将从服务器上得到的结果返回给Internet上请求连接的客户端，此时代理服务器对外就表现为一个服务器。<br/><br>   当一个代理服务器能够代理外部网络上的主机，访问内部网络时，这种代理服务的方式称为反向代理服务，当做服务器的替身，这样，代理服务器就在安全数据库和可能的恶意攻击之间提供了又一道屏障。<br/><br>   防火墙通路只允许代理服务器有权进行访问。<br/><br>   可以使用多个代理服务器来处理对一个高用量内容服务器的请求，这样做的好处是内容服务器可以处理更高的负载，并且比其独自工作时更有效率。<br/><br>   配置文件主要由四部分组成：main(全区设置)，server(主机配置)，upstream(负载均衡服务器设置)，和location(URL匹配特定位置设置)。<br/><br>   有1全局变量2事件配置3 http参数4虚拟主机基本设置5 Nignx状态监控6反向代理7负载均衡8 URL重写9 IP限制<br/><br>   主要了解虚拟主机配置，反向代理，负载均衡，url重新<br/></p>
]]></content>
      <categories>
        <category>面试题</category>
      </categories>
      <tags>
        <tag>java</tag>
      </tags>
  </entry>
</search>
